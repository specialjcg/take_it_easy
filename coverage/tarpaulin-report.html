<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: white;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
  counter-reset: line;
  display: flex;
  flex-direction: column;
}

.code-line::before {
    content: counter(line);
    margin-right: 10px;
}
.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
  counter-increment: line;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","build.rs"],"content":"fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    tonic_build::configure()\n        .build_server(true)\n        .build_client(true)\n        .out_dir(\"src/generated\")\n        .compile(\n            \u0026[\n                \"protos/common.proto\",\n                \"protos/session_service.proto\",\n                \"protos/game_service.proto\",\n            ],\n            \u0026[\"protos\"],\n        )?;\n    Ok(())\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","build.rs"],"content":"fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    // Configuration de tonic-build\n    tonic_build::configure()\n        .build_server(true)\n        .build_client(true)\n        .compile(\n            \u0026[\"protos/session_manager.protos\"],\n            \u0026[\"protos/\"],\n        )?;\n\n    // Alternative si vous voulez plus de contr√¥le :\n    /*\n    tonic_build::configure()\n        .out_dir(\"src/generated\")  // R√©pertoire de sortie personnalis√©\n        .build_server(true)\n        .build_client(true)\n        .compile(\n            \u0026[\"protos/session_manager.protos\"],\n            \u0026[\"protos/\"],\n        )?;\n    */\n\n    Ok(())\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","data","append_result.rs"],"content":"use std::fs::OpenOptions;\nuse std::io::{BufWriter, Write};\nuse chrono::Utc;\n\npub fn append_to_results_file(file_path: \u0026str, avg_score: f64) {\n    let timestamp = Utc::now().to_rfc3339();\n    let result_line = format!(\"{},{:.2}\\n\", timestamp, avg_score);\n\n    let file = OpenOptions::new()\n        .create(true)\n        .append(true)\n        .open(file_path)\n        .expect(\"Unable to open results file\");\n    let mut writer = BufWriter::new(file);\n    writer\n        .write_all(result_line.as_bytes())\n        .expect(\"Unable to write to results file\");\n}\n","traces":[{"line":5,"address":[5000928,4999984,5000934],"length":1,"stats":{"Line":0}},{"line":6,"address":[5000023],"length":1,"stats":{"Line":0}},{"line":7,"address":[5000070,5000130],"length":1,"stats":{"Line":0}},{"line":9,"address":[5000537,5000601],"length":1,"stats":{"Line":0}},{"line":14,"address":[5000726],"length":1,"stats":{"Line":0}},{"line":15,"address":[5000812],"length":1,"stats":{"Line":0}},{"line":16,"address":[5000741],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":7},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","data","load_data.rs"],"content":"use std::path::Path;\nuse tch::Tensor;\nuse crate::mcts::mcts_result::MCTSResult;\n\npub fn load_game_data(file_path: \u0026str) -\u003e Vec\u003cMCTSResult\u003e {\n    // Paths for the .pt files\n    let states_path = format!(\"{}_states.pt\", file_path);\n    let positions_path = format!(\"{}_positions.pt\", file_path);\n    let subscores_path = format!(\"{}_subscores.pt\", file_path);\n\n    // Check if all files exist\n    if !Path::new(\u0026states_path).exists() {\n        println!(\n            \"‚ö†Ô∏è  Warning: '{}' not found. Returning empty dataset.\",\n            states_path\n        );\n        return Vec::new();\n    }\n    if !Path::new(\u0026positions_path).exists() {\n        println!(\n            \"‚ö†Ô∏è  Warning: '{}' not found. Returning empty dataset.\",\n            positions_path\n        );\n        return Vec::new();\n    }\n    if !Path::new(\u0026subscores_path).exists() {\n        println!(\n            \"‚ö†Ô∏è  Warning: '{}' not found. Returning empty dataset.\",\n            subscores_path\n        );\n        return Vec::new();\n    }\n\n    println!(\"üöÄ Loading game data from .pt files...\");\n\n    // Load the saved tensors\n    let state_tensor = Tensor::load(states_path).expect(\"Failed to load states\");\n    let position_tensor = Tensor::load(positions_path).expect(\"Failed to load positions\");\n    let subscore_tensor = Tensor::load(subscores_path).expect(\"Failed to load subscores\");\n\n    // Convert them back into MCTSResult objects\n    let mut data = Vec::new();\n    for i in 0..state_tensor.size()[0] {\n        data.push(MCTSResult {\n            board_tensor: state_tensor.get(i),\n            best_position: position_tensor.get(i).int64_value(\u0026[]) as usize,\n            subscore: subscore_tensor.get(i).double_value(\u0026[]),\n        });\n    }\n    println!(\"‚úÖ Loaded {} game records.\", data.len());\n    data\n}","traces":[{"line":5,"address":[5553680,5556626,5556576],"length":1,"stats":{"Line":0}},{"line":7,"address":[5553719],"length":1,"stats":{"Line":0}},{"line":8,"address":[5553926,5553971],"length":1,"stats":{"Line":0}},{"line":9,"address":[5554147,5554079],"length":1,"stats":{"Line":0}},{"line":12,"address":[5554255,5554347],"length":1,"stats":{"Line":0}},{"line":13,"address":[5554374,5554436],"length":1,"stats":{"Line":0}},{"line":17,"address":[5554513],"length":1,"stats":{"Line":0}},{"line":19,"address":[5554401,5554560],"length":1,"stats":{"Line":0}},{"line":20,"address":[5554649,5554587],"length":1,"stats":{"Line":0}},{"line":24,"address":[5554726],"length":1,"stats":{"Line":0}},{"line":26,"address":[5554614,5554754],"length":1,"stats":{"Line":0}},{"line":27,"address":[5554831,5554775],"length":1,"stats":{"Line":0}},{"line":31,"address":[5554908],"length":1,"stats":{"Line":0}},{"line":34,"address":[5554802,5554993],"length":1,"stats":{"Line":0}},{"line":37,"address":[5555012],"length":1,"stats":{"Line":0}},{"line":38,"address":[5555127,5555234],"length":1,"stats":{"Line":0}},{"line":39,"address":[5555393,5555286],"length":1,"stats":{"Line":0}},{"line":42,"address":[5555453],"length":1,"stats":{"Line":0}},{"line":43,"address":[5555649,5555568,5555504],"length":1,"stats":{"Line":0}},{"line":44,"address":[5556387],"length":1,"stats":{"Line":0}},{"line":45,"address":[5556095,5555793],"length":1,"stats":{"Line":0}},{"line":46,"address":[5556103,5556176],"length":1,"stats":{"Line":0}},{"line":47,"address":[5556266],"length":1,"stats":{"Line":0}},{"line":50,"address":[5555847],"length":1,"stats":{"Line":0}},{"line":51,"address":[5555976],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":25},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","data","mod.rs"],"content":"pub mod load_data;\npub mod save_data;\npub mod append_result;","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","data","save_data.rs"],"content":"use tch::Tensor;\nuse crate::mcts::mcts_result::MCTSResult;\n\npub fn save_game_data(file_path: \u0026str, game_data: Vec\u003cMCTSResult\u003e) {\n    println!(\"üöÄ Saving game data to .pt files...\");\n\n    let mut tensors = vec![];\n    let mut positions = vec![];\n    let mut subscores = vec![];\n\n    for result in game_data {\n        tensors.push(result.board_tensor.shallow_clone());\n        positions.push(result.best_position as i64);\n        subscores.push(result.subscore as f32);\n    }\n\n    // Cr√©ation des nouveaux tensors\n    let state_tensor = Tensor::stack(\u0026tensors, 0);\n    let position_tensor = Tensor::from_slice(\u0026positions).view([-1, 1]);\n    let subscore_tensor = Tensor::from_slice(\u0026subscores).view([-1, 1]);\n\n    // üîÑ Append logic: charger les anciens tensors s'ils existent\n    let combined_states = if let Ok(prev) = Tensor::load(format!(\"{}_states.pt\", file_path)) {\n        Tensor::cat(\u0026[prev, state_tensor], 0)\n    } else {\n        state_tensor\n    };\n\n    let combined_positions = if let Ok(prev) = Tensor::load(format!(\"{}_positions.pt\", file_path)) {\n        Tensor::cat(\u0026[prev, position_tensor], 0)\n    } else {\n        position_tensor\n    };\n\n    let combined_subscores = if let Ok(prev) = Tensor::load(format!(\"{}_subscores.pt\", file_path)) {\n        Tensor::cat(\u0026[prev, subscore_tensor], 0)\n    } else {\n        subscore_tensor\n    };\n\n    // üîÑ Sauvegarde des tensors concat√©n√©s\n    if let Err(e) = combined_states.save(format!(\"{}_states.pt\", file_path)) {    }\n    if let Err(e) = combined_positions.save(format!(\"{}_positions.pt\", file_path)) {    }\n    if let Err(e) = combined_subscores.save(format!(\"{}_subscores.pt\", file_path)) {    }}\n","traces":[{"line":4,"address":[4307008,4311927,4308761],"length":1,"stats":{"Line":0}},{"line":5,"address":[4307039,4307194],"length":1,"stats":{"Line":0}},{"line":7,"address":[4307213],"length":1,"stats":{"Line":0}},{"line":8,"address":[4307232],"length":1,"stats":{"Line":0}},{"line":9,"address":[4307300],"length":1,"stats":{"Line":0}},{"line":11,"address":[4307356,4307578,4307451],"length":1,"stats":{"Line":0}},{"line":12,"address":[4307624,4311814],"length":1,"stats":{"Line":0}},{"line":13,"address":[4311840],"length":1,"stats":{"Line":0}},{"line":14,"address":[4311874],"length":1,"stats":{"Line":0}},{"line":18,"address":[4307666],"length":1,"stats":{"Line":0}},{"line":19,"address":[4307826,4307746],"length":1,"stats":{"Line":0}},{"line":20,"address":[4308040],"length":1,"stats":{"Line":0}},{"line":23,"address":[4308492,4308273],"length":1,"stats":{"Line":0}},{"line":24,"address":[4308521,4308632],"length":1,"stats":{"Line":0}},{"line":26,"address":[4308468],"length":1,"stats":{"Line":0}},{"line":29,"address":[4308826,4308916,4309108],"length":1,"stats":{"Line":0}},{"line":30,"address":[4309248,4309137],"length":1,"stats":{"Line":0}},{"line":32,"address":[4309084],"length":1,"stats":{"Line":0}},{"line":35,"address":[4309526,4309718,4309436],"length":1,"stats":{"Line":0}},{"line":36,"address":[4309858,4309747],"length":1,"stats":{"Line":0}},{"line":38,"address":[4309694],"length":1,"stats":{"Line":0}},{"line":42,"address":[4310485,4310136,4310046],"length":1,"stats":{"Line":0}},{"line":43,"address":[4310458,4310504,4310853],"length":1,"stats":{"Line":0}},{"line":44,"address":[4310826,4309482,4307153,4307775,4310872,4307991,4311948,4310092,4307307,4308232,4307251,4307410,4308872],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":24},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","game","create_deck.rs"],"content":"pub(crate) use crate::game::deck::Deck;\nuse crate::game::tile::Tile;\n\npub fn create_deck() -\u003e Deck {\n    let tiles = vec![\n        new_tiles(1, 2, 3),\n        new_tiles(1, 6, 8),\n        new_tiles(1, 7, 3),\n        new_tiles(1, 6, 3),\n        new_tiles(1, 2, 8),\n        new_tiles(1, 2, 4),\n        new_tiles(1, 7, 4),\n        new_tiles(1, 6, 4),\n        new_tiles(1, 7, 8),\n        new_tiles(5, 2, 3),\n        new_tiles(5, 6, 8),\n        new_tiles(5, 7, 3),\n        new_tiles(5, 6, 3),\n        new_tiles(5, 2, 8),\n        new_tiles(5, 2, 4),\n        new_tiles(5, 7, 4),\n        new_tiles(5, 6, 4),\n        new_tiles(5, 7, 8),\n        new_tiles(9, 2, 3),\n        new_tiles(9, 6, 8),\n        new_tiles(9, 7, 3),\n        new_tiles(9, 6, 3),\n        new_tiles(9, 2, 8),\n        new_tiles(9, 2, 4),\n        new_tiles(9, 7, 4),\n        new_tiles(9, 6, 4),\n        new_tiles(9, 7, 8),\n    ];\n\n   Deck { tiles}\n}\n\npub(crate) fn new_tiles(x: i32, y: i32, z: i32) -\u003e Tile {\n    Tile(x, y, z)\n}\n#[cfg(test)]\nmod tests {\n    use crate::game::create_deck::create_deck;\n    use crate::game::tile::Tile;\n\n    #[test]\n    fn test_create_shuffle_deck() {\n        // Create the shuffle deck\n        let deck = create_deck();\n\n        // Check that the deck has exactly 27 tiles\n        assert_eq!(\n            deck.tiles.len(),\n            27,\n            \"The deck should contain exactly 27 tiles, but found {}.\",\n            deck.tiles.len()\n        );\n\n        // Verify that specific tiles exist in the deck\n        let expected_tile = Tile(1, 2, 3);\n        assert!(\n            deck.tiles.contains(\u0026expected_tile),\n            \"The deck should contain the tile {:?}.\",\n            expected_tile\n        );\n\n        let another_tile = Tile(9, 7, 8);\n        assert!(\n            deck.tiles.contains(\u0026another_tile),\n            \"The deck should contain the tile {:?}.\",\n            another_tile\n        );\n    }\n\n    #[test]\n    fn test_new_tiles() {\n        // Create a tile using new_tiles\n        let tile = Tile(1, 2, 3);\n\n        // Verify that the tile has the correct values\n        assert_eq!(tile.0, 1, \"The first value of the tile should be 1.\");\n        assert_eq!(tile.1, 2, \"The second value of the tile should be 2.\");\n        assert_eq!(tile.2, 3, \"The third value of the tile should be 3.\");\n    }\n}\n","traces":[{"line":4,"address":[5330144,5331825,5331831],"length":1,"stats":{"Line":1}},{"line":5,"address":[5331812,5331013,5330171,5330213],"length":1,"stats":{"Line":2}},{"line":6,"address":[5330201],"length":1,"stats":{"Line":1}},{"line":7,"address":[5330265],"length":1,"stats":{"Line":1}},{"line":8,"address":[5330292],"length":1,"stats":{"Line":1}},{"line":9,"address":[5330319],"length":1,"stats":{"Line":1}},{"line":10,"address":[5330346],"length":1,"stats":{"Line":1}},{"line":11,"address":[5330376],"length":1,"stats":{"Line":1}},{"line":12,"address":[5330406],"length":1,"stats":{"Line":1}},{"line":13,"address":[5330436],"length":1,"stats":{"Line":1}},{"line":14,"address":[5330466],"length":1,"stats":{"Line":1}},{"line":15,"address":[5330496],"length":1,"stats":{"Line":1}},{"line":16,"address":[5330526],"length":1,"stats":{"Line":1}},{"line":17,"address":[5330556],"length":1,"stats":{"Line":1}},{"line":18,"address":[5330586],"length":1,"stats":{"Line":1}},{"line":19,"address":[5330616],"length":1,"stats":{"Line":1}},{"line":20,"address":[5330646],"length":1,"stats":{"Line":1}},{"line":21,"address":[5330676],"length":1,"stats":{"Line":1}},{"line":22,"address":[5330706],"length":1,"stats":{"Line":1}},{"line":23,"address":[5330736],"length":1,"stats":{"Line":1}},{"line":24,"address":[5330766],"length":1,"stats":{"Line":1}},{"line":25,"address":[5330796],"length":1,"stats":{"Line":1}},{"line":26,"address":[5330826],"length":1,"stats":{"Line":1}},{"line":27,"address":[5330856],"length":1,"stats":{"Line":1}},{"line":28,"address":[5330886],"length":1,"stats":{"Line":1}},{"line":29,"address":[5330916],"length":1,"stats":{"Line":1}},{"line":30,"address":[5330946],"length":1,"stats":{"Line":1}},{"line":31,"address":[5330976],"length":1,"stats":{"Line":1}},{"line":32,"address":[5331006],"length":1,"stats":{"Line":1}},{"line":38,"address":[5331856],"length":1,"stats":{"Line":1}},{"line":39,"address":[5331871],"length":1,"stats":{"Line":1}}],"covered":31,"coverable":31},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","game","deck.rs"],"content":"use serde::{Deserialize, Serialize};\nuse crate::game::tile::Tile;\n\n#[derive(Debug, Clone, PartialEq,Serialize,Deserialize)]\npub struct Deck{\n    pub(crate) tiles: Vec\u003cTile\u003e,\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","game","game_state.rs"],"content":"use crate::game::deck::Deck;\nuse crate::game::plateau::Plateau;\n\n#[derive(Debug, Clone, PartialEq)]\npub struct GameState {\n    pub plateau: Plateau,\n    pub deck: Deck,\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","game","get_legal_moves.rs"],"content":"use crate::game::plateau::Plateau;\nuse crate::game::tile::Tile;\n\npub fn get_legal_moves(plateau: Plateau) -\u003e Vec\u003cusize\u003e {\n    plateau\n        .tiles\n        .iter()\n        .enumerate()\n        .filter_map(|(i, tile)| {\n            if *tile == Tile(0, 0, 0) {\n                Some(i)\n            } else {\n                None\n            }\n        })\n        .collect()\n}","traces":[{"line":4,"address":[3246429,3246256],"length":1,"stats":{"Line":1}},{"line":5,"address":[3246283,3246338],"length":1,"stats":{"Line":2}},{"line":9,"address":[5106339,5106304],"length":1,"stats":{"Line":2}},{"line":10,"address":[5106374,5106349],"length":1,"stats":{"Line":2}},{"line":11,"address":[5106381],"length":1,"stats":{"Line":1}},{"line":13,"address":[5106365],"length":1,"stats":{"Line":1}}],"covered":6,"coverable":6},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","game","mod.rs"],"content":"pub mod deck;\npub mod plateau;\npub mod game_state;\npub mod tile;\npub mod create_deck;\npub mod remove_tile_from_deck;\npub mod plateau_is_full;\npub mod get_legal_moves;\npub mod simulate_game;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","game","plateau.rs"],"content":"use serde::{Deserialize, Serialize};\nuse crate::game::tile::Tile;\n\n#[derive(Debug, Clone, PartialEq,Serialize,Deserialize)]\npub(crate) struct Plateau{\n    pub(crate) tiles: Vec\u003cTile\u003e,\n}\n\n\npub(crate) fn create_plateau_empty() -\u003e Plateau {\n    Plateau {\n        tiles: vec![Tile(0, 0, 0); 19],\n    }\n}\n","traces":[{"line":10,"address":[3562624],"length":1,"stats":{"Line":1}},{"line":12,"address":[3562637],"length":1,"stats":{"Line":1}}],"covered":2,"coverable":2},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","game","plateau_is_full.rs"],"content":"use crate::game::plateau::Plateau;\nuse crate::game::tile::Tile;\n\npub fn is_plateau_full(plateau: \u0026Plateau) -\u003e bool {\n    plateau.tiles.iter().all(|tile| *tile != Tile(0, 0, 0))\n}","traces":[{"line":4,"address":[4734608],"length":1,"stats":{"Line":1}},{"line":5,"address":[4293273,4293248],"length":1,"stats":{"Line":3}}],"covered":2,"coverable":2},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","game","remove_tile_from_deck.rs"],"content":"use crate::game::deck::Deck;\nuse crate::game::tile::Tile;\n\n// pub(crate) fn replace_tile_in_deck(deck: \u0026Deck, tile_to_replace: \u0026Tile) -\u003e Deck {\n//     // Replace the specified tile with (0, 0, 0)\n//     let new_tiles: Vec\u003cTile\u003e = deck\n//         .tiles\n//         .iter()\n//         .map(|tile| {\n//             if tile == tile_to_replace {\n//                 Tile(0, 0, 0) // Replace the tile\n//             } else {\n//                 *tile // Keep the original tile\n//             }\n//         })\n//         .collect();\n//\n//     Deck { tiles: new_tiles } // Return the new deck with replaced tiles\n// }\npub(crate) fn replace_tile_in_deck(deck: \u0026Deck, tile_to_replace: \u0026Tile) -\u003e Deck {\n    let new_tiles: Vec\u003cTile\u003e = deck\n        .tiles\n        .iter()\n        .map(|tile| {\n            if tile == tile_to_replace {\n                Tile(0, 0, 0) // Replace the tile\n            } else {\n                *tile // Keep the original tile\n            }\n        })\n        .collect();\n\n    Deck { tiles: new_tiles } // Return the new deck with replaced tiles\n}\n\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_remove_tile_from_deck() {\n        // Create a sample deck\n        let deck = Deck {\n            tiles: vec![\n                Tile(1, 2, 3),\n                Tile(4, 5, 6),\n                Tile(7, 8, 9),\n            ],\n        };\n\n        // Define the tile to remove\n        let tile_to_remove = Tile(4, 5, 6);\n\n        // Remove the tile from the deck\n        let updated_deck = replace_tile_in_deck(\u0026deck, \u0026tile_to_remove);\n\n        // Ensure the tile is removed\n        assert!(!updated_deck.tiles.contains(\u0026tile_to_remove));\n\n        // Ensure other tiles are still present\n        assert!(updated_deck.tiles.contains(\u0026Tile(1, 2, 3)));\n        assert!(updated_deck.tiles.contains(\u0026Tile(7, 8, 9)));\n    }\n\n    #[test]\n    fn test_remove_tile_not_in_deck() {\n        // Create a sample deck\n        let deck = Deck {\n            tiles: vec![\n                Tile(1, 2, 3),\n                Tile(4, 5, 6),\n                Tile(7, 8, 9),\n            ],\n        };\n\n        // Define a tile that doesn't exist in the deck\n        let tile_to_remove = Tile(0, 0, 0);\n\n        // Remove the tile\n        let updated_deck = replace_tile_in_deck(\u0026deck, \u0026tile_to_remove);\n\n        // Ensure the deck size remains unchanged\n        assert_eq!(updated_deck.tiles.len(), 3);\n\n        // Ensure all original tiles are still present\n        assert!(updated_deck.tiles.contains(\u0026Tile(1, 2, 3)));\n        assert!(updated_deck.tiles.contains(\u0026Tile(4, 5, 6)));\n        assert!(updated_deck.tiles.contains(\u0026Tile(7, 8, 9)));\n    }\n\n    #[test]\n    fn test_replace_tile_in_deck() {\n        // Create a sample deck\n        let deck = Deck {\n            tiles: vec![\n                Tile(1, 2, 3),\n                Tile(4, 5, 6),\n                Tile(7, 8, 9),\n            ],\n        };\n\n        // Define the tile to replace\n        let tile_to_replace = Tile(4, 5, 6);\n\n        // Replace the tile in the deck\n        let updated_deck = replace_tile_in_deck(\u0026deck, \u0026tile_to_replace);\n\n        // Ensure the tile is replaced with (0, 0, 0)\n        assert!(updated_deck.tiles.contains(\u0026Tile(0, 0, 0)));\n\n        // Ensure other tiles are still present\n        assert!(updated_deck.tiles.contains(\u0026Tile(1, 2, 3)));\n        assert!(updated_deck.tiles.contains(\u0026Tile(7, 8, 9)));\n\n        // Ensure the replaced tile is no longer present\n        assert!(!updated_deck.tiles.contains(\u0026tile_to_replace));\n    }\n\n    #[test]\n    fn test_replace_tile_not_in_deck() {\n        // Create a sample deck\n        let deck = Deck {\n            tiles: vec![\n                Tile(1, 2, 3),\n                Tile(4, 5, 6),\n                Tile(7, 8, 9),\n            ],\n        };\n\n        // Define a tile that doesn't exist in the deck\n        let tile_to_replace = Tile(0, 0, 0);\n\n        // Replace the tile\n        let updated_deck = replace_tile_in_deck(\u0026deck, \u0026tile_to_replace);\n\n        // Ensure the deck size remains unchanged\n        assert_eq!(updated_deck.tiles.len(), 3);\n\n        // Ensure all original tiles are still present\n        assert!(updated_deck.tiles.contains(\u0026Tile(1, 2, 3)));\n        assert!(updated_deck.tiles.contains(\u0026Tile(4, 5, 6)));\n        assert!(updated_deck.tiles.contains(\u0026Tile(7, 8, 9)));\n\n        // Ensure (0, 0, 0) is not added unless it replaces something\n        assert_eq!(\n            updated_deck.tiles.iter().filter(|\u0026\u0026tile| tile == Tile(0, 0, 0)).count(),\n            0\n        );\n    }\n}\n","traces":[{"line":20,"address":[3527744],"length":1,"stats":{"Line":1}},{"line":21,"address":[3527779],"length":1,"stats":{"Line":1}},{"line":24,"address":[4551488],"length":1,"stats":{"Line":1}},{"line":25,"address":[4551551,4551512],"length":1,"stats":{"Line":7}},{"line":26,"address":[4551558],"length":1,"stats":{"Line":1}},{"line":28,"address":[4551534],"length":1,"stats":{"Line":1}}],"covered":6,"coverable":6},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","game","simulate_game.rs"],"content":"use rand::Rng;\nuse crate::game::deck::Deck;\nuse crate::game::get_legal_moves::get_legal_moves;\nuse crate::game::plateau::Plateau;\nuse crate::game::plateau_is_full::is_plateau_full;\nuse crate::game::tile::Tile;\nuse crate::scoring::scoring::result;\n\npub fn simulate_games(plateau: Plateau, deck: Deck) -\u003e i32 {\n    let mut simulated_plateau = plateau.clone();\n    let simulated_deck = deck.clone();\n    let mut legal_moves = get_legal_moves(simulated_plateau.clone());\n\n    // Filter out invalid tiles (0, 0, 0)\n    let mut valid_tiles: Vec\u003cTile\u003e = simulated_deck\n        .tiles\n        .iter()\n        .cloned()\n        .filter(|tile| *tile != Tile(0, 0, 0))\n        .collect();\n\n    let mut rng = rand::rng(); // Fixed: Use new API\n\n    while !is_plateau_full(\u0026simulated_plateau) {\n        if legal_moves.is_empty() || valid_tiles.is_empty() {\n            break;\n        }\n\n        // Fixed: Use new rand API\n        let position_index = rng.random_range(0..legal_moves.len());\n        let position = legal_moves.swap_remove(position_index); // Swap-remove for O(1) removal\n\n        let tile_index = rng.random_range(0..valid_tiles.len());\n        let chosen_tile = valid_tiles.swap_remove(tile_index); // Swap-remove for O(1) removal\n\n        // Place the chosen tile\n        simulated_plateau.tiles[position] = chosen_tile;\n    }\n\n    result(\u0026simulated_plateau) // Compute and return the result\n}","traces":[{"line":9,"address":[4729456,4730515],"length":1,"stats":{"Line":1}},{"line":10,"address":[4729493],"length":1,"stats":{"Line":1}},{"line":11,"address":[4729556],"length":1,"stats":{"Line":1}},{"line":12,"address":[4729676,4729616],"length":1,"stats":{"Line":2}},{"line":15,"address":[4729691,4729771],"length":1,"stats":{"Line":2}},{"line":19,"address":[5097705,5097680],"length":1,"stats":{"Line":2}},{"line":22,"address":[4729867,4729928],"length":1,"stats":{"Line":2}},{"line":24,"address":[4730000,4730350,4729944],"length":1,"stats":{"Line":3}},{"line":25,"address":[4730055,4730006],"length":1,"stats":{"Line":2}},{"line":30,"address":[4730090],"length":1,"stats":{"Line":1}},{"line":31,"address":[4730163],"length":1,"stats":{"Line":1}},{"line":33,"address":[4730208],"length":1,"stats":{"Line":1}},{"line":34,"address":[4730285],"length":1,"stats":{"Line":1}},{"line":37,"address":[4730297],"length":1,"stats":{"Line":1}},{"line":40,"address":[4730037],"length":1,"stats":{"Line":1}}],"covered":15,"coverable":15},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","game","tile.rs"],"content":"use serde::{Deserialize, Serialize};\n\n#[derive(Debug, Clone, PartialEq, Copy,Hash,Eq,Serialize,Deserialize)]\npub(crate) struct Tile(pub i32, pub i32, pub i32);","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","generated","lib.rs"],"content":"// src/generated/lib.rs - Point d'entr√©e pour les modules g√©n√©r√©s\n\n// Include the generated protobuf code\ninclude!(\"takeiteasygame.v1.rs\");","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","generated","mod.rs"],"content":"// src/generated/mod.rs - Module racine pour le code g√©n√©r√©\n\npub mod takeiteasygame {\n    pub mod v1 {\n        // Include the tonic-generated code\n        include!(\"takeiteasygame.v1.rs\");\n    }\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","generated","mod_manual.rs"],"content":"// src/generated/mod_manual.rs - Types temporaires avant g√©n√©ration compl√®te\n\npub mod takeiteasygame {\n    pub mod v1 {\n        use std::collections::HashMap;\n        use serde::{Deserialize, Serialize};\n        use tonic::{Request, Response, Status};\n\n        // ============================================================================\n        // TYPES DE BASE - COMPATIBLES AVEC VOTRE SYST√àME\n        // ============================================================================\n\n        #[derive(Clone, PartialEq, Debug, Serialize, Deserialize)]\n        pub struct Player {\n            pub id: String,\n            pub name: String,\n            pub score: i32,\n            pub is_ready: bool,\n            pub is_connected: bool,\n            pub joined_at: i64,\n        }\n\n        #[derive(Clone, PartialEq, Debug, Serialize, Deserialize)]\n        pub struct GameState {\n            pub session_id: String,\n            pub players: Vec\u003cPlayer\u003e,\n            pub current_player_id: String,\n            pub state: i32, // 0=WAITING, 1=IN_PROGRESS, 2=FINISHED\n            pub board_state: String, // JSON de TakeItEasyGameState\n            pub turn_number: i32,\n        }\n\n        #[derive(Clone, PartialEq, Debug, Serialize, Deserialize)]\n        pub struct Error {\n            pub code: String,\n            pub message: String,\n            pub details: HashMap\u003cString, String\u003e,\n        }\n\n        // ============================================================================\n        // MESSAGES DE SESSION\n        // ============================================================================\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct CreateSessionRequest {\n            pub player_name: String,\n            pub max_players: i32,\n            pub game_mode: String,\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct CreateSessionSuccess {\n            pub session_code: String,\n            pub session_id: String,\n            pub player_id: String,\n            pub player: Option\u003cPlayer\u003e,\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct CreateSessionResponse {\n            pub result: Option\u003ccreate_session_response::Result\u003e,\n        }\n\n        pub mod create_session_response {\n            use super::*;\n\n            #[derive(Clone, PartialEq, Debug)]\n            pub enum Result {\n                Success(CreateSessionSuccess),\n                Error(Error),\n            }\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct JoinSessionRequest {\n            pub session_code: String,\n            pub player_name: String,\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct JoinSessionSuccess {\n            pub session_id: String,\n            pub player_id: String,\n            pub game_state: Option\u003cGameState\u003e,\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct JoinSessionResponse {\n            pub result: Option\u003cjoin_session_response::Result\u003e,\n        }\n\n        pub mod join_session_response {\n            use super::*;\n\n            #[derive(Clone, PartialEq, Debug)]\n            pub enum Result {\n                Success(JoinSessionSuccess),\n                Error(Error),\n            }\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct SetReadyRequest {\n            pub session_id: String,\n            pub player_id: String,\n            pub ready: bool,\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct SetReadyResponse {\n            pub success: bool,\n            pub error: Option\u003cError\u003e,\n            pub game_started: bool,\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct GetSessionStateRequest {\n            pub session_id: String,\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct GetSessionStateResponse {\n            pub game_state: Option\u003cGameState\u003e,\n            pub error: Option\u003cError\u003e,\n        }\n\n        // ============================================================================\n        // MESSAGES DE JEU\n        // ============================================================================\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct MakeMoveRequest {\n            pub session_id: String,\n            pub player_id: String,\n            pub move_data: String,\n            pub timestamp: i64,\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct MakeMoveSuccess {\n            pub new_game_state: Option\u003cGameState\u003e,\n            pub mcts_response: String,\n            pub points_earned: i32,\n            pub is_game_over: bool,\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct MakeMoveResponse {\n            pub result: Option\u003cmake_move_response::Result\u003e,\n        }\n\n        pub mod make_move_response {\n            use super::*;\n\n            #[derive(Clone, PartialEq, Debug)]\n            pub enum Result {\n                Success(MakeMoveSuccess),\n                Error(Error),\n            }\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct GetAvailableMovesRequest {\n            pub session_id: String,\n            pub player_id: String,\n        }\n\n        #[derive(Clone, PartialEq, Debug)]\n        pub struct GetAvailableMovesResponse {\n            pub available_moves: Vec\u003cString\u003e,\n            pub error: Option\u003cError\u003e,\n        }\n\n        // ============================================================================\n        // TRAITS DE SERVICE - D√âFINITIONS MINIMALES\n        // ============================================================================\n\n        #[tonic::async_trait]\n        pub trait SessionService: Send + Sync + 'static {\n            async fn create_session(\n                \u0026self,\n                request: Request\u003cCreateSessionRequest\u003e,\n            ) -\u003e Result\u003cResponse\u003cCreateSessionResponse\u003e, Status\u003e;\n\n            async fn join_session(\n                \u0026self,\n                request: Request\u003cJoinSessionRequest\u003e,\n            ) -\u003e Result\u003cResponse\u003cJoinSessionResponse\u003e, Status\u003e;\n\n            async fn set_ready(\n                \u0026self,\n                request: Request\u003cSetReadyRequest\u003e,\n            ) -\u003e Result\u003cResponse\u003cSetReadyResponse\u003e, Status\u003e;\n\n            async fn get_session_state(\n                \u0026self,\n                request: Request\u003cGetSessionStateRequest\u003e,\n            ) -\u003e Result\u003cResponse\u003cGetSessionStateResponse\u003e, Status\u003e;\n        }\n\n        #[tonic::async_trait]\n        pub trait GameService: Send + Sync + 'static {\n            async fn make_move(\n                \u0026self,\n                request: Request\u003cMakeMoveRequest\u003e,\n            ) -\u003e Result\u003cResponse\u003cMakeMoveResponse\u003e, Status\u003e;\n\n            async fn get_available_moves(\n                \u0026self,\n                request: Request\u003cGetAvailableMovesRequest\u003e,\n            ) -\u003e Result\u003cResponse\u003cGetAvailableMovesResponse\u003e, Status\u003e;\n        }\n\n        // ============================================================================\n        // SERVEURS GRPC - IMPL√âMENTATION TEMPORAIRE SIMPLIFI√âE\n        // ============================================================================\n\n        pub mod session_service_server {\n            use super::*;\n            use std::sync::Arc;\n\n            #[derive(Clone)]\n            pub struct SessionServiceServer\u003cT\u003e {\n                inner: Arc\u003cT\u003e,\n            }\n\n            impl\u003cT\u003e SessionServiceServer\u003cT\u003e {\n                pub fn new(inner: T) -\u003e Self {\n                    Self {\n                        inner: Arc::new(inner),\n                    }\n                }\n            }\n\n            // Impl√©mentation minimale pour permettre la compilation\n            // Sera remplac√©e par tonic-build\n            use tonic::server::{NamedService, UnaryService};\n            use tonic::codegen::*;\n\n            impl\u003cT: SessionService\u003e NamedService for SessionServiceServer\u003cT\u003e {\n                const NAME: \u0026'static str = \"takeiteasygame.v1.SessionService\";\n            }\n\n            // Service trait sera impl√©ment√© automatiquement par tonic-build\n        }\n\n        pub mod game_service_server {\n            use super::*;\n            use std::sync::Arc;\n\n            #[derive(Clone)]\n            pub struct GameServiceServer\u003cT\u003e {\n                inner: Arc\u003cT\u003e,\n            }\n\n            impl\u003cT\u003e GameServiceServer\u003cT\u003e {\n                pub fn new(inner: T) -\u003e Self {\n                    Self {\n                        inner: Arc::new(inner),\n                    }\n                }\n            }\n\n            use tonic::server::NamedService;\n\n            impl\u003cT: GameService\u003e NamedService for GameServiceServer\u003cT\u003e {\n                const NAME: \u0026'static str = \"takeiteasygame.v1.GameService\";\n            }\n        }\n    }\n}","traces":[{"line":228,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":257,"address":[],"length":0,"stats":{"Line":0}},{"line":259,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":4},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","generated","takeiteasygame.training.v1.rs"],"content":"// This file is @generated by prost-build.\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct TrainingGameState {\n    /// URLs des images des tuiles\n    #[prost(string, repeated, tag = \"1\")]\n    pub plateau_tiles: ::prost::alloc::vec::Vec\u003c::prost::alloc::string::String\u003e,\n    /// URL de la prochaine tuile (ou null)\n    #[prost(string, tag = \"2\")]\n    pub next_tile: ::prost::alloc::string::String,\n    #[prost(int32, tag = \"3\")]\n    pub current_score: i32,\n    #[prost(int32, tag = \"4\")]\n    pub game_number: i32,\n    #[prost(int32, tag = \"5\")]\n    pub total_games: i32,\n    #[prost(bool, tag = \"6\")]\n    pub is_game_finished: bool,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct TrainingUpdate {\n    #[prost(oneof = \"training_update::UpdateType\", tags = \"1, 2, 3, 4, 5\")]\n    pub update_type: ::core::option::Option\u003ctraining_update::UpdateType\u003e,\n}\n/// Nested message and enum types in `TrainingUpdate`.\npub mod training_update {\n    #[allow(clippy::derive_partial_eq_without_eq)]\n    #[derive(Clone, PartialEq, ::prost::Oneof)]\n    pub enum UpdateType {\n        #[prost(message, tag = \"1\")]\n        GameState(super::GameStateUpdate),\n        #[prost(message, tag = \"2\")]\n        Score(super::ScoreUpdate),\n        #[prost(message, tag = \"3\")]\n        GameResult(super::GameResultUpdate),\n        #[prost(message, tag = \"4\")]\n        BatchResult(super::BatchResultUpdate),\n        #[prost(message, tag = \"5\")]\n        TrainingStats(super::TrainingStatsUpdate),\n    }\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GameStateUpdate {\n    #[prost(string, repeated, tag = \"1\")]\n    pub plateau_tiles: ::prost::alloc::vec::Vec\u003c::prost::alloc::string::String\u003e,\n    #[prost(string, tag = \"2\")]\n    pub next_tile: ::prost::alloc::string::String,\n    #[prost(int32, tag = \"3\")]\n    pub current_turn: i32,\n    #[prost(int32, tag = \"4\")]\n    pub total_turns: i32,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct ScoreUpdate {\n    #[prost(int32, tag = \"1\")]\n    pub current_score: i32,\n    #[prost(int32, tag = \"2\")]\n    pub game_number: i32,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GameResultUpdate {\n    #[prost(int32, tag = \"1\")]\n    pub final_score: i32,\n    #[prost(int32, tag = \"2\")]\n    pub game_number: i32,\n    #[prost(message, repeated, tag = \"3\")]\n    pub position_scores: ::prost::alloc::vec::Vec\u003cPositionScore\u003e,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct PositionScore {\n    #[prost(int32, tag = \"1\")]\n    pub position: i32,\n    #[prost(double, tag = \"2\")]\n    pub average_score: f64,\n    #[prost(int32, tag = \"3\")]\n    pub games_played: i32,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct BatchResultUpdate {\n    #[prost(int32, tag = \"1\")]\n    pub batch_number: i32,\n    #[prost(double, tag = \"2\")]\n    pub average_score: f64,\n    #[prost(int32, tag = \"3\")]\n    pub games_completed: i32,\n    #[prost(int32, tag = \"4\")]\n    pub total_games: i32,\n    #[prost(message, repeated, tag = \"5\")]\n    pub best_positions: ::prost::alloc::vec::Vec\u003cPositionScore\u003e,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct TrainingStatsUpdate {\n    #[prost(int32, tag = \"1\")]\n    pub total_games_played: i32,\n    #[prost(int32, tag = \"2\")]\n    pub total_score: i32,\n    #[prost(double, tag = \"3\")]\n    pub overall_average: f64,\n    #[prost(string, tag = \"4\")]\n    pub model_saved_path: ::prost::alloc::string::String,\n    #[prost(bool, tag = \"5\")]\n    pub evaluation_completed: bool,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct StartTrainingRequest {\n    #[prost(int32, tag = \"1\")]\n    pub num_games: i32,\n    #[prost(int32, tag = \"2\")]\n    pub num_simulations: i32,\n    #[prost(int32, tag = \"3\")]\n    pub evaluation_interval: i32,\n    /// Identifier le client pour le streaming\n    #[prost(string, tag = \"4\")]\n    pub client_id: ::prost::alloc::string::String,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct StartTrainingResponse {\n    #[prost(bool, tag = \"1\")]\n    pub success: bool,\n    #[prost(string, tag = \"2\")]\n    pub message: ::prost::alloc::string::String,\n    #[prost(string, tag = \"3\")]\n    pub training_session_id: ::prost::alloc::string::String,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct StopTrainingRequest {\n    #[prost(string, tag = \"1\")]\n    pub training_session_id: ::prost::alloc::string::String,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct StopTrainingResponse {\n    #[prost(bool, tag = \"1\")]\n    pub success: bool,\n    #[prost(string, tag = \"2\")]\n    pub message: ::prost::alloc::string::String,\n    #[prost(message, optional, tag = \"3\")]\n    pub final_stats: ::core::option::Option\u003cTrainingStatsUpdate\u003e,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GetTrainingStatusRequest {\n    #[prost(string, tag = \"1\")]\n    pub training_session_id: ::prost::alloc::string::String,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GetTrainingStatusResponse {\n    #[prost(bool, tag = \"1\")]\n    pub is_running: bool,\n    #[prost(int32, tag = \"2\")]\n    pub current_game: i32,\n    #[prost(int32, tag = \"3\")]\n    pub total_games: i32,\n    #[prost(double, tag = \"4\")]\n    pub current_average_score: f64,\n    #[prost(string, tag = \"5\")]\n    pub status_message: ::prost::alloc::string::String,\n}\n/// Generated client implementations.\npub mod training_service_client {\n    #![allow(unused_variables, dead_code, missing_docs, clippy::let_unit_value)]\n    use tonic::codegen::*;\n    use tonic::codegen::http::Uri;\n    #[derive(Debug, Clone)]\n    pub struct TrainingServiceClient\u003cT\u003e {\n        inner: tonic::client::Grpc\u003cT\u003e,\n    }\n    impl TrainingServiceClient\u003ctonic::transport::Channel\u003e {\n        /// Attempt to create a new client by connecting to a given endpoint.\n        pub async fn connect\u003cD\u003e(dst: D) -\u003e Result\u003cSelf, tonic::transport::Error\u003e\n        where\n            D: TryInto\u003ctonic::transport::Endpoint\u003e,\n            D::Error: Into\u003cStdError\u003e,\n        {\n            let conn = tonic::transport::Endpoint::new(dst)?.connect().await?;\n            Ok(Self::new(conn))\n        }\n    }\n    impl\u003cT\u003e TrainingServiceClient\u003cT\u003e\n    where\n        T: tonic::client::GrpcService\u003ctonic::body::BoxBody\u003e,\n        T::Error: Into\u003cStdError\u003e,\n        T::ResponseBody: Body\u003cData = Bytes\u003e + Send + 'static,\n        \u003cT::ResponseBody as Body\u003e::Error: Into\u003cStdError\u003e + Send,\n    {\n        pub fn new(inner: T) -\u003e Self {\n            let inner = tonic::client::Grpc::new(inner);\n            Self { inner }\n        }\n        pub fn with_origin(inner: T, origin: Uri) -\u003e Self {\n            let inner = tonic::client::Grpc::with_origin(inner, origin);\n            Self { inner }\n        }\n        pub fn with_interceptor\u003cF\u003e(\n            inner: T,\n            interceptor: F,\n        ) -\u003e TrainingServiceClient\u003cInterceptedService\u003cT, F\u003e\u003e\n        where\n            F: tonic::service::Interceptor,\n            T::ResponseBody: Default,\n            T: tonic::codegen::Service\u003c\n                http::Request\u003ctonic::body::BoxBody\u003e,\n                Response = http::Response\u003c\n                    \u003cT as tonic::client::GrpcService\u003ctonic::body::BoxBody\u003e\u003e::ResponseBody,\n                \u003e,\n            \u003e,\n            \u003cT as tonic::codegen::Service\u003c\n                http::Request\u003ctonic::body::BoxBody\u003e,\n            \u003e\u003e::Error: Into\u003cStdError\u003e + Send + Sync,\n        {\n            TrainingServiceClient::new(InterceptedService::new(inner, interceptor))\n        }\n        /// Compress requests with the given encoding.\n        ///\n        /// This requires the server to support it otherwise it might respond with an\n        /// error.\n        #[must_use]\n        pub fn send_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.inner = self.inner.send_compressed(encoding);\n            self\n        }\n        /// Enable decompressing responses.\n        #[must_use]\n        pub fn accept_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.inner = self.inner.accept_compressed(encoding);\n            self\n        }\n        /// Limits the maximum size of a decoded message.\n        ///\n        /// Default: `4MB`\n        #[must_use]\n        pub fn max_decoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.inner = self.inner.max_decoding_message_size(limit);\n            self\n        }\n        /// Limits the maximum size of an encoded message.\n        ///\n        /// Default: `usize::MAX`\n        #[must_use]\n        pub fn max_encoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.inner = self.inner.max_encoding_message_size(limit);\n            self\n        }\n        /// D√©marrer une session d'entra√Ænement\n        pub async fn start_training(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::StartTrainingRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::StartTrainingResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.training.v1.TrainingService/StartTraining\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(\n                    GrpcMethod::new(\n                        \"takeiteasygame.training.v1.TrainingService\",\n                        \"StartTraining\",\n                    ),\n                );\n            self.inner.unary(req, path, codec).await\n        }\n        /// Arr√™ter une session d'entra√Ænement\n        pub async fn stop_training(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::StopTrainingRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::StopTrainingResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.training.v1.TrainingService/StopTraining\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(\n                    GrpcMethod::new(\n                        \"takeiteasygame.training.v1.TrainingService\",\n                        \"StopTraining\",\n                    ),\n                );\n            self.inner.unary(req, path, codec).await\n        }\n        /// Obtenir le statut d'une session d'entra√Ænement\n        pub async fn get_training_status(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::GetTrainingStatusRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::GetTrainingStatusResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.training.v1.TrainingService/GetTrainingStatus\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(\n                    GrpcMethod::new(\n                        \"takeiteasygame.training.v1.TrainingService\",\n                        \"GetTrainingStatus\",\n                    ),\n                );\n            self.inner.unary(req, path, codec).await\n        }\n        /// Stream des mises √† jour d'entra√Ænement (remplace WebSocket)\n        pub async fn stream_training_updates(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::StartTrainingRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003ctonic::codec::Streaming\u003csuper::TrainingUpdate\u003e\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.training.v1.TrainingService/StreamTrainingUpdates\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(\n                    GrpcMethod::new(\n                        \"takeiteasygame.training.v1.TrainingService\",\n                        \"StreamTrainingUpdates\",\n                    ),\n                );\n            self.inner.server_streaming(req, path, codec).await\n        }\n    }\n}\n/// Generated server implementations.\npub mod training_service_server {\n    #![allow(unused_variables, dead_code, missing_docs, clippy::let_unit_value)]\n    use tonic::codegen::*;\n    /// Generated trait containing gRPC methods that should be implemented for use with TrainingServiceServer.\n    #[async_trait]\n    pub trait TrainingService: Send + Sync + 'static {\n        /// D√©marrer une session d'entra√Ænement\n        async fn start_training(\n            \u0026self,\n            request: tonic::Request\u003csuper::StartTrainingRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::StartTrainingResponse\u003e,\n            tonic::Status,\n        \u003e;\n        /// Arr√™ter une session d'entra√Ænement\n        async fn stop_training(\n            \u0026self,\n            request: tonic::Request\u003csuper::StopTrainingRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::StopTrainingResponse\u003e,\n            tonic::Status,\n        \u003e;\n        /// Obtenir le statut d'une session d'entra√Ænement\n        async fn get_training_status(\n            \u0026self,\n            request: tonic::Request\u003csuper::GetTrainingStatusRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::GetTrainingStatusResponse\u003e,\n            tonic::Status,\n        \u003e;\n        /// Server streaming response type for the StreamTrainingUpdates method.\n        type StreamTrainingUpdatesStream: tonic::codegen::tokio_stream::Stream\u003c\n                Item = std::result::Result\u003csuper::TrainingUpdate, tonic::Status\u003e,\n            \u003e\n            + Send\n            + 'static;\n        /// Stream des mises √† jour d'entra√Ænement (remplace WebSocket)\n        async fn stream_training_updates(\n            \u0026self,\n            request: tonic::Request\u003csuper::StartTrainingRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003cSelf::StreamTrainingUpdatesStream\u003e,\n            tonic::Status,\n        \u003e;\n    }\n    #[derive(Debug)]\n    pub struct TrainingServiceServer\u003cT: TrainingService\u003e {\n        inner: _Inner\u003cT\u003e,\n        accept_compression_encodings: EnabledCompressionEncodings,\n        send_compression_encodings: EnabledCompressionEncodings,\n        max_decoding_message_size: Option\u003cusize\u003e,\n        max_encoding_message_size: Option\u003cusize\u003e,\n    }\n    struct _Inner\u003cT\u003e(Arc\u003cT\u003e);\n    impl\u003cT: TrainingService\u003e TrainingServiceServer\u003cT\u003e {\n        pub fn new(inner: T) -\u003e Self {\n            Self::from_arc(Arc::new(inner))\n        }\n        pub fn from_arc(inner: Arc\u003cT\u003e) -\u003e Self {\n            let inner = _Inner(inner);\n            Self {\n                inner,\n                accept_compression_encodings: Default::default(),\n                send_compression_encodings: Default::default(),\n                max_decoding_message_size: None,\n                max_encoding_message_size: None,\n            }\n        }\n        pub fn with_interceptor\u003cF\u003e(\n            inner: T,\n            interceptor: F,\n        ) -\u003e InterceptedService\u003cSelf, F\u003e\n        where\n            F: tonic::service::Interceptor,\n        {\n            InterceptedService::new(Self::new(inner), interceptor)\n        }\n        /// Enable decompressing requests with the given encoding.\n        #[must_use]\n        pub fn accept_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.accept_compression_encodings.enable(encoding);\n            self\n        }\n        /// Compress responses with the given encoding, if the client supports it.\n        #[must_use]\n        pub fn send_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.send_compression_encodings.enable(encoding);\n            self\n        }\n        /// Limits the maximum size of a decoded message.\n        ///\n        /// Default: `4MB`\n        #[must_use]\n        pub fn max_decoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.max_decoding_message_size = Some(limit);\n            self\n        }\n        /// Limits the maximum size of an encoded message.\n        ///\n        /// Default: `usize::MAX`\n        #[must_use]\n        pub fn max_encoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.max_encoding_message_size = Some(limit);\n            self\n        }\n    }\n    impl\u003cT, B\u003e tonic::codegen::Service\u003chttp::Request\u003cB\u003e\u003e for TrainingServiceServer\u003cT\u003e\n    where\n        T: TrainingService,\n        B: Body + Send + 'static,\n        B::Error: Into\u003cStdError\u003e + Send + 'static,\n    {\n        type Response = http::Response\u003ctonic::body::BoxBody\u003e;\n        type Error = std::convert::Infallible;\n        type Future = BoxFuture\u003cSelf::Response, Self::Error\u003e;\n        fn poll_ready(\n            \u0026mut self,\n            _cx: \u0026mut Context\u003c'_\u003e,\n        ) -\u003e Poll\u003cstd::result::Result\u003c(), Self::Error\u003e\u003e {\n            Poll::Ready(Ok(()))\n        }\n        fn call(\u0026mut self, req: http::Request\u003cB\u003e) -\u003e Self::Future {\n            let inner = self.inner.clone();\n            match req.uri().path() {\n                \"/takeiteasygame.training.v1.TrainingService/StartTraining\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct StartTrainingSvc\u003cT: TrainingService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: TrainingService,\n                    \u003e tonic::server::UnaryService\u003csuper::StartTrainingRequest\u003e\n                    for StartTrainingSvc\u003cT\u003e {\n                        type Response = super::StartTrainingResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::StartTrainingRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as TrainingService\u003e::start_training(\u0026inner, request)\n                                    .await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = StartTrainingSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                \"/takeiteasygame.training.v1.TrainingService/StopTraining\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct StopTrainingSvc\u003cT: TrainingService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: TrainingService,\n                    \u003e tonic::server::UnaryService\u003csuper::StopTrainingRequest\u003e\n                    for StopTrainingSvc\u003cT\u003e {\n                        type Response = super::StopTrainingResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::StopTrainingRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as TrainingService\u003e::stop_training(\u0026inner, request).await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = StopTrainingSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                \"/takeiteasygame.training.v1.TrainingService/GetTrainingStatus\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct GetTrainingStatusSvc\u003cT: TrainingService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: TrainingService,\n                    \u003e tonic::server::UnaryService\u003csuper::GetTrainingStatusRequest\u003e\n                    for GetTrainingStatusSvc\u003cT\u003e {\n                        type Response = super::GetTrainingStatusResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::GetTrainingStatusRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as TrainingService\u003e::get_training_status(\u0026inner, request)\n                                    .await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = GetTrainingStatusSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                \"/takeiteasygame.training.v1.TrainingService/StreamTrainingUpdates\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct StreamTrainingUpdatesSvc\u003cT: TrainingService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: TrainingService,\n                    \u003e tonic::server::ServerStreamingService\u003csuper::StartTrainingRequest\u003e\n                    for StreamTrainingUpdatesSvc\u003cT\u003e {\n                        type Response = super::TrainingUpdate;\n                        type ResponseStream = T::StreamTrainingUpdatesStream;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::ResponseStream\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::StartTrainingRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as TrainingService\u003e::stream_training_updates(\n                                        \u0026inner,\n                                        request,\n                                    )\n                                    .await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = StreamTrainingUpdatesSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.server_streaming(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                _ =\u003e {\n                    Box::pin(async move {\n                        Ok(\n                            http::Response::builder()\n                                .status(200)\n                                .header(\"grpc-status\", \"12\")\n                                .header(\"content-type\", \"application/grpc\")\n                                .body(empty_body())\n                                .unwrap(),\n                        )\n                    })\n                }\n            }\n        }\n    }\n    impl\u003cT: TrainingService\u003e Clone for TrainingServiceServer\u003cT\u003e {\n        fn clone(\u0026self) -\u003e Self {\n            let inner = self.inner.clone();\n            Self {\n                inner,\n                accept_compression_encodings: self.accept_compression_encodings,\n                send_compression_encodings: self.send_compression_encodings,\n                max_decoding_message_size: self.max_decoding_message_size,\n                max_encoding_message_size: self.max_encoding_message_size,\n            }\n        }\n    }\n    impl\u003cT: TrainingService\u003e Clone for _Inner\u003cT\u003e {\n        fn clone(\u0026self) -\u003e Self {\n            Self(Arc::clone(\u0026self.0))\n        }\n    }\n    impl\u003cT: std::fmt::Debug\u003e std::fmt::Debug for _Inner\u003cT\u003e {\n        fn fmt(\u0026self, f: \u0026mut std::fmt::Formatter\u003c'_\u003e) -\u003e std::fmt::Result {\n            write!(f, \"{:?}\", self.0)\n        }\n    }\n    impl\u003cT: TrainingService\u003e tonic::server::NamedService for TrainingServiceServer\u003cT\u003e {\n        const NAME: \u0026'static str = \"takeiteasygame.training.v1.TrainingService\";\n    }\n}\n","traces":[{"line":186,"address":[],"length":0,"stats":{"Line":0}},{"line":187,"address":[],"length":0,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[],"length":0,"stats":{"Line":0}},{"line":222,"address":[],"length":0,"stats":{"Line":0}},{"line":229,"address":[],"length":0,"stats":{"Line":0}},{"line":230,"address":[],"length":0,"stats":{"Line":0}},{"line":231,"address":[],"length":0,"stats":{"Line":0}},{"line":235,"address":[],"length":0,"stats":{"Line":0}},{"line":236,"address":[],"length":0,"stats":{"Line":0}},{"line":237,"address":[],"length":0,"stats":{"Line":0}},{"line":243,"address":[],"length":0,"stats":{"Line":0}},{"line":244,"address":[],"length":0,"stats":{"Line":0}},{"line":245,"address":[],"length":0,"stats":{"Line":0}},{"line":251,"address":[],"length":0,"stats":{"Line":0}},{"line":252,"address":[],"length":0,"stats":{"Line":0}},{"line":253,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":265,"address":[],"length":0,"stats":{"Line":0}},{"line":266,"address":[],"length":0,"stats":{"Line":0}},{"line":267,"address":[],"length":0,"stats":{"Line":0}},{"line":268,"address":[],"length":0,"stats":{"Line":0}},{"line":269,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":276,"address":[],"length":0,"stats":{"Line":0}},{"line":277,"address":[],"length":0,"stats":{"Line":0}},{"line":279,"address":[],"length":0,"stats":{"Line":0}},{"line":280,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":296,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":298,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[],"length":0,"stats":{"Line":0}},{"line":300,"address":[],"length":0,"stats":{"Line":0}},{"line":303,"address":[],"length":0,"stats":{"Line":0}},{"line":307,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":0}},{"line":310,"address":[],"length":0,"stats":{"Line":0}},{"line":311,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":315,"address":[],"length":0,"stats":{"Line":0}},{"line":325,"address":[],"length":0,"stats":{"Line":0}},{"line":327,"address":[],"length":0,"stats":{"Line":0}},{"line":328,"address":[],"length":0,"stats":{"Line":0}},{"line":329,"address":[],"length":0,"stats":{"Line":0}},{"line":330,"address":[],"length":0,"stats":{"Line":0}},{"line":331,"address":[],"length":0,"stats":{"Line":0}},{"line":334,"address":[],"length":0,"stats":{"Line":0}},{"line":338,"address":[],"length":0,"stats":{"Line":0}},{"line":339,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":342,"address":[],"length":0,"stats":{"Line":0}},{"line":343,"address":[],"length":0,"stats":{"Line":0}},{"line":346,"address":[],"length":0,"stats":{"Line":0}},{"line":356,"address":[],"length":0,"stats":{"Line":0}},{"line":358,"address":[],"length":0,"stats":{"Line":0}},{"line":359,"address":[],"length":0,"stats":{"Line":0}},{"line":360,"address":[],"length":0,"stats":{"Line":0}},{"line":361,"address":[],"length":0,"stats":{"Line":0}},{"line":362,"address":[],"length":0,"stats":{"Line":0}},{"line":365,"address":[],"length":0,"stats":{"Line":0}},{"line":369,"address":[],"length":0,"stats":{"Line":0}},{"line":370,"address":[],"length":0,"stats":{"Line":0}},{"line":372,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":374,"address":[],"length":0,"stats":{"Line":0}},{"line":377,"address":[],"length":0,"stats":{"Line":0}},{"line":437,"address":[],"length":0,"stats":{"Line":0}},{"line":438,"address":[],"length":0,"stats":{"Line":0}},{"line":440,"address":[],"length":0,"stats":{"Line":0}},{"line":441,"address":[],"length":0,"stats":{"Line":0}},{"line":444,"address":[],"length":0,"stats":{"Line":0}},{"line":445,"address":[],"length":0,"stats":{"Line":0}},{"line":457,"address":[],"length":0,"stats":{"Line":0}},{"line":461,"address":[],"length":0,"stats":{"Line":0}},{"line":462,"address":[],"length":0,"stats":{"Line":0}},{"line":463,"address":[],"length":0,"stats":{"Line":0}},{"line":467,"address":[],"length":0,"stats":{"Line":0}},{"line":468,"address":[],"length":0,"stats":{"Line":0}},{"line":469,"address":[],"length":0,"stats":{"Line":0}},{"line":475,"address":[],"length":0,"stats":{"Line":0}},{"line":476,"address":[],"length":0,"stats":{"Line":0}},{"line":477,"address":[],"length":0,"stats":{"Line":0}},{"line":483,"address":[],"length":0,"stats":{"Line":0}},{"line":484,"address":[],"length":0,"stats":{"Line":0}},{"line":485,"address":[],"length":0,"stats":{"Line":0}},{"line":501,"address":[],"length":0,"stats":{"Line":0}},{"line":503,"address":[],"length":0,"stats":{"Line":0}},{"line":504,"address":[],"length":0,"stats":{"Line":0}},{"line":505,"address":[],"length":0,"stats":{"Line":0}},{"line":506,"address":[],"length":0,"stats":{"Line":0}},{"line":509,"address":[],"length":0,"stats":{"Line":0}},{"line":510,"address":[],"length":0,"stats":{"Line":0}},{"line":511,"address":[],"length":0,"stats":{"Line":0}},{"line":512,"address":[],"length":0,"stats":{"Line":0}},{"line":518,"address":[],"length":0,"stats":{"Line":0}},{"line":522,"address":[],"length":0,"stats":{"Line":0}},{"line":523,"address":[],"length":0,"stats":{"Line":0}},{"line":524,"address":[],"length":0,"stats":{"Line":0}},{"line":525,"address":[],"length":0,"stats":{"Line":0}},{"line":527,"address":[],"length":0,"stats":{"Line":0}},{"line":530,"address":[],"length":0,"stats":{"Line":0}},{"line":531,"address":[],"length":0,"stats":{"Line":0}},{"line":532,"address":[],"length":0,"stats":{"Line":0}},{"line":533,"address":[],"length":0,"stats":{"Line":0}},{"line":534,"address":[],"length":0,"stats":{"Line":0}},{"line":535,"address":[],"length":0,"stats":{"Line":0}},{"line":536,"address":[],"length":0,"stats":{"Line":0}},{"line":537,"address":[],"length":0,"stats":{"Line":0}},{"line":538,"address":[],"length":0,"stats":{"Line":0}},{"line":539,"address":[],"length":0,"stats":{"Line":0}},{"line":541,"address":[],"length":0,"stats":{"Line":0}},{"line":542,"address":[],"length":0,"stats":{"Line":0}},{"line":545,"address":[],"length":0,"stats":{"Line":0}},{"line":546,"address":[],"length":0,"stats":{"Line":0}},{"line":548,"address":[],"length":0,"stats":{"Line":0}},{"line":549,"address":[],"length":0,"stats":{"Line":0}},{"line":551,"address":[],"length":0,"stats":{"Line":0}},{"line":553,"address":[],"length":0,"stats":{"Line":0}},{"line":556,"address":[],"length":0,"stats":{"Line":0}},{"line":557,"address":[],"length":0,"stats":{"Line":0}},{"line":558,"address":[],"length":0,"stats":{"Line":0}},{"line":559,"address":[],"length":0,"stats":{"Line":0}},{"line":565,"address":[],"length":0,"stats":{"Line":0}},{"line":569,"address":[],"length":0,"stats":{"Line":0}},{"line":570,"address":[],"length":0,"stats":{"Line":0}},{"line":571,"address":[],"length":0,"stats":{"Line":0}},{"line":573,"address":[],"length":0,"stats":{"Line":0}},{"line":576,"address":[],"length":0,"stats":{"Line":0}},{"line":577,"address":[],"length":0,"stats":{"Line":0}},{"line":578,"address":[],"length":0,"stats":{"Line":0}},{"line":579,"address":[],"length":0,"stats":{"Line":0}},{"line":580,"address":[],"length":0,"stats":{"Line":0}},{"line":581,"address":[],"length":0,"stats":{"Line":0}},{"line":582,"address":[],"length":0,"stats":{"Line":0}},{"line":583,"address":[],"length":0,"stats":{"Line":0}},{"line":584,"address":[],"length":0,"stats":{"Line":0}},{"line":585,"address":[],"length":0,"stats":{"Line":0}},{"line":587,"address":[],"length":0,"stats":{"Line":0}},{"line":588,"address":[],"length":0,"stats":{"Line":0}},{"line":591,"address":[],"length":0,"stats":{"Line":0}},{"line":592,"address":[],"length":0,"stats":{"Line":0}},{"line":594,"address":[],"length":0,"stats":{"Line":0}},{"line":595,"address":[],"length":0,"stats":{"Line":0}},{"line":597,"address":[],"length":0,"stats":{"Line":0}},{"line":599,"address":[],"length":0,"stats":{"Line":0}},{"line":602,"address":[],"length":0,"stats":{"Line":0}},{"line":603,"address":[],"length":0,"stats":{"Line":0}},{"line":604,"address":[],"length":0,"stats":{"Line":0}},{"line":605,"address":[],"length":0,"stats":{"Line":0}},{"line":611,"address":[],"length":0,"stats":{"Line":0}},{"line":615,"address":[],"length":0,"stats":{"Line":0}},{"line":616,"address":[],"length":0,"stats":{"Line":0}},{"line":617,"address":[],"length":0,"stats":{"Line":0}},{"line":618,"address":[],"length":0,"stats":{"Line":0}},{"line":620,"address":[],"length":0,"stats":{"Line":0}},{"line":623,"address":[],"length":0,"stats":{"Line":0}},{"line":624,"address":[],"length":0,"stats":{"Line":0}},{"line":625,"address":[],"length":0,"stats":{"Line":0}},{"line":626,"address":[],"length":0,"stats":{"Line":0}},{"line":627,"address":[],"length":0,"stats":{"Line":0}},{"line":628,"address":[],"length":0,"stats":{"Line":0}},{"line":629,"address":[],"length":0,"stats":{"Line":0}},{"line":630,"address":[],"length":0,"stats":{"Line":0}},{"line":631,"address":[],"length":0,"stats":{"Line":0}},{"line":632,"address":[],"length":0,"stats":{"Line":0}},{"line":634,"address":[],"length":0,"stats":{"Line":0}},{"line":635,"address":[],"length":0,"stats":{"Line":0}},{"line":638,"address":[],"length":0,"stats":{"Line":0}},{"line":639,"address":[],"length":0,"stats":{"Line":0}},{"line":641,"address":[],"length":0,"stats":{"Line":0}},{"line":642,"address":[],"length":0,"stats":{"Line":0}},{"line":644,"address":[],"length":0,"stats":{"Line":0}},{"line":646,"address":[],"length":0,"stats":{"Line":0}},{"line":649,"address":[],"length":0,"stats":{"Line":0}},{"line":650,"address":[],"length":0,"stats":{"Line":0}},{"line":651,"address":[],"length":0,"stats":{"Line":0}},{"line":652,"address":[],"length":0,"stats":{"Line":0}},{"line":659,"address":[],"length":0,"stats":{"Line":0}},{"line":663,"address":[],"length":0,"stats":{"Line":0}},{"line":664,"address":[],"length":0,"stats":{"Line":0}},{"line":666,"address":[],"length":0,"stats":{"Line":0}},{"line":667,"address":[],"length":0,"stats":{"Line":0}},{"line":669,"address":[],"length":0,"stats":{"Line":0}},{"line":671,"address":[],"length":0,"stats":{"Line":0}},{"line":674,"address":[],"length":0,"stats":{"Line":0}},{"line":675,"address":[],"length":0,"stats":{"Line":0}},{"line":676,"address":[],"length":0,"stats":{"Line":0}},{"line":677,"address":[],"length":0,"stats":{"Line":0}},{"line":678,"address":[],"length":0,"stats":{"Line":0}},{"line":679,"address":[],"length":0,"stats":{"Line":0}},{"line":680,"address":[],"length":0,"stats":{"Line":0}},{"line":681,"address":[],"length":0,"stats":{"Line":0}},{"line":682,"address":[],"length":0,"stats":{"Line":0}},{"line":683,"address":[],"length":0,"stats":{"Line":0}},{"line":685,"address":[],"length":0,"stats":{"Line":0}},{"line":686,"address":[],"length":0,"stats":{"Line":0}},{"line":689,"address":[],"length":0,"stats":{"Line":0}},{"line":690,"address":[],"length":0,"stats":{"Line":0}},{"line":692,"address":[],"length":0,"stats":{"Line":0}},{"line":693,"address":[],"length":0,"stats":{"Line":0}},{"line":695,"address":[],"length":0,"stats":{"Line":0}},{"line":697,"address":[],"length":0,"stats":{"Line":0}},{"line":698,"address":[],"length":0,"stats":{"Line":0}},{"line":699,"address":[],"length":0,"stats":{"Line":0}},{"line":700,"address":[],"length":0,"stats":{"Line":0}},{"line":701,"address":[],"length":0,"stats":{"Line":0}},{"line":702,"address":[],"length":0,"stats":{"Line":0}},{"line":703,"address":[],"length":0,"stats":{"Line":0}},{"line":704,"address":[],"length":0,"stats":{"Line":0}},{"line":705,"address":[],"length":0,"stats":{"Line":0}},{"line":713,"address":[],"length":0,"stats":{"Line":0}},{"line":714,"address":[],"length":0,"stats":{"Line":0}},{"line":717,"address":[],"length":0,"stats":{"Line":0}},{"line":718,"address":[],"length":0,"stats":{"Line":0}},{"line":719,"address":[],"length":0,"stats":{"Line":0}},{"line":720,"address":[],"length":0,"stats":{"Line":0}},{"line":725,"address":[],"length":0,"stats":{"Line":0}},{"line":726,"address":[],"length":0,"stats":{"Line":0}},{"line":730,"address":[],"length":0,"stats":{"Line":0}},{"line":731,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":225},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","generated","takeiteasygame.v1.rs"],"content":"// This file is @generated by prost-build.\n/// Types communs partag√©s entre services\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct Player {\n    #[prost(string, tag = \"1\")]\n    pub id: ::prost::alloc::string::String,\n    #[prost(string, tag = \"2\")]\n    pub name: ::prost::alloc::string::String,\n    #[prost(int32, tag = \"3\")]\n    pub score: i32,\n    #[prost(bool, tag = \"4\")]\n    pub is_ready: bool,\n    #[prost(bool, tag = \"5\")]\n    pub is_connected: bool,\n    #[prost(int64, tag = \"6\")]\n    pub joined_at: i64,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GameState {\n    #[prost(string, tag = \"1\")]\n    pub session_id: ::prost::alloc::string::String,\n    #[prost(message, repeated, tag = \"2\")]\n    pub players: ::prost::alloc::vec::Vec\u003cPlayer\u003e,\n    #[prost(string, tag = \"3\")]\n    pub current_player_id: ::prost::alloc::string::String,\n    #[prost(enumeration = \"SessionState\", tag = \"4\")]\n    pub state: i32,\n    /// JSON serialized board\n    #[prost(string, tag = \"5\")]\n    pub board_state: ::prost::alloc::string::String,\n    #[prost(int32, tag = \"6\")]\n    pub turn_number: i32,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct Error {\n    #[prost(string, tag = \"1\")]\n    pub code: ::prost::alloc::string::String,\n    #[prost(string, tag = \"2\")]\n    pub message: ::prost::alloc::string::String,\n    #[prost(map = \"string, string\", tag = \"3\")]\n    pub details: ::std::collections::HashMap\u003c\n        ::prost::alloc::string::String,\n        ::prost::alloc::string::String,\n    \u003e,\n}\n#[derive(Clone, Copy, Debug, PartialEq, Eq, Hash, PartialOrd, Ord, ::prost::Enumeration)]\n#[repr(i32)]\npub enum SessionState {\n    Waiting = 0,\n    InProgress = 1,\n    Finished = 2,\n    Cancelled = 3,\n}\nimpl SessionState {\n    /// String value of the enum field names used in the ProtoBuf definition.\n    ///\n    /// The values are not transformed in any way and thus are considered stable\n    /// (if the ProtoBuf definition does not change) and safe for programmatic use.\n    pub fn as_str_name(\u0026self) -\u003e \u0026'static str {\n        match self {\n            SessionState::Waiting =\u003e \"WAITING\",\n            SessionState::InProgress =\u003e \"IN_PROGRESS\",\n            SessionState::Finished =\u003e \"FINISHED\",\n            SessionState::Cancelled =\u003e \"CANCELLED\",\n        }\n    }\n    /// Creates an enum from field names used in the ProtoBuf definition.\n    pub fn from_str_name(value: \u0026str) -\u003e ::core::option::Option\u003cSelf\u003e {\n        match value {\n            \"WAITING\" =\u003e Some(Self::Waiting),\n            \"IN_PROGRESS\" =\u003e Some(Self::InProgress),\n            \"FINISHED\" =\u003e Some(Self::Finished),\n            \"CANCELLED\" =\u003e Some(Self::Cancelled),\n            _ =\u003e None,\n        }\n    }\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct CreateSessionRequest {\n    #[prost(string, tag = \"1\")]\n    pub player_name: ::prost::alloc::string::String,\n    #[prost(int32, tag = \"2\")]\n    pub max_players: i32,\n    #[prost(string, tag = \"3\")]\n    pub game_mode: ::prost::alloc::string::String,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct CreateSessionSuccess {\n    #[prost(string, tag = \"1\")]\n    pub session_code: ::prost::alloc::string::String,\n    #[prost(string, tag = \"2\")]\n    pub session_id: ::prost::alloc::string::String,\n    #[prost(string, tag = \"3\")]\n    pub player_id: ::prost::alloc::string::String,\n    #[prost(message, optional, tag = \"4\")]\n    pub player: ::core::option::Option\u003cPlayer\u003e,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct CreateSessionResponse {\n    #[prost(oneof = \"create_session_response::Result\", tags = \"1, 2\")]\n    pub result: ::core::option::Option\u003ccreate_session_response::Result\u003e,\n}\n/// Nested message and enum types in `CreateSessionResponse`.\npub mod create_session_response {\n    #[allow(clippy::derive_partial_eq_without_eq)]\n    #[derive(Clone, PartialEq, ::prost::Oneof)]\n    pub enum Result {\n        #[prost(message, tag = \"1\")]\n        Success(super::CreateSessionSuccess),\n        #[prost(message, tag = \"2\")]\n        Error(super::Error),\n    }\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct JoinSessionRequest {\n    #[prost(string, tag = \"1\")]\n    pub session_code: ::prost::alloc::string::String,\n    #[prost(string, tag = \"2\")]\n    pub player_name: ::prost::alloc::string::String,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct JoinSessionSuccess {\n    #[prost(string, tag = \"1\")]\n    pub session_id: ::prost::alloc::string::String,\n    #[prost(string, tag = \"2\")]\n    pub player_id: ::prost::alloc::string::String,\n    #[prost(message, optional, tag = \"3\")]\n    pub game_state: ::core::option::Option\u003cGameState\u003e,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct JoinSessionResponse {\n    #[prost(oneof = \"join_session_response::Result\", tags = \"1, 2\")]\n    pub result: ::core::option::Option\u003cjoin_session_response::Result\u003e,\n}\n/// Nested message and enum types in `JoinSessionResponse`.\npub mod join_session_response {\n    #[allow(clippy::derive_partial_eq_without_eq)]\n    #[derive(Clone, PartialEq, ::prost::Oneof)]\n    pub enum Result {\n        #[prost(message, tag = \"1\")]\n        Success(super::JoinSessionSuccess),\n        #[prost(message, tag = \"2\")]\n        Error(super::Error),\n    }\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct SetReadyRequest {\n    #[prost(string, tag = \"1\")]\n    pub session_id: ::prost::alloc::string::String,\n    #[prost(string, tag = \"2\")]\n    pub player_id: ::prost::alloc::string::String,\n    #[prost(bool, tag = \"3\")]\n    pub ready: bool,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct SetReadyResponse {\n    #[prost(bool, tag = \"1\")]\n    pub success: bool,\n    #[prost(message, optional, tag = \"2\")]\n    pub error: ::core::option::Option\u003cError\u003e,\n    #[prost(bool, tag = \"3\")]\n    pub game_started: bool,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GetSessionStateRequest {\n    #[prost(string, tag = \"1\")]\n    pub session_id: ::prost::alloc::string::String,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GetSessionStateResponse {\n    #[prost(message, optional, tag = \"1\")]\n    pub game_state: ::core::option::Option\u003cGameState\u003e,\n    #[prost(message, optional, tag = \"2\")]\n    pub error: ::core::option::Option\u003cError\u003e,\n}\n/// Generated client implementations.\npub mod session_service_client {\n    #![allow(unused_variables, dead_code, missing_docs, clippy::let_unit_value)]\n    use tonic::codegen::*;\n    use tonic::codegen::http::Uri;\n    #[derive(Debug, Clone)]\n    pub struct SessionServiceClient\u003cT\u003e {\n        inner: tonic::client::Grpc\u003cT\u003e,\n    }\n    impl SessionServiceClient\u003ctonic::transport::Channel\u003e {\n        /// Attempt to create a new client by connecting to a given endpoint.\n        pub async fn connect\u003cD\u003e(dst: D) -\u003e Result\u003cSelf, tonic::transport::Error\u003e\n        where\n            D: TryInto\u003ctonic::transport::Endpoint\u003e,\n            D::Error: Into\u003cStdError\u003e,\n        {\n            let conn = tonic::transport::Endpoint::new(dst)?.connect().await?;\n            Ok(Self::new(conn))\n        }\n    }\n    impl\u003cT\u003e SessionServiceClient\u003cT\u003e\n    where\n        T: tonic::client::GrpcService\u003ctonic::body::BoxBody\u003e,\n        T::Error: Into\u003cStdError\u003e,\n        T::ResponseBody: Body\u003cData = Bytes\u003e + Send + 'static,\n        \u003cT::ResponseBody as Body\u003e::Error: Into\u003cStdError\u003e + Send,\n    {\n        pub fn new(inner: T) -\u003e Self {\n            let inner = tonic::client::Grpc::new(inner);\n            Self { inner }\n        }\n        pub fn with_origin(inner: T, origin: Uri) -\u003e Self {\n            let inner = tonic::client::Grpc::with_origin(inner, origin);\n            Self { inner }\n        }\n        pub fn with_interceptor\u003cF\u003e(\n            inner: T,\n            interceptor: F,\n        ) -\u003e SessionServiceClient\u003cInterceptedService\u003cT, F\u003e\u003e\n        where\n            F: tonic::service::Interceptor,\n            T::ResponseBody: Default,\n            T: tonic::codegen::Service\u003c\n                http::Request\u003ctonic::body::BoxBody\u003e,\n                Response = http::Response\u003c\n                    \u003cT as tonic::client::GrpcService\u003ctonic::body::BoxBody\u003e\u003e::ResponseBody,\n                \u003e,\n            \u003e,\n            \u003cT as tonic::codegen::Service\u003c\n                http::Request\u003ctonic::body::BoxBody\u003e,\n            \u003e\u003e::Error: Into\u003cStdError\u003e + Send + Sync,\n        {\n            SessionServiceClient::new(InterceptedService::new(inner, interceptor))\n        }\n        /// Compress requests with the given encoding.\n        ///\n        /// This requires the server to support it otherwise it might respond with an\n        /// error.\n        #[must_use]\n        pub fn send_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.inner = self.inner.send_compressed(encoding);\n            self\n        }\n        /// Enable decompressing responses.\n        #[must_use]\n        pub fn accept_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.inner = self.inner.accept_compressed(encoding);\n            self\n        }\n        /// Limits the maximum size of a decoded message.\n        ///\n        /// Default: `4MB`\n        #[must_use]\n        pub fn max_decoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.inner = self.inner.max_decoding_message_size(limit);\n            self\n        }\n        /// Limits the maximum size of an encoded message.\n        ///\n        /// Default: `usize::MAX`\n        #[must_use]\n        pub fn max_encoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.inner = self.inner.max_encoding_message_size(limit);\n            self\n        }\n        pub async fn create_session(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::CreateSessionRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::CreateSessionResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.v1.SessionService/CreateSession\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(\n                    GrpcMethod::new(\"takeiteasygame.v1.SessionService\", \"CreateSession\"),\n                );\n            self.inner.unary(req, path, codec).await\n        }\n        pub async fn join_session(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::JoinSessionRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::JoinSessionResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.v1.SessionService/JoinSession\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(\n                    GrpcMethod::new(\"takeiteasygame.v1.SessionService\", \"JoinSession\"),\n                );\n            self.inner.unary(req, path, codec).await\n        }\n        pub async fn set_ready(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::SetReadyRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::SetReadyResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.v1.SessionService/SetReady\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(GrpcMethod::new(\"takeiteasygame.v1.SessionService\", \"SetReady\"));\n            self.inner.unary(req, path, codec).await\n        }\n        pub async fn get_session_state(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::GetSessionStateRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::GetSessionStateResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.v1.SessionService/GetSessionState\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(\n                    GrpcMethod::new(\n                        \"takeiteasygame.v1.SessionService\",\n                        \"GetSessionState\",\n                    ),\n                );\n            self.inner.unary(req, path, codec).await\n        }\n    }\n}\n/// Generated server implementations.\npub mod session_service_server {\n    #![allow(unused_variables, dead_code, missing_docs, clippy::let_unit_value)]\n    use tonic::codegen::*;\n    /// Generated trait containing gRPC methods that should be implemented for use with SessionServiceServer.\n    #[async_trait]\n    pub trait SessionService: Send + Sync + 'static {\n        async fn create_session(\n            \u0026self,\n            request: tonic::Request\u003csuper::CreateSessionRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::CreateSessionResponse\u003e,\n            tonic::Status,\n        \u003e;\n        async fn join_session(\n            \u0026self,\n            request: tonic::Request\u003csuper::JoinSessionRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::JoinSessionResponse\u003e,\n            tonic::Status,\n        \u003e;\n        async fn set_ready(\n            \u0026self,\n            request: tonic::Request\u003csuper::SetReadyRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::SetReadyResponse\u003e,\n            tonic::Status,\n        \u003e;\n        async fn get_session_state(\n            \u0026self,\n            request: tonic::Request\u003csuper::GetSessionStateRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::GetSessionStateResponse\u003e,\n            tonic::Status,\n        \u003e;\n    }\n    #[derive(Debug)]\n    pub struct SessionServiceServer\u003cT: SessionService\u003e {\n        inner: _Inner\u003cT\u003e,\n        accept_compression_encodings: EnabledCompressionEncodings,\n        send_compression_encodings: EnabledCompressionEncodings,\n        max_decoding_message_size: Option\u003cusize\u003e,\n        max_encoding_message_size: Option\u003cusize\u003e,\n    }\n    struct _Inner\u003cT\u003e(Arc\u003cT\u003e);\n    impl\u003cT: SessionService\u003e SessionServiceServer\u003cT\u003e {\n        pub fn new(inner: T) -\u003e Self {\n            Self::from_arc(Arc::new(inner))\n        }\n        pub fn from_arc(inner: Arc\u003cT\u003e) -\u003e Self {\n            let inner = _Inner(inner);\n            Self {\n                inner,\n                accept_compression_encodings: Default::default(),\n                send_compression_encodings: Default::default(),\n                max_decoding_message_size: None,\n                max_encoding_message_size: None,\n            }\n        }\n        pub fn with_interceptor\u003cF\u003e(\n            inner: T,\n            interceptor: F,\n        ) -\u003e InterceptedService\u003cSelf, F\u003e\n        where\n            F: tonic::service::Interceptor,\n        {\n            InterceptedService::new(Self::new(inner), interceptor)\n        }\n        /// Enable decompressing requests with the given encoding.\n        #[must_use]\n        pub fn accept_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.accept_compression_encodings.enable(encoding);\n            self\n        }\n        /// Compress responses with the given encoding, if the client supports it.\n        #[must_use]\n        pub fn send_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.send_compression_encodings.enable(encoding);\n            self\n        }\n        /// Limits the maximum size of a decoded message.\n        ///\n        /// Default: `4MB`\n        #[must_use]\n        pub fn max_decoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.max_decoding_message_size = Some(limit);\n            self\n        }\n        /// Limits the maximum size of an encoded message.\n        ///\n        /// Default: `usize::MAX`\n        #[must_use]\n        pub fn max_encoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.max_encoding_message_size = Some(limit);\n            self\n        }\n    }\n    impl\u003cT, B\u003e tonic::codegen::Service\u003chttp::Request\u003cB\u003e\u003e for SessionServiceServer\u003cT\u003e\n    where\n        T: SessionService,\n        B: Body + Send + 'static,\n        B::Error: Into\u003cStdError\u003e + Send + 'static,\n    {\n        type Response = http::Response\u003ctonic::body::BoxBody\u003e;\n        type Error = std::convert::Infallible;\n        type Future = BoxFuture\u003cSelf::Response, Self::Error\u003e;\n        fn poll_ready(\n            \u0026mut self,\n            _cx: \u0026mut Context\u003c'_\u003e,\n        ) -\u003e Poll\u003cstd::result::Result\u003c(), Self::Error\u003e\u003e {\n            Poll::Ready(Ok(()))\n        }\n        fn call(\u0026mut self, req: http::Request\u003cB\u003e) -\u003e Self::Future {\n            let inner = self.inner.clone();\n            match req.uri().path() {\n                \"/takeiteasygame.v1.SessionService/CreateSession\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct CreateSessionSvc\u003cT: SessionService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: SessionService,\n                    \u003e tonic::server::UnaryService\u003csuper::CreateSessionRequest\u003e\n                    for CreateSessionSvc\u003cT\u003e {\n                        type Response = super::CreateSessionResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::CreateSessionRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as SessionService\u003e::create_session(\u0026inner, request).await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = CreateSessionSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                \"/takeiteasygame.v1.SessionService/JoinSession\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct JoinSessionSvc\u003cT: SessionService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: SessionService,\n                    \u003e tonic::server::UnaryService\u003csuper::JoinSessionRequest\u003e\n                    for JoinSessionSvc\u003cT\u003e {\n                        type Response = super::JoinSessionResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::JoinSessionRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as SessionService\u003e::join_session(\u0026inner, request).await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = JoinSessionSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                \"/takeiteasygame.v1.SessionService/SetReady\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct SetReadySvc\u003cT: SessionService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: SessionService,\n                    \u003e tonic::server::UnaryService\u003csuper::SetReadyRequest\u003e\n                    for SetReadySvc\u003cT\u003e {\n                        type Response = super::SetReadyResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::SetReadyRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as SessionService\u003e::set_ready(\u0026inner, request).await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = SetReadySvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                \"/takeiteasygame.v1.SessionService/GetSessionState\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct GetSessionStateSvc\u003cT: SessionService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: SessionService,\n                    \u003e tonic::server::UnaryService\u003csuper::GetSessionStateRequest\u003e\n                    for GetSessionStateSvc\u003cT\u003e {\n                        type Response = super::GetSessionStateResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::GetSessionStateRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as SessionService\u003e::get_session_state(\u0026inner, request)\n                                    .await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = GetSessionStateSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                _ =\u003e {\n                    Box::pin(async move {\n                        Ok(\n                            http::Response::builder()\n                                .status(200)\n                                .header(\"grpc-status\", \"12\")\n                                .header(\"content-type\", \"application/grpc\")\n                                .body(empty_body())\n                                .unwrap(),\n                        )\n                    })\n                }\n            }\n        }\n    }\n    impl\u003cT: SessionService\u003e Clone for SessionServiceServer\u003cT\u003e {\n        fn clone(\u0026self) -\u003e Self {\n            let inner = self.inner.clone();\n            Self {\n                inner,\n                accept_compression_encodings: self.accept_compression_encodings,\n                send_compression_encodings: self.send_compression_encodings,\n                max_decoding_message_size: self.max_decoding_message_size,\n                max_encoding_message_size: self.max_encoding_message_size,\n            }\n        }\n    }\n    impl\u003cT: SessionService\u003e Clone for _Inner\u003cT\u003e {\n        fn clone(\u0026self) -\u003e Self {\n            Self(Arc::clone(\u0026self.0))\n        }\n    }\n    impl\u003cT: std::fmt::Debug\u003e std::fmt::Debug for _Inner\u003cT\u003e {\n        fn fmt(\u0026self, f: \u0026mut std::fmt::Formatter\u003c'_\u003e) -\u003e std::fmt::Result {\n            write!(f, \"{:?}\", self.0)\n        }\n    }\n    impl\u003cT: SessionService\u003e tonic::server::NamedService for SessionServiceServer\u003cT\u003e {\n        const NAME: \u0026'static str = \"takeiteasygame.v1.SessionService\";\n    }\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct MakeMoveRequest {\n    #[prost(string, tag = \"1\")]\n    pub session_id: ::prost::alloc::string::String,\n    #[prost(string, tag = \"2\")]\n    pub player_id: ::prost::alloc::string::String,\n    /// JSON du mouvement\n    #[prost(string, tag = \"3\")]\n    pub move_data: ::prost::alloc::string::String,\n    #[prost(int64, tag = \"4\")]\n    pub timestamp: i64,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct MakeMoveResponse {\n    #[prost(oneof = \"make_move_response::Result\", tags = \"1, 2\")]\n    pub result: ::core::option::Option\u003cmake_move_response::Result\u003e,\n}\n/// Nested message and enum types in `MakeMoveResponse`.\npub mod make_move_response {\n    #[allow(clippy::derive_partial_eq_without_eq)]\n    #[derive(Clone, PartialEq, ::prost::Oneof)]\n    pub enum Result {\n        #[prost(message, tag = \"1\")]\n        Success(super::MakeMoveSuccess),\n        #[prost(message, tag = \"2\")]\n        Error(super::Error),\n    }\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct MakeMoveSuccess {\n    #[prost(message, optional, tag = \"1\")]\n    pub new_game_state: ::core::option::Option\u003cGameState\u003e,\n    /// R√©ponse de l'IA si applicable\n    #[prost(string, tag = \"2\")]\n    pub mcts_response: ::prost::alloc::string::String,\n    #[prost(int32, tag = \"3\")]\n    pub points_earned: i32,\n    #[prost(bool, tag = \"4\")]\n    pub is_game_over: bool,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GetAvailableMovesRequest {\n    #[prost(string, tag = \"1\")]\n    pub session_id: ::prost::alloc::string::String,\n    #[prost(string, tag = \"2\")]\n    pub player_id: ::prost::alloc::string::String,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GetAvailableMovesResponse {\n    /// JSON des mouvements possibles\n    #[prost(string, repeated, tag = \"1\")]\n    pub available_moves: ::prost::alloc::vec::Vec\u003c::prost::alloc::string::String\u003e,\n    #[prost(message, optional, tag = \"2\")]\n    pub error: ::core::option::Option\u003cError\u003e,\n}\n/// D√©marrer un nouveau tour\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct StartTurnRequest {\n    #[prost(string, tag = \"1\")]\n    pub session_id: ::prost::alloc::string::String,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct StartTurnResponse {\n    #[prost(bool, tag = \"1\")]\n    pub success: bool,\n    /// \"5-3-7\"\n    #[prost(string, tag = \"2\")]\n    pub announced_tile: ::prost::alloc::string::String,\n    /// \"537.png\"\n    #[prost(string, tag = \"3\")]\n    pub tile_image: ::prost::alloc::string::String,\n    #[prost(int32, tag = \"4\")]\n    pub turn_number: i32,\n    #[prost(string, repeated, tag = \"5\")]\n    pub waiting_for_players: ::prost::alloc::vec::Vec\u003c::prost::alloc::string::String\u003e,\n    /// JSON complet de l'√©tat\n    #[prost(string, tag = \"6\")]\n    pub game_state: ::prost::alloc::string::String,\n    #[prost(message, optional, tag = \"7\")]\n    pub error: ::core::option::Option\u003cError\u003e,\n}\n/// Obtenir l'√©tat complet du jeu\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GetGameStateRequest {\n    #[prost(string, tag = \"1\")]\n    pub session_id: ::prost::alloc::string::String,\n}\n#[allow(clippy::derive_partial_eq_without_eq)]\n#[derive(Clone, PartialEq, ::prost::Message)]\npub struct GetGameStateResponse {\n    #[prost(bool, tag = \"1\")]\n    pub success: bool,\n    /// JSON complet de l'√©tat\n    #[prost(string, tag = \"2\")]\n    pub game_state: ::prost::alloc::string::String,\n    /// \"5-3-7\" ou vide\n    #[prost(string, tag = \"3\")]\n    pub current_tile: ::prost::alloc::string::String,\n    /// Num√©ro du tour (0-18)\n    #[prost(int32, tag = \"4\")]\n    pub current_turn: i32,\n    #[prost(string, repeated, tag = \"5\")]\n    pub waiting_for_players: ::prost::alloc::vec::Vec\u003c::prost::alloc::string::String\u003e,\n    #[prost(bool, tag = \"6\")]\n    pub is_game_finished: bool,\n    /// JSON des scores finaux\n    #[prost(string, tag = \"7\")]\n    pub final_scores: ::prost::alloc::string::String,\n    #[prost(message, optional, tag = \"8\")]\n    pub error: ::core::option::Option\u003cError\u003e,\n}\n/// Generated client implementations.\npub mod game_service_client {\n    #![allow(unused_variables, dead_code, missing_docs, clippy::let_unit_value)]\n    use tonic::codegen::*;\n    use tonic::codegen::http::Uri;\n    #[derive(Debug, Clone)]\n    pub struct GameServiceClient\u003cT\u003e {\n        inner: tonic::client::Grpc\u003cT\u003e,\n    }\n    impl GameServiceClient\u003ctonic::transport::Channel\u003e {\n        /// Attempt to create a new client by connecting to a given endpoint.\n        pub async fn connect\u003cD\u003e(dst: D) -\u003e Result\u003cSelf, tonic::transport::Error\u003e\n        where\n            D: TryInto\u003ctonic::transport::Endpoint\u003e,\n            D::Error: Into\u003cStdError\u003e,\n        {\n            let conn = tonic::transport::Endpoint::new(dst)?.connect().await?;\n            Ok(Self::new(conn))\n        }\n    }\n    impl\u003cT\u003e GameServiceClient\u003cT\u003e\n    where\n        T: tonic::client::GrpcService\u003ctonic::body::BoxBody\u003e,\n        T::Error: Into\u003cStdError\u003e,\n        T::ResponseBody: Body\u003cData = Bytes\u003e + Send + 'static,\n        \u003cT::ResponseBody as Body\u003e::Error: Into\u003cStdError\u003e + Send,\n    {\n        pub fn new(inner: T) -\u003e Self {\n            let inner = tonic::client::Grpc::new(inner);\n            Self { inner }\n        }\n        pub fn with_origin(inner: T, origin: Uri) -\u003e Self {\n            let inner = tonic::client::Grpc::with_origin(inner, origin);\n            Self { inner }\n        }\n        pub fn with_interceptor\u003cF\u003e(\n            inner: T,\n            interceptor: F,\n        ) -\u003e GameServiceClient\u003cInterceptedService\u003cT, F\u003e\u003e\n        where\n            F: tonic::service::Interceptor,\n            T::ResponseBody: Default,\n            T: tonic::codegen::Service\u003c\n                http::Request\u003ctonic::body::BoxBody\u003e,\n                Response = http::Response\u003c\n                    \u003cT as tonic::client::GrpcService\u003ctonic::body::BoxBody\u003e\u003e::ResponseBody,\n                \u003e,\n            \u003e,\n            \u003cT as tonic::codegen::Service\u003c\n                http::Request\u003ctonic::body::BoxBody\u003e,\n            \u003e\u003e::Error: Into\u003cStdError\u003e + Send + Sync,\n        {\n            GameServiceClient::new(InterceptedService::new(inner, interceptor))\n        }\n        /// Compress requests with the given encoding.\n        ///\n        /// This requires the server to support it otherwise it might respond with an\n        /// error.\n        #[must_use]\n        pub fn send_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.inner = self.inner.send_compressed(encoding);\n            self\n        }\n        /// Enable decompressing responses.\n        #[must_use]\n        pub fn accept_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.inner = self.inner.accept_compressed(encoding);\n            self\n        }\n        /// Limits the maximum size of a decoded message.\n        ///\n        /// Default: `4MB`\n        #[must_use]\n        pub fn max_decoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.inner = self.inner.max_decoding_message_size(limit);\n            self\n        }\n        /// Limits the maximum size of an encoded message.\n        ///\n        /// Default: `usize::MAX`\n        #[must_use]\n        pub fn max_encoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.inner = self.inner.max_encoding_message_size(limit);\n            self\n        }\n        /// Faire un mouvement\n        pub async fn make_move(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::MakeMoveRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::MakeMoveResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.v1.GameService/MakeMove\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(GrpcMethod::new(\"takeiteasygame.v1.GameService\", \"MakeMove\"));\n            self.inner.unary(req, path, codec).await\n        }\n        /// Obtenir les mouvements disponibles\n        pub async fn get_available_moves(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::GetAvailableMovesRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::GetAvailableMovesResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.v1.GameService/GetAvailableMoves\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(\n                    GrpcMethod::new(\"takeiteasygame.v1.GameService\", \"GetAvailableMoves\"),\n                );\n            self.inner.unary(req, path, codec).await\n        }\n        /// üé≤ NOUVELLES M√âTHODES GAMEPLAY\n        pub async fn start_turn(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::StartTurnRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::StartTurnResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.v1.GameService/StartTurn\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(GrpcMethod::new(\"takeiteasygame.v1.GameService\", \"StartTurn\"));\n            self.inner.unary(req, path, codec).await\n        }\n        pub async fn get_game_state(\n            \u0026mut self,\n            request: impl tonic::IntoRequest\u003csuper::GetGameStateRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::GetGameStateResponse\u003e,\n            tonic::Status,\n        \u003e {\n            self.inner\n                .ready()\n                .await\n                .map_err(|e| {\n                    tonic::Status::new(\n                        tonic::Code::Unknown,\n                        format!(\"Service was not ready: {}\", e.into()),\n                    )\n                })?;\n            let codec = tonic::codec::ProstCodec::default();\n            let path = http::uri::PathAndQuery::from_static(\n                \"/takeiteasygame.v1.GameService/GetGameState\",\n            );\n            let mut req = request.into_request();\n            req.extensions_mut()\n                .insert(\n                    GrpcMethod::new(\"takeiteasygame.v1.GameService\", \"GetGameState\"),\n                );\n            self.inner.unary(req, path, codec).await\n        }\n    }\n}\n/// Generated server implementations.\npub mod game_service_server {\n    #![allow(unused_variables, dead_code, missing_docs, clippy::let_unit_value)]\n    use tonic::codegen::*;\n    /// Generated trait containing gRPC methods that should be implemented for use with GameServiceServer.\n    #[async_trait]\n    pub trait GameService: Send + Sync + 'static {\n        /// Faire un mouvement\n        async fn make_move(\n            \u0026self,\n            request: tonic::Request\u003csuper::MakeMoveRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::MakeMoveResponse\u003e,\n            tonic::Status,\n        \u003e;\n        /// Obtenir les mouvements disponibles\n        async fn get_available_moves(\n            \u0026self,\n            request: tonic::Request\u003csuper::GetAvailableMovesRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::GetAvailableMovesResponse\u003e,\n            tonic::Status,\n        \u003e;\n        /// üé≤ NOUVELLES M√âTHODES GAMEPLAY\n        async fn start_turn(\n            \u0026self,\n            request: tonic::Request\u003csuper::StartTurnRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::StartTurnResponse\u003e,\n            tonic::Status,\n        \u003e;\n        async fn get_game_state(\n            \u0026self,\n            request: tonic::Request\u003csuper::GetGameStateRequest\u003e,\n        ) -\u003e std::result::Result\u003c\n            tonic::Response\u003csuper::GetGameStateResponse\u003e,\n            tonic::Status,\n        \u003e;\n    }\n    #[derive(Debug)]\n    pub struct GameServiceServer\u003cT: GameService\u003e {\n        inner: _Inner\u003cT\u003e,\n        accept_compression_encodings: EnabledCompressionEncodings,\n        send_compression_encodings: EnabledCompressionEncodings,\n        max_decoding_message_size: Option\u003cusize\u003e,\n        max_encoding_message_size: Option\u003cusize\u003e,\n    }\n    struct _Inner\u003cT\u003e(Arc\u003cT\u003e);\n    impl\u003cT: GameService\u003e GameServiceServer\u003cT\u003e {\n        pub fn new(inner: T) -\u003e Self {\n            Self::from_arc(Arc::new(inner))\n        }\n        pub fn from_arc(inner: Arc\u003cT\u003e) -\u003e Self {\n            let inner = _Inner(inner);\n            Self {\n                inner,\n                accept_compression_encodings: Default::default(),\n                send_compression_encodings: Default::default(),\n                max_decoding_message_size: None,\n                max_encoding_message_size: None,\n            }\n        }\n        pub fn with_interceptor\u003cF\u003e(\n            inner: T,\n            interceptor: F,\n        ) -\u003e InterceptedService\u003cSelf, F\u003e\n        where\n            F: tonic::service::Interceptor,\n        {\n            InterceptedService::new(Self::new(inner), interceptor)\n        }\n        /// Enable decompressing requests with the given encoding.\n        #[must_use]\n        pub fn accept_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.accept_compression_encodings.enable(encoding);\n            self\n        }\n        /// Compress responses with the given encoding, if the client supports it.\n        #[must_use]\n        pub fn send_compressed(mut self, encoding: CompressionEncoding) -\u003e Self {\n            self.send_compression_encodings.enable(encoding);\n            self\n        }\n        /// Limits the maximum size of a decoded message.\n        ///\n        /// Default: `4MB`\n        #[must_use]\n        pub fn max_decoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.max_decoding_message_size = Some(limit);\n            self\n        }\n        /// Limits the maximum size of an encoded message.\n        ///\n        /// Default: `usize::MAX`\n        #[must_use]\n        pub fn max_encoding_message_size(mut self, limit: usize) -\u003e Self {\n            self.max_encoding_message_size = Some(limit);\n            self\n        }\n    }\n    impl\u003cT, B\u003e tonic::codegen::Service\u003chttp::Request\u003cB\u003e\u003e for GameServiceServer\u003cT\u003e\n    where\n        T: GameService,\n        B: Body + Send + 'static,\n        B::Error: Into\u003cStdError\u003e + Send + 'static,\n    {\n        type Response = http::Response\u003ctonic::body::BoxBody\u003e;\n        type Error = std::convert::Infallible;\n        type Future = BoxFuture\u003cSelf::Response, Self::Error\u003e;\n        fn poll_ready(\n            \u0026mut self,\n            _cx: \u0026mut Context\u003c'_\u003e,\n        ) -\u003e Poll\u003cstd::result::Result\u003c(), Self::Error\u003e\u003e {\n            Poll::Ready(Ok(()))\n        }\n        fn call(\u0026mut self, req: http::Request\u003cB\u003e) -\u003e Self::Future {\n            let inner = self.inner.clone();\n            match req.uri().path() {\n                \"/takeiteasygame.v1.GameService/MakeMove\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct MakeMoveSvc\u003cT: GameService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: GameService,\n                    \u003e tonic::server::UnaryService\u003csuper::MakeMoveRequest\u003e\n                    for MakeMoveSvc\u003cT\u003e {\n                        type Response = super::MakeMoveResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::MakeMoveRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as GameService\u003e::make_move(\u0026inner, request).await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = MakeMoveSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                \"/takeiteasygame.v1.GameService/GetAvailableMoves\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct GetAvailableMovesSvc\u003cT: GameService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: GameService,\n                    \u003e tonic::server::UnaryService\u003csuper::GetAvailableMovesRequest\u003e\n                    for GetAvailableMovesSvc\u003cT\u003e {\n                        type Response = super::GetAvailableMovesResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::GetAvailableMovesRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as GameService\u003e::get_available_moves(\u0026inner, request)\n                                    .await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = GetAvailableMovesSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                \"/takeiteasygame.v1.GameService/StartTurn\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct StartTurnSvc\u003cT: GameService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: GameService,\n                    \u003e tonic::server::UnaryService\u003csuper::StartTurnRequest\u003e\n                    for StartTurnSvc\u003cT\u003e {\n                        type Response = super::StartTurnResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::StartTurnRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as GameService\u003e::start_turn(\u0026inner, request).await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = StartTurnSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                \"/takeiteasygame.v1.GameService/GetGameState\" =\u003e {\n                    #[allow(non_camel_case_types)]\n                    struct GetGameStateSvc\u003cT: GameService\u003e(pub Arc\u003cT\u003e);\n                    impl\u003c\n                        T: GameService,\n                    \u003e tonic::server::UnaryService\u003csuper::GetGameStateRequest\u003e\n                    for GetGameStateSvc\u003cT\u003e {\n                        type Response = super::GetGameStateResponse;\n                        type Future = BoxFuture\u003c\n                            tonic::Response\u003cSelf::Response\u003e,\n                            tonic::Status,\n                        \u003e;\n                        fn call(\n                            \u0026mut self,\n                            request: tonic::Request\u003csuper::GetGameStateRequest\u003e,\n                        ) -\u003e Self::Future {\n                            let inner = Arc::clone(\u0026self.0);\n                            let fut = async move {\n                                \u003cT as GameService\u003e::get_game_state(\u0026inner, request).await\n                            };\n                            Box::pin(fut)\n                        }\n                    }\n                    let accept_compression_encodings = self.accept_compression_encodings;\n                    let send_compression_encodings = self.send_compression_encodings;\n                    let max_decoding_message_size = self.max_decoding_message_size;\n                    let max_encoding_message_size = self.max_encoding_message_size;\n                    let inner = self.inner.clone();\n                    let fut = async move {\n                        let inner = inner.0;\n                        let method = GetGameStateSvc(inner);\n                        let codec = tonic::codec::ProstCodec::default();\n                        let mut grpc = tonic::server::Grpc::new(codec)\n                            .apply_compression_config(\n                                accept_compression_encodings,\n                                send_compression_encodings,\n                            )\n                            .apply_max_message_size_config(\n                                max_decoding_message_size,\n                                max_encoding_message_size,\n                            );\n                        let res = grpc.unary(method, req).await;\n                        Ok(res)\n                    };\n                    Box::pin(fut)\n                }\n                _ =\u003e {\n                    Box::pin(async move {\n                        Ok(\n                            http::Response::builder()\n                                .status(200)\n                                .header(\"grpc-status\", \"12\")\n                                .header(\"content-type\", \"application/grpc\")\n                                .body(empty_body())\n                                .unwrap(),\n                        )\n                    })\n                }\n            }\n        }\n    }\n    impl\u003cT: GameService\u003e Clone for GameServiceServer\u003cT\u003e {\n        fn clone(\u0026self) -\u003e Self {\n            let inner = self.inner.clone();\n            Self {\n                inner,\n                accept_compression_encodings: self.accept_compression_encodings,\n                send_compression_encodings: self.send_compression_encodings,\n                max_decoding_message_size: self.max_decoding_message_size,\n                max_encoding_message_size: self.max_encoding_message_size,\n            }\n        }\n    }\n    impl\u003cT: GameService\u003e Clone for _Inner\u003cT\u003e {\n        fn clone(\u0026self) -\u003e Self {\n            Self(Arc::clone(\u0026self.0))\n        }\n    }\n    impl\u003cT: std::fmt::Debug\u003e std::fmt::Debug for _Inner\u003cT\u003e {\n        fn fmt(\u0026self, f: \u0026mut std::fmt::Formatter\u003c'_\u003e) -\u003e std::fmt::Result {\n            write!(f, \"{:?}\", self.0)\n        }\n    }\n    impl\u003cT: GameService\u003e tonic::server::NamedService for GameServiceServer\u003cT\u003e {\n        const NAME: \u0026'static str = \"takeiteasygame.v1.GameService\";\n    }\n}\n","traces":[{"line":62,"address":[5907216],"length":1,"stats":{"Line":0}},{"line":63,"address":[5907221],"length":1,"stats":{"Line":0}},{"line":64,"address":[5907251],"length":1,"stats":{"Line":0}},{"line":65,"address":[5907274],"length":1,"stats":{"Line":0}},{"line":66,"address":[5907297],"length":1,"stats":{"Line":0}},{"line":67,"address":[5907320],"length":1,"stats":{"Line":0}},{"line":71,"address":[5907360],"length":1,"stats":{"Line":0}},{"line":73,"address":[5907383,5907436],"length":1,"stats":{"Line":0}},{"line":74,"address":[5907413,5907486],"length":1,"stats":{"Line":0}},{"line":75,"address":[5907536,5907463],"length":1,"stats":{"Line":0}},{"line":76,"address":[5907513,5907564],"length":1,"stats":{"Line":0}},{"line":77,"address":[5907554],"length":1,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[],"length":0,"stats":{"Line":0}},{"line":216,"address":[],"length":0,"stats":{"Line":0}},{"line":217,"address":[],"length":0,"stats":{"Line":0}},{"line":220,"address":[],"length":0,"stats":{"Line":0}},{"line":221,"address":[],"length":0,"stats":{"Line":0}},{"line":241,"address":[],"length":0,"stats":{"Line":0}},{"line":248,"address":[],"length":0,"stats":{"Line":0}},{"line":249,"address":[],"length":0,"stats":{"Line":0}},{"line":250,"address":[],"length":0,"stats":{"Line":0}},{"line":254,"address":[],"length":0,"stats":{"Line":0}},{"line":255,"address":[],"length":0,"stats":{"Line":0}},{"line":256,"address":[],"length":0,"stats":{"Line":0}},{"line":262,"address":[],"length":0,"stats":{"Line":0}},{"line":263,"address":[],"length":0,"stats":{"Line":0}},{"line":264,"address":[],"length":0,"stats":{"Line":0}},{"line":270,"address":[],"length":0,"stats":{"Line":0}},{"line":271,"address":[],"length":0,"stats":{"Line":0}},{"line":272,"address":[],"length":0,"stats":{"Line":0}},{"line":281,"address":[],"length":0,"stats":{"Line":0}},{"line":283,"address":[],"length":0,"stats":{"Line":0}},{"line":284,"address":[],"length":0,"stats":{"Line":0}},{"line":285,"address":[],"length":0,"stats":{"Line":0}},{"line":286,"address":[],"length":0,"stats":{"Line":0}},{"line":287,"address":[],"length":0,"stats":{"Line":0}},{"line":290,"address":[],"length":0,"stats":{"Line":0}},{"line":294,"address":[],"length":0,"stats":{"Line":0}},{"line":295,"address":[],"length":0,"stats":{"Line":0}},{"line":297,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[],"length":0,"stats":{"Line":0}},{"line":308,"address":[],"length":0,"stats":{"Line":0}},{"line":310,"address":[],"length":0,"stats":{"Line":0}},{"line":311,"address":[],"length":0,"stats":{"Line":0}},{"line":312,"address":[],"length":0,"stats":{"Line":0}},{"line":313,"address":[],"length":0,"stats":{"Line":0}},{"line":314,"address":[],"length":0,"stats":{"Line":0}},{"line":317,"address":[],"length":0,"stats":{"Line":0}},{"line":321,"address":[],"length":0,"stats":{"Line":0}},{"line":322,"address":[],"length":0,"stats":{"Line":0}},{"line":324,"address":[],"length":0,"stats":{"Line":0}},{"line":326,"address":[],"length":0,"stats":{"Line":0}},{"line":335,"address":[],"length":0,"stats":{"Line":0}},{"line":337,"address":[],"length":0,"stats":{"Line":0}},{"line":338,"address":[],"length":0,"stats":{"Line":0}},{"line":339,"address":[],"length":0,"stats":{"Line":0}},{"line":340,"address":[],"length":0,"stats":{"Line":0}},{"line":341,"address":[],"length":0,"stats":{"Line":0}},{"line":344,"address":[],"length":0,"stats":{"Line":0}},{"line":348,"address":[],"length":0,"stats":{"Line":0}},{"line":349,"address":[],"length":0,"stats":{"Line":0}},{"line":350,"address":[],"length":0,"stats":{"Line":0}},{"line":351,"address":[],"length":0,"stats":{"Line":0}},{"line":360,"address":[],"length":0,"stats":{"Line":0}},{"line":362,"address":[],"length":0,"stats":{"Line":0}},{"line":363,"address":[],"length":0,"stats":{"Line":0}},{"line":364,"address":[],"length":0,"stats":{"Line":0}},{"line":365,"address":[],"length":0,"stats":{"Line":0}},{"line":366,"address":[],"length":0,"stats":{"Line":0}},{"line":369,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[],"length":0,"stats":{"Line":0}},{"line":374,"address":[],"length":0,"stats":{"Line":0}},{"line":376,"address":[],"length":0,"stats":{"Line":0}},{"line":377,"address":[],"length":0,"stats":{"Line":0}},{"line":378,"address":[],"length":0,"stats":{"Line":0}},{"line":381,"address":[],"length":0,"stats":{"Line":0}},{"line":431,"address":[4692816],"length":1,"stats":{"Line":0}},{"line":432,"address":[4692848],"length":1,"stats":{"Line":0}},{"line":434,"address":[4693026,4692880,4693032],"length":1,"stats":{"Line":0}},{"line":435,"address":[4692898],"length":1,"stats":{"Line":0}},{"line":438,"address":[4692908],"length":1,"stats":{"Line":0}},{"line":439,"address":[4692943],"length":1,"stats":{"Line":0}},{"line":451,"address":[],"length":0,"stats":{"Line":0}},{"line":455,"address":[],"length":0,"stats":{"Line":0}},{"line":456,"address":[],"length":0,"stats":{"Line":0}},{"line":457,"address":[],"length":0,"stats":{"Line":0}},{"line":461,"address":[],"length":0,"stats":{"Line":0}},{"line":462,"address":[],"length":0,"stats":{"Line":0}},{"line":463,"address":[],"length":0,"stats":{"Line":0}},{"line":469,"address":[],"length":0,"stats":{"Line":0}},{"line":470,"address":[],"length":0,"stats":{"Line":0}},{"line":471,"address":[],"length":0,"stats":{"Line":0}},{"line":477,"address":[],"length":0,"stats":{"Line":0}},{"line":478,"address":[],"length":0,"stats":{"Line":0}},{"line":479,"address":[],"length":0,"stats":{"Line":0}},{"line":491,"address":[4693056],"length":1,"stats":{"Line":0}},{"line":495,"address":[4693066],"length":1,"stats":{"Line":0}},{"line":497,"address":[4694869,4693088],"length":1,"stats":{"Line":0}},{"line":498,"address":[4693241,4693165],"length":1,"stats":{"Line":0}},{"line":499,"address":[4693249,4693313,4694057,4693149],"length":1,"stats":{"Line":0}},{"line":500,"address":[4693374],"length":1,"stats":{"Line":0}},{"line":503,"address":[],"length":0,"stats":{"Line":0}},{"line":504,"address":[],"length":0,"stats":{"Line":0}},{"line":505,"address":[],"length":0,"stats":{"Line":0}},{"line":506,"address":[],"length":0,"stats":{"Line":0}},{"line":512,"address":[4694912,4695124,4695099],"length":1,"stats":{"Line":0}},{"line":516,"address":[4694948,4695008],"length":1,"stats":{"Line":0}},{"line":517,"address":[4695016,4695171,4695272,4695136,4695830,4695504,4695735],"length":1,"stats":{"Line":0}},{"line":518,"address":[4695224,4695299,4695356,4695530],"length":1,"stats":{"Line":0}},{"line":520,"address":[4695067,4694932],"length":1,"stats":{"Line":0}},{"line":523,"address":[],"length":0,"stats":{"Line":0}},{"line":524,"address":[],"length":0,"stats":{"Line":0}},{"line":525,"address":[4693463],"length":1,"stats":{"Line":0}},{"line":526,"address":[4693502],"length":1,"stats":{"Line":0}},{"line":527,"address":[4693542,4694686],"length":1,"stats":{"Line":0}},{"line":528,"address":[4696779,4696384,4695907,4695872,4696825,4696040,4694694],"length":1,"stats":{"Line":0}},{"line":529,"address":[4695960],"length":1,"stats":{"Line":0}},{"line":530,"address":[4696016],"length":1,"stats":{"Line":0}},{"line":531,"address":[4696033],"length":1,"stats":{"Line":0}},{"line":532,"address":[4696174,4696130],"length":1,"stats":{"Line":0}},{"line":534,"address":[],"length":0,"stats":{"Line":0}},{"line":535,"address":[],"length":0,"stats":{"Line":0}},{"line":538,"address":[4696154],"length":1,"stats":{"Line":0}},{"line":539,"address":[4696166],"length":1,"stats":{"Line":0}},{"line":541,"address":[3735911],"length":1,"stats":{"Line":0}},{"line":542,"address":[4696693],"length":1,"stats":{"Line":0}},{"line":544,"address":[4694780],"length":1,"stats":{"Line":0}},{"line":546,"address":[4693429,4693571],"length":1,"stats":{"Line":0}},{"line":549,"address":[],"length":0,"stats":{"Line":0}},{"line":550,"address":[],"length":0,"stats":{"Line":0}},{"line":551,"address":[],"length":0,"stats":{"Line":0}},{"line":552,"address":[],"length":0,"stats":{"Line":0}},{"line":558,"address":[4697094,4697069,4696880],"length":1,"stats":{"Line":0}},{"line":562,"address":[4696916,4696976],"length":1,"stats":{"Line":0}},{"line":563,"address":[4697701,4697104,4697796,4696984,4697139,4697240,4697471],"length":1,"stats":{"Line":0}},{"line":564,"address":[4697497,4697192,4697267,4697324],"length":1,"stats":{"Line":0}},{"line":566,"address":[4697037,4696900],"length":1,"stats":{"Line":0}},{"line":569,"address":[],"length":0,"stats":{"Line":0}},{"line":570,"address":[],"length":0,"stats":{"Line":0}},{"line":571,"address":[4693627],"length":1,"stats":{"Line":0}},{"line":572,"address":[4693666],"length":1,"stats":{"Line":0}},{"line":573,"address":[4693706,4694499],"length":1,"stats":{"Line":0}},{"line":574,"address":[4698352,4694507,4698008,4698747,4698793,4697840,4697875],"length":1,"stats":{"Line":0}},{"line":575,"address":[4697928],"length":1,"stats":{"Line":0}},{"line":576,"address":[4697984],"length":1,"stats":{"Line":0}},{"line":577,"address":[4698001],"length":1,"stats":{"Line":0}},{"line":578,"address":[4698098,4698142],"length":1,"stats":{"Line":0}},{"line":580,"address":[],"length":0,"stats":{"Line":0}},{"line":581,"address":[],"length":0,"stats":{"Line":0}},{"line":584,"address":[4698122],"length":1,"stats":{"Line":0}},{"line":585,"address":[4698134],"length":1,"stats":{"Line":0}},{"line":587,"address":[3736391],"length":1,"stats":{"Line":0}},{"line":588,"address":[4698661],"length":1,"stats":{"Line":0}},{"line":590,"address":[4694593],"length":1,"stats":{"Line":0}},{"line":592,"address":[4693593,4693735],"length":1,"stats":{"Line":0}},{"line":595,"address":[],"length":0,"stats":{"Line":0}},{"line":596,"address":[],"length":0,"stats":{"Line":0}},{"line":597,"address":[],"length":0,"stats":{"Line":0}},{"line":598,"address":[],"length":0,"stats":{"Line":0}},{"line":604,"address":[4699060,4698848,4699035],"length":1,"stats":{"Line":0}},{"line":608,"address":[4698884,4698944],"length":1,"stats":{"Line":0}},{"line":609,"address":[4699072,4698952,4699107,4699766,4699440,4699671,4699208],"length":1,"stats":{"Line":0}},{"line":610,"address":[4699466,4699235,4699160,4699292],"length":1,"stats":{"Line":0}},{"line":612,"address":[4698868,4699003],"length":1,"stats":{"Line":0}},{"line":615,"address":[],"length":0,"stats":{"Line":0}},{"line":616,"address":[],"length":0,"stats":{"Line":0}},{"line":617,"address":[4693791],"length":1,"stats":{"Line":0}},{"line":618,"address":[4693824],"length":1,"stats":{"Line":0}},{"line":619,"address":[4694312,4693861],"length":1,"stats":{"Line":0}},{"line":620,"address":[4699976,4700320,4699843,4700761,4694320,4700715,4699808],"length":1,"stats":{"Line":0}},{"line":621,"address":[4699896],"length":1,"stats":{"Line":0}},{"line":622,"address":[4699952],"length":1,"stats":{"Line":0}},{"line":623,"address":[4699969],"length":1,"stats":{"Line":0}},{"line":624,"address":[4700110,4700066],"length":1,"stats":{"Line":0}},{"line":626,"address":[],"length":0,"stats":{"Line":0}},{"line":627,"address":[],"length":0,"stats":{"Line":0}},{"line":630,"address":[4700090],"length":1,"stats":{"Line":0}},{"line":631,"address":[4700102],"length":1,"stats":{"Line":0}},{"line":633,"address":[3735671],"length":1,"stats":{"Line":0}},{"line":634,"address":[4700629],"length":1,"stats":{"Line":0}},{"line":636,"address":[4694406],"length":1,"stats":{"Line":0}},{"line":638,"address":[4693757,4693890],"length":1,"stats":{"Line":0}},{"line":641,"address":[],"length":0,"stats":{"Line":0}},{"line":642,"address":[],"length":0,"stats":{"Line":0}},{"line":643,"address":[],"length":0,"stats":{"Line":0}},{"line":644,"address":[],"length":0,"stats":{"Line":0}},{"line":650,"address":[4701086,4700816,4701061],"length":1,"stats":{"Line":0}},{"line":654,"address":[4700852,4700915],"length":1,"stats":{"Line":0}},{"line":655,"address":[4701237,4700923,4701104,4701535,4701762,4701857,4701139],"length":1,"stats":{"Line":0}},{"line":656,"address":[4701216,4701493,4701725,4701323],"length":1,"stats":{"Line":0}},{"line":657,"address":[4701512,4701561,4701727,4701466,4701192,4701264],"length":1,"stats":{"Line":0}},{"line":659,"address":[4701029,4700836],"length":1,"stats":{"Line":0}},{"line":662,"address":[],"length":0,"stats":{"Line":0}},{"line":663,"address":[],"length":0,"stats":{"Line":0}},{"line":664,"address":[4693946],"length":1,"stats":{"Line":0}},{"line":665,"address":[4693979],"length":1,"stats":{"Line":0}},{"line":666,"address":[4694013,4694134],"length":1,"stats":{"Line":0}},{"line":667,"address":[4702416,4702857,4701939,4702811,4701904,4694142,4702072],"length":1,"stats":{"Line":0}},{"line":668,"address":[4701992],"length":1,"stats":{"Line":0}},{"line":669,"address":[4702048],"length":1,"stats":{"Line":0}},{"line":670,"address":[4702065],"length":1,"stats":{"Line":0}},{"line":671,"address":[4702162,4702206],"length":1,"stats":{"Line":0}},{"line":673,"address":[],"length":0,"stats":{"Line":0}},{"line":674,"address":[],"length":0,"stats":{"Line":0}},{"line":677,"address":[4702186],"length":1,"stats":{"Line":0}},{"line":678,"address":[4702198],"length":1,"stats":{"Line":0}},{"line":680,"address":[3736151],"length":1,"stats":{"Line":0}},{"line":681,"address":[4702725],"length":1,"stats":{"Line":0}},{"line":683,"address":[4694228],"length":1,"stats":{"Line":0}},{"line":685,"address":[],"length":0,"stats":{"Line":0}},{"line":686,"address":[4693896,4694034,4702912,4703325,4702998,4703457,4702942],"length":1,"stats":{"Line":0}},{"line":687,"address":[4703368],"length":1,"stats":{"Line":0}},{"line":688,"address":[4703298,4702975,4703076,4703259],"length":1,"stats":{"Line":0}},{"line":689,"address":[],"length":0,"stats":{"Line":0}},{"line":690,"address":[],"length":0,"stats":{"Line":0}},{"line":691,"address":[4703179],"length":1,"stats":{"Line":0}},{"line":692,"address":[4703290,4703187,4703208,4703435,4703020],"length":1,"stats":{"Line":0}},{"line":693,"address":[],"length":0,"stats":{"Line":0}},{"line":701,"address":[4703504],"length":1,"stats":{"Line":0}},{"line":702,"address":[4703534],"length":1,"stats":{"Line":0}},{"line":705,"address":[],"length":0,"stats":{"Line":0}},{"line":706,"address":[],"length":0,"stats":{"Line":0}},{"line":707,"address":[4703565],"length":1,"stats":{"Line":0}},{"line":708,"address":[4703572],"length":1,"stats":{"Line":0}},{"line":713,"address":[4703616],"length":1,"stats":{"Line":0}},{"line":714,"address":[4703621],"length":1,"stats":{"Line":0}},{"line":718,"address":[],"length":0,"stats":{"Line":0}},{"line":719,"address":[],"length":0,"stats":{"Line":0}},{"line":861,"address":[],"length":0,"stats":{"Line":0}},{"line":862,"address":[],"length":0,"stats":{"Line":0}},{"line":872,"address":[],"length":0,"stats":{"Line":0}},{"line":873,"address":[],"length":0,"stats":{"Line":0}},{"line":876,"address":[],"length":0,"stats":{"Line":0}},{"line":877,"address":[],"length":0,"stats":{"Line":0}},{"line":897,"address":[],"length":0,"stats":{"Line":0}},{"line":904,"address":[],"length":0,"stats":{"Line":0}},{"line":905,"address":[],"length":0,"stats":{"Line":0}},{"line":906,"address":[],"length":0,"stats":{"Line":0}},{"line":910,"address":[],"length":0,"stats":{"Line":0}},{"line":911,"address":[],"length":0,"stats":{"Line":0}},{"line":912,"address":[],"length":0,"stats":{"Line":0}},{"line":918,"address":[],"length":0,"stats":{"Line":0}},{"line":919,"address":[],"length":0,"stats":{"Line":0}},{"line":920,"address":[],"length":0,"stats":{"Line":0}},{"line":926,"address":[],"length":0,"stats":{"Line":0}},{"line":927,"address":[],"length":0,"stats":{"Line":0}},{"line":928,"address":[],"length":0,"stats":{"Line":0}},{"line":938,"address":[],"length":0,"stats":{"Line":0}},{"line":940,"address":[],"length":0,"stats":{"Line":0}},{"line":941,"address":[],"length":0,"stats":{"Line":0}},{"line":942,"address":[],"length":0,"stats":{"Line":0}},{"line":943,"address":[],"length":0,"stats":{"Line":0}},{"line":944,"address":[],"length":0,"stats":{"Line":0}},{"line":947,"address":[],"length":0,"stats":{"Line":0}},{"line":951,"address":[],"length":0,"stats":{"Line":0}},{"line":952,"address":[],"length":0,"stats":{"Line":0}},{"line":953,"address":[],"length":0,"stats":{"Line":0}},{"line":954,"address":[],"length":0,"stats":{"Line":0}},{"line":964,"address":[],"length":0,"stats":{"Line":0}},{"line":966,"address":[],"length":0,"stats":{"Line":0}},{"line":967,"address":[],"length":0,"stats":{"Line":0}},{"line":968,"address":[],"length":0,"stats":{"Line":0}},{"line":969,"address":[],"length":0,"stats":{"Line":0}},{"line":970,"address":[],"length":0,"stats":{"Line":0}},{"line":973,"address":[],"length":0,"stats":{"Line":0}},{"line":977,"address":[],"length":0,"stats":{"Line":0}},{"line":978,"address":[],"length":0,"stats":{"Line":0}},{"line":980,"address":[],"length":0,"stats":{"Line":0}},{"line":982,"address":[],"length":0,"stats":{"Line":0}},{"line":992,"address":[],"length":0,"stats":{"Line":0}},{"line":994,"address":[],"length":0,"stats":{"Line":0}},{"line":995,"address":[],"length":0,"stats":{"Line":0}},{"line":996,"address":[],"length":0,"stats":{"Line":0}},{"line":997,"address":[],"length":0,"stats":{"Line":0}},{"line":998,"address":[],"length":0,"stats":{"Line":0}},{"line":1001,"address":[],"length":0,"stats":{"Line":0}},{"line":1005,"address":[],"length":0,"stats":{"Line":0}},{"line":1006,"address":[],"length":0,"stats":{"Line":0}},{"line":1007,"address":[],"length":0,"stats":{"Line":0}},{"line":1008,"address":[],"length":0,"stats":{"Line":0}},{"line":1017,"address":[],"length":0,"stats":{"Line":0}},{"line":1019,"address":[],"length":0,"stats":{"Line":0}},{"line":1020,"address":[],"length":0,"stats":{"Line":0}},{"line":1021,"address":[],"length":0,"stats":{"Line":0}},{"line":1022,"address":[],"length":0,"stats":{"Line":0}},{"line":1023,"address":[],"length":0,"stats":{"Line":0}},{"line":1026,"address":[],"length":0,"stats":{"Line":0}},{"line":1030,"address":[],"length":0,"stats":{"Line":0}},{"line":1031,"address":[],"length":0,"stats":{"Line":0}},{"line":1033,"address":[],"length":0,"stats":{"Line":0}},{"line":1035,"address":[],"length":0,"stats":{"Line":0}},{"line":1088,"address":[5675696],"length":1,"stats":{"Line":0}},{"line":1089,"address":[5675721],"length":1,"stats":{"Line":0}},{"line":1091,"address":[5675760,5675912,5675906],"length":1,"stats":{"Line":0}},{"line":1092,"address":[5675778],"length":1,"stats":{"Line":0}},{"line":1095,"address":[5675788],"length":1,"stats":{"Line":0}},{"line":1096,"address":[5675823],"length":1,"stats":{"Line":0}},{"line":1108,"address":[],"length":0,"stats":{"Line":0}},{"line":1112,"address":[],"length":0,"stats":{"Line":0}},{"line":1113,"address":[],"length":0,"stats":{"Line":0}},{"line":1114,"address":[],"length":0,"stats":{"Line":0}},{"line":1118,"address":[],"length":0,"stats":{"Line":0}},{"line":1119,"address":[],"length":0,"stats":{"Line":0}},{"line":1120,"address":[],"length":0,"stats":{"Line":0}},{"line":1126,"address":[],"length":0,"stats":{"Line":0}},{"line":1127,"address":[],"length":0,"stats":{"Line":0}},{"line":1128,"address":[],"length":0,"stats":{"Line":0}},{"line":1134,"address":[],"length":0,"stats":{"Line":0}},{"line":1135,"address":[],"length":0,"stats":{"Line":0}},{"line":1136,"address":[],"length":0,"stats":{"Line":0}},{"line":1148,"address":[5675936],"length":1,"stats":{"Line":0}},{"line":1152,"address":[5675946],"length":1,"stats":{"Line":0}},{"line":1154,"address":[5675968,5677749],"length":1,"stats":{"Line":0}},{"line":1155,"address":[5676045,5676121],"length":1,"stats":{"Line":0}},{"line":1156,"address":[5676129,5676937,5676193,5676029],"length":1,"stats":{"Line":0}},{"line":1157,"address":[5676254],"length":1,"stats":{"Line":0}},{"line":1160,"address":[],"length":0,"stats":{"Line":0}},{"line":1161,"address":[],"length":0,"stats":{"Line":0}},{"line":1162,"address":[],"length":0,"stats":{"Line":0}},{"line":1163,"address":[],"length":0,"stats":{"Line":0}},{"line":1169,"address":[5678006,5677792,5677981],"length":1,"stats":{"Line":0}},{"line":1173,"address":[5677828,5677888],"length":1,"stats":{"Line":0}},{"line":1174,"address":[5678383,5678708,5678016,5677896,5678051,5678152,5678613],"length":1,"stats":{"Line":0}},{"line":1175,"address":[5678179,5678236,5678104,5678409],"length":1,"stats":{"Line":0}},{"line":1177,"address":[5677812,5677949],"length":1,"stats":{"Line":0}},{"line":1180,"address":[],"length":0,"stats":{"Line":0}},{"line":1181,"address":[],"length":0,"stats":{"Line":0}},{"line":1182,"address":[5676343],"length":1,"stats":{"Line":0}},{"line":1183,"address":[5676382],"length":1,"stats":{"Line":0}},{"line":1184,"address":[5676422,5677566],"length":1,"stats":{"Line":0}},{"line":1185,"address":[5678787,5678920,5678752,5679264,5677574,5679659,5679705],"length":1,"stats":{"Line":0}},{"line":1186,"address":[5678840],"length":1,"stats":{"Line":0}},{"line":1187,"address":[5678896],"length":1,"stats":{"Line":0}},{"line":1188,"address":[5678913],"length":1,"stats":{"Line":0}},{"line":1189,"address":[5679010,5679054],"length":1,"stats":{"Line":0}},{"line":1191,"address":[],"length":0,"stats":{"Line":0}},{"line":1192,"address":[],"length":0,"stats":{"Line":0}},{"line":1195,"address":[5679034],"length":1,"stats":{"Line":0}},{"line":1196,"address":[5679046],"length":1,"stats":{"Line":0}},{"line":1198,"address":[5678947,5679073,5679290],"length":1,"stats":{"Line":0}},{"line":1199,"address":[5679573],"length":1,"stats":{"Line":0}},{"line":1201,"address":[5677660],"length":1,"stats":{"Line":0}},{"line":1203,"address":[5676309,5676451],"length":1,"stats":{"Line":0}},{"line":1206,"address":[],"length":0,"stats":{"Line":0}},{"line":1207,"address":[],"length":0,"stats":{"Line":0}},{"line":1208,"address":[],"length":0,"stats":{"Line":0}},{"line":1209,"address":[],"length":0,"stats":{"Line":0}},{"line":1215,"address":[5679760,5679974,5679949],"length":1,"stats":{"Line":0}},{"line":1219,"address":[5679796,5679856],"length":1,"stats":{"Line":0}},{"line":1220,"address":[5680676,5679864,5680581,5680019,5679984,5680120,5680351],"length":1,"stats":{"Line":0}},{"line":1221,"address":[5680204,5680096,5680309,5680541],"length":1,"stats":{"Line":0}},{"line":1222,"address":[5680147,5680543,5680072,5680282,5680328,5680377],"length":1,"stats":{"Line":0}},{"line":1224,"address":[5679917,5679780],"length":1,"stats":{"Line":0}},{"line":1227,"address":[],"length":0,"stats":{"Line":0}},{"line":1228,"address":[],"length":0,"stats":{"Line":0}},{"line":1229,"address":[5676507],"length":1,"stats":{"Line":0}},{"line":1230,"address":[5676546],"length":1,"stats":{"Line":0}},{"line":1231,"address":[5676586,5677379],"length":1,"stats":{"Line":0}},{"line":1232,"address":[5680720,5677387,5681232,5681673,5680888,5681627,5680755],"length":1,"stats":{"Line":0}},{"line":1233,"address":[5680808],"length":1,"stats":{"Line":0}},{"line":1234,"address":[5680864],"length":1,"stats":{"Line":0}},{"line":1235,"address":[5680881],"length":1,"stats":{"Line":0}},{"line":1236,"address":[5680978,5681022],"length":1,"stats":{"Line":0}},{"line":1238,"address":[],"length":0,"stats":{"Line":0}},{"line":1239,"address":[],"length":0,"stats":{"Line":0}},{"line":1242,"address":[5681002],"length":1,"stats":{"Line":0}},{"line":1243,"address":[5681014],"length":1,"stats":{"Line":0}},{"line":1245,"address":[5681041,5680915,5681258],"length":1,"stats":{"Line":0}},{"line":1246,"address":[5681541],"length":1,"stats":{"Line":0}},{"line":1248,"address":[5677473],"length":1,"stats":{"Line":0}},{"line":1250,"address":[5676473,5676615],"length":1,"stats":{"Line":0}},{"line":1253,"address":[],"length":0,"stats":{"Line":0}},{"line":1254,"address":[],"length":0,"stats":{"Line":0}},{"line":1255,"address":[],"length":0,"stats":{"Line":0}},{"line":1256,"address":[],"length":0,"stats":{"Line":0}},{"line":1262,"address":[5681728,5681973,5681998],"length":1,"stats":{"Line":0}},{"line":1266,"address":[5681764,5681827],"length":1,"stats":{"Line":0}},{"line":1267,"address":[5682149,5682674,5682447,5682016,5681835,5682051,5682769],"length":1,"stats":{"Line":0}},{"line":1268,"address":[5682104,5682235,5682176,5682473],"length":1,"stats":{"Line":0}},{"line":1270,"address":[5681748,5681941],"length":1,"stats":{"Line":0}},{"line":1273,"address":[],"length":0,"stats":{"Line":0}},{"line":1274,"address":[],"length":0,"stats":{"Line":0}},{"line":1275,"address":[5676671],"length":1,"stats":{"Line":0}},{"line":1276,"address":[5676704],"length":1,"stats":{"Line":0}},{"line":1277,"address":[5677192,5676741],"length":1,"stats":{"Line":0}},{"line":1278,"address":[5683769,5683328,5682816,5682984,5683723,5682851,5677200],"length":1,"stats":{"Line":0}},{"line":1279,"address":[5682904],"length":1,"stats":{"Line":0}},{"line":1280,"address":[5682960],"length":1,"stats":{"Line":0}},{"line":1281,"address":[5682977],"length":1,"stats":{"Line":0}},{"line":1282,"address":[5683118,5683074],"length":1,"stats":{"Line":0}},{"line":1284,"address":[],"length":0,"stats":{"Line":0}},{"line":1285,"address":[],"length":0,"stats":{"Line":0}},{"line":1288,"address":[5683098],"length":1,"stats":{"Line":0}},{"line":1289,"address":[5683110],"length":1,"stats":{"Line":0}},{"line":1291,"address":[3731207],"length":1,"stats":{"Line":0}},{"line":1292,"address":[5683637],"length":1,"stats":{"Line":0}},{"line":1294,"address":[5677286],"length":1,"stats":{"Line":0}},{"line":1296,"address":[5676637,5676770],"length":1,"stats":{"Line":0}},{"line":1299,"address":[],"length":0,"stats":{"Line":0}},{"line":1300,"address":[],"length":0,"stats":{"Line":0}},{"line":1301,"address":[],"length":0,"stats":{"Line":0}},{"line":1302,"address":[],"length":0,"stats":{"Line":0}},{"line":1308,"address":[5684094,5683824,5684069],"length":1,"stats":{"Line":0}},{"line":1312,"address":[5683860,5683923],"length":1,"stats":{"Line":0}},{"line":1313,"address":[5683931,5684245,5684865,5684543,5684770,5684112,5684147],"length":1,"stats":{"Line":0}},{"line":1314,"address":[5684272,5684569,5684331,5684200],"length":1,"stats":{"Line":0}},{"line":1316,"address":[5684037,5683844],"length":1,"stats":{"Line":0}},{"line":1319,"address":[],"length":0,"stats":{"Line":0}},{"line":1320,"address":[],"length":0,"stats":{"Line":0}},{"line":1321,"address":[5676826],"length":1,"stats":{"Line":0}},{"line":1322,"address":[5676859],"length":1,"stats":{"Line":0}},{"line":1323,"address":[5676893,5677014],"length":1,"stats":{"Line":0}},{"line":1324,"address":[5677022,5684912,5685424,5685819,5685865,5685080,5684947],"length":1,"stats":{"Line":0}},{"line":1325,"address":[5685000],"length":1,"stats":{"Line":0}},{"line":1326,"address":[5685056],"length":1,"stats":{"Line":0}},{"line":1327,"address":[5685073],"length":1,"stats":{"Line":0}},{"line":1328,"address":[5685214,5685170],"length":1,"stats":{"Line":0}},{"line":1330,"address":[],"length":0,"stats":{"Line":0}},{"line":1331,"address":[],"length":0,"stats":{"Line":0}},{"line":1334,"address":[5685194],"length":1,"stats":{"Line":0}},{"line":1335,"address":[5685206],"length":1,"stats":{"Line":0}},{"line":1337,"address":[3731687],"length":1,"stats":{"Line":0}},{"line":1338,"address":[5685733],"length":1,"stats":{"Line":0}},{"line":1340,"address":[5677108],"length":1,"stats":{"Line":0}},{"line":1342,"address":[],"length":0,"stats":{"Line":0}},{"line":1343,"address":[5676914,5676776,5685950,5686006,5686333,5686465,5685920],"length":1,"stats":{"Line":0}},{"line":1344,"address":[5686376],"length":1,"stats":{"Line":0}},{"line":1345,"address":[5686267,5686084,5685983,5686306],"length":1,"stats":{"Line":0}},{"line":1346,"address":[],"length":0,"stats":{"Line":0}},{"line":1347,"address":[],"length":0,"stats":{"Line":0}},{"line":1348,"address":[5686187],"length":1,"stats":{"Line":0}},{"line":1349,"address":[5686195,5686443,5686298,5686028,5686216],"length":1,"stats":{"Line":0}},{"line":1350,"address":[],"length":0,"stats":{"Line":0}},{"line":1358,"address":[5686512],"length":1,"stats":{"Line":0}},{"line":1359,"address":[5686542],"length":1,"stats":{"Line":0}},{"line":1362,"address":[],"length":0,"stats":{"Line":0}},{"line":1363,"address":[],"length":0,"stats":{"Line":0}},{"line":1364,"address":[5686573],"length":1,"stats":{"Line":0}},{"line":1365,"address":[5686580],"length":1,"stats":{"Line":0}},{"line":1370,"address":[5686624],"length":1,"stats":{"Line":0}},{"line":1371,"address":[5686629],"length":1,"stats":{"Line":0}},{"line":1375,"address":[],"length":0,"stats":{"Line":0}},{"line":1376,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":444},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","logging.rs"],"content":"use flexi_logger::{Cleanup, Criterion, FileSpec, Logger, Naming, opt_format};\n\npub fn setup_logging() {\n    Logger::try_with_env_or_str(\"debug\")  // Use the log level from the environment or fallback to \"info\"\n        .unwrap()\n        .log_to_file(FileSpec::default().directory(\"/var/log/takeiteasy/\"))\n        .format(opt_format)  // Optional: Custom format for logs\n        .rotate(\n            Criterion::Size(10 * 1024 * 1024), // Rotate logs after they reach 10 MB\n            Naming::Numbers,  // Name log files with numbers (e.g., log.1, log.2)\n            Cleanup::KeepLogFiles(1),  // Keep the last 7 log files\n        )\n        .start()\n        .unwrap();\n}","traces":[{"line":3,"address":[4774997,4774400,4775029],"length":1,"stats":{"Line":0}},{"line":4,"address":[4774636,4774585,4774407,4774841,4774937],"length":1,"stats":{"Line":0}},{"line":6,"address":[4774490,4774628,4775035,4774509],"length":1,"stats":{"Line":0}},{"line":7,"address":[4774665],"length":1,"stats":{"Line":0}},{"line":9,"address":[4774673,4774908,4774789],"length":1,"stats":{"Line":0}},{"line":10,"address":[4774805],"length":1,"stats":{"Line":0}},{"line":11,"address":[4774817],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":7},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","main.rs"],"content":"// main.rs - Version corrig√©e avec les bonnes compatibilit√©s\nuse clap::Parser;\nuse futures_util::StreamExt;\nuse std::net::SocketAddr;\nuse std::path::Path;\nuse std::sync::{Arc, Mutex};\nuse tch::nn::{self, OptimizerConfig};\nuse tch::Device;\nuse tokio::fs;\nuse tokio::net::TcpListener;\nuse tokio_tungstenite::accept_async;\nuse tonic::transport::Server;\nuse tonic_web::GrpcWebLayer;\nuse http::{header, Method, StatusCode};\nuse tonic::body::BoxBody;\nuse tonic::transport::Body;\nuse tower::{Layer, Service};\nuse std::task::{Context, Poll};\nuse std::pin::Pin;\nuse std::future::Future;\n\n// Imports Axum pour le serveur web\nuse axum::{\n    response::Html,\n    routing::get,\n    Router,\n};\nuse tower_http::cors::{Any, CorsLayer};\nuse tower_http::services::ServeDir;\n\nuse crate::logging::setup_logging;\nuse crate::mcts_vs_human::play_mcts_vs_human;\nuse neural::policy_value_net::{PolicyNet, ValueNet};\nuse crate::training::session::train_and_evaluate;\n\n// Services gRPC\nuse crate::services::session_service::SessionServiceImpl;\nuse crate::services::game_service::GameServiceImpl;\nuse crate::generated::takeiteasygame::v1::session_service_server::SessionServiceServer;\nuse crate::generated::takeiteasygame::v1::game_service_server::GameServiceServer;\n\n#[cfg(test)]\nmod test;\n\n// Modules existants (inchang√©s)\nmod game;\nmod logging;\nmod mcts;\nmod mcts_vs_human;\nmod neural;\nmod utils;\nmod strategy;\nmod scoring;\nmod data;\nmod training;\n\n// Nouveaux modules avec paradigme fonctionnel\nmod generated;\nmod services;\n\n#[derive(Parser, Debug)]\n#[command(name = \"take_it_easy\")]\nstruct Config {\n    /// Number of games to simulate\n    #[arg(short = 'g', long, default_value_t = 200)]\n    num_games: usize,\n\n    /// Number of simulations per game state\n    #[arg(short = 's', long, default_value_t = 150)]\n    num_simulations: usize,\n\n    /// Mode de jeu\n    #[arg(long, value_enum, default_value = \"mcts-vs-human\")]\n    mode: GameMode,\n\n    /// Port pour le serveur gRPC Multiplayer\n    #[arg(short = 'p', long, default_value_t = 50051)]\n    port: u16,\n}\n\n#[derive(clap::ValueEnum, Clone, Debug)]\nenum GameMode {\n    /// Mode entra√Ænement normal\n    Training,\n    /// MCTS vs un seul humain\n    MctsVsHuman,\n    /// MCTS vs plusieurs humains (style Kahoot)\n    Multiplayer,\n}\n\n// ============================================================================\n// SERVEUR WEB POUR LES FICHIERS STATIQUES\n// ============================================================================\n\nasync fn start_web_server(port: u16) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    let app = Router::new()\n        .route(\"/\", get(|| async {\n            Html(fs::read_to_string(\"web/index.html\").await.unwrap_or_else(|_|\n                r#\"\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\u003chead\u003e\u003ctitle\u003eTake It Easy\u003c/title\u003e\u003c/head\u003e\n\u003cbody\u003e\n\u003ch1\u003eüéÆ Take It Easy - Multiplayer\u003c/h1\u003e\n\u003cp\u003ePlace your frontend files in ./web/ directory\u003c/p\u003e\n\u003cp\u003egRPC server is running on port 50051\u003c/p\u003e\n\u003c/body\u003e\u003c/html\u003e\"#.to_string()\n            ))\n        }))\n        .nest_service(\"/static\", ServeDir::new(\"web\"))\n        .fallback_service(ServeDir::new(\"web\"))\n        .layer(\n            CorsLayer::new()\n                .allow_origin(Any)\n                .allow_methods(Any)\n                .allow_headers(Any)\n        );\n\n    let addr: SocketAddr = format!(\"0.0.0.0:{}\", port + 1000).parse()?;\n    let listener = tokio::net::TcpListener::bind(addr).await?;\n    axum::serve(listener, app).await?;\n    Ok(())\n}\n#[derive(Clone)]\npub struct SimpleCors\u003cS\u003e {\n    inner: S,\n}\n\nimpl\u003cS\u003e SimpleCors\u003cS\u003e {\n    pub fn new(inner: S) -\u003e Self {\n        Self { inner }\n    }\n}\n\nimpl\u003cS\u003e Service\u003chttp::Request\u003cBody\u003e\u003e for SimpleCors\u003cS\u003e\nwhere\n    S: Service\u003chttp::Request\u003cBody\u003e, Response = http::Response\u003cBoxBody\u003e\u003e + Clone + Send + 'static,\n    S::Future: Send + 'static,\n{\n    type Response = S::Response;\n    type Error = S::Error;\n    type Future = Pin\u003cBox\u003cdyn Future\u003cOutput = Result\u003cSelf::Response, Self::Error\u003e\u003e + Send\u003e\u003e;\n\n    fn poll_ready(\u0026mut self, cx: \u0026mut Context\u003c'_\u003e) -\u003e Poll\u003cResult\u003c(), Self::Error\u003e\u003e {\n        self.inner.poll_ready(cx)\n    }\n\n    fn call(\u0026mut self, req: http::Request\u003cBody\u003e) -\u003e Self::Future {\n        let mut inner = self.inner.clone();\n\n        Box::pin(async move {\n            // Handle preflight OPTIONS requests\n            if req.method() == Method::OPTIONS {\n                let response = http::Response::builder()\n                    .status(StatusCode::OK)\n                    .header(header::ACCESS_CONTROL_ALLOW_ORIGIN, \"*\")\n                    .header(header::ACCESS_CONTROL_ALLOW_METHODS, \"GET, POST, OPTIONS\")\n                    .header(header::ACCESS_CONTROL_ALLOW_HEADERS, \"content-type, x-grpc-web, x-user-agent, grpc-timeout, grpc-accept-encoding\")\n                    .header(header::ACCESS_CONTROL_MAX_AGE, \"86400\")\n                    .body(BoxBody::default())\n                    .unwrap();\n\n                return Ok(response);\n            }\n\n            // Process normal request and add CORS headers to response\n            let mut response = inner.call(req).await?;\n\n            let headers = response.headers_mut();\n            headers.insert(header::ACCESS_CONTROL_ALLOW_ORIGIN, header::HeaderValue::from_static(\"*\"));\n            headers.insert(header::ACCESS_CONTROL_ALLOW_METHODS, header::HeaderValue::from_static(\"GET, POST, OPTIONS\"));\n            headers.insert(header::ACCESS_CONTROL_ALLOW_HEADERS, header::HeaderValue::from_static(\"content-type, x-grpc-web, x-user-agent, grpc-timeout, grpc-accept-encoding\"));\n            headers.insert(header::ACCESS_CONTROL_EXPOSE_HEADERS, header::HeaderValue::from_static(\"grpc-status, grpc-message\"));\n\n            Ok(response)\n        })\n    }\n}\n\n// Layer pour le middleware\n#[derive(Clone)]\npub struct SimpleCorsLayer;\n\nimpl\u003cS\u003e Layer\u003cS\u003e for SimpleCorsLayer {\n    type Service = SimpleCors\u003cS\u003e;\n\n    fn layer(\u0026self, inner: S) -\u003e Self::Service {\n        SimpleCors::new(inner)\n    }\n}\n// ============================================================================\n// SERVEUR GRPC AVEC GRPC-WEB\n// ============================================================================\n\nasync fn start_multiplayer_server(\n    policy_net: PolicyNet,\n    value_net: ValueNet,\n    num_simulations: usize,\n    port: u16,\n) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    let addr: SocketAddr = format!(\"0.0.0.0:{}\", port).parse()?;\n\n    // Cr√©er le session manager partag√©\n    let session_manager = Arc::new(crate::services::session_manager::new_session_manager());\n\n    // Wrapper les r√©seaux de neurones pour le partage\n    let policy_net_arc = Arc::new(Mutex::new(policy_net));\n    let value_net_arc = Arc::new(Mutex::new(value_net));\n\n    // Cr√©er les services gRPC (avec les nouvelles m√©thodes gameplay)\n    let session_service = SessionServiceImpl::new_with_manager(session_manager.clone()); // ‚Üê Modifi√©\n    let game_service = GameServiceImpl::new(\n        session_manager.clone(),\n        policy_net_arc.clone(),\n        value_net_arc.clone(),\n        num_simulations\n    );\n\n    // Serveur gRPC UNIQUEMENT - plus de REST\n    Server::builder()\n        .accept_http1(true)\n        .layer(SimpleCorsLayer)\n        .layer(GrpcWebLayer::new())\n        .add_service(SessionServiceServer::new(session_service))\n        .add_service(GameServiceServer::new(game_service)) // ‚Üê Maintenant avec StartTurn et GetGameState\n        .serve(addr)\n        .await?;\n\n    Ok(())\n}\n\n// ============================================================================\n// FONCTION PRINCIPALE\n// ============================================================================\n\n#[tokio::main]\nasync fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    let config = Config::parse();\n    let model_path = \"model_weights\";\n    setup_logging();\n    // Initialize VarStore (votre syst√®me existant)\n    let mut vs_policy = nn::VarStore::new(Device::Cpu);\n    let mut vs_value = nn::VarStore::new(Device::Cpu);\n    let input_dim = (5, 47, 1);\n    let mut policy_net = PolicyNet::new(\u0026vs_policy, input_dim);\n    let mut value_net = ValueNet::new(\u0026mut vs_value, input_dim);\n\n    // Load weights if the model directory exists\n    if Path::new(model_path).exists() {\n        if let Err(e) = policy_net.load_model(\u0026mut vs_policy, \"model_weights/policy/policy.params\")\n        {\n            log::error!(\"‚ö†Ô∏è Error loading PolicyNet: {:?}\", e);        }\n\n        if let Err(e) = value_net.load_model(\u0026mut vs_value, \"model_weights/value/value.params\") {\n            log::error!(\"‚ö†Ô∏è Error loading ValueNet: {:?}\", e);        }\n    } else {    }\n\n    let mut optimizer_policy = nn::Adam::default().build(\u0026vs_policy, 1e-3).unwrap();\n    let mut optimizer_value = nn::Adam {\n        wd: 1e-6,\n        ..Default::default()\n    }\n        .build(\u0026vs_value, 2e-4)\n        .unwrap();\n\n    // Match sur les modes\n    match config.mode {\n        GameMode::Training =\u003e {            let listener = TcpListener::bind(\"127.0.0.1:9000\")\n                .await\n                .expect(\"Unable to bind WebSocket on port 9000 for training\");\n            train_and_evaluate(\n                \u0026vs_policy,\n                \u0026vs_value,\n                \u0026mut policy_net,\n                \u0026mut value_net,\n                \u0026mut optimizer_policy,\n                \u0026mut optimizer_value,\n                config.num_games,\n                config.num_simulations,\n                50,\n                listener.into(),\n            )\n                .await;\n        }\n\n        GameMode::MctsVsHuman =\u003e {            let listener = TcpListener::bind(\"127.0.0.1:9001\")\n                .await\n                .expect(\"Unable to bind WebSocket on port 9001 for MCTS vs Human\");\n\n            let (stream, _) = listener.accept().await.unwrap();\n            let ws_stream = accept_async(stream).await.unwrap();\n            let (mut write, mut read) = ws_stream.split();\n\n            play_mcts_vs_human(\n                \u0026policy_net,\n                \u0026value_net,\n                config.num_simulations,\n                \u0026mut write,\n                \u0026mut read,\n                (\u0026listener).into(),\n            )\n                .await;\n        }\n\n        GameMode::Multiplayer =\u003e {\n            // Lancer le serveur web en arri√®re-plan\n            let web_port = config.port;\n            tokio::spawn(async move {\n                if let Err(e) = start_web_server(web_port).await {\n                    log::error!(\"‚ùå Web server error: {}\", e);\n                }\n            });\n\n            // Donner un peu de temps au serveur web pour d√©marrer\n            tokio::time::sleep(tokio::time::Duration::from_millis(500)).await;\n\n            // Lancer le serveur gRPC (bloquant)\n            start_multiplayer_server(\n                policy_net,\n                value_net,\n                config.num_simulations,\n                config.port,\n            )\n                .await?;\n        }\n    }    Ok(())\n}","traces":[{"line":95,"address":[4703632,4703643],"length":1,"stats":{"Line":0}},{"line":96,"address":[4904682,4903936,4904082,4904470,4904154,4904312],"length":1,"stats":{"Line":0}},{"line":97,"address":[4906979,4907529,4907190,4904090,4906928,4907056,4907090,4906944,4906936],"length":1,"stats":{"Line":0}},{"line":98,"address":[4907029,4907147,4907216,4907536,4907627,4907633,4907080],"length":1,"stats":{"Line":0}},{"line":99,"address":[4907552],"length":1,"stats":{"Line":0}},{"line":105,"address":[4907575,4907607],"length":1,"stats":{"Line":0}},{"line":108,"address":[4904386,4905558,4904271,4905628,4904023,4904244],"length":1,"stats":{"Line":0}},{"line":109,"address":[4904031,4904402,4904525,4905533,4905636,4904429],"length":1,"stats":{"Line":0}},{"line":111,"address":[4904541,4904601],"length":1,"stats":{"Line":0}},{"line":117,"address":[4904915,4905444,4904788],"length":1,"stats":{"Line":0}},{"line":118,"address":[4905260,4905695,4903981,4905370,4906344],"length":1,"stats":{"Line":0}},{"line":119,"address":[4906798,4906107,4904002,4906267,4906377],"length":1,"stats":{"Line":0}},{"line":120,"address":[4906686],"length":1,"stats":{"Line":0}},{"line":128,"address":[4907648],"length":1,"stats":{"Line":0}},{"line":142,"address":[4907680],"length":1,"stats":{"Line":0}},{"line":143,"address":[4907701],"length":1,"stats":{"Line":0}},{"line":146,"address":[4907728,4907936,4907965],"length":1,"stats":{"Line":0}},{"line":147,"address":[4907775],"length":1,"stats":{"Line":0}},{"line":149,"address":[4908019,4908157,4907984,4907828,4909037,4910791,4907754],"length":1,"stats":{"Line":0}},{"line":151,"address":[4908072,4908247],"length":1,"stats":{"Line":0}},{"line":152,"address":[4908377,4908903,4908942,4908499],"length":1,"stats":{"Line":0}},{"line":153,"address":[],"length":0,"stats":{"Line":0}},{"line":154,"address":[],"length":0,"stats":{"Line":0}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[],"length":0,"stats":{"Line":0}},{"line":157,"address":[4908827],"length":1,"stats":{"Line":0}},{"line":158,"address":[4908934,4909015,4908464,4908852,4908835],"length":1,"stats":{"Line":0}},{"line":159,"address":[],"length":0,"stats":{"Line":0}},{"line":161,"address":[4908969],"length":1,"stats":{"Line":0}},{"line":165,"address":[4909069,4908400,4908184,4908285,4911014],"length":1,"stats":{"Line":0}},{"line":167,"address":[4909788,4909717],"length":1,"stats":{"Line":0}},{"line":168,"address":[4909861,4909796,4910982],"length":1,"stats":{"Line":0}},{"line":169,"address":[4909976,4910950,4910041],"length":1,"stats":{"Line":0}},{"line":170,"address":[4910221,4910918,4910156],"length":1,"stats":{"Line":0}},{"line":171,"address":[4910336,4910886,4910401],"length":1,"stats":{"Line":0}},{"line":173,"address":[4910516],"length":1,"stats":{"Line":0}},{"line":185,"address":[4911152],"length":1,"stats":{"Line":0}},{"line":186,"address":[4911180],"length":1,"stats":{"Line":0}},{"line":193,"address":[4703664],"length":1,"stats":{"Line":0}},{"line":199,"address":[4911718,4911593,4913824],"length":1,"stats":{"Line":0}},{"line":202,"address":[4912081],"length":1,"stats":{"Line":0}},{"line":205,"address":[4912277,4912160],"length":1,"stats":{"Line":0}},{"line":206,"address":[4912329,4912446],"length":1,"stats":{"Line":0}},{"line":209,"address":[4912592,4912498],"length":1,"stats":{"Line":0}},{"line":211,"address":[4912632,4912699],"length":1,"stats":{"Line":0}},{"line":212,"address":[4912715,4912793],"length":1,"stats":{"Line":0}},{"line":213,"address":[4912809],"length":1,"stats":{"Line":0}},{"line":218,"address":[4914495,4912965,4913297,4913423,4914059,4913603,4913138,4914195,4913048,4914129,4913470],"length":1,"stats":{"Line":0}},{"line":220,"address":[4913078],"length":1,"stats":{"Line":0}},{"line":221,"address":[4913195,4913086,4912984,4913097,4913698],"length":1,"stats":{"Line":0}},{"line":222,"address":[4913304,4913203],"length":1,"stats":{"Line":0}},{"line":223,"address":[4912992,4913674,4913312,4913382,4913241,4913462],"length":1,"stats":{"Line":0}},{"line":225,"address":[3772032,3772142],"length":1,"stats":{"Line":0}},{"line":227,"address":[4914277],"length":1,"stats":{"Line":0}},{"line":235,"address":[4715840,4716303,4716297],"length":1,"stats":{"Line":0}},{"line":236,"address":[4915767],"length":1,"stats":{"Line":0}},{"line":237,"address":[4915675],"length":1,"stats":{"Line":0}},{"line":238,"address":[4916090],"length":1,"stats":{"Line":0}},{"line":240,"address":[4916097],"length":1,"stats":{"Line":0}},{"line":241,"address":[4916144],"length":1,"stats":{"Line":0}},{"line":242,"address":[4916239],"length":1,"stats":{"Line":0}},{"line":243,"address":[4916275,4916400],"length":1,"stats":{"Line":0}},{"line":244,"address":[4916415,4916547],"length":1,"stats":{"Line":0}},{"line":247,"address":[4916562,4918074,4916665],"length":1,"stats":{"Line":0}},{"line":248,"address":[4916792,4916714],"length":1,"stats":{"Line":0}},{"line":250,"address":[4917434,4916757,4917366,4916954,4916909],"length":1,"stats":{"Line":0}},{"line":252,"address":[4917384,4917488],"length":1,"stats":{"Line":0}},{"line":253,"address":[4917605,4917696],"length":1,"stats":{"Line":0}},{"line":254,"address":[4917650,4918056,4917453,4918079],"length":1,"stats":{"Line":0}},{"line":256,"address":[4916692,4918098],"length":1,"stats":{"Line":0}},{"line":261,"address":[4918334],"length":1,"stats":{"Line":0}},{"line":265,"address":[4918418],"length":1,"stats":{"Line":0}},{"line":266,"address":[4918666,4918463,4919200,4919270],"length":1,"stats":{"Line":0}},{"line":267,"address":[4915880,4919047,4919248,4918699,4918659],"length":1,"stats":{"Line":0}},{"line":270,"address":[4919312],"length":1,"stats":{"Line":0}},{"line":271,"address":[4919328],"length":1,"stats":{"Line":0}},{"line":272,"address":[4919343],"length":1,"stats":{"Line":0}},{"line":273,"address":[4919358],"length":1,"stats":{"Line":0}},{"line":274,"address":[4919376],"length":1,"stats":{"Line":0}},{"line":275,"address":[4919394],"length":1,"stats":{"Line":0}},{"line":276,"address":[4919412],"length":1,"stats":{"Line":0}},{"line":277,"address":[4919424],"length":1,"stats":{"Line":0}},{"line":279,"address":[4919436],"length":1,"stats":{"Line":0}},{"line":281,"address":[3759242],"length":1,"stats":{"Line":0}},{"line":284,"address":[4920095,4918755,4920025,4918493],"length":1,"stats":{"Line":0}},{"line":285,"address":[4920073,4915922,4918788,4918748,4919872],"length":1,"stats":{"Line":0}},{"line":288,"address":[3759286],"length":1,"stats":{"Line":0}},{"line":289,"address":[4920833,4915964,4920683,4920903],"length":1,"stats":{"Line":0}},{"line":290,"address":[4921154],"length":1,"stats":{"Line":0}},{"line":293,"address":[4921237],"length":1,"stats":{"Line":0}},{"line":294,"address":[4921260],"length":1,"stats":{"Line":0}},{"line":295,"address":[4921277],"length":1,"stats":{"Line":0}},{"line":296,"address":[4921289],"length":1,"stats":{"Line":0}},{"line":297,"address":[4921306],"length":1,"stats":{"Line":0}},{"line":298,"address":[4921323],"length":1,"stats":{"Line":0}},{"line":300,"address":[3759334],"length":1,"stats":{"Line":0}},{"line":305,"address":[4918523],"length":1,"stats":{"Line":0}},{"line":306,"address":[4918829,4923255,4923129,4923356,4918543,4923210,4924026,4923104],"length":1,"stats":{"Line":0}},{"line":307,"address":[4923655,4923179,4923312,4923382,4923237],"length":1,"stats":{"Line":0}},{"line":308,"address":[4923708,4923736,4923613],"length":1,"stats":{"Line":0}},{"line":313,"address":[3759356],"length":1,"stats":{"Line":0}},{"line":317,"address":[4922072],"length":1,"stats":{"Line":0}},{"line":318,"address":[4922136],"length":1,"stats":{"Line":0}},{"line":319,"address":[4922196],"length":1,"stats":{"Line":0}},{"line":322,"address":[3759382],"length":1,"stats":{"Line":0}},{"line":324,"address":[4716169,4715985],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":106},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","mcts","algorithm.rs"],"content":"use std::collections::HashMap;\nuse tch::IndexOp;\nuse crate::game::deck::Deck;\nuse crate::game::get_legal_moves::get_legal_moves;\nuse crate::game::plateau::Plateau;\nuse crate::game::plateau_is_full::is_plateau_full;\nuse crate::game::remove_tile_from_deck::replace_tile_in_deck;\nuse crate::game::simulate_game::simulate_games;\nuse crate::game::tile::Tile;\nuse crate::mcts::mcts_result::MCTSResult;\nuse crate::neural::policy_value_net::{PolicyNet, ValueNet};\nuse crate::neural::tensor_conversion::convert_plateau_to_tensor;\nuse crate::scoring::scoring::result;\nuse crate::strategy::position_evaluation::enhanced_position_evaluation;\nuse crate::utils::random_index::random_index;\n\npub fn mcts_find_best_position_for_tile_with_nn(\n    plateau: \u0026mut Plateau,\n    deck: \u0026mut Deck,\n    chosen_tile: Tile,\n    policy_net: \u0026PolicyNet,\n    value_net: \u0026ValueNet,\n    num_simulations: usize,\n    current_turn: usize,\n    total_turns: usize,\n) -\u003e MCTSResult {\n    let legal_moves = get_legal_moves(plateau.clone());\n    if legal_moves.is_empty() {\n        return MCTSResult {\n            best_position: 0,\n            board_tensor: convert_plateau_to_tensor(\n                plateau,\n                \u0026chosen_tile,\n                deck,\n                current_turn,\n                total_turns,\n            ),\n            subscore: 0.0,\n        };\n    }\n\n    let board_tensor =\n        convert_plateau_to_tensor(plateau, \u0026chosen_tile, deck, current_turn, total_turns);\n    let policy_logits = policy_net.forward(\u0026board_tensor, false);\n    let policy = policy_logits.log_softmax(-1, tch::Kind::Float).exp(); // Log-softmax improves numerical stability\n\n    let mut visit_counts: HashMap\u003cusize, usize\u003e = HashMap::new();\n    let mut total_scores: HashMap\u003cusize, f64\u003e = HashMap::new();\n    let mut ucb_scores: HashMap\u003cusize, f64\u003e = HashMap::new();\n    let mut total_visits: i32 = 0;\n\n    for \u0026position in \u0026legal_moves {\n        visit_counts.insert(position, 0);\n        total_scores.insert(position, 0.0);\n        ucb_scores.insert(position, f64::NEG_INFINITY);\n    }\n\n    let c_puct = if current_turn \u003c 5 {\n        4.2 // Plus d'exploitation en d√©but de partie (positions critiques)\n    } else if current_turn \u003e 15 {\n        3.0 // Plus d'exploration en fin de partie (adaptation)\n    } else {\n        3.8 // √âquilibre pour le milieu de partie\n    };\n\n    // **Compute ValueNet scores for all legal moves**\n    let mut value_estimates = HashMap::new();\n    let mut min_value = f64::INFINITY;\n    let mut max_value = f64::NEG_INFINITY;\n\n    for \u0026position in \u0026legal_moves {\n        let mut temp_plateau = plateau.clone();\n        let mut temp_deck = deck.clone();\n\n        temp_plateau.tiles[position] = chosen_tile;\n        temp_deck = replace_tile_in_deck(\u0026temp_deck, \u0026chosen_tile);\n        let board_tensor_temp = convert_plateau_to_tensor(\n            \u0026temp_plateau,\n            \u0026chosen_tile,\n            \u0026temp_deck,\n            current_turn,\n            total_turns,\n        );\n\n        let pred_value = value_net\n            .forward(\u0026board_tensor_temp, false)\n            .double_value(\u0026[]);\n        let pred_value = pred_value.clamp(-1.0, 1.0);\n\n        // Track min and max for dynamic pruning\n        min_value = min_value.min(pred_value);\n        max_value = max_value.max(pred_value);\n\n        value_estimates.insert(position, pred_value);\n    }\n\n    // **Dynamic Pruning Strategy**\n    let value_threshold = if current_turn \u003c 8 {\n        min_value + (max_value - min_value) * 0.1 // Garder plus de candidats en d√©but\n    } else {\n        min_value + (max_value - min_value) * 0.15 // Pruning moins agressif\n    };\n\n    for _ in 0..num_simulations {\n        let mut moves_with_prior: Vec\u003c_\u003e = legal_moves\n            .iter()\n            .filter(|\u0026\u0026pos| value_estimates[\u0026pos] \u003e= value_threshold) // Prune weak moves\n            .map(|\u0026pos| (pos, policy.i((0, pos as i64)).double_value(\u0026[])))\n            .collect();\n\n        moves_with_prior.sort_by(|a, b| b.1.partial_cmp(\u0026a.1).unwrap_or(std::cmp::Ordering::Equal));\n\n        let top_k = usize::min(\n            moves_with_prior.len(),\n            ((total_visits as f64).sqrt() as usize).max(5),\n        );\n\n        let subset_moves: Vec\u003cusize\u003e = moves_with_prior\n            .iter()\n            .take(top_k)\n            .map(|\u0026(pos, _)| pos)\n            .collect();\n\n        for \u0026position in \u0026subset_moves {\n            let mut temp_plateau = plateau.clone();\n            let mut temp_deck = deck.clone();\n\n            temp_plateau.tiles[position] = chosen_tile;\n            temp_deck = replace_tile_in_deck(\u0026temp_deck, \u0026chosen_tile);\n\n            let value_estimate = *value_estimates.get(\u0026position).unwrap_or(\u00260.0);\n\n            // **Improved Adaptive Rollout Strategy**\n            let rollout_count = match value_estimate {\n                x if x \u003e 8.0 =\u003e 2, // Very strong move -\u003e minimal rollouts\n                x if x \u003e 6.0 =\u003e 4, // Strong move -\u003e fewer rollouts\n                x if x \u003e 4.0 =\u003e 6, // Decent move -\u003e moderate rollouts\n                _ =\u003e 8,            // Uncertain move -\u003e more rollouts\n            };\n\n            let mut total_simulated_score = 0.0;\n\n            for _ in 0..rollout_count {\n                let lookahead_plateau = temp_plateau.clone();\n                let lookahead_deck = temp_deck.clone();\n\n                // üîÆ √âtape 1.1 ‚Äî Tirer une tuile hypoth√©tique (T2)\n                if lookahead_deck.tiles.is_empty() {\n                    continue;\n                }\n                let tile2_index = random_index(lookahead_deck.tiles.len());\n                let tile2 = lookahead_deck.tiles[tile2_index];\n\n                // üîç √âtape 1.2 ‚Äî Simuler tous les placements possibles de cette tuile\n                let second_moves = get_legal_moves(lookahead_plateau.clone());\n\n                let mut best_score_for_tile2: f64 = 0.0;\n\n                for \u0026pos2 in \u0026second_moves {\n                    let mut plateau2 = lookahead_plateau.clone();\n                    let mut deck2 = lookahead_deck.clone();\n\n                    plateau2.tiles[pos2] = tile2;\n                    deck2 = replace_tile_in_deck(\u0026deck2, \u0026tile2);\n\n                    let score = simulate_games(plateau2.clone(), deck2.clone()) as f64;\n                    best_score_for_tile2 = best_score_for_tile2.max(score);\n                }\n\n                total_simulated_score += best_score_for_tile2;\n            }\n\n            let simulated_score = total_simulated_score / rollout_count as f64;\n\n            let visits = visit_counts.entry(position).or_insert(0);\n            *visits += 1;\n            total_visits += 1;\n\n            let total_score = total_scores.entry(position).or_insert(0.0);\n            *total_score += simulated_score as f64;\n\n            let exploration_param = c_puct * (total_visits as f64).ln() / (1.0 + *visits as f64);\n            let prior_prob = policy.i((0, position as i64)).double_value(\u0026[]);\n            let average_score = *total_score / (*visits as f64);\n            // üß™ Reduce weight of rollout average\n            let enhanced_eval =\n                enhanced_position_evaluation(\u0026temp_plateau, position, \u0026chosen_tile, current_turn);\n\n            // Int√©grer dans le calcul UCB\n            let mut ucb_score = (average_score * 0.5)\n                + exploration_param * (prior_prob.sqrt())\n                + 0.25 * value_estimate.clamp(0.0, 2.0)\n                + 0.1 * enhanced_eval; // Nouveau facteur d'√©valuation\n\n            // üî• Explicit Priority Logic HERE üî•\n            // 1Ô∏è‚É£ Ajoute cette fonction en dehors de ta mcts_find_best_position_for_tile_with_nn\n\n            // 2Ô∏è‚É£ Int√®gre ceci dans ta boucle ucb_scores, juste apr√®s le boost fixe\n\n            if chosen_tile.0 == 9 \u0026\u0026 [7, 8, 9, 10, 11].contains(\u0026position) {\n                ucb_score += 10000.0; // double boost\n            } else if chosen_tile.0 == 5 \u0026\u0026 [3, 4, 5, 6, 12, 13, 14, 15].contains(\u0026position) {\n                ucb_score += 8000.0;\n            } else if chosen_tile.0 == 1 \u0026\u0026 [0, 1, 2, 16, 17, 18].contains(\u0026position) {\n                ucb_score += 6000.0;\n            }\n\n            // üî• Alignment Priority Logic üî•\n\n            ucb_scores.insert(position, ucb_score);\n        }\n    }\n\n    // Select the move with the highest UCB score\n    let best_position = legal_moves\n        .into_iter()\n        .max_by(|\u0026a, \u0026b| {\n            ucb_scores\n                .get(\u0026a)\n                .unwrap_or(\u0026f64::NEG_INFINITY)\n                .partial_cmp(ucb_scores.get(\u0026b).unwrap_or(\u0026f64::NEG_INFINITY))\n                .unwrap_or(std::cmp::Ordering::Equal)\n        })\n        .unwrap_or(0);\n\n    // **NEW: Simulate the Rest of the Game to Get Final Score**\n    let mut final_plateau = plateau.clone();\n    let mut final_deck = deck.clone();\n    final_plateau.tiles[best_position] = chosen_tile;\n    final_deck = replace_tile_in_deck(\u0026final_deck, \u0026chosen_tile);\n\n    while !is_plateau_full(\u0026final_plateau) {\n        let tile_index = random_index(final_deck.tiles.len());\n        let random_tile = final_deck.tiles[tile_index];\n\n        let available_moves = get_legal_moves(final_plateau.clone());\n        if available_moves.is_empty() {\n            break;\n        }\n\n        let random_position = available_moves[random_index(available_moves.len())];\n        final_plateau.tiles[random_position] = random_tile;\n        final_deck = replace_tile_in_deck(\u0026final_deck, \u0026random_tile);\n    }\n\n    let final_score = result(\u0026final_plateau); // Get actual game score\n    MCTSResult {\n        best_position,\n        board_tensor,\n        subscore: final_score as f64, // Store real final score, not UCB score\n    }\n}","traces":[{"line":17,"address":[5440688,5443661,5448920],"length":1,"stats":{"Line":0}},{"line":27,"address":[5440831],"length":1,"stats":{"Line":0}},{"line":28,"address":[5440987,5440921],"length":1,"stats":{"Line":0}},{"line":29,"address":[5448874],"length":1,"stats":{"Line":0}},{"line":31,"address":[5441088],"length":1,"stats":{"Line":0}},{"line":42,"address":[5441033,5441122],"length":1,"stats":{"Line":0}},{"line":44,"address":[5441148,5441212],"length":1,"stats":{"Line":0}},{"line":45,"address":[5441319,5441220],"length":1,"stats":{"Line":0}},{"line":47,"address":[5441482],"length":1,"stats":{"Line":0}},{"line":48,"address":[5441497],"length":1,"stats":{"Line":0}},{"line":49,"address":[5441549],"length":1,"stats":{"Line":0}},{"line":50,"address":[5441593],"length":1,"stats":{"Line":0}},{"line":52,"address":[5441692,5441604],"length":1,"stats":{"Line":0}},{"line":53,"address":[5441821],"length":1,"stats":{"Line":0}},{"line":54,"address":[5448793],"length":1,"stats":{"Line":0}},{"line":55,"address":[5448824],"length":1,"stats":{"Line":0}},{"line":58,"address":[5441839,5441878],"length":1,"stats":{"Line":0}},{"line":59,"address":[5441861],"length":1,"stats":{"Line":0}},{"line":60,"address":[5441853,5441897],"length":1,"stats":{"Line":0}},{"line":61,"address":[5441899],"length":1,"stats":{"Line":0}},{"line":63,"address":[5441880],"length":1,"stats":{"Line":0}},{"line":67,"address":[5441924],"length":1,"stats":{"Line":0}},{"line":68,"address":[5441941],"length":1,"stats":{"Line":0}},{"line":69,"address":[5441959],"length":1,"stats":{"Line":0}},{"line":71,"address":[5441967,5442058],"length":1,"stats":{"Line":0}},{"line":72,"address":[5442191],"length":1,"stats":{"Line":0}},{"line":73,"address":[5448013],"length":1,"stats":{"Line":0}},{"line":75,"address":[5448068,5448145],"length":1,"stats":{"Line":0}},{"line":76,"address":[5448173],"length":1,"stats":{"Line":0}},{"line":85,"address":[5448446,5448535,5448385],"length":1,"stats":{"Line":0}},{"line":87,"address":[5448544,5448488],"length":1,"stats":{"Line":0}},{"line":88,"address":[5448585],"length":1,"stats":{"Line":0}},{"line":91,"address":[5448613],"length":1,"stats":{"Line":0}},{"line":92,"address":[5448656],"length":1,"stats":{"Line":0}},{"line":94,"address":[5448715],"length":1,"stats":{"Line":0}},{"line":98,"address":[5442267,5442209],"length":1,"stats":{"Line":0}},{"line":99,"address":[5442269],"length":1,"stats":{"Line":0}},{"line":101,"address":[5442215],"length":1,"stats":{"Line":0}},{"line":104,"address":[5442329],"length":1,"stats":{"Line":0}},{"line":105,"address":[5443905,5442435],"length":1,"stats":{"Line":0}},{"line":107,"address":[4120224,4120243],"length":1,"stats":{"Line":0}},{"line":108,"address":[4120304,4120318],"length":1,"stats":{"Line":0}},{"line":111,"address":[4120464,4120494],"length":1,"stats":{"Line":0}},{"line":114,"address":[5444135],"length":1,"stats":{"Line":0}},{"line":115,"address":[5444150],"length":1,"stats":{"Line":0}},{"line":118,"address":[5444344],"length":1,"stats":{"Line":0}},{"line":121,"address":[4120544,4120554],"length":1,"stats":{"Line":0}},{"line":124,"address":[5444491,5444586],"length":1,"stats":{"Line":0}},{"line":125,"address":[5444711],"length":1,"stats":{"Line":0}},{"line":126,"address":[5444771],"length":1,"stats":{"Line":0}},{"line":128,"address":[5444909,5444818],"length":1,"stats":{"Line":0}},{"line":129,"address":[5444937],"length":1,"stats":{"Line":0}},{"line":131,"address":[5445082],"length":1,"stats":{"Line":0}},{"line":135,"address":[5445228,5445148],"length":1,"stats":{"Line":0}},{"line":136,"address":[5445282,5445187],"length":1,"stats":{"Line":0}},{"line":137,"address":[5445241,5445308],"length":1,"stats":{"Line":0}},{"line":138,"address":[5445295],"length":1,"stats":{"Line":0}},{"line":141,"address":[5445319],"length":1,"stats":{"Line":0}},{"line":143,"address":[5445331],"length":1,"stats":{"Line":0}},{"line":144,"address":[5445452],"length":1,"stats":{"Line":0}},{"line":145,"address":[5446818],"length":1,"stats":{"Line":0}},{"line":148,"address":[5446873,5446931],"length":1,"stats":{"Line":0}},{"line":151,"address":[5446986,5446945],"length":1,"stats":{"Line":0}},{"line":152,"address":[5447017],"length":1,"stats":{"Line":0}},{"line":155,"address":[5447086],"length":1,"stats":{"Line":0}},{"line":157,"address":[5447116],"length":1,"stats":{"Line":0}},{"line":159,"address":[5447128,5447211],"length":1,"stats":{"Line":0}},{"line":160,"address":[5447335],"length":1,"stats":{"Line":0}},{"line":161,"address":[5447441],"length":1,"stats":{"Line":0}},{"line":163,"address":[5447493,5447562],"length":1,"stats":{"Line":0}},{"line":164,"address":[5447607],"length":1,"stats":{"Line":0}},{"line":166,"address":[5447969,5447752],"length":1,"stats":{"Line":0}},{"line":167,"address":[5447891],"length":1,"stats":{"Line":0}},{"line":170,"address":[5447342],"length":1,"stats":{"Line":0}},{"line":173,"address":[5445462],"length":1,"stats":{"Line":0}},{"line":175,"address":[5445502],"length":1,"stats":{"Line":0}},{"line":176,"address":[5445576,5445638],"length":1,"stats":{"Line":0}},{"line":177,"address":[5445703,5445615,5445665],"length":1,"stats":{"Line":0}},{"line":179,"address":[5445672,5445732],"length":1,"stats":{"Line":0}},{"line":180,"address":[5445772],"length":1,"stats":{"Line":0}},{"line":182,"address":[5445784],"length":1,"stats":{"Line":0}},{"line":183,"address":[5445929],"length":1,"stats":{"Line":0}},{"line":184,"address":[5446130],"length":1,"stats":{"Line":0}},{"line":186,"address":[5446194],"length":1,"stats":{"Line":0}},{"line":190,"address":[5446270,5446442,5446426,5446330],"length":1,"stats":{"Line":0}},{"line":191,"address":[5446283],"length":1,"stats":{"Line":0}},{"line":192,"address":[5446343],"length":1,"stats":{"Line":0}},{"line":193,"address":[5446430],"length":1,"stats":{"Line":0}},{"line":200,"address":[5446520,5446455],"length":1,"stats":{"Line":0}},{"line":201,"address":[5446526],"length":1,"stats":{"Line":0}},{"line":202,"address":[5446587,5446679,5446506,5446647],"length":1,"stats":{"Line":0}},{"line":203,"address":[5446653],"length":1,"stats":{"Line":0}},{"line":204,"address":[5446633,5446684,5446764],"length":1,"stats":{"Line":0}},{"line":205,"address":[5446738],"length":1,"stats":{"Line":0}},{"line":210,"address":[5446552],"length":1,"stats":{"Line":0}},{"line":215,"address":[5442473],"length":1,"stats":{"Line":0}},{"line":217,"address":[4120600,4120576],"length":1,"stats":{"Line":0}},{"line":218,"address":[4120616,4120690,4120700],"length":1,"stats":{"Line":0}},{"line":221,"address":[4120654],"length":1,"stats":{"Line":0}},{"line":222,"address":[4120695],"length":1,"stats":{"Line":0}},{"line":227,"address":[5442650],"length":1,"stats":{"Line":0}},{"line":228,"address":[5442673],"length":1,"stats":{"Line":0}},{"line":229,"address":[5442811,5442728],"length":1,"stats":{"Line":0}},{"line":230,"address":[5442839],"length":1,"stats":{"Line":0}},{"line":232,"address":[5442992],"length":1,"stats":{"Line":0}},{"line":233,"address":[5443075,5443027],"length":1,"stats":{"Line":0}},{"line":234,"address":[5443106],"length":1,"stats":{"Line":0}},{"line":236,"address":[5443181],"length":1,"stats":{"Line":0}},{"line":237,"address":[5443288,5443211],"length":1,"stats":{"Line":0}},{"line":241,"address":[5443351,5443294],"length":1,"stats":{"Line":0}},{"line":242,"address":[5443427],"length":1,"stats":{"Line":0}},{"line":243,"address":[5443510],"length":1,"stats":{"Line":0}},{"line":246,"address":[5443690,5443050],"length":1,"stats":{"Line":0}},{"line":250,"address":[5443713],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":114},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","mcts","mcts_node.rs"],"content":"use crate::game::game_state::GameState;\n\n#[derive(Debug, Clone, PartialEq)]\npub struct MCTSNode {\n    pub state: GameState,             // Current game state\n    pub visits: usize,                // Number of visits\n    pub value: f64,                   // Total value of the node\n    pub children: Vec\u003cMCTSNode\u003e,      // Child nodes\n    pub parent: Option\u003c*mut MCTSNode\u003e, // Pointer to the parent node (raw pointer to allow mutation)\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","mcts","mcts_result.rs"],"content":"use tch::Tensor;\n\n#[derive(Debug)]\npub struct MCTSResult {\n    pub board_tensor: Tensor,\n    pub best_position: usize,\n    pub subscore: f64,\n}\n\nimpl Clone for MCTSResult {\n    fn clone(\u0026self) -\u003e Self {\n        MCTSResult {\n            board_tensor: self.board_tensor.shallow_clone(), // Manually clone the tensor\n            best_position: self.best_position,\n            subscore: self.subscore,\n        }\n    }\n}","traces":[{"line":11,"address":[3533808],"length":1,"stats":{"Line":0}},{"line":13,"address":[3533840],"length":1,"stats":{"Line":0}},{"line":14,"address":[3533864],"length":1,"stats":{"Line":0}},{"line":15,"address":[3533868],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":4},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","mcts","mod.rs"],"content":"pub mod mcts_node;\npub mod mcts_result;\npub mod algorithm;","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","mcts_vs_human.rs"],"content":"use crate::game::create_deck::create_deck;\nuse crate::game::plateau_is_full::is_plateau_full;\nuse crate::game::remove_tile_from_deck::replace_tile_in_deck;\nuse crate::training::websocket::send_websocket_message;\nuse crate::utils::image::generate_tile_image_names;\n// Import de votre fonction\n\nuse crate::game::plateau::create_plateau_empty;\nuse crate::game::tile::Tile;\nuse crate::mcts::algorithm::mcts_find_best_position_for_tile_with_nn;\nuse crate::neural::policy_value_net::{PolicyNet, ValueNet};\nuse crate::scoring::scoring::result;\nuse futures_util::stream::SplitSink;\nuse futures_util::StreamExt;\nuse rand::Rng;\nuse serde_json::json;\nuse tokio::net::{TcpListener, TcpStream};\nuse tokio_tungstenite::tungstenite::protocol::Message;\nuse tokio_tungstenite::WebSocketStream;\n\npub async fn play_mcts_vs_human(\n    policy_net: \u0026PolicyNet,\n    value_net: \u0026ValueNet,\n    num_simulations: usize,\n    write: \u0026mut SplitSink\u003cWebSocketStream\u003cTcpStream\u003e, Message\u003e,\n    read: \u0026mut (impl StreamExt\u003cItem = Result\u003cMessage, tokio_tungstenite::tungstenite::Error\u003e\u003e + Unpin),\n    listener: \u0026TcpListener, // ‚úÖ Ajout du listener pour votre fonction\n) {\n    let mut deck = create_deck();\n    let mut plateau_human = create_plateau_empty();\n    let mut plateau_mcts = create_plateau_empty();\n\n    let total_turns = 19;\n    let mut current_turn = 0;\n\n    while !is_plateau_full(\u0026plateau_human) {\n        let tile_index = rand::rng().random_range(0..deck.tiles.len());\n        let tile = deck.tiles[tile_index];\n        deck = replace_tile_in_deck(\u0026deck, \u0026tile); // remove it from deck\n        let tile_image = format!(\"../image/{}{}{}.png\", tile.0, tile.1, tile.2);\n\n        // ‚úÖ Send state to frontend - REFACTORIS√â\n        let payload = json!({\n            \"type\": \"mcts_vs_human_turn\",\n            \"tile\": tile_image,\n            \"plateau_human\": generate_tile_image_names(\u0026plateau_human.tiles),\n            \"plateau_mcts\": generate_tile_image_names(\u0026plateau_mcts.tiles)\n        });\n\n        // üîÑ REMPLACEMENT: write.send() simple ‚Üí send_websocket_message()\n        if let Err(e) = send_websocket_message(\n            write,\n            payload.to_string(),\n            listener\n        ).await {\n            eprintln!(\"‚ùå Failed to send turn info to frontend: {}\", e);\n            return;\n        }\n\n        // ‚úÖ Wait for HUMAN move (pas de changement n√©cessaire ici)\n        let mut human_move: Option\u003cusize\u003e = None;\n        while let Some(msg) = read.next().await {\n            match msg {\n                Ok(Message::Text(text)) =\u003e {\n                    if let Some(pos_str) = text.strip_prefix(\"HUMAN_MOVE:\") {\n                        if let Ok(pos) = pos_str.trim().parse::\u003cusize\u003e() {\n                            human_move = Some(pos);\n                            break;\n                        }\n                    }\n                }\n                Ok(Message::Close(_)) | Err(_) =\u003e {\n                    eprintln!(\"‚ùå WebSocket connection closed or errored during input.\");\n                    return;\n                }\n                _ =\u003e {}\n            }\n        }\n\n        if let Some(pos) = human_move {\n            if plateau_human.tiles[pos] == Tile(0, 0, 0) {\n                plateau_human.tiles[pos] = tile;\n            } else {\n                eprintln!(\"‚ö†Ô∏è Human tried to play on non-empty tile. Ignoring.\");\n                continue; // Skip to the next loop iteration\n            }\n        } else {\n            eprintln!(\"‚ùå No valid move received from human.\");\n            break;\n        }\n\n        // ‚úÖ MCTS plays\n        let mut deck_clone = deck.clone(); // don't mutate original deck\n        let mcts_result = mcts_find_best_position_for_tile_with_nn(\n            \u0026mut plateau_mcts,\n            \u0026mut deck_clone,\n            tile,\n            policy_net,\n            value_net,\n            num_simulations,\n            current_turn,\n            total_turns,\n        );\n        plateau_mcts.tiles[mcts_result.best_position] = tile;\n\n        current_turn += 1;\n    }\n\n    // ‚úÖ Game over - send results - REFACTORIS√â\n    let score_human = result(\u0026plateau_human);\n    let score_mcts = result(\u0026plateau_mcts);\n\n    let final_payload = json!({\n        \"type\": \"mcts_vs_human_result\",\n        \"score_human\": score_human,\n        \"score_mcts\": score_mcts\n    });\n\n    // üîÑ REMPLACEMENT: write.send() simple ‚Üí send_websocket_message()\n    if let Err(e) = send_websocket_message(\n        write,\n        final_payload.to_string(),\n        listener\n    ).await {\n        eprintln!(\"‚ùå Failed to send final results: {}\", e);\n    }\n}\n","traces":[{"line":21,"address":[3849888],"length":1,"stats":{"Line":0}},{"line":29,"address":[3850293],"length":1,"stats":{"Line":0}},{"line":30,"address":[3850450],"length":1,"stats":{"Line":0}},{"line":31,"address":[3850510],"length":1,"stats":{"Line":0}},{"line":33,"address":[3850573],"length":1,"stats":{"Line":0}},{"line":34,"address":[3850592],"length":1,"stats":{"Line":0}},{"line":36,"address":[3850611,3853420],"length":1,"stats":{"Line":0}},{"line":37,"address":[3853426,3853499],"length":1,"stats":{"Line":0}},{"line":38,"address":[3853654],"length":1,"stats":{"Line":0}},{"line":39,"address":[3853717,3853773],"length":1,"stats":{"Line":0}},{"line":40,"address":[3853876],"length":1,"stats":{"Line":0}},{"line":43,"address":[3854876,3854462,3854712,3854170,3854784,3854532,3854869,3855289,3856350,3855197,3855282,3854235,3855122,3854125],"length":1,"stats":{"Line":0}},{"line":46,"address":[3854846,3854755],"length":1,"stats":{"Line":0}},{"line":47,"address":[3855165,3855259],"length":1,"stats":{"Line":0}},{"line":52,"address":[3855574],"length":1,"stats":{"Line":0}},{"line":53,"address":[3855591],"length":1,"stats":{"Line":0}},{"line":54,"address":[3855618],"length":1,"stats":{"Line":0}},{"line":56,"address":[3856064,3855995],"length":1,"stats":{"Line":0}},{"line":61,"address":[3856281],"length":1,"stats":{"Line":0}},{"line":62,"address":[3850699,3850366,3850772,3852038,3856300],"length":1,"stats":{"Line":0}},{"line":63,"address":[3851001,3851097],"length":1,"stats":{"Line":0}},{"line":64,"address":[3851202],"length":1,"stats":{"Line":0}},{"line":65,"address":[3851250,3851333],"length":1,"stats":{"Line":0}},{"line":66,"address":[3851528,3851467],"length":1,"stats":{"Line":0}},{"line":67,"address":[3851583],"length":1,"stats":{"Line":0}},{"line":73,"address":[3852068,3851068],"length":1,"stats":{"Line":0}},{"line":80,"address":[3852417,3852379],"length":1,"stats":{"Line":0}},{"line":81,"address":[3852448,3852570],"length":1,"stats":{"Line":0}},{"line":82,"address":[3852638,3852888],"length":1,"stats":{"Line":0}},{"line":84,"address":[3852711,3852604],"length":1,"stats":{"Line":0}},{"line":88,"address":[3852482,3856494],"length":1,"stats":{"Line":0}},{"line":93,"address":[3852909],"length":1,"stats":{"Line":0}},{"line":95,"address":[3852936],"length":1,"stats":{"Line":0}},{"line":97,"address":[3852954],"length":1,"stats":{"Line":0}},{"line":98,"address":[3852982],"length":1,"stats":{"Line":0}},{"line":99,"address":[3852994],"length":1,"stats":{"Line":0}},{"line":100,"address":[3852998],"length":1,"stats":{"Line":0}},{"line":101,"address":[3853002],"length":1,"stats":{"Line":0}},{"line":102,"address":[3853009],"length":1,"stats":{"Line":0}},{"line":104,"address":[3853230,3853101],"length":1,"stats":{"Line":0}},{"line":106,"address":[3853323,3853251],"length":1,"stats":{"Line":0}},{"line":110,"address":[3856583,3853445],"length":1,"stats":{"Line":0}},{"line":111,"address":[3856585],"length":1,"stats":{"Line":0}},{"line":113,"address":[3856981,3857812,3856754,3857051,3856644,3857231,3856689,3857304],"length":1,"stats":{"Line":0}},{"line":121,"address":[3857523],"length":1,"stats":{"Line":0}},{"line":122,"address":[3857540],"length":1,"stats":{"Line":0}},{"line":123,"address":[3857618],"length":1,"stats":{"Line":0}},{"line":125,"address":[3858233,3858286],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":48},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","mod.rs"],"content":"pub mod game;\npub mod mcts;\n\npub mod utils;\npub mod neural;\npub mod strategy;\npub mod scoring;\n\npub mod data;\n\npub mod training;","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","neural","mod.rs"],"content":"pub mod res_net_block;\npub mod policy_value_net;\npub mod tensor_conversion;\npub mod training;","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","neural","policy_value_net.rs"],"content":"\nuse tch::{nn, Tensor};\nuse tch::nn::VarStore;\nuse tch::Result;\n\nuse crate::neural::res_net_block::ResNetBlock;\n\npub struct PolicyNet {\n    conv1: nn::Conv2D,\n    gn1: nn::GroupNorm,\n    res_blocks: Vec\u003cResNetBlock\u003e,\n    flatten: nn::Linear,\n    fc1: nn::Linear,\n    policy_head: nn::Linear,\n    dropout_rate: f64,\n}\nconst NUM_RES_BLOCKS: usize = 4; // Or any number you want\nconst INITIAL_CONV_CHANNELS: i64 = 128;\n\nconst NUM_RES_BLOCKS_VALUE: usize = 4; // Or adjust as needed\nconst INITIAL_CONV_CHANNELS_VALUE: i64 = 128;\nimpl\u003c'a\u003e PolicyNet {\n    // policy_value_net.rs (PolicyNet and ValueNet)\n    pub fn new(vs: \u0026nn::VarStore, input_dim: (i64, i64, i64)) -\u003e Self {\n        let p = vs.root(); // p is a Path\n        let (channels, height, width) = input_dim;\n\n        let conv1 = nn::conv2d(\u0026p / \"policy_conv1\", channels, INITIAL_CONV_CHANNELS, 3, nn::ConvConfig { padding: 1,..Default::default() });\n        let gn1 = nn::group_norm(\u0026p / \"gn1\", 16, 128, Default::default());\n\n        let mut res_blocks = Vec::new();\n        let mut in_channels = INITIAL_CONV_CHANNELS;\n\n        for _ in 0..NUM_RES_BLOCKS {\n            let out_channels = 32; // Or adjust as needed (e.g., increase in stages)\n            res_blocks.push(ResNetBlock::new(\u0026vs, in_channels, out_channels)); // Use \u0026vs here!\n            in_channels = out_channels;\n        }\n\n\n        let flatten_size = in_channels * height * width; // Adjust if you have downsampling in ResNetBlocks\n        let flatten = nn::linear(\u0026p / \"policy_flatten\", flatten_size, 2048, Default::default());\n        let fc1 = nn::linear(\u0026p / \"policy_fc1\", 2048, 512, Default::default());\n        let policy_head = nn::linear(\u0026p / \"policy_head\", 512, 19, nn::LinearConfig::default());\n\n        initialize_weights(\u0026vs); // Use \u0026vs here!\n\n        Self {\n            conv1,\n            gn1,\n            res_blocks,\n            flatten,\n            fc1,\n            policy_head,\n            dropout_rate: 0.3,\n        }\n    }\n\n    pub fn save_model(\u0026self, vs: \u0026nn::VarStore, path: \u0026str) -\u003e Result\u003c()\u003e {\n        // Save the model's state dictionary to the specified path\n        vs.save(path)?;\n        Ok(())\n    }\n\n    pub fn load_model(\u0026self, vs: \u0026mut nn::VarStore, path: \u0026str) -\u003e Result\u003c()\u003e {\n        // Load the model's state dictionary from the specified path\n        vs.load(path)?;\n        // Recreate the model with the loaded weights\n        Ok(())\n    }\n    pub fn forward(\u0026self, x: \u0026Tensor, train: bool) -\u003e Tensor {\n        let mut h = x.apply(\u0026self.conv1).apply_t(\u0026self.gn1, train).leaky_relu();\n\n        for block in \u0026self.res_blocks {\n            h = block.forward(\u0026h, train);\n        }\n        // In PolicyNet::forward and ValueNet::forward:\n        let expected_flatten_size = {\n            let size = h.size();\n            (size[1], size[2], size[3]) // Extract dimensions as a tuple\n        };\n        let flattened_size = expected_flatten_size.0 * expected_flatten_size.1 * expected_flatten_size.2;\n\n        h = h.view([-1, flattened_size]);\n\n        h = h.apply(\u0026self.flatten).relu();\n        if train { h = h.dropout(self.dropout_rate, train); }\n\n        h = h.apply(\u0026self.fc1).relu();\n        if train { h = h.dropout(self.dropout_rate, train); }\n\n        h.apply(\u0026self.policy_head).softmax(-1, tch::Kind::Float)\n    }\n\n}\n\n// Initialize weights\npub fn initialize_weights(vs: \u0026nn::VarStore) {\n    for (name, mut param) in vs.variables() {\n        let size = param.size();\n\n        if size.len() == 4 {\n            // Xavier/Glorot initialization for conv layers\n            let fan_in = (size[1] * size[2] * size[3]) as f64;\n            let fan_out = (size[0] * size[2] * size[3]) as f64;\n            let bound = (6.0 / (fan_in + fan_out)).sqrt();\n            tch::no_grad(|| {\n                let _ = param.f_uniform_(-bound, bound).unwrap();\n            });\n        } else if size.len() == 2 {\n            // Xavier initialization for linear layers\n            let fan_in = size[1] as f64;\n            let fan_out = size[0] as f64;\n            let bound = (6.0 / (fan_in + fan_out)).sqrt();\n            tch::no_grad(|| {\n                let _ = param.f_uniform_(-bound, bound).unwrap();\n            });\n        } else if size.len() == 1 {\n            // Zero initialization for biases\n            tch::no_grad(|| {\n                let _ = param.f_zero_().unwrap();\n            });\n        }\n\n        // Validation after initialization\n        if param.isnan().any().double_value(\u0026[]) \u003e 0.0 {\n            log::error!(\"üö® NaN detected in {} after initialization!\", name);\n        }    }\n}\n\n\n\n//... other imports\n\n\npub struct ValueNet {\n    conv1: nn::Conv2D,\n    bn1: nn::BatchNorm,\n    res_blocks: Vec\u003cResNetBlock\u003e,\n    flatten: nn::Linear,\n    fc1: nn::Linear, // Added FC layer\n    value_head: nn::Linear,\n    dropout_rate: f64,\n}\n\nimpl ValueNet {\n    pub fn new(vs: \u0026VarStore, input_dim: (i64, i64, i64)) -\u003e Self {\n        let p = vs.root();\n        let (channels, height, width) = input_dim;\n\n        let conv1 = nn::conv2d(\u0026p / \"value_conv1\", channels, INITIAL_CONV_CHANNELS_VALUE, 3, nn::ConvConfig { padding: 1,..Default::default() });\n\n        let bn1 = nn::batch_norm2d(\u0026p / \"value_bn1\", INITIAL_CONV_CHANNELS_VALUE, nn::BatchNormConfig { affine: true, ..Default::default() });\n\n        let mut res_blocks = Vec::new();\n        let mut in_channels = INITIAL_CONV_CHANNELS_VALUE;\n\n        for _ in 0..NUM_RES_BLOCKS_VALUE {\n            let out_channels = 128; // Or adjust as needed\n            res_blocks.push(ResNetBlock::new(\u0026vs, in_channels, out_channels)); // Use \u0026vs here!\n            in_channels = out_channels;\n        }\n\n        let flatten_size = in_channels * height * width; // Adjust if you have downsampling\n        let flatten = nn::linear(\u0026p / \"value_flatten\", flatten_size, 2048, Default::default()); // Increased size\n        let fc1 = nn::linear(\u0026p / \"value_fc1\", 2048, 512, Default::default()); // Added FC layer\n        let value_head = nn::linear(\u0026p / \"value_head\", 512, 1, nn::LinearConfig::default());\n\n        initialize_weights(\u0026vs); // Use \u0026vs here!\n\n        Self {\n            conv1,\n            bn1,\n            res_blocks,\n            flatten,\n            fc1,\n            value_head,\n            dropout_rate: 0.3,\n        }\n    }\n    pub fn save_model(\u0026self, vs: \u0026nn::VarStore, path: \u0026str) -\u003e Result\u003c()\u003e {\n        // Save the model's state dictionary to the specified path\n        vs.save(path)?;\n        Ok(())\n    }\n\n    pub fn load_model(\u0026self, vs: \u0026mut nn::VarStore, path: \u0026str) -\u003e Result\u003c()\u003e {\n        // Load the model's state dictionary from the specified path\n        vs.load(path)?;\n        // Recreate the model with the loaded weights\n        Ok(())\n    }\n    pub fn forward(\u0026self, x: \u0026Tensor, train: bool) -\u003e Tensor {\n        // Input validation and normalization\n        if x.isnan().any().double_value(\u0026[]) \u003e 0.0 || x.isinf().any().double_value(\u0026[]) \u003e 0.0 {\n            log::error!(\"‚ö†Ô∏è Invalid input to ValueNet\");\n            return Tensor::zeros(\u0026[1, 1], (tch::Kind::Float, tch::Device::Cpu));\n        }\n\n        // More robust normalization\n        let x_mean = x.mean(tch::Kind::Float);\n        let x_std = x.std(false).clamp_min(1e-6);\n        let x = (x - x_mean) / x_std;\n\n        // Forward pass with LeakyReLU for better gradient flow\n        let mut h = x.apply(\u0026self.conv1).apply_t(\u0026self.bn1, train);\n\n        // Use LeakyReLU instead of ReLU for better gradient flow\n        h = h.leaky_relu_();\n\n        // ResNet blocks\n        for block in \u0026self.res_blocks {\n            h = block.forward(\u0026h, train);\n\n            // Check for NaN/Inf after each block\n            if h.isnan().any().double_value(\u0026[]) \u003e 0.0 || h.isinf().any().double_value(\u0026[]) \u003e 0.0 {\n                log::error!(\"‚ö†Ô∏è Invalid values detected in ResNet block\");\n                return Tensor::zeros(\u0026[1, 1], (tch::Kind::Float, tch::Device::Cpu));\n            }\n        }\n\n        // Flatten and fully connected layers\n        let flattened_size = {\n            let size = h.size();\n            size[1] * size[2] * size[3]\n        };\n\n        h = h.view([-1, flattened_size])\n            .apply(\u0026self.flatten).leaky_relu_();\n\n        if train {\n            h = h.dropout(self.dropout_rate, train);\n        }\n\n        h = h.apply(\u0026self.fc1).leaky_relu_();\n\n        if train {\n            h = h.dropout(self.dropout_rate, train);\n        }\n\n        // Final value prediction with tanh activation for bounded output\n        let output = h.apply(\u0026self.value_head).tanh() * 2.0; // Scale to [-2, 2] range\n\n        // Final validation\n        if output.isnan().any().double_value(\u0026[]) \u003e 0.0 || output.isinf().any().double_value(\u0026[]) \u003e 0.0 {\n            log::error!(\"‚ö†Ô∏è Invalid output from ValueNet\");\n            return Tensor::zeros(\u0026[1, 1], (tch::Kind::Float, tch::Device::Cpu));\n        }\n\n        output\n    }\n\n\n\n}\n#[allow(dead_code)]\nfn kaiming_uniform(tensor: \u0026mut Tensor, fan_in: f64) {\n    let bound = (6.0f64).sqrt() / fan_in.sqrt();\n    tch::no_grad(|| {\n        let _ = tensor.f_uniform_(-bound, bound).unwrap();\n    });\n}\n\n\n\n#[cfg(test)]\nmod tests {\n    use tch::{nn, Device};\n\n    use super::*;\n\n    #[test]\n    fn test_policy_net_creation() {\n        let vs = nn::VarStore::new(Device::Cpu);\n        let input_dim = (3, 5, 5); // Example dimensions: channels, height, width\n        let policy_net = PolicyNet::new(\u0026vs,  input_dim);\n\n        // Assert that the PolicyNet was created correctly\n        assert_eq!(policy_net.res_blocks.len(), 4);\n        assert_eq!(policy_net.dropout_rate, 0.3);\n    }\n\n    #[test]\n    fn test_policy_net_forward() {\n        let vs = nn::VarStore::new(Device::Cpu);\n        let input_dim = (3, 5, 5);\n        let policy_net = PolicyNet::new(\u0026vs,  input_dim);\n\n        // Create a dummy input tensor\n        let input = Tensor::rand(\u0026[1, 3, 5, 5], (tch::Kind::Float, Device::Cpu));\n        let output = policy_net.forward(\u0026input, true);\n\n        // Assert that the output has the expected shape\n        assert_eq!(output.size(), vec![1, 19]); // Assuming 19 is the number of actions\n    }\n\n\n    #[test]\n    fn test_value_net_creation_and_forward() {\n        let vs = nn::VarStore::new(Device::Cpu);\n        let input_dim = (3, 5, 5);\n        let value_net = ValueNet::new(\u0026vs,  input_dim);\n\n        // Create a dummy input tensor\n        let input = Tensor::rand(\u0026[1, 3, 5, 5], (tch::Kind::Float, Device::Cpu));\n        let output = value_net.forward(\u0026input, true);\n\n        // Assert that the output has the expected shape\n        assert_eq!(output.size(), vec![1, 1]); // Assuming 1 output value\n    }\n}\n","traces":[{"line":24,"address":[5066438,5066601,5064224],"length":1,"stats":{"Line":2}},{"line":25,"address":[5064251],"length":1,"stats":{"Line":2}},{"line":26,"address":[5064325],"length":1,"stats":{"Line":2}},{"line":28,"address":[5064375,5064447,5066579],"length":1,"stats":{"Line":4}},{"line":29,"address":[5066557,5064731,5064811],"length":1,"stats":{"Line":4}},{"line":31,"address":[5064941],"length":1,"stats":{"Line":2}},{"line":32,"address":[5064992],"length":1,"stats":{"Line":2}},{"line":34,"address":[5066552,5065004,5065081],"length":1,"stats":{"Line":6}},{"line":35,"address":[5065134],"length":1,"stats":{"Line":2}},{"line":36,"address":[5066510,5065146],"length":1,"stats":{"Line":4}},{"line":37,"address":[5066540],"length":1,"stats":{"Line":2}},{"line":41,"address":[5065187,5065301],"length":1,"stats":{"Line":2}},{"line":42,"address":[5065319,5066488,5065265],"length":1,"stats":{"Line":4}},{"line":43,"address":[5065448,5065528,5066466],"length":1,"stats":{"Line":2}},{"line":44,"address":[5065734,5065654,5066444],"length":1,"stats":{"Line":3}},{"line":46,"address":[5065860],"length":1,"stats":{"Line":1}},{"line":59,"address":[5066624],"length":1,"stats":{"Line":0}},{"line":61,"address":[5066712],"length":1,"stats":{"Line":0}},{"line":62,"address":[5066828],"length":1,"stats":{"Line":0}},{"line":65,"address":[5066864],"length":1,"stats":{"Line":0}},{"line":67,"address":[5066952],"length":1,"stats":{"Line":0}},{"line":69,"address":[5067068],"length":1,"stats":{"Line":0}},{"line":71,"address":[5069142,5067104,5069136],"length":1,"stats":{"Line":1}},{"line":72,"address":[5067172],"length":1,"stats":{"Line":1}},{"line":74,"address":[5067518,5069233],"length":1,"stats":{"Line":2}},{"line":75,"address":[5069182,5067673,5069155],"length":1,"stats":{"Line":2}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[5067705],"length":1,"stats":{"Line":1}},{"line":80,"address":[5067732,5067823],"length":1,"stats":{"Line":2}},{"line":82,"address":[5067977,5068111],"length":1,"stats":{"Line":1}},{"line":84,"address":[5068063,5068129,5068153],"length":1,"stats":{"Line":2}},{"line":86,"address":[5068209,5068345],"length":1,"stats":{"Line":1}},{"line":87,"address":[5068416,5068541,5068479],"length":1,"stats":{"Line":2}},{"line":89,"address":[5068430,5068599,5068699],"length":1,"stats":{"Line":2}},{"line":90,"address":[5068833,5068770,5068895],"length":1,"stats":{"Line":2}},{"line":92,"address":[5068953,5068784],"length":1,"stats":{"Line":2}},{"line":98,"address":[5071267,5071273,5069248],"length":1,"stats":{"Line":1}},{"line":99,"address":[5069399,5069266],"length":1,"stats":{"Line":2}},{"line":100,"address":[5069484],"length":1,"stats":{"Line":2}},{"line":102,"address":[5069653,5069577],"length":1,"stats":{"Line":3}},{"line":104,"address":[5069659,5069980,5069736],"length":1,"stats":{"Line":3}},{"line":105,"address":[5070006,5069942,5070224],"length":1,"stats":{"Line":3}},{"line":106,"address":[5070251,5070195],"length":1,"stats":{"Line":3}},{"line":107,"address":[3427744],"length":1,"stats":{"Line":4}},{"line":108,"address":[3427757],"length":1,"stats":{"Line":2}},{"line":110,"address":[5069698,5070320],"length":1,"stats":{"Line":4}},{"line":112,"address":[5070326,5070394],"length":1,"stats":{"Line":4}},{"line":113,"address":[5070414],"length":1,"stats":{"Line":2}},{"line":114,"address":[5070474],"length":1,"stats":{"Line":1}},{"line":115,"address":[3427856],"length":1,"stats":{"Line":4}},{"line":116,"address":[3427869],"length":1,"stats":{"Line":2}},{"line":118,"address":[5070362,5070551],"length":1,"stats":{"Line":4}},{"line":120,"address":[3427968],"length":1,"stats":{"Line":4}},{"line":121,"address":[3427977],"length":1,"stats":{"Line":2}},{"line":126,"address":[5070844,5070285,5070586],"length":1,"stats":{"Line":4}},{"line":127,"address":[5070863],"length":1,"stats":{"Line":0}},{"line":147,"address":[5073631,5073794,5071296],"length":1,"stats":{"Line":1}},{"line":148,"address":[5071323],"length":1,"stats":{"Line":1}},{"line":149,"address":[5071397],"length":1,"stats":{"Line":1}},{"line":151,"address":[5071447,5071519,5073772],"length":1,"stats":{"Line":2}},{"line":153,"address":[5071803,5071883,5073750],"length":1,"stats":{"Line":2}},{"line":155,"address":[5072134],"length":1,"stats":{"Line":1}},{"line":156,"address":[5072185],"length":1,"stats":{"Line":1}},{"line":158,"address":[5073745,5072274,5072197],"length":1,"stats":{"Line":3}},{"line":159,"address":[5072327],"length":1,"stats":{"Line":1}},{"line":160,"address":[5073703,5072339],"length":1,"stats":{"Line":2}},{"line":161,"address":[5073733],"length":1,"stats":{"Line":1}},{"line":164,"address":[5072494,5072380],"length":1,"stats":{"Line":1}},{"line":165,"address":[5073681,5072512,5072458],"length":1,"stats":{"Line":2}},{"line":166,"address":[5073659,5072641,5072721],"length":1,"stats":{"Line":2}},{"line":167,"address":[5072927,5073637,5072847],"length":1,"stats":{"Line":2}},{"line":169,"address":[5073053],"length":1,"stats":{"Line":1}},{"line":181,"address":[5073808],"length":1,"stats":{"Line":0}},{"line":183,"address":[5073896],"length":1,"stats":{"Line":0}},{"line":184,"address":[5074012],"length":1,"stats":{"Line":0}},{"line":187,"address":[5074048],"length":1,"stats":{"Line":0}},{"line":189,"address":[5074136],"length":1,"stats":{"Line":0}},{"line":191,"address":[5074252],"length":1,"stats":{"Line":0}},{"line":193,"address":[5074288,5078058,5079562],"length":1,"stats":{"Line":1}},{"line":195,"address":[5079647,5074356,5079594],"length":1,"stats":{"Line":1}},{"line":196,"address":[5079608,5079762],"length":1,"stats":{"Line":0}},{"line":197,"address":[5079663],"length":1,"stats":{"Line":0}},{"line":201,"address":[5074904],"length":1,"stats":{"Line":1}},{"line":202,"address":[5075023,5074953],"length":1,"stats":{"Line":2}},{"line":203,"address":[5075195],"length":1,"stats":{"Line":1}},{"line":206,"address":[5075391,5075297],"length":1,"stats":{"Line":2}},{"line":209,"address":[5075562,5075616],"length":1,"stats":{"Line":1}},{"line":212,"address":[5075672],"length":1,"stats":{"Line":1}},{"line":213,"address":[5078491,5078464,5075827],"length":1,"stats":{"Line":2}},{"line":216,"address":[5079139,5078542],"length":1,"stats":{"Line":1}},{"line":217,"address":[5079162,5079264,5079097],"length":1,"stats":{"Line":0}},{"line":218,"address":[5079487,5079168],"length":1,"stats":{"Line":0}},{"line":224,"address":[5075859],"length":1,"stats":{"Line":1}},{"line":225,"address":[5075977,5075886,5076187],"length":1,"stats":{"Line":2}},{"line":228,"address":[5076213,5076450,5076517,5076295,5076374,5076477],"length":1,"stats":{"Line":5}},{"line":229,"address":[5076288,5076409,5076485,5076525,5076322],"length":1,"stats":{"Line":2}},{"line":231,"address":[5076755,5076570],"length":1,"stats":{"Line":2}},{"line":232,"address":[5076636,5076704],"length":1,"stats":{"Line":1}},{"line":235,"address":[5076768,5076874,5076584],"length":1,"stats":{"Line":2}},{"line":237,"address":[5077133,5076948],"length":1,"stats":{"Line":2}},{"line":238,"address":[5077014,5077082],"length":1,"stats":{"Line":1}},{"line":242,"address":[5076962,5077146],"length":1,"stats":{"Line":2}},{"line":245,"address":[5078064,5077994,5077339],"length":1,"stats":{"Line":1}},{"line":246,"address":[5078090,5078192,5078013],"length":1,"stats":{"Line":0}},{"line":247,"address":[5078096,5078415],"length":1,"stats":{"Line":0}},{"line":250,"address":[5077908],"length":1,"stats":{"Line":1}},{"line":257,"address":[5079952],"length":1,"stats":{"Line":0}},{"line":258,"address":[5079978],"length":1,"stats":{"Line":0}},{"line":259,"address":[3428032],"length":1,"stats":{"Line":0}},{"line":260,"address":[3428045],"length":1,"stats":{"Line":0}}],"covered":86,"coverable":110},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","neural","res_net_block.rs"],"content":"use tch::{nn, Tensor};\n\n/// Residual Block\npub struct ResNetBlock {\n    pub(crate) conv1: nn::Conv2D,\n    pub(crate) bn1: nn::BatchNorm,\n    pub(crate) conv2: nn::Conv2D,\n    pub(crate) bn2: nn::BatchNorm,\n    downsample: Option\u003cnn::Conv2D\u003e, // Optional downsampling for skip connections\n}\n\nimpl\u003c'a\u003e ResNetBlock {\n    pub fn new(vs: \u0026nn::VarStore, channels_in: i64, channels_out: i64) -\u003e Self {\n        let p = vs.root();\n        let conv1 = nn::conv2d(\n            \u0026p / \"conv1\",\n            channels_in,\n            channels_out,\n            3,\n            nn::ConvConfig {\n                padding: 1,\n                ..Default::default()\n            },\n        );\n        let bn1 = nn::batch_norm2d(\n            \u0026p / \"bn1\",\n            channels_out,\n            nn::BatchNormConfig {\n                ws_init: nn::Init::Const(1.0),\n                bs_init: nn::Init::Const(0.0),\n                ..Default::default()\n            },\n        );\n        let conv2 = nn::conv2d(\n            \u0026p / \"conv2\",\n            channels_out,\n            channels_out,\n            3,\n            nn::ConvConfig {\n                padding: 1,\n                ..Default::default()\n            },\n        );\n        let bn2 = nn::batch_norm2d(\n            \u0026p / \"bn2\",\n            channels_out,\n            nn::BatchNormConfig {\n                ws_init: nn::Init::Const(1.0),\n                bs_init: nn::Init::Const(0.0),\n                ..Default::default()\n            },\n        );\n\n        // Downsample if input/output channels differ\n        let downsample = if channels_in != channels_out {\n            Some(nn::conv2d(\n                \u0026p / \"downsample\",\n                channels_in,\n                channels_out,\n                1,\n                Default::default(),\n            ))\n        } else {\n            None\n        };\n\n\n\n\n\n\n        Self {\n            conv1,\n            bn1,\n            conv2,\n            bn2,\n            downsample,\n        }\n    }\n\n    pub fn forward(\u0026self, x: \u0026Tensor, train: bool) -\u003e Tensor {\n        let residual = if let Some(downsample) = \u0026self.downsample {\n            x.apply(downsample)\n        } else {\n            x.shallow_clone()\n        };\n\n        let x = x\n            .apply(\u0026self.conv1)\n            .apply_t(\u0026self.bn1, train)\n            .clamp(-1e3, 1e3) // Ensure this isn't in-place\n            .relu();          // Ensure this isn't in-place\n        let x = x\n            .apply(\u0026self.conv2)\n            .apply_t(\u0026self.bn2, train)\n            .clamp(-1e3, 1e3); // Ensure this isn't in-place\n\n        (x + residual).relu() // Safe addition and relu\n    }\n\n}\n\n#[cfg(test)]\nmod tests {\n    use tch::{Device, nn};\n\n    use super::*;\n\n    #[test]\n    fn test_resnet_block() {\n        let vs = nn::VarStore::new(Device::Cpu);\n        let res_block = ResNetBlock::new(\u0026vs, 64, 64);\n\n        let input = Tensor::rand(\u0026[1, 64, 8, 8], tch::kind::FLOAT_CPU);\n        let output = res_block.forward(\u0026input, true);\n\n        assert_eq!(output.size(), vec![1, 64, 8, 8]);\n    }\n}\n","traces":[{"line":13,"address":[5041056,5043242,5043336],"length":1,"stats":{"Line":1}},{"line":14,"address":[5041107],"length":1,"stats":{"Line":1}},{"line":16,"address":[5041171,5041243],"length":1,"stats":{"Line":2}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[5041318],"length":1,"stats":{"Line":1}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[5041251],"length":1,"stats":{"Line":1}},{"line":26,"address":[5041524,5041601],"length":1,"stats":{"Line":2}},{"line":27,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[5041728],"length":1,"stats":{"Line":1}},{"line":29,"address":[5041619],"length":1,"stats":{"Line":1}},{"line":30,"address":[5041639],"length":1,"stats":{"Line":1}},{"line":31,"address":[5041663],"length":1,"stats":{"Line":1}},{"line":35,"address":[5041907,5041987],"length":1,"stats":{"Line":2}},{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":37,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[5042057],"length":1,"stats":{"Line":4}},{"line":40,"address":[],"length":0,"stats":{"Line":0}},{"line":41,"address":[5041995],"length":1,"stats":{"Line":4}},{"line":45,"address":[5042269,5042349],"length":1,"stats":{"Line":8}},{"line":46,"address":[],"length":0,"stats":{"Line":0}},{"line":47,"address":[5042476],"length":1,"stats":{"Line":4}},{"line":48,"address":[5042367],"length":1,"stats":{"Line":4}},{"line":49,"address":[5042387],"length":1,"stats":{"Line":4}},{"line":50,"address":[5042411],"length":1,"stats":{"Line":4}},{"line":55,"address":[5042665,5043215,5042682],"length":1,"stats":{"Line":8}},{"line":56,"address":[5043189,5043132],"length":1,"stats":{"Line":4}},{"line":57,"address":[5042684,5043061],"length":1,"stats":{"Line":4}},{"line":58,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[5043069],"length":1,"stats":{"Line":2}},{"line":64,"address":[5042670],"length":1,"stats":{"Line":2}},{"line":81,"address":[5043360,5044634,5044640],"length":1,"stats":{"Line":1}},{"line":82,"address":[5043408],"length":1,"stats":{"Line":1}},{"line":83,"address":[5043483],"length":1,"stats":{"Line":1}},{"line":85,"address":[5043509],"length":1,"stats":{"Line":1}},{"line":88,"address":[5043863,5043700,5043624,5043538,5043794,5043609],"length":1,"stats":{"Line":6}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[5043617],"length":1,"stats":{"Line":1}},{"line":93,"address":[5044280,5044186,5044107,5044057],"length":1,"stats":{"Line":4}},{"line":94,"address":[5044050],"length":1,"stats":{"Line":1}},{"line":95,"address":[5044100],"length":1,"stats":{"Line":1}},{"line":96,"address":[5044137,5044288,5044234],"length":1,"stats":{"Line":1}},{"line":98,"address":[5044416],"length":1,"stats":{"Line":1}}],"covered":34,"coverable":46},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","neural","tensor_conversion.rs"],"content":"use tch::Tensor;\nuse crate::game::deck::Deck;\nuse crate::game::plateau::Plateau;\nuse crate::game::tile::Tile;\n\npub fn convert_plateau_to_tensor(\n    plateau: \u0026Plateau,\n    _tile: \u0026Tile, // Add underscore prefix\n    _deck: \u0026Deck, // Add underscore prefix\n    current_turn: usize,\n    total_turns: usize,\n) -\u003e Tensor {\n    let mut features = vec![0.0; 5 * 47]; // 5 channels\n\n    // Channel 1-3: Plateau (only use plateau data, not tile/deck)\n    for (i, t) in plateau.tiles.iter().enumerate() {\n        if i \u003c 19 {\n            features[i] = (t.0 as f32 / 10.0).clamp(0.0, 1.0);\n            features[47 + i] = (t.1 as f32 / 10.0).clamp(0.0, 1.0);\n            features[2 * 47 + i] = (t.2 as f32 / 10.0).clamp(0.0, 1.0);\n        }\n    }\n\n    // Channel 4: Score Potential for each position\n    let potential_scores = compute_potential_scores(plateau);\n    for i in 0..19 {\n        features[3 * 47 + i] = potential_scores[i];\n    }\n\n    // Channel 5: Current Turn\n    let turn_normalized = current_turn as f32 / total_turns as f32;\n    for i in 0..19 {\n        features[4 * 47 + i] = turn_normalized;\n    }\n\n    Tensor::from_slice(\u0026features).view([1, 5, 47, 1])\n}\nfn compute_potential_scores(plateau: \u0026Plateau) -\u003e Vec\u003cf32\u003e {\n    let mut scores = vec![0.0; 19]; // Potential score for each position\n\n    let patterns: Vec\u003c(\u0026[usize], i32, Box\u003cdyn Fn(\u0026Tile) -\u003e i32\u003e)\u003e = vec![\n        (\u0026[0, 1, 2], 3, Box::new(|tile: \u0026Tile| tile.0)),\n        (\u0026[3, 4, 5, 6], 4, Box::new(|tile: \u0026Tile| tile.0)),\n        (\u0026[7, 8, 9, 10, 11], 5, Box::new(|tile: \u0026Tile| tile.0)),\n        (\u0026[12, 13, 14, 15], 4, Box::new(|tile: \u0026Tile| tile.0)),\n        (\u0026[16, 17, 18], 3, Box::new(|tile: \u0026Tile| tile.0)),\n        (\u0026[0, 3, 7], 3, Box::new(|tile: \u0026Tile| tile.1)),\n        (\u0026[1, 4, 8, 12], 4, Box::new(|tile: \u0026Tile| tile.1)),\n        (\u0026[2, 5, 9, 13, 16], 5, Box::new(|tile: \u0026Tile| tile.1)),\n        (\u0026[6, 10, 14, 17], 4, Box::new(|tile: \u0026Tile| tile.1)),\n        (\u0026[11, 15, 18], 3, Box::new(|tile: \u0026Tile| tile.1)),\n        (\u0026[7, 12, 16], 3, Box::new(|tile: \u0026Tile| tile.2)),\n        (\u0026[3, 8, 13, 17], 4, Box::new(|tile: \u0026Tile| tile.2)),\n        (\u0026[0, 4, 9, 14, 18], 5, Box::new(|tile: \u0026Tile| tile.2)),\n        (\u0026[1, 5, 10, 15], 4, Box::new(|tile: \u0026Tile| tile.2)),\n        (\u0026[2, 6, 11], 3, Box::new(|tile: \u0026Tile| tile.2)),\n    ];\n\n    for (indices, multiplier, selector) in \u0026patterns {\n        let mut filled_values = Vec::new();\n        let mut empty_positions = Vec::new();\n\n        for \u0026pos in *indices {\n            if plateau.tiles[pos] == Tile(0, 0, 0) {\n                empty_positions.push(pos);\n            } else {\n                filled_values.push(selector(\u0026plateau.tiles[pos]) as f32);\n            }\n        }\n\n        // If at least one tile is placed in the pattern\n        if !filled_values.is_empty() {\n            let avg_filled_value = filled_values.iter().sum::\u003cf32\u003e() / filled_values.len() as f32;\n            let potential_score = avg_filled_value * (*multiplier as f32);\n\n            for \u0026pos in empty_positions.iter() {\n                scores[pos] += potential_score / empty_positions.len() as f32; // Distribute potential score\n            }\n        }\n    }\n\n    scores\n}\n\n","traces":[{"line":6,"address":[3450453,3450459,3448896],"length":1,"stats":{"Line":1}},{"line":13,"address":[3448967,3449059],"length":1,"stats":{"Line":1}},{"line":16,"address":[3449132,3449036],"length":1,"stats":{"Line":2}},{"line":17,"address":[3449399,3451183],"length":1,"stats":{"Line":2}},{"line":18,"address":[3450767],"length":1,"stats":{"Line":1}},{"line":19,"address":[3450865],"length":1,"stats":{"Line":1}},{"line":20,"address":[3451004],"length":1,"stats":{"Line":1}},{"line":25,"address":[3449430],"length":1,"stats":{"Line":1}},{"line":26,"address":[3450754,3449533,3449437],"length":1,"stats":{"Line":3}},{"line":27,"address":[3449654,3450604],"length":1,"stats":{"Line":2}},{"line":31,"address":[3449877,3449695,3449790],"length":1,"stats":{"Line":3}},{"line":32,"address":[3450591,3449899],"length":1,"stats":{"Line":2}},{"line":33,"address":[3450488,3450072],"length":1,"stats":{"Line":2}},{"line":36,"address":[3450115],"length":1,"stats":{"Line":1}},{"line":38,"address":[3451200,3455538,3455549],"length":1,"stats":{"Line":1}},{"line":39,"address":[3451239],"length":1,"stats":{"Line":1}},{"line":41,"address":[3455544,3452508,3452632,3453128,3451516,3452260,3452384,3451640,3452136,3452880,3453229,3451392,3452756,3452012,3453004,3451297,3451361,3451888,3451764],"length":1,"stats":{"Line":3}},{"line":42,"address":[3451369,3451432],"length":1,"stats":{"Line":2}},{"line":43,"address":[3451493,3451556],"length":1,"stats":{"Line":2}},{"line":44,"address":[3451680,3451617],"length":1,"stats":{"Line":2}},{"line":45,"address":[3451804,3451741],"length":1,"stats":{"Line":2}},{"line":46,"address":[3451865,3451928],"length":1,"stats":{"Line":2}},{"line":47,"address":[3874368,3874378],"length":1,"stats":{"Line":2}},{"line":48,"address":[3452113,3452176],"length":1,"stats":{"Line":2}},{"line":49,"address":[3452237,3452300],"length":1,"stats":{"Line":2}},{"line":50,"address":[3452361,3452424],"length":1,"stats":{"Line":2}},{"line":51,"address":[3452485,3452548],"length":1,"stats":{"Line":2}},{"line":52,"address":[3452609,3452672],"length":1,"stats":{"Line":2}},{"line":53,"address":[3452733,3452796],"length":1,"stats":{"Line":2}},{"line":54,"address":[3452857,3452920],"length":1,"stats":{"Line":2}},{"line":55,"address":[3874496,3874506],"length":1,"stats":{"Line":2}},{"line":56,"address":[3453168,3453105],"length":1,"stats":{"Line":2}},{"line":59,"address":[3454089,3454010],"length":1,"stats":{"Line":2}},{"line":60,"address":[3454263],"length":1,"stats":{"Line":1}},{"line":61,"address":[3454348],"length":1,"stats":{"Line":1}},{"line":63,"address":[3454419,3454510],"length":1,"stats":{"Line":2}},{"line":64,"address":[3454635,3455377],"length":1,"stats":{"Line":2}},{"line":65,"address":[3455533,3455448],"length":1,"stats":{"Line":2}},{"line":67,"address":[3455421,3455487],"length":1,"stats":{"Line":0}},{"line":72,"address":[3454668],"length":1,"stats":{"Line":1}},{"line":73,"address":[3454764,3454934,3454703],"length":1,"stats":{"Line":0}},{"line":74,"address":[3454947],"length":1,"stats":{"Line":0}},{"line":76,"address":[3454970,3455342],"length":1,"stats":{"Line":0}},{"line":77,"address":[3455286,3455183],"length":1,"stats":{"Line":0}},{"line":82,"address":[3454278],"length":1,"stats":{"Line":1}}],"covered":40,"coverable":45},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","neural","training","gradient_clipping.rs"],"content":"//! Gestion des gradients et clipping pour stabiliser l'entra√Ænement\n\nuse tch::nn;\n\n/// R√©sultat du clipping des gradients\n#[derive(Debug)]\npub struct GradientClippingResult {\n    pub max_grad_value: f64,\n    pub max_grad_policy: f64,\n}\n\n/// Applique un clipping am√©lior√© des gradients pour les r√©seaux value et policy\npub fn enhanced_gradient_clipping(\n    vs_value: \u0026nn::VarStore,\n    vs_policy: \u0026nn::VarStore,\n) -\u003e GradientClippingResult {\n    let max_grad_value = clip_value_network_gradients(vs_value);\n    let max_grad_policy = clip_policy_network_gradients(vs_policy);\n\n    log_gradient_norms(max_grad_value, max_grad_policy);\n\n    GradientClippingResult {\n        max_grad_value,\n        max_grad_policy,\n    }\n}\n\n/// Applique un clipping agressif pour le r√©seau de valeur\nfn clip_value_network_gradients(vs_value: \u0026nn::VarStore) -\u003e f64 {\n    let mut max_grad_value: f64 = 0.0;\n\n    tch::no_grad(|| {\n        for (_name, tensor) in vs_value.variables() {\n            if tensor.grad().defined() {\n                let grad_norm = tensor.grad().norm().double_value(\u0026[]);\n                max_grad_value = max_grad_value.max(grad_norm);\n\n                // Clipping tr√®s agressif pour stabilit√©\n                let _ = tensor.grad().clamp_(-0.5, 0.5);\n            }\n        }\n    });\n\n    max_grad_value\n}\n\n/// Applique un clipping mod√©r√© pour le r√©seau de policy\nfn clip_policy_network_gradients(vs_policy: \u0026nn::VarStore) -\u003e f64 {\n    let mut max_grad_policy: f64 = 0.0;\n\n    tch::no_grad(|| {\n        for (_name, tensor) in vs_policy.variables() {\n            if tensor.grad().defined() {\n                let grad_norm = tensor.grad().norm().double_value(\u0026[]);\n                max_grad_policy = max_grad_policy.max(grad_norm);\n\n                // Clipping mod√©r√©\n                let _ = tensor.grad().clamp_(-1.0, 1.0);\n            }\n        }\n    });\n\n    max_grad_policy\n}\n\n/// Log les normes de gradients si elles sont √©lev√©es\nfn log_gradient_norms(max_grad_value: f64, max_grad_policy: f64) {\n    if max_grad_value \u003e 1.0 {    }\n    if max_grad_policy \u003e 2.0 {    }\n}\n\n/// Version simple du clipping des gradients\n#[allow(dead_code)]\npub fn simple_gradient_clipping(\n    vs: \u0026nn::VarStore,\n    max_norm: f64,\n) -\u003e f64 {\n    let mut max_grad: f64 = 0.0;\n\n    tch::no_grad(|| {\n        for (_name, tensor) in vs.variables() {\n            if tensor.grad().defined() {\n                let grad_norm = tensor.grad().norm().double_value(\u0026[]);\n                max_grad = max_grad.max(grad_norm);\n\n                let _ = tensor.grad().clamp_(-max_norm, max_norm);\n            }\n        }\n    });\n\n    max_grad\n}","traces":[{"line":13,"address":[4394736],"length":1,"stats":{"Line":0}},{"line":17,"address":[4394754],"length":1,"stats":{"Line":0}},{"line":18,"address":[4394775],"length":1,"stats":{"Line":0}},{"line":20,"address":[4394801],"length":1,"stats":{"Line":0}},{"line":29,"address":[4394832],"length":1,"stats":{"Line":0}},{"line":30,"address":[4394841],"length":1,"stats":{"Line":0}},{"line":32,"address":[4394850],"length":1,"stats":{"Line":0}},{"line":33,"address":[5332037,5331905],"length":1,"stats":{"Line":0}},{"line":34,"address":[5332217,5332122],"length":1,"stats":{"Line":0}},{"line":35,"address":[5332359],"length":1,"stats":{"Line":0}},{"line":36,"address":[5332611],"length":1,"stats":{"Line":0}},{"line":39,"address":[5332648],"length":1,"stats":{"Line":0}},{"line":44,"address":[4394860],"length":1,"stats":{"Line":0}},{"line":48,"address":[4394880],"length":1,"stats":{"Line":0}},{"line":49,"address":[4394889],"length":1,"stats":{"Line":0}},{"line":51,"address":[4394898],"length":1,"stats":{"Line":0}},{"line":52,"address":[5333061,5332929],"length":1,"stats":{"Line":0}},{"line":53,"address":[5333241,5333146],"length":1,"stats":{"Line":0}},{"line":54,"address":[5333383],"length":1,"stats":{"Line":0}},{"line":55,"address":[5333635],"length":1,"stats":{"Line":0}},{"line":58,"address":[5333672],"length":1,"stats":{"Line":0}},{"line":63,"address":[4394908],"length":1,"stats":{"Line":0}},{"line":67,"address":[4394928],"length":1,"stats":{"Line":0}},{"line":74,"address":[4394944],"length":1,"stats":{"Line":0}},{"line":78,"address":[4394959],"length":1,"stats":{"Line":0}},{"line":80,"address":[4394968],"length":1,"stats":{"Line":0}},{"line":81,"address":[5334078,5333948],"length":1,"stats":{"Line":0}},{"line":82,"address":[5334163,5334258],"length":1,"stats":{"Line":0}},{"line":83,"address":[5334400],"length":1,"stats":{"Line":0}},{"line":84,"address":[5334657],"length":1,"stats":{"Line":0}},{"line":86,"address":[5334697],"length":1,"stats":{"Line":0}},{"line":91,"address":[4395003],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":32},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","neural","training","mod.rs"],"content":"//! Module d'entra√Ænement - Optimisation et stabilisation\n\npub mod gradient_clipping;\npub mod normalization;\npub mod trainer;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","neural","training","normalization.rs"],"content":"//! Normalisation robuste des donn√©es pour l'entra√Ænement\n\nuse tch::{Tensor, IndexOp};\n\n/// Applique une normalisation robuste bas√©e sur la m√©diane (MAD)\npub fn robust_state_normalization(state: \u0026Tensor) -\u003e Tensor {\n    let clamped = clamp_extreme_values(state);\n    let median = calculate_median(\u0026clamped);\n    let mad = calculate_mad(\u0026clamped, median);\n\n    normalize_with_mad(\u0026clamped, median, mad)\n}\n\n/// Clamp les valeurs extr√™mes pour √©viter les outliers\nfn clamp_extreme_values(state: \u0026Tensor) -\u003e Tensor {\n    state.clamp(-10.0, 10.0)\n}\n\n/// Calcule la m√©diane d'un tensor\nfn calculate_median(tensor: \u0026Tensor) -\u003e f64 {\n    let flattened = tensor.view(-1);\n    let sorted = flattened.sort(0, false).0;\n    let median_idx = sorted.size()[0] / 2;\n    sorted.i(median_idx).double_value(\u0026[])\n}\n\n/// Calcule la Median Absolute Deviation (MAD)\nfn calculate_mad(tensor: \u0026Tensor, median: f64) -\u003e f64 {\n    let flattened = tensor.view(-1);\n    let deviations = (flattened - median).abs();\n    let sorted_dev = deviations.sort(0, false).0;\n    let median_idx = sorted_dev.size()[0] / 2;\n    sorted_dev.i(median_idx).double_value(\u0026[]) * 1.4826\n}\n\n/// Normalise avec MAD au lieu de l'√©cart-type standard\nfn normalize_with_mad(tensor: \u0026Tensor, median: f64, mad: f64) -\u003e Tensor {\n    let normalized = if mad \u003e 1e-6 {\n        (tensor - median) / mad.max(1e-6)\n    } else {\n        tensor - median\n    };\n\n    // Clamp final pour √©viter les valeurs extr√™mes\n    normalized.clamp(-3.0, 3.0)\n}\n\n/// Version simple de normalisation z-score\n#[allow(dead_code)]\npub fn simple_normalization(tensor: \u0026Tensor) -\u003e Tensor {\n    let mean = tensor.mean(tch::Kind::Float);\n    let std = tensor.std(false).clamp_min(1e-8);\n    (tensor - mean) / std\n}\n\n/// Normalisation min-max\n#[allow(dead_code)]\npub fn min_max_normalization(tensor: \u0026Tensor) -\u003e Tensor {\n    let min_val = tensor.min();\n    let max_val = tensor.max();\n    let range = max_val - \u0026min_val;\n\n    if range.double_value(\u0026[]) \u003e 1e-8 {\n        (tensor - min_val) / range\n    } else {\n        tensor.shallow_clone()\n    }\n}","traces":[{"line":6,"address":[5224816,5224975,5224969],"length":1,"stats":{"Line":0}},{"line":7,"address":[5224825],"length":1,"stats":{"Line":0}},{"line":8,"address":[5224840,5224891],"length":1,"stats":{"Line":0}},{"line":9,"address":[5224902],"length":1,"stats":{"Line":0}},{"line":11,"address":[5224938],"length":1,"stats":{"Line":0}},{"line":15,"address":[5224992],"length":1,"stats":{"Line":0}},{"line":16,"address":[5224997],"length":1,"stats":{"Line":0}},{"line":20,"address":[5225024,5225646,5225640],"length":1,"stats":{"Line":0}},{"line":21,"address":[5225041],"length":1,"stats":{"Line":0}},{"line":22,"address":[5225132,5225051],"length":1,"stats":{"Line":0}},{"line":23,"address":[5225206],"length":1,"stats":{"Line":0}},{"line":24,"address":[5225409],"length":1,"stats":{"Line":0}},{"line":28,"address":[5225664,5226453,5226447],"length":1,"stats":{"Line":0}},{"line":29,"address":[5225699],"length":1,"stats":{"Line":0}},{"line":30,"address":[5225721],"length":1,"stats":{"Line":0}},{"line":31,"address":[5225860],"length":1,"stats":{"Line":0}},{"line":32,"address":[5225977],"length":1,"stats":{"Line":0}},{"line":33,"address":[5226180,5226300],"length":1,"stats":{"Line":0}},{"line":37,"address":[5226480,5226781,5226787],"length":1,"stats":{"Line":0}},{"line":38,"address":[5226518,5226726],"length":1,"stats":{"Line":0}},{"line":39,"address":[5226571,5226650,5226797],"length":1,"stats":{"Line":0}},{"line":41,"address":[5226548],"length":1,"stats":{"Line":0}},{"line":45,"address":[5226613],"length":1,"stats":{"Line":0}},{"line":50,"address":[5227155,5226816,5227149],"length":1,"stats":{"Line":0}},{"line":51,"address":[5226830],"length":1,"stats":{"Line":0}},{"line":52,"address":[5226929,5226874],"length":1,"stats":{"Line":0}},{"line":53,"address":[5227055],"length":1,"stats":{"Line":0}},{"line":58,"address":[5227184,5227595,5227601],"length":1,"stats":{"Line":0}},{"line":59,"address":[5227198],"length":1,"stats":{"Line":0}},{"line":60,"address":[5227232,5227285],"length":1,"stats":{"Line":0}},{"line":61,"address":[5227290],"length":1,"stats":{"Line":0}},{"line":63,"address":[5227392,5227326],"length":1,"stats":{"Line":0}},{"line":64,"address":[5227482,5227432],"length":1,"stats":{"Line":0}},{"line":66,"address":[5227463,5227411],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":34},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","neural","training","trainer.rs"],"content":"use tch::{nn, IndexOp, Tensor};\nuse tch::nn::Optimizer;\nuse crate::mcts::mcts_result::MCTSResult;\nuse crate::neural::policy_value_net::{PolicyNet, ValueNet};\nuse crate::neural::training::gradient_clipping::enhanced_gradient_clipping;\nuse crate::neural::training::normalization::robust_state_normalization;\n\npub fn train_network_with_game_data(\n    vs_policy: \u0026nn::VarStore,\n    vs_value: \u0026nn::VarStore,\n    game_data: \u0026[MCTSResult],\n    _discount_factor: f64,\n    policy_net: \u0026PolicyNet,\n    value_net: \u0026ValueNet,\n    optimizer_policy: \u0026mut Optimizer,\n    optimizer_value: \u0026mut Optimizer,\n) {\n    // Hyperparameters\n    let entropy_weight = 0.05;\n    let gamma = 0.99;\n    let epsilon = 1e-8;\n\n    // Initialize accumulators\n    let mut predictions = Vec::new();\n    let mut targets = Vec::new();\n    let mut total_policy_loss = Tensor::zeros(\u0026[], tch::kind::FLOAT_CPU);\n    let mut total_value_loss = Tensor::zeros(\u0026[], tch::kind::FLOAT_CPU);\n    let mut total_entropy_loss = Tensor::zeros(\u0026[], tch::kind::FLOAT_CPU);\n\n    // Initialize trajectory rewards and discounted sum\n    let mut trajectory_rewards = Vec::new();\n    let mut discounted_sum = Tensor::zeros(\u0026[], (tch::Kind::Float, tch::Device::Cpu));\n\n    // === Training Loop ===\n    for (step, result) in game_data.iter().rev().enumerate() {\n        // üõë No Normalization: Use raw tensor\n        let state = result.board_tensor.shallow_clone();\n        let normalized_state = robust_state_normalization(\u0026state);\n\n        // Forward pass through networks with normalized state\n        let pred_policy = policy_net.forward(\u0026normalized_state, true).clamp_min(1e-7);\n        let pred_value = value_net.forward(\u0026normalized_state, true);\n\n        // Forward pass through networks with normalized state\n        // Normalize reward: divide by a constant max value (e.g., 100)\n        let reward = Tensor::from(result.subscore).to_kind(tch::Kind::Float) / 100.0;\n        let gamma_tensor = Tensor::from_slice(\u0026[gamma]).to_kind(tch::Kind::Float);\n\n        // ‚úÖ NaN \u0026 Inf Check for reward\n        if reward.isnan().any().double_value(\u0026[]) \u003e 0.0\n            || reward.isinf().any().double_value(\u0026[]) \u003e 0.0\n        {\n            log::error!(\"‚ö†Ô∏è NaN or Inf detected in reward at step {}\", step);\n            continue;\n        }\n\n        // Update discounted sum with normalized reward\n        discounted_sum = reward + gamma_tensor * discounted_sum;\n\n        // ‚úÖ NaN \u0026 Inf Check for discounted sum\n        if discounted_sum.isnan().any().double_value(\u0026[]) \u003e 0.0\n            || discounted_sum.isinf().any().double_value(\u0026[]) \u003e 0.0\n        {\n            log::error!(\"‚ö†Ô∏è NaN or Inf detected in discounted sum at step {}\", step);\n            continue;\n        }\n\n        // Store the value for analysis\n        trajectory_rewards.push(discounted_sum.double_value(\u0026[]));\n\n        // Generate target tensor directly from discounted sum\n        let discounted_reward = discounted_sum.shallow_clone();\n\n        // Append for later analysis\n        predictions.push(pred_value.double_value(\u0026[]));\n        targets.push(discounted_reward.double_value(\u0026[]));\n\n        // === Compute Losses ===\n        // Policy loss\n        let best_position = result.best_position as i64;\n        let target_policy = Tensor::zeros(\u0026[1, pred_policy.size()[1]], tch::kind::FLOAT_CPU);\n        let _ = target_policy.i((0, best_position)).fill_(1.0);\n        let log_policy = pred_policy.log();\n        let policy_loss = -(target_policy * log_policy.shallow_clone()).sum(tch::Kind::Float);\n        total_policy_loss += policy_loss;\n\n        // Entropy loss\n        let entropy_loss = -(pred_policy * (log_policy + epsilon)).sum(tch::Kind::Float);\n        total_entropy_loss += entropy_loss;\n\n        // Value loss (Huber loss for better stability)\n        let diff = discounted_reward.shallow_clone() - pred_value.shallow_clone();\n        let abs_diff = diff.abs();\n        let delta = 1.0;\n        let value_loss = abs_diff.le(delta).to_kind(tch::Kind::Float) * 0.5 * \u0026diff * \u0026diff\n            + abs_diff.gt(delta).to_kind(tch::Kind::Float) * (delta * (\u0026abs_diff - 0.5 * delta));\n        total_value_loss += value_loss.mean(tch::Kind::Float);\n    }\n\n    // Fix: Add explicit type annotation for total_loss\n    let total_loss: Tensor = total_policy_loss.shallow_clone()\n        + total_value_loss.shallow_clone()\n        + (entropy_weight * total_entropy_loss.shallow_clone());\n\n    // Log the loss before backpropagation\n    // ‚úÖ Enhanced NaN and Inf check before backpropagation\n    if total_loss.isnan().any().double_value(\u0026[]) \u003e 0.0 {\n        log::error!(\"‚ö†Ô∏è NaN detected in total loss! Skipping backpropagation.\");\n        return;\n    }\n    if total_loss.isinf().any().double_value(\u0026[]) \u003e 0.0 {\n        log::error!(\"‚ö†Ô∏è Inf detected in total loss! Skipping backpropagation.\");\n        return;\n    }\n\n    // Check if total_loss requires gradients before calling backward\n    if !total_loss.requires_grad() {\n        log::error!(\"‚ö†Ô∏è Total loss does not require gradients! Skipping backpropagation.\");\n        return;\n    }\n\n    total_loss.backward();\n\n    // Utilisez :\n    let gradient_result = enhanced_gradient_clipping(vs_value, vs_policy);\n    let _max_grad_value = gradient_result.max_grad_value;\n    let _max_grad_policy = gradient_result.max_grad_policy;\n\n    // === Optimizer Step ===\n    optimizer_policy.step();\n    optimizer_policy.zero_grad();\n    optimizer_value.step();\n    optimizer_value.zero_grad();}","traces":[{"line":8,"address":[3858896,3862229,3869222],"length":1,"stats":{"Line":0}},{"line":19,"address":[3859094,3859050],"length":1,"stats":{"Line":0}},{"line":20,"address":[3859068],"length":1,"stats":{"Line":0}},{"line":21,"address":[3859086],"length":1,"stats":{"Line":0}},{"line":24,"address":[3859230],"length":1,"stats":{"Line":0}},{"line":25,"address":[3859243],"length":1,"stats":{"Line":0}},{"line":26,"address":[3859294,3859398],"length":1,"stats":{"Line":0}},{"line":27,"address":[3859513,3859406],"length":1,"stats":{"Line":0}},{"line":28,"address":[3859521,3859628],"length":1,"stats":{"Line":0}},{"line":31,"address":[3859644],"length":1,"stats":{"Line":0}},{"line":32,"address":[3859692,3859854],"length":1,"stats":{"Line":0}},{"line":35,"address":[3859870,3859947],"length":1,"stats":{"Line":0}},{"line":37,"address":[3862744,3860206],"length":1,"stats":{"Line":0}},{"line":38,"address":[3862835,3862760],"length":1,"stats":{"Line":0}},{"line":41,"address":[3862920,3862856],"length":1,"stats":{"Line":0}},{"line":42,"address":[3863105],"length":1,"stats":{"Line":0}},{"line":46,"address":[3863216,3863144],"length":1,"stats":{"Line":0}},{"line":47,"address":[3863437],"length":1,"stats":{"Line":0}},{"line":50,"address":[3863660,3868682],"length":1,"stats":{"Line":0}},{"line":51,"address":[3863946,3868621],"length":1,"stats":{"Line":0}},{"line":53,"address":[3868640,3868705],"length":1,"stats":{"Line":0}},{"line":58,"address":[3864315,3868599,3864232],"length":1,"stats":{"Line":0}},{"line":61,"address":[3868285,3864431],"length":1,"stats":{"Line":0}},{"line":62,"address":[3868224,3864717],"length":1,"stats":{"Line":0}},{"line":64,"address":[3868308,3868333,3868243],"length":1,"stats":{"Line":0}},{"line":69,"address":[3865003],"length":1,"stats":{"Line":0}},{"line":72,"address":[3865071],"length":1,"stats":{"Line":0}},{"line":75,"address":[3865114,3865204],"length":1,"stats":{"Line":0}},{"line":76,"address":[3865226],"length":1,"stats":{"Line":0}},{"line":80,"address":[3865302],"length":1,"stats":{"Line":0}},{"line":81,"address":[3865322],"length":1,"stats":{"Line":0}},{"line":82,"address":[3865625],"length":1,"stats":{"Line":0}},{"line":83,"address":[3865789],"length":1,"stats":{"Line":0}},{"line":84,"address":[3865899,3868161,3865840],"length":1,"stats":{"Line":0}},{"line":85,"address":[3866201],"length":1,"stats":{"Line":0}},{"line":88,"address":[3866236,3866311,3868105],"length":1,"stats":{"Line":0}},{"line":89,"address":[3866613],"length":1,"stats":{"Line":0}},{"line":92,"address":[3866726,3866648,3868061],"length":1,"stats":{"Line":0}},{"line":93,"address":[3866834,3866913],"length":1,"stats":{"Line":0}},{"line":94,"address":[3866931],"length":1,"stats":{"Line":0}},{"line":95,"address":[3867019,3867119,3867566,3866955],"length":1,"stats":{"Line":0}},{"line":96,"address":[3867449,3867250,3867611,3867998,3867359,3867070],"length":1,"stats":{"Line":0}},{"line":97,"address":[3867742],"length":1,"stats":{"Line":0}},{"line":101,"address":[3860355,3860533,3860228],"length":1,"stats":{"Line":0}},{"line":102,"address":[3860306,3860406,3862714,3860279],"length":1,"stats":{"Line":0}},{"line":103,"address":[3860422,3862692,3860449,3860584],"length":1,"stats":{"Line":0}},{"line":107,"address":[3860592,3860671,3862235],"length":1,"stats":{"Line":0}},{"line":108,"address":[3862254],"length":1,"stats":{"Line":0}},{"line":111,"address":[3860919,3861913],"length":1,"stats":{"Line":0}},{"line":112,"address":[3861932],"length":1,"stats":{"Line":0}},{"line":117,"address":[3861205],"length":1,"stats":{"Line":0}},{"line":118,"address":[3861318,3861346,3861244],"length":1,"stats":{"Line":0}},{"line":122,"address":[3861289],"length":1,"stats":{"Line":0}},{"line":125,"address":[3861595],"length":1,"stats":{"Line":0}},{"line":126,"address":[3861664],"length":1,"stats":{"Line":0}},{"line":127,"address":[3861673],"length":1,"stats":{"Line":0}},{"line":130,"address":[3861682],"length":1,"stats":{"Line":0}},{"line":131,"address":[3861701],"length":1,"stats":{"Line":0}},{"line":132,"address":[3861720],"length":1,"stats":{"Line":0}},{"line":133,"address":[3869200,3861324,3862551,3859250,3859349,3859651,3859786,3859893,3859461,3860619,3861739,3859576],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":60},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","scoring","mod.rs"],"content":"pub mod scoring;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","scoring","scoring.rs"],"content":"pub fn compute_alignment_score(plateau: \u0026Plateau, position: usize, _tile: \u0026Tile) -\u003e f64 {\n    let patterns: Vec\u003c(\u0026[usize], Box\u003cdyn Fn(\u0026Tile) -\u003e i32\u003e)\u003e = vec![\n        (\u0026[0, 1, 2], Box::new(|t: \u0026Tile| t.0)),\n        (\u0026[3, 4, 5, 6], Box::new(|t: \u0026Tile| t.0)),\n        (\u0026[7, 8, 9, 10, 11], Box::new(|t: \u0026Tile| t.0)),\n        (\u0026[12, 13, 14, 15], Box::new(|t: \u0026Tile| t.0)),\n        (\u0026[16, 17, 18], Box::new(|t: \u0026Tile| t.0)),\n        (\u0026[0, 3, 7], Box::new(|t: \u0026Tile| t.1)),\n        (\u0026[1, 4, 8, 12], Box::new(|t: \u0026Tile| t.1)),\n        (\u0026[2, 5, 9, 13, 16], Box::new(|t: \u0026Tile| t.1)),\n        (\u0026[6, 10, 14, 17], Box::new(|t: \u0026Tile| t.1)),\n        (\u0026[11, 15, 18], Box::new(|t: \u0026Tile| t.1)),\n        (\u0026[7, 12, 16], Box::new(|t: \u0026Tile| t.2)),\n        (\u0026[3, 8, 13, 17], Box::new(|t: \u0026Tile| t.2)),\n        (\u0026[0, 4, 9, 14, 18], Box::new(|t: \u0026Tile| t.2)),\n        (\u0026[1, 5, 10, 15], Box::new(|t: \u0026Tile| t.2)),\n        (\u0026[2, 6, 11], Box::new(|t: \u0026Tile| t.2)),\n    ];\n\n    let mut score = 0.0;\n\n    for (indices, selector) in patterns {\n        if indices.contains(\u0026position) {\n            let values: Vec\u003ci32\u003e = indices\n                .iter()\n                .map(|\u0026i| selector(\u0026plateau.tiles[i]))\n                .filter(|\u0026v| v != 0)\n                .collect();\n\n            if !values.is_empty() {\n                let sum = values.iter().sum::\u003ci32\u003e() as f64;\n                score += sum / values.len() as f64;\n            }\n        }\n    }\n\n    score\n}\nuse crate::game::plateau::Plateau;\nuse crate::game::tile::Tile;\n\npub fn result(plateau: \u0026Plateau) -\u003e i32 {\n    let mut result = 0;\n\n    // Inline the logic of calculate_score\n    let patterns: Vec\u003c(\u0026[usize], i32, Box\u003cdyn Fn(\u0026Tile) -\u003e i32\u003e)\u003e = vec![\n        (\u0026[0, 1, 2][..], 3, Box::new(|tile: \u0026Tile| tile.0)),\n        (\u0026[3, 4, 5, 6][..], 4, Box::new(|tile: \u0026Tile| tile.0)),\n        (\u0026[7, 8, 9, 10, 11][..], 5, Box::new(|tile: \u0026Tile| tile.0)),\n        (\u0026[12, 13, 14, 15][..], 4, Box::new(|tile: \u0026Tile| tile.0)),\n        (\u0026[16, 17, 18][..], 3, Box::new(|tile: \u0026Tile| tile.0)),\n        (\u0026[0, 3, 7][..], 3, Box::new(|tile: \u0026Tile| tile.1)),\n        (\u0026[1, 4, 8, 12][..], 4, Box::new(|tile: \u0026Tile| tile.1)),\n        (\u0026[2, 5, 9, 13, 16][..], 5, Box::new(|tile: \u0026Tile| tile.1)),\n        (\u0026[6, 10, 14, 17][..], 4, Box::new(|tile: \u0026Tile| tile.1)),\n        (\u0026[11, 15, 18][..], 3, Box::new(|tile: \u0026Tile| tile.1)),\n        (\u0026[7, 12, 16][..], 3, Box::new(|tile: \u0026Tile| tile.2)),\n        (\u0026[3, 8, 13, 17][..], 4, Box::new(|tile: \u0026Tile| tile.2)),\n        (\u0026[0, 4, 9, 14, 18][..], 5, Box::new(|tile: \u0026Tile| tile.2)),\n        (\u0026[1, 5, 10, 15][..], 4, Box::new(|tile: \u0026Tile| tile.2)),\n        (\u0026[2, 6, 11][..], 3, Box::new(|tile: \u0026Tile| tile.2)),\n    ];\n\n    for (indices, multiplier, selector) in patterns {\n        let first_value = selector(\u0026plateau.tiles[indices[0]]);\n        if indices.iter().all(|\u0026i| selector(\u0026plateau.tiles[i]) == first_value) {\n            result += first_value * multiplier;\n        }\n    }\n\n    result\n}\n","traces":[{"line":1,"address":[5880688,5884157,5884163],"length":1,"stats":{"Line":0}},{"line":2,"address":[5883449,5881986,5881216,5881766,5880737,5881436,5882397,5880996,5880886,5882206,5882313,5880773,5882096,5881546,5881876,5881326,5881106,5881656,5884176],"length":1,"stats":{"Line":0}},{"line":3,"address":[5880813,5880750],"length":1,"stats":{"Line":0}},{"line":4,"address":[3528090,3528080],"length":1,"stats":{"Line":0}},{"line":5,"address":[3528096,3528106],"length":1,"stats":{"Line":0}},{"line":6,"address":[3528112,3528122],"length":1,"stats":{"Line":0}},{"line":7,"address":[3528128,3528138],"length":1,"stats":{"Line":0}},{"line":8,"address":[5881303,5881363],"length":1,"stats":{"Line":0}},{"line":9,"address":[3528170,3528160],"length":1,"stats":{"Line":0}},{"line":10,"address":[3528176,3528186],"length":1,"stats":{"Line":0}},{"line":11,"address":[3528192,3528202],"length":1,"stats":{"Line":0}},{"line":12,"address":[5881803,5881743],"length":1,"stats":{"Line":0}},{"line":13,"address":[5881853,5881913],"length":1,"stats":{"Line":0}},{"line":14,"address":[3528250,3528240],"length":1,"stats":{"Line":0}},{"line":15,"address":[3528256,3528266],"length":1,"stats":{"Line":0}},{"line":16,"address":[3528282,3528272],"length":1,"stats":{"Line":0}},{"line":17,"address":[5882347,5882293],"length":1,"stats":{"Line":0}},{"line":20,"address":[5883350],"length":1,"stats":{"Line":0}},{"line":22,"address":[5883362,5883525,5883478],"length":1,"stats":{"Line":0}},{"line":23,"address":[5883727,5883630],"length":1,"stats":{"Line":0}},{"line":24,"address":[5883761],"length":1,"stats":{"Line":0}},{"line":26,"address":[3527886,3527872],"length":1,"stats":{"Line":0}},{"line":27,"address":[3527946,3527936],"length":1,"stats":{"Line":0}},{"line":30,"address":[5883877,5884152,5883932],"length":1,"stats":{"Line":0}},{"line":31,"address":[5883946,5883991],"length":1,"stats":{"Line":0}},{"line":32,"address":[5884068],"length":1,"stats":{"Line":0}},{"line":37,"address":[5883666],"length":1,"stats":{"Line":0}},{"line":42,"address":[5888434,5888440,5884192],"length":1,"stats":{"Line":1}},{"line":43,"address":[5884215],"length":1,"stats":{"Line":2}},{"line":46,"address":[5884888,5886274,5884492,5886670,5885284,5887183,5884236,5885086,5886472,5885878,5885482,5886868,5887054,5884294,5888453,5886076,5885680,5887801,5884690],"length":1,"stats":{"Line":3}},{"line":47,"address":[3528314,3528304],"length":1,"stats":{"Line":8}},{"line":48,"address":[3528330,3528320],"length":1,"stats":{"Line":8}},{"line":49,"address":[3528346,3528336],"length":1,"stats":{"Line":8}},{"line":50,"address":[3528352,3528362],"length":1,"stats":{"Line":8}},{"line":51,"address":[3528368,3528378],"length":1,"stats":{"Line":8}},{"line":52,"address":[3528384,3528394],"length":1,"stats":{"Line":9}},{"line":53,"address":[3528400,3528410],"length":1,"stats":{"Line":9}},{"line":54,"address":[3528416,3528426],"length":1,"stats":{"Line":9}},{"line":55,"address":[3528442,3528432],"length":1,"stats":{"Line":9}},{"line":56,"address":[3528448,3528458],"length":1,"stats":{"Line":9}},{"line":57,"address":[3528474,3528464],"length":1,"stats":{"Line":9}},{"line":58,"address":[3528490,3528480],"length":1,"stats":{"Line":9}},{"line":59,"address":[3528496,3528506],"length":1,"stats":{"Line":9}},{"line":60,"address":[3528512,3528522],"length":1,"stats":{"Line":9}},{"line":61,"address":[3528538,3528528],"length":1,"stats":{"Line":9}},{"line":64,"address":[5887714,5887830,5887877],"length":1,"stats":{"Line":7}},{"line":65,"address":[5888000,5888050,5888154],"length":1,"stats":{"Line":5}},{"line":66,"address":[3527968,3527987],"length":1,"stats":{"Line":10}},{"line":67,"address":[5888340,5888413],"length":1,"stats":{"Line":1}},{"line":71,"address":[5888022],"length":1,"stats":{"Line":1}}],"covered":23,"coverable":50},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","services","game_manager.rs"],"content":"// src/services/game_manager.rs - Int√©gration avec votre syst√®me existant\n\nuse std::collections::HashMap;\nuse std::sync::Mutex;\nuse serde::{Serialize, Deserialize};\nuse crate::generated::takeiteasygame::v1::*;\n\n// Import de vos modules existants\nuse crate::game::create_deck::{create_deck, Deck};\nuse crate::game::plateau::{create_plateau_empty, Plateau};\nuse crate::game::tile::Tile;\nuse crate::game::plateau_is_full::is_plateau_full;\nuse crate::game::remove_tile_from_deck::replace_tile_in_deck;\nuse crate::mcts::algorithm::mcts_find_best_position_for_tile_with_nn;\nuse crate::neural::policy_value_net::{PolicyNet, ValueNet};\nuse crate::scoring::scoring::result;\nuse rand::Rng;\nuse crate::game::get_legal_moves::get_legal_moves;\n// ============================================================================\n// ADAPTATION DE VOS TYPES EXISTANTS VERS LE SYST√àME FONCTIONNEL\n// ============================================================================\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct TakeItEasyGameState {\n    pub session_id: String,\n    pub deck: Deck,\n    pub player_plateaus: HashMap\u003cString, Plateau\u003e, // player_id -\u003e plateau\n    pub current_tile: Option\u003cTile\u003e,\n    pub current_turn: usize,\n    pub total_turns: usize,\n    pub game_status: GameStatus,\n    pub scores: HashMap\u003cString, i32\u003e,\n    pub waiting_for_players: Vec\u003cString\u003e, // Qui doit encore jouer ce tour\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct PlayerMove {\n    pub player_id: String,\n    pub position: usize, // Position sur le plateau (0-46)\n    pub tile: Tile,\n    pub timestamp: i64,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct MctsMove {\n    pub position: usize,\n    pub tile: Tile,\n    pub evaluation_score: f32,\n    pub search_depth: usize,\n    pub variations_considered: usize,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct MoveResult {\n    pub new_game_state: TakeItEasyGameState,\n    pub points_earned: i32,\n    pub mcts_response: Option\u003cMctsMove\u003e,\n    pub is_game_over: bool,\n    pub turn_completed: bool, // Si tous les joueurs ont jou√© ce tour\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub enum GameStatus {\n    WaitingForPlayers,\n    InProgress,\n    Finished,\n}\n\n// ============================================================================\n// FONCTIONS PURES - ADAPTATION DE VOTRE LOGIQUE EXISTANTE\n// ============================================================================\n\npub fn create_take_it_easy_game(\n    session_id: String,\n    player_ids: Vec\u003cString\u003e\n) -\u003e TakeItEasyGameState {\n    let deck = create_deck();\n    let mut player_plateaus = HashMap::new();\n\n    // Cr√©er un plateau vide pour chaque joueur (y compris MCTS)\n    for player_id in \u0026player_ids {\n        player_plateaus.insert(player_id.clone(), create_plateau_empty());\n    }\n\n    // Ajouter MCTS comme joueur automatique si pas d√©j√† pr√©sent\n    if !player_ids.contains(\u0026\"mcts_ai\".to_string()) {\n        player_plateaus.insert(\"mcts_ai\".to_string(), create_plateau_empty());\n    }\n\n    TakeItEasyGameState {\n        session_id,\n        deck,\n        player_plateaus,\n        current_tile: None,\n        current_turn: 0,\n        total_turns: 19, // Comme dans votre impl√©mentation\n        game_status: GameStatus::InProgress,\n        scores: player_ids.iter().map(|id| (id.clone(), 0)).collect(),\n        waiting_for_players: vec![],\n    }\n}\n\n// game_manager.rs - dans start_new_turn\n// Dans game_manager.rs - CORRIGER start_new_turn\npub fn start_new_turn(\n    mut game_state: TakeItEasyGameState\n) -\u003e Result\u003cTakeItEasyGameState, String\u003e {\n    if game_state.current_turn \u003e= game_state.total_turns {\n        return Err(\"GAME_ALREADY_FINISHED\".to_string());\n    }\n\n    // üîß UTILISER VOS FONCTIONS : Filtrer les tuiles valides comme dans simulate_game\n    let valid_tiles: Vec\u003cTile\u003e = game_state.deck\n        .tiles\n        .iter()\n        .cloned()\n        .filter(|tile| *tile != Tile(0, 0, 0))  // ‚úÖ M√™me logique que simulate_game.rs\n        .collect();\n\n    if valid_tiles.is_empty() {\n        return Err(\"NO_TILES_REMAINING\".to_string());\n    }\n\n    // üé≤ Piocher une tuile al√©atoire SEULEMENT parmi les tuiles valides\n    let tile_index = rand::rng().random_range(0..valid_tiles.len());\n    let chosen_tile = valid_tiles[tile_index];\n\n\n    // üîß UTILISER VOTRE FONCTION : Remplacer la tuile dans le deck\n    game_state.deck = replace_tile_in_deck(\u0026game_state.deck, \u0026chosen_tile);\n    game_state.current_tile = Some(chosen_tile);\n\n    // üîß TOUS LES JOUEURS (humains + MCTS) doivent jouer\n    game_state.waiting_for_players = game_state.player_plateaus.keys().cloned().collect();\n\n\n\n    Ok(game_state)\n}\n// Dans game_manager.rs - NOUVELLE fonction utilisant vos concepts\npub fn get_available_tiles_from_deck(deck: \u0026Deck) -\u003e Vec\u003cTile\u003e {\n    // üîß UTILISE LA M√äME LOGIQUE que simulate_game.rs\n    deck.tiles\n        .iter()\n        .cloned()\n        .filter(|tile| *tile != Tile(0, 0, 0))\n        .collect()\n}\n\npub fn count_remaining_tiles(deck: \u0026Deck) -\u003e usize {\n    // üîß UTILISE VOS FONCTIONS pour compter les tuiles restantes\n    get_available_tiles_from_deck(deck).len()\n}\n\npub fn is_deck_empty(deck: \u0026Deck) -\u003e bool {\n    // üîß UTILISE VOS FONCTIONS pour v√©rifier si le deck est vide\n    get_available_tiles_from_deck(deck).is_empty()\n}\n\n\n// Dans game_manager.rs - AM√âLIORER ensure_current_tile\npub fn ensure_current_tile(mut game_state: TakeItEasyGameState) -\u003e Result\u003cTakeItEasyGameState, String\u003e {\n    if game_state.current_tile.is_some() {\n        // ‚úÖ Une tuile existe d√©j√†, pas besoin de modification\n        return Ok(game_state);\n    }\n\n    // üé≤ Aucune tuile courante, en tirer une NOUVELLE\n    game_state = start_new_turn(game_state)?;\n\n    Ok(game_state)\n}\n// game_manager.rs - dans apply_player_move\n// Dans game_manager.rs - AM√âLIORER apply_player_move\npub fn apply_player_move(\n    mut game_state: TakeItEasyGameState,\n    player_move: PlayerMove\n) -\u003e Result\u003cTakeItEasyGameState, String\u003e {\n\n    // V√©rifications utilisant vos fonctions\n    if game_state.current_tile.is_none() {\n        return Err(\"NO_CURRENT_TILE\".to_string());\n    }\n\n    let current_tile = game_state.current_tile.unwrap();\n\n    if player_move.tile != current_tile {\n        return Err(\"WRONG_TILE\".to_string());\n    }\n\n    // üîß UTILISER VOS FONCTIONS : V√©rifier les mouvements l√©gaux\n    let player_plateau = game_state.player_plateaus.get(\u0026player_move.player_id)\n        .ok_or_else(|| {\n            \"PLAYER_NOT_FOUND\".to_string()\n        })?;\n\n    let legal_moves = get_legal_moves(player_plateau.clone());\n    if !legal_moves.contains(\u0026player_move.position) {\n        return Err(\"ILLEGAL_MOVE\".to_string());\n    }\n\n    // R√©cup√©rer le plateau du joueur pour modification\n    let player_plateau = game_state.player_plateaus.get_mut(\u0026player_move.player_id)\n        .ok_or_else(|| \"PLAYER_NOT_FOUND\".to_string())?;\n\n    // Placer la tuile\n    player_plateau.tiles[player_move.position] = player_move.tile;\n\n    // Retirer le joueur de la liste d'attente\n    game_state.waiting_for_players.retain(|id| id != \u0026player_move.player_id);\n\n\n    Ok(game_state)\n}\n\n// Dans game_manager.rs - AM√âLIORER process_mcts_turn avec vos fonctions\npub fn process_mcts_turn(\n    mut game_state: TakeItEasyGameState,\n    policy_net: \u0026Mutex\u003cPolicyNet\u003e,\n    value_net: \u0026Mutex\u003cValueNet\u003e,\n    num_simulations: usize\n) -\u003e Result\u003c(TakeItEasyGameState, MctsMove), String\u003e {\n    let current_tile = game_state.current_tile.ok_or(\"NO_CURRENT_TILE\")?;\n\n    // ‚úÖ V√âRIFICATION: MCTS ne peut jouer que s'il est en attente\n    if !game_state.waiting_for_players.contains(\u0026\"mcts_ai\".to_string()) {\n        return Err(\"MCTS_NOT_WAITING\".to_string());\n    }\n\n    // R√©cup√©rer le plateau MCTS\n    let mcts_plateau = game_state.player_plateaus.get_mut(\"mcts_ai\")\n        .ok_or(\"MCTS_PLAYER_NOT_FOUND\")?;\n\n    // ‚úÖ V√âRIFICATION: Mouvements l√©gaux\n    let legal_moves = get_legal_moves(mcts_plateau.clone());\n    if legal_moves.is_empty() {\n        return Err(\"NO_LEGAL_MOVES_FOR_MCTS\".to_string());\n    }\n    let mut deck_clone = game_state.deck.clone();\n\n    // Utiliser MCTS pour choisir la position\n    let policy_locked = policy_net.lock().map_err(|_| \"Failed to lock policy net\")?;\n    let value_locked = value_net.lock().map_err(|_| \"Failed to lock value net\")?;\n\n    let mcts_result = mcts_find_best_position_for_tile_with_nn(\n        mcts_plateau,\n        \u0026mut deck_clone,\n        current_tile,\n        \u0026*policy_locked,\n        \u0026*value_locked,\n        num_simulations,\n        game_state.current_turn,\n        game_state.total_turns,\n    );\n\n    // ‚úÖ VALIDATION: Position l√©gale\n    if !legal_moves.contains(\u0026mcts_result.best_position) {\n        log::error!(\"‚ùå MCTS a choisi un mouvement ill√©gal: {} (l√©gaux: {:?})\",\n            mcts_result.best_position, legal_moves);\n        return Err(\"MCTS_ILLEGAL_MOVE\".to_string());\n    }\n\n    // ‚úÖ PLACEMENT UNIQUE DE LA TUILE\n    mcts_plateau.tiles[mcts_result.best_position] = current_tile;\n\n    // ‚úÖ RETIRER MCTS DE LA LISTE D'ATTENTE (important !)\n    game_state.waiting_for_players.retain(|id| id != \"mcts_ai\");\n\n    let mcts_move = MctsMove {\n        position: mcts_result.best_position,\n        tile: current_tile,\n        evaluation_score: mcts_result.subscore as f32,\n        search_depth: num_simulations,\n        variations_considered: num_simulations,\n    };\n    Ok((game_state, mcts_move))\n}\n\n// Dans game_manager.rs - NOUVELLE fonction de debug compl√®te\npub fn debug_game_state(game_state: \u0026TakeItEasyGameState) {\n    // üîß UTILISER VOS FONCTIONS pour le debug\n    let remaining_tiles = count_remaining_tiles(\u0026game_state.deck);\n    let available_tiles = get_available_tiles_from_deck(\u0026game_state.deck);\n    // Debug plateaux\n    for (player_id, plateau) in \u0026game_state.player_plateaus {\n        let legal_moves = get_legal_moves(plateau.clone());\n        let filled_positions = plateau.tiles.iter()\n            .enumerate()\n            .filter(|(_, tile)| **tile != Tile(0, 0, 0))\n            .count();    }}\n// game_manager.rs - check_turn_completion d√©marre automatiquement le tour suivant\npub fn check_turn_completion(\n    mut game_state: TakeItEasyGameState\n) -\u003e Result\u003cTakeItEasyGameState, String\u003e {\n    // Si tous les joueurs (humains + MCTS) ont jou√©\n    if game_state.waiting_for_players.is_empty() {\n        let completed_turn = game_state.current_turn;\n        game_state.current_turn += 1;\n        game_state.current_tile = None;\n        // V√©rifier si le jeu est termin√©\n        if game_state.current_turn \u003e= game_state.total_turns {\n            game_state.game_status = GameStatus::Finished;\n            game_state.scores = calculate_final_scores(\u0026game_state);        } else {\n            // üé≤ D√âMARRAGE AUTOMATIQUE DU TOUR SUIVANT \n                      game_state = start_new_turn(game_state)?;        }\n    } else {    }\n\n    Ok(game_state)\n}\n\npub fn calculate_final_scores(game_state: \u0026TakeItEasyGameState) -\u003e HashMap\u003cString, i32\u003e {\n    let mut scores = HashMap::new();\n\n    // Utiliser votre fonction de scoring existante\n    for (player_id, plateau) in \u0026game_state.player_plateaus {\n        let score = result(plateau);\n        scores.insert(player_id.clone(), score);\n    }\n\n    scores\n}\n\npub fn is_game_finished(game_state: \u0026TakeItEasyGameState) -\u003e bool {\n    matches!(game_state.game_status, GameStatus::Finished) ||\n        game_state.current_turn \u003e= game_state.total_turns ||\n        game_state.player_plateaus.values().all(|plateau| is_plateau_full(plateau))\n}\n\npub fn get_available_positions(game_state: \u0026TakeItEasyGameState, player_id: \u0026str) -\u003e Vec\u003cusize\u003e {\n    if let Some(plateau) = game_state.player_plateaus.get(player_id) {\n        plateau.tiles.iter()\n            .enumerate()\n            .filter(|(_, tile)| **tile == Tile(0, 0, 0))\n            .map(|(index, _)| index)\n            .collect()\n    } else {\n        vec![]\n    }\n}\n\n// ============================================================================\n// FONCTIONS DE COMPOSITION - LOGIQUE M√âTIER COMPL√àTE\n// ============================================================================\n\n// game_manager.rs - votre fonction reste la m√™me, mais on change la logique\npub fn process_player_move_with_mcts(\n    game_state: TakeItEasyGameState,\n    player_move: PlayerMove,\n    policy_net: \u0026Mutex\u003cPolicyNet\u003e,\n    value_net: \u0026Mutex\u003cValueNet\u003e,\n    num_simulations: usize\n) -\u003e Result\u003cMoveResult, String\u003e {\n    // 1. Appliquer le mouvement du joueur\n    let mut new_state = apply_player_move(game_state, player_move.clone())?;\n\n    // 2. ‚úÖ GESTION UNIQUE DE MCTS ICI\n    let mcts_response = if player_move.player_id != \"mcts_ai\"\n        \u0026\u0026 new_state.waiting_for_players.contains(\u0026\"mcts_ai\".to_string()) {\n        // MCTS joue automatiquement UNE SEULE FOIS\n        match process_mcts_turn(new_state.clone(), policy_net, value_net, num_simulations) {\n            Ok((updated_state, mcts_move)) =\u003e {\n                new_state = updated_state;                Some(mcts_move)\n            },\n            Err(_e) =\u003e {\n                new_state.waiting_for_players.retain(|id| id != \"mcts_ai\");\n                None\n            }\n        }\n    } else {\n        None\n    };\n\n    // 3. V√©rifier la fin du tour (d√©marre automatiquement le tour suivant)\n    new_state = check_turn_completion(new_state)?;\n\n    // 4. Calculer les points\n    let initial_score = new_state.scores.get(\u0026player_move.player_id).unwrap_or(\u00260).clone();\n    let points_earned = if let Some(plateau) = new_state.player_plateaus.get(\u0026player_move.player_id) {\n        result(plateau) - initial_score\n    } else {\n        0\n    };\n\n    Ok(MoveResult {\n        new_game_state: new_state.clone(),\n        points_earned,\n        mcts_response,\n        is_game_over: is_game_finished(\u0026new_state),\n        turn_completed: new_state.waiting_for_players.is_empty(),\n    })\n}\n// ============================================================================\n// CONVERSION VERS PROTOBUF (COMPATIBLE AVEC VOS TYPES)\n// ============================================================================\n\npub fn take_it_easy_state_to_protobuf(state: \u0026TakeItEasyGameState) -\u003e GameState {\n    let players: Vec\u003ccrate::generated::takeiteasygame::v1::Player\u003e = state.scores.iter().map(|(player_id, score)| {\n        crate::generated::takeiteasygame::v1::Player {\n            id: player_id.clone(),\n            name: player_id.clone(),\n            score: *score,\n            is_ready: true,\n            is_connected: true,\n            joined_at: chrono::Utc::now().timestamp(),\n        }\n    }).collect();\n\n    GameState {\n        session_id: state.session_id.clone(),\n        players,\n        current_player_id: state.waiting_for_players.first().cloned().unwrap_or_default(),\n        state: match state.game_status {\n            GameStatus::WaitingForPlayers =\u003e 0,\n            GameStatus::InProgress =\u003e 1,\n            GameStatus::Finished =\u003e 2,\n        },\n        board_state: serde_json::to_string(state).unwrap_or_default(),\n        turn_number: state.current_turn as i32,\n    }\n}\n\npub fn player_move_from_json(move_data: \u0026str, player_id: \u0026str) -\u003e Result\u003cPlayerMove, String\u003e {\n    #[derive(Deserialize)]\n    struct MoveData {\n        position: usize,\n        tile: Option\u003c(i32, i32, i32)\u003e, // Optionnel car d√©fini par le serveur\n    }\n\n    let data: MoveData = serde_json::from_str(move_data)\n        .map_err(|e| format!(\"Invalid move format: {}\", e))?;\n\n    Ok(PlayerMove {\n        player_id: player_id.to_string(),\n        position: data.position,\n        tile: Tile(0, 0, 0), // Sera remplac√© par la tuile courante\n        timestamp: chrono::Utc::now().timestamp(),\n    })\n}\n\npub fn mcts_move_to_json(mcts_move: \u0026MctsMove) -\u003e Result\u003cString, String\u003e {\n    serde_json::to_string(mcts_move)\n        .map_err(|e| format!(\"Failed to serialize MCTS move: {}\", e))\n}","traces":[{"line":73,"address":[3985465,3983776,3984753],"length":1,"stats":{"Line":0}},{"line":77,"address":[3983812],"length":1,"stats":{"Line":0}},{"line":78,"address":[3983916],"length":1,"stats":{"Line":0}},{"line":81,"address":[3983982,3984059],"length":1,"stats":{"Line":0}},{"line":82,"address":[3985274,3984159],"length":1,"stats":{"Line":0}},{"line":86,"address":[3984186],"length":1,"stats":{"Line":0}},{"line":87,"address":[3984386,3984731],"length":1,"stats":{"Line":0}},{"line":98,"address":[3609600,3609637],"length":1,"stats":{"Line":0}},{"line":99,"address":[3984882],"length":1,"stats":{"Line":0}},{"line":105,"address":[3985504,3986946,3986679],"length":1,"stats":{"Line":0}},{"line":108,"address":[3985535],"length":1,"stats":{"Line":0}},{"line":109,"address":[3986768,3985628],"length":1,"stats":{"Line":0}},{"line":113,"address":[3985713,3985607],"length":1,"stats":{"Line":0}},{"line":117,"address":[3609696,3609721],"length":1,"stats":{"Line":0}},{"line":120,"address":[3985872,3985817],"length":1,"stats":{"Line":0}},{"line":121,"address":[3985894,3986693],"length":1,"stats":{"Line":0}},{"line":125,"address":[3985933,3985878],"length":1,"stats":{"Line":0}},{"line":126,"address":[3986078],"length":1,"stats":{"Line":0}},{"line":130,"address":[3986139],"length":1,"stats":{"Line":0}},{"line":131,"address":[3986304],"length":1,"stats":{"Line":0}},{"line":134,"address":[3986357],"length":1,"stats":{"Line":0}},{"line":138,"address":[3986564],"length":1,"stats":{"Line":0}},{"line":141,"address":[3986992],"length":1,"stats":{"Line":0}},{"line":143,"address":[3987024],"length":1,"stats":{"Line":0}},{"line":146,"address":[3609744,3609769],"length":1,"stats":{"Line":0}},{"line":150,"address":[3987186,3987180,3987088],"length":1,"stats":{"Line":0}},{"line":152,"address":[3987110],"length":1,"stats":{"Line":0}},{"line":155,"address":[3987298,3987292,3987200],"length":1,"stats":{"Line":0}},{"line":157,"address":[3987222],"length":1,"stats":{"Line":0}},{"line":162,"address":[3987782,3987807,3987312],"length":1,"stats":{"Line":0}},{"line":163,"address":[3987342,3987418],"length":1,"stats":{"Line":0}},{"line":165,"address":[3987489],"length":1,"stats":{"Line":0}},{"line":169,"address":[3987429,3987553,3987780],"length":1,"stats":{"Line":0}},{"line":171,"address":[3987718],"length":1,"stats":{"Line":0}},{"line":175,"address":[3987824,3989121,3988986],"length":1,"stats":{"Line":0}},{"line":181,"address":[3987859,3987931],"length":1,"stats":{"Line":0}},{"line":182,"address":[3987984,3989055],"length":1,"stats":{"Line":0}},{"line":185,"address":[3987942],"length":1,"stats":{"Line":0}},{"line":187,"address":[3988020],"length":1,"stats":{"Line":0}},{"line":188,"address":[3988079,3988999],"length":1,"stats":{"Line":0}},{"line":192,"address":[3988063,3988230,3988126,3988992],"length":1,"stats":{"Line":0}},{"line":193,"address":[3609792],"length":1,"stats":{"Line":0}},{"line":194,"address":[3609804],"length":1,"stats":{"Line":0}},{"line":197,"address":[3988279],"length":1,"stats":{"Line":0}},{"line":198,"address":[3988397,3988309],"length":1,"stats":{"Line":0}},{"line":199,"address":[3988426,3988488],"length":1,"stats":{"Line":0}},{"line":203,"address":[3988467,3988676,3988969,3988572],"length":1,"stats":{"Line":0}},{"line":204,"address":[3609852,3609840],"length":1,"stats":{"Line":0}},{"line":207,"address":[3988722],"length":1,"stats":{"Line":0}},{"line":210,"address":[3988803],"length":1,"stats":{"Line":0}},{"line":213,"address":[3988819],"length":1,"stats":{"Line":0}},{"line":217,"address":[3989152,3991871,3991990],"length":1,"stats":{"Line":0}},{"line":223,"address":[3989351,3991985,3989231],"length":1,"stats":{"Line":0}},{"line":226,"address":[3989468],"length":1,"stats":{"Line":0}},{"line":227,"address":[3989699],"length":1,"stats":{"Line":0}},{"line":231,"address":[3989813,3989973,3991980],"length":1,"stats":{"Line":0}},{"line":235,"address":[3990022],"length":1,"stats":{"Line":0}},{"line":236,"address":[3990129,3990052],"length":1,"stats":{"Line":0}},{"line":237,"address":[3990162,3991929],"length":1,"stats":{"Line":0}},{"line":239,"address":[3990143],"length":1,"stats":{"Line":0}},{"line":242,"address":[3609956,3609936],"length":1,"stats":{"Line":0}},{"line":243,"address":[3991877,3990500,3990437],"length":1,"stats":{"Line":0}},{"line":249,"address":[3990654],"length":1,"stats":{"Line":0}},{"line":250,"address":[3990714],"length":1,"stats":{"Line":0}},{"line":252,"address":[3990760],"length":1,"stats":{"Line":0}},{"line":253,"address":[3990767],"length":1,"stats":{"Line":0}},{"line":257,"address":[3990849,3990928],"length":1,"stats":{"Line":0}},{"line":258,"address":[3991045,3991085,3990961],"length":1,"stats":{"Line":0}},{"line":260,"address":[3991051,3991398],"length":1,"stats":{"Line":0}},{"line":264,"address":[3991496,3991011],"length":1,"stats":{"Line":0}},{"line":267,"address":[3610046,3610032],"length":1,"stats":{"Line":0}},{"line":270,"address":[3991544],"length":1,"stats":{"Line":0}},{"line":272,"address":[3991552],"length":1,"stats":{"Line":0}},{"line":276,"address":[3991628],"length":1,"stats":{"Line":0}},{"line":280,"address":[3992032,3992541,3992547],"length":1,"stats":{"Line":0}},{"line":282,"address":[3992052],"length":1,"stats":{"Line":0}},{"line":283,"address":[3992084],"length":1,"stats":{"Line":0}},{"line":285,"address":[3992147,3992094],"length":1,"stats":{"Line":0}},{"line":286,"address":[3992338,3992297],"length":1,"stats":{"Line":0}},{"line":287,"address":[3992350,3992421],"length":1,"stats":{"Line":0}},{"line":289,"address":[3610093,3610080],"length":1,"stats":{"Line":0}},{"line":292,"address":[3993323,3992560,3993416],"length":1,"stats":{"Line":0}},{"line":296,"address":[3992590,3992686],"length":1,"stats":{"Line":0}},{"line":297,"address":[3992764],"length":1,"stats":{"Line":0}},{"line":298,"address":[3992779,3992861],"length":1,"stats":{"Line":0}},{"line":299,"address":[3992817],"length":1,"stats":{"Line":0}},{"line":301,"address":[3992843,3993290,3993154],"length":1,"stats":{"Line":0}},{"line":302,"address":[3992952],"length":1,"stats":{"Line":0}},{"line":303,"address":[3993179,3992972],"length":1,"stats":{"Line":0}},{"line":305,"address":[3992995,3993159,3992886],"length":1,"stats":{"Line":0}},{"line":308,"address":[3992697],"length":1,"stats":{"Line":0}},{"line":311,"address":[3993804,3993456,3993810],"length":1,"stats":{"Line":0}},{"line":312,"address":[3993491],"length":1,"stats":{"Line":0}},{"line":315,"address":[3993554,3993501],"length":1,"stats":{"Line":0}},{"line":316,"address":[3993749,3993696],"length":1,"stats":{"Line":0}},{"line":317,"address":[3993756],"length":1,"stats":{"Line":0}},{"line":320,"address":[3993712],"length":1,"stats":{"Line":0}},{"line":323,"address":[3993824],"length":1,"stats":{"Line":0}},{"line":324,"address":[3993838,3993851],"length":1,"stats":{"Line":0}},{"line":325,"address":[3993863],"length":1,"stats":{"Line":0}},{"line":326,"address":[3610128,3610153],"length":1,"stats":{"Line":0}},{"line":329,"address":[3993936],"length":1,"stats":{"Line":0}},{"line":330,"address":[3994011],"length":1,"stats":{"Line":0}},{"line":331,"address":[3994066],"length":1,"stats":{"Line":0}},{"line":333,"address":[3610176,3610189],"length":1,"stats":{"Line":0}},{"line":334,"address":[3610242,3610224],"length":1,"stats":{"Line":0}},{"line":337,"address":[3994147],"length":1,"stats":{"Line":0}},{"line":346,"address":[3996361,3996430,3994176],"length":1,"stats":{"Line":0}},{"line":354,"address":[3994472,3996410,3994255],"length":1,"stats":{"Line":0}},{"line":357,"address":[3994678,3994747,3994765],"length":1,"stats":{"Line":0}},{"line":358,"address":[3994770],"length":1,"stats":{"Line":0}},{"line":360,"address":[3995066],"length":1,"stats":{"Line":0}},{"line":361,"address":[3995235],"length":1,"stats":{"Line":0}},{"line":362,"address":[3995293],"length":1,"stats":{"Line":0}},{"line":364,"address":[3995157],"length":1,"stats":{"Line":0}},{"line":365,"address":[3610270,3610256],"length":1,"stats":{"Line":0}},{"line":366,"address":[3995527],"length":1,"stats":{"Line":0}},{"line":370,"address":[3994753],"length":1,"stats":{"Line":0}},{"line":374,"address":[3995574,3996367,3994984],"length":1,"stats":{"Line":0}},{"line":377,"address":[3995769],"length":1,"stats":{"Line":0}},{"line":378,"address":[3995941,3995973,3995839],"length":1,"stats":{"Line":0}},{"line":379,"address":[3995951,3995975,3995919],"length":1,"stats":{"Line":0}},{"line":381,"address":[3995930],"length":1,"stats":{"Line":0}},{"line":384,"address":[3996159],"length":1,"stats":{"Line":0}},{"line":385,"address":[3996011],"length":1,"stats":{"Line":0}},{"line":386,"address":[3996018],"length":1,"stats":{"Line":0}},{"line":387,"address":[3996029],"length":1,"stats":{"Line":0}},{"line":388,"address":[3996085],"length":1,"stats":{"Line":0}},{"line":389,"address":[3996136],"length":1,"stats":{"Line":0}},{"line":396,"address":[3996448,3997077,3997105],"length":1,"stats":{"Line":0}},{"line":397,"address":[3996478],"length":1,"stats":{"Line":0}},{"line":398,"address":[3610563],"length":1,"stats":{"Line":0}},{"line":399,"address":[3610379],"length":1,"stats":{"Line":0}},{"line":400,"address":[3610413],"length":1,"stats":{"Line":0}},{"line":401,"address":[3610463],"length":1,"stats":{"Line":0}},{"line":404,"address":[3610469,3610523],"length":1,"stats":{"Line":0}},{"line":406,"address":[3610631],"length":1,"stats":{"Line":0}},{"line":409,"address":[3996559],"length":1,"stats":{"Line":0}},{"line":411,"address":[3996658,3996733],"length":1,"stats":{"Line":0}},{"line":412,"address":[3996793],"length":1,"stats":{"Line":0}},{"line":417,"address":[3996879,3996812],"length":1,"stats":{"Line":0}},{"line":418,"address":[3996905],"length":1,"stats":{"Line":0}},{"line":422,"address":[3997136,3997645,3997639],"length":1,"stats":{"Line":0}},{"line":429,"address":[3997195,3997290],"length":1,"stats":{"Line":0}},{"line":430,"address":[3610693,3610672],"length":1,"stats":{"Line":0}},{"line":432,"address":[3997514],"length":1,"stats":{"Line":0}},{"line":433,"address":[3997351],"length":1,"stats":{"Line":0}},{"line":434,"address":[3997368],"length":1,"stats":{"Line":0}},{"line":435,"address":[3997381],"length":1,"stats":{"Line":0}},{"line":436,"address":[3997477,3997414],"length":1,"stats":{"Line":0}},{"line":440,"address":[3997664],"length":1,"stats":{"Line":0}},{"line":441,"address":[3997683],"length":1,"stats":{"Line":0}},{"line":442,"address":[3610880,3610901],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":153},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","services","game_service.rs"],"content":"// src/services/game_service.rs - GameService √©tendu avec gameplay MCTS - VERSION CORRIG√âE\n\nuse tonic::{Request, Response, Status};\nuse std::sync::{Arc, Mutex};\nuse tokio::sync::RwLock;\n// Import des types g√©n√©r√©s par tonic\nuse crate::generated::takeiteasygame::v1::*;\nuse crate::generated::takeiteasygame::v1::game_service_server::GameService;\nuse crate::mcts::algorithm::mcts_find_best_position_for_tile_with_nn;\nuse crate::services::game_manager::{TakeItEasyGameState, MoveResult, create_take_it_easy_game, start_new_turn, process_player_move_with_mcts, get_available_positions, take_it_easy_state_to_protobuf, player_move_from_json, mcts_move_to_json, is_game_finished, ensure_current_tile, apply_player_move, MctsMove, PlayerMove, check_turn_completion};\nuse crate::services::session_manager::{get_store_from_manager, SessionManager, get_session_by_id_from_store, update_session_in_store, SessionStoreState, GameSession, get_session_by_code_from_store};\nuse crate::neural::policy_value_net::{PolicyNet, ValueNet};\nuse crate::utils::image::generate_tile_image_names;\nuse crate::game::get_legal_moves::get_legal_moves;\n\n// ============================================================================\n// GAMESERVICE AVEC INT√âGRATION MCTS + NOUVELLES M√âTHODES GAMEPLAY\n// ============================================================================\n\n#[derive(Clone)]\npub struct GameServiceImpl {\n    session_manager: Arc\u003cSessionManager\u003e,\n    policy_net: Arc\u003cMutex\u003cPolicyNet\u003e\u003e,\n    value_net: Arc\u003cMutex\u003cValueNet\u003e\u003e,\n    num_simulations: usize,\n}\n\nimpl GameServiceImpl {\n    pub fn new(\n        session_manager: Arc\u003cSessionManager\u003e,\n        policy_net: Arc\u003cMutex\u003cPolicyNet\u003e\u003e,\n        value_net: Arc\u003cMutex\u003cValueNet\u003e\u003e,\n        num_simulations: usize\n    ) -\u003e Self {\n        GameServiceImpl {\n            session_manager,\n            policy_net,\n            value_net,\n            num_simulations,\n        }\n    }\n}\n\n// ============================================================================\n// FONCTIONS PURES - CR√âATION DE R√âPONSES (existantes + nouvelles)\n// ============================================================================\n\nfn make_move_success_response(move_result: MoveResult) -\u003e MakeMoveResponse {\n    let mcts_response_json = move_result.mcts_response\n        .as_ref()\n        .and_then(|mcts| mcts_move_to_json(mcts).ok())\n        .unwrap_or_default();\n\n    MakeMoveResponse {\n        result: Some(make_move_response::Result::Success(\n            MakeMoveSuccess {\n                new_game_state: Some(take_it_easy_state_to_protobuf(\u0026move_result.new_game_state)),\n                mcts_response: mcts_response_json,\n                points_earned: move_result.points_earned,\n                is_game_over: move_result.is_game_over,\n            }\n        )),\n    }\n}\n\nfn make_move_error_response(code: String, message: String) -\u003e MakeMoveResponse {\n    MakeMoveResponse {\n        result: Some(make_move_response::Result::Error(Error {\n            code,\n            message,\n            details: std::collections::HashMap::new(),\n        })),\n    }\n}\n\nfn available_moves_success_response(positions: Vec\u003cusize\u003e, current_tile: Option\u003ccrate::game::tile::Tile\u003e) -\u003e GetAvailableMovesResponse {\n    let moves_json: Vec\u003cString\u003e = positions\n        .iter()\n        .map(|pos| {\n            serde_json::json!({\n                \"position\": pos,\n                \"tile\": current_tile.map(|t| (t.0, t.1, t.2))\n            }).to_string()\n        })\n        .collect();\n\n    GetAvailableMovesResponse {\n        available_moves: moves_json,\n        error: None,\n    }\n}\n\nfn available_moves_error_response(code: String, message: String) -\u003e GetAvailableMovesResponse {\n    GetAvailableMovesResponse {\n        available_moves: vec![],\n        error: Some(Error {\n            code,\n            message,\n            details: std::collections::HashMap::new(),\n        }),\n    }\n}\n\nfn start_turn_success_response(\n    announced_tile: String,\n    tile_image: String,\n    turn_number: i32,\n    waiting_for_players: Vec\u003cString\u003e,\n    game_state_json: String\n) -\u003e StartTurnResponse {\n    StartTurnResponse {\n        success: true,\n        announced_tile,\n        tile_image,\n        turn_number,\n        waiting_for_players,\n        game_state: game_state_json,\n        error: None,\n    }\n}\n\nfn start_turn_error_response(message: String) -\u003e StartTurnResponse {\n    StartTurnResponse {\n        success: false,\n        announced_tile: String::new(),\n        tile_image: String::new(),\n        turn_number: 0,\n        waiting_for_players: vec![],\n        game_state: String::new(),\n        error: Some(Error {\n            code: \"START_TURN_FAILED\".to_string(),\n            message,\n            details: std::collections::HashMap::new(),\n        }),\n    }\n}\n\nfn game_state_success_response(\n    game_state_json: String,\n    current_tile: String,\n    current_turn: i32,\n    waiting_for_players: Vec\u003cString\u003e,\n    is_game_finished: bool,\n    final_scores_json: String\n) -\u003e GetGameStateResponse {\n    GetGameStateResponse {\n        success: true,\n        game_state: game_state_json,\n        current_tile,\n        current_turn,\n        waiting_for_players,\n        is_game_finished,\n        final_scores: final_scores_json,\n        error: None,\n    }\n}\n\nfn game_state_error_response(message: String) -\u003e GetGameStateResponse {\n    GetGameStateResponse {\n        success: false,\n        game_state: String::new(),\n        current_tile: String::new(),\n        current_turn: 0,\n        waiting_for_players: vec![],\n        is_game_finished: false,\n        final_scores: String::new(),\n        error: Some(Error {\n            code: \"GET_GAME_STATE_FAILED\".to_string(),\n            message,\n            details: std::collections::HashMap::new(),\n        }),\n    }\n}\n\n// ============================================================================\n// FONCTION AUXILIAIRE : process_mcts_move_only\n// ============================================================================\n\npub fn process_mcts_move_only(\n    game_state: TakeItEasyGameState,\n    policy_net: \u0026Mutex\u003cPolicyNet\u003e,\n    value_net: \u0026Mutex\u003cValueNet\u003e,\n    num_simulations: usize\n) -\u003e Result\u003c(TakeItEasyGameState, MctsMove), String\u003e {\n\n    // ‚úÖ V√âRIFICATION: MCTS doit √™tre en attente\n    if !game_state.waiting_for_players.contains(\u0026\"mcts_ai\".to_string()) {\n        return Err(\"MCTS_NOT_WAITING\".to_string());\n    }\n\n    let current_tile = game_state.current_tile.ok_or(\"NO_CURRENT_TILE\")?;\n\n    // R√©cup√©rer le plateau MCTS\n    let mcts_plateau = game_state.player_plateaus.get(\"mcts_ai\")\n        .ok_or(\"MCTS_PLAYER_NOT_FOUND\")?\n        .clone();\n\n    // ‚úÖ V√âRIFICATION: Mouvements l√©gaux\n    let legal_moves = get_legal_moves(mcts_plateau.clone());\n    if legal_moves.is_empty() {\n        return Err(\"NO_LEGAL_MOVES_FOR_MCTS\".to_string());\n    }\n\n\n    let mut deck_clone = game_state.deck.clone();\n\n    // Verrouiller les r√©seaux\n    let policy_locked = policy_net.lock().map_err(|_| \"Failed to lock policy net\")?;\n    let value_locked = value_net.lock().map_err(|_| \"Failed to lock value net\")?;\n\n    // ‚úÖ EX√âCUTION MCTS\n    let mut mcts_plateau_mut = mcts_plateau.clone();\n    let mcts_result = mcts_find_best_position_for_tile_with_nn(\n        \u0026mut mcts_plateau_mut,\n        \u0026mut deck_clone,\n        current_tile,\n        \u0026*policy_locked,\n        \u0026*value_locked,\n        num_simulations,\n        game_state.current_turn,\n        game_state.total_turns,\n    );\n\n    // ‚úÖ VALIDATION: Position choisie doit √™tre l√©gale\n    if !legal_moves.contains(\u0026mcts_result.best_position) {\n        return Err(\"MCTS_ILLEGAL_MOVE\".to_string());\n    }\n\n    // Cr√©er le mouvement MCTS\n    let mcts_player_move = PlayerMove {\n        player_id: \"mcts_ai\".to_string(),\n        position: mcts_result.best_position,\n        tile: current_tile,\n        timestamp: chrono::Utc::now().timestamp(),\n    };\n\n\n    // Appliquer le mouvement MCTS\n    let updated_state = apply_player_move(game_state, mcts_player_move)?;\n\n    let mcts_move = MctsMove {\n        position: mcts_result.best_position,\n        tile: current_tile,\n        evaluation_score: mcts_result.subscore as f32,\n        search_depth: num_simulations,\n        variations_considered: num_simulations,\n    };\n\n\n    Ok((updated_state, mcts_move))\n}\n\n// ============================================================================\n// FONCTION POUR G√âRER session par code OU ID\n// ============================================================================\n\npub async fn get_session_by_code_or_id_from_store(\n    store: \u0026Arc\u003cRwLock\u003cSessionStoreState\u003e\u003e,\n    identifier: \u0026str\n) -\u003e Option\u003cGameSession\u003e {\n    // Essayer d'abord par ID (UUID)\n    if let Some(session) = get_session_by_id_from_store(store, identifier).await {\n        return Some(session);\n    }\n\n    // Ensuite essayer par code (ex: \"GTHG7Q\")\n    get_session_by_code_from_store(store, identifier).await\n}\n\n// ============================================================================\n// FONCTIONS COMPOSABLES - LOGIQUE M√âTIER (existantes + nouvelles)\n// ============================================================================\n\nasync fn make_move_logic(\n    service: \u0026GameServiceImpl,\n    session_id: String,\n    player_id: String,\n    move_data: String,\n    timestamp: i64\n) -\u003e Result\u003cResponse\u003cMakeMoveResponse\u003e, Status\u003e {\n    let store = get_store_from_manager(\u0026service.session_manager);\n\n    let session = match get_session_by_code_or_id_from_store(store, \u0026session_id).await {\n        Some(session) =\u003e session,\n        None =\u003e {\n            let response = make_move_error_response(\n                \"SESSION_NOT_FOUND\".to_string(),\n                \"Session not found\".to_string()\n            );\n            return Ok(Response::new(response));\n        }\n    };\n\n    // R√©cup√©rer l'√©tat de jeu\n    let game_state: TakeItEasyGameState = if session.board_state.is_empty() || session.board_state == \"{}\" {\n        let response = make_move_error_response(\n            \"GAME_NOT_STARTED\".to_string(),\n            \"No game state found. Please start a turn first.\".to_string()\n        );\n        return Ok(Response::new(response));\n    } else {\n        serde_json::from_str(\u0026session.board_state)\n            .map_err(|e| Status::internal(format!(\"Failed to parse game state: {}\", e)))?\n    };\n\n    // V√©rification: S'assurer qu'une tuile courante existe\n    let game_state = match ensure_current_tile(game_state) {\n        Ok(state) =\u003e {            state\n        },\n        Err(e) =\u003e {\n            log::error!(\"‚ùå √âchec garantie tuile: {}\", e);\n            return Ok(Response::new(make_move_error_response(\n                \"NO_CURRENT_TILE\".to_string(),\n                format!(\"No current tile available: {}\", e)\n            )));\n        }\n    };\n    // Parser le mouvement du joueur\n    let player_move = match player_move_from_json(\u0026move_data, \u0026player_id) {\n        Ok(mv) =\u003e {\n            let mut mv = mv;\n            mv.timestamp = timestamp;\n            if let Some(current_tile) = game_state.current_tile {\n                mv.tile = current_tile;\n            }\n            mv\n        },\n        Err(e) =\u003e {\n            let response = make_move_error_response(\n                \"INVALID_MOVE_FORMAT\".to_string(),\n                format!(\"Failed to parse move: {}\", e)\n            );\n            return Ok(Response::new(response));\n        }\n    };\n\n    // Traitement du mouvement avec MCTS\n    match process_player_move_with_mcts(\n        game_state,\n        player_move,\n        \u0026*service.policy_net,\n        \u0026*service.value_net,\n        service.num_simulations\n    ) {\n        Ok(move_result) =\u003e {\n            let final_state = move_result.new_game_state.clone();\n\n            // Sauvegarder l'√©tat final\n            let mut updated_session = session;\n            updated_session.board_state = serde_json::to_string(\u0026final_state).unwrap_or_default();\n\n            // Mettre √† jour les scores\n            for (player_id, score) in \u0026final_state.scores {\n                if let Some(player) = updated_session.players.get_mut(player_id) {\n                    player.score = *score;\n                }\n            }\n\n            update_session_in_store(store, updated_session).await\n                .map_err(|e| Status::internal(e))?;\n\n            let response = make_move_success_response(move_result);\n            Ok(Response::new(response))\n        },\n        Err(error_code) =\u003e {\n            let response = make_move_error_response(\n                error_code,\n                \"Failed to process move\".to_string()\n            );\n            Ok(Response::new(response))\n        }\n    }\n}\n\nasync fn get_available_moves_logic(\n    service: \u0026GameServiceImpl,\n    session_id: String,\n    player_id: String\n) -\u003e Result\u003cResponse\u003cGetAvailableMovesResponse\u003e, Status\u003e {\n    let store = get_store_from_manager(\u0026service.session_manager);\n\n    // R√©cup√©rer la session\n    let session = match get_session_by_id_from_store(store, \u0026session_id).await {\n        Some(session) =\u003e session,\n        None =\u003e {\n            let response = available_moves_error_response(\n                \"SESSION_NOT_FOUND\".to_string(),\n                \"Session not found\".to_string()\n            );\n            return Ok(Response::new(response));\n        }\n    };\n\n    // R√©cup√©rer l'√©tat de jeu\n    let game_state: TakeItEasyGameState = if session.board_state.is_empty() || session.board_state == \"{}\" {\n        let response = available_moves_error_response(\n            \"GAME_NOT_STARTED\".to_string(),\n            \"Game has not started yet\".to_string()\n        );\n        return Ok(Response::new(response));\n    } else {\n        serde_json::from_str(\u0026session.board_state)\n            .map_err(|e| Status::internal(format!(\"Failed to parse game state: {}\", e)))?\n    };\n\n    // V√©rifier si le jeu est termin√©\n    if is_game_finished(\u0026game_state) {\n        let response = available_moves_error_response(\n            \"GAME_FINISHED\".to_string(),\n            \"Game is already finished\".to_string()\n        );\n        return Ok(Response::new(response));\n    }\n\n    // Obtenir les positions disponibles\n    let available_positions = get_available_positions(\u0026game_state, \u0026player_id);\n    let current_tile = game_state.current_tile;\n\n    let response = available_moves_success_response(available_positions, current_tile);\n    Ok(Response::new(response))\n}\n\nasync fn start_turn_logic(\n    service: \u0026GameServiceImpl,\n    session_id: String\n) -\u003e Result\u003cResponse\u003cStartTurnResponse\u003e, Status\u003e {\n    let store = get_store_from_manager(\u0026service.session_manager);\n    let session = match get_session_by_code_or_id_from_store(store, \u0026session_id).await {\n        Some(session) =\u003e {            session\n        },\n        None =\u003e {\n            return Ok(Response::new(start_turn_error_response(\"Session not found\".to_string())));\n        }\n    };\n\n    // R√©cup√©rer ou cr√©er l'√©tat de jeu\n    let mut game_state: TakeItEasyGameState = if session.board_state.is_empty() || session.board_state == \"{}\" {\n        // Premi√®re fois - cr√©er le jeu\n        let player_ids: Vec\u003cString\u003e = session.players.keys().cloned().collect();\n        create_take_it_easy_game(session_id.clone(), player_ids)\n    } else {\n        // D√©s√©rialiser l'√©tat existant\n        match serde_json::from_str::\u003cTakeItEasyGameState\u003e(\u0026session.board_state) {\n            Ok(mut state) =\u003e {\n                state.session_id = session_id.clone();\n                state\n            },\n            Err(e) =\u003e {                let player_ids: Vec\u003cString\u003e = session.players.keys().cloned().collect();\n                create_take_it_easy_game(session_id.clone(), player_ids)\n            }\n        }\n    };\n\n    // V√©rifier si une tuile existe d√©j√† pour ce tour\n    let new_state = if game_state.current_tile.is_some() {\n        // ‚úÖ Une tuile existe d√©j√†, utiliser l'√©tat actuel\n        game_state\n    } else {\n        match start_new_turn(game_state) {\n            Ok(new_state) =\u003e {\n                new_state\n            },\n            Err(e) =\u003e {\n                return Ok(Response::new(start_turn_error_response(format!(\"Failed to start turn: {}\", e))));\n            }\n        }\n    };\n\n    // ‚úÖ NOUVEAU: FAIRE JOUER MCTS AUTOMATIQUEMENT D√àS QU'UNE TUILE EST DISPONIBLE\n    let final_state = if new_state.waiting_for_players.contains(\u0026\"mcts_ai\".to_string()) {\n\n        // Utiliser la fonction process_mcts_move_only\n        match process_mcts_move_only(\n            new_state.clone(),\n            \u0026*service.policy_net,\n            \u0026*service.value_net,\n            service.num_simulations\n        ) {\n            Ok((updated_state, _mcts_move)) =\u003e {\n                let update_state_clone = updated_state.clone();\n                // V√©rifier si le tour est termin√© apr√®s que MCTS ait jou√©\n                match check_turn_completion(update_state_clone) {\n                    Ok(completed_state) =\u003e {\n                        completed_state\n                    },\n                    Err(_e) =\u003e {\n                        updated_state.clone()\n                    }\n                }\n            },\n            Err(_e) =\u003e {\n                // Retirer MCTS de la liste pour ne pas bloquer le jeu\n                let mut fallback_state = new_state.clone();\n                fallback_state.waiting_for_players.retain(|id| id != \"mcts_ai\");\n                fallback_state\n            }\n        }\n    } else {\n        new_state\n    };\n\n    // Extraire les informations de la tuile\n    let announced_tile = final_state.current_tile.unwrap();\n    let announced_tile_str = format!(\"{}-{}-{}\", announced_tile.0, announced_tile.1, announced_tile.2);\n    let tile_image = generate_tile_image_names(\u0026[announced_tile])[0].clone();\n\n    let turn_number = final_state.current_turn as i32;\n    let waiting_for_players = final_state.waiting_for_players.clone();\n    let game_state_json = serde_json::to_string(\u0026final_state).unwrap_or_default();\n\n    // Sauvegarder l'√©tat mis √† jour (avec le mouvement MCTS si applicable)\n    let mut updated_session = session;\n    updated_session.board_state = game_state_json.clone();\n\n    if let Err(e) = update_session_in_store(store, updated_session).await {\n        return Ok(Response::new(start_turn_error_response(format!(\"Failed to update session: {}\", e))));\n    }\n\n\n    let response = start_turn_success_response(\n        announced_tile_str,\n        tile_image,\n        turn_number,\n        waiting_for_players,\n        game_state_json\n    );\n    Ok(Response::new(response))\n}\n\nasync fn get_game_state_logic(\n    service: \u0026GameServiceImpl,\n    session_id: String\n) -\u003e Result\u003cResponse\u003cGetGameStateResponse\u003e, Status\u003e {\n    let store = get_store_from_manager(\u0026service.session_manager);\n\n    // R√©cup√©rer la session\n    let session = match get_session_by_id_from_store(store, \u0026session_id).await {\n        Some(session) =\u003e session,\n        None =\u003e {\n            return Ok(Response::new(game_state_error_response(\"Session not found\".to_string())));\n        }\n    };\n\n    if session.board_state.is_empty() || session.board_state == \"{}\" {\n        return Ok(Response::new(game_state_error_response(\"Game not started yet\".to_string())));\n    }\n\n    let game_state: TakeItEasyGameState = match serde_json::from_str(\u0026session.board_state) {\n        Ok(state) =\u003e state,\n        Err(e) =\u003e return Ok(Response::new(game_state_error_response(format!(\"Failed to parse game state: {}\", e)))),\n    };\n\n    let current_tile_str = game_state.current_tile\n        .map(|t| format!(\"{}-{}-{}\", t.0, t.1, t.2))\n        .unwrap_or_default();\n\n    let final_scores_json = if is_game_finished(\u0026game_state) {\n        serde_json::to_string(\u0026game_state.scores).unwrap_or_default()\n    } else {\n        \"{}\".to_string()\n    };\n\n    let current_turn = game_state.current_turn as i32;\n    let waiting_for_players = game_state.waiting_for_players.clone();\n    let is_finished = is_game_finished(\u0026game_state);\n    let game_state_json = serde_json::to_string(\u0026game_state).unwrap_or_default();\n\n    let response = game_state_success_response(\n        game_state_json,\n        current_tile_str,\n        current_turn,\n        waiting_for_players,\n        is_finished,\n        final_scores_json\n    );\n\n    Ok(Response::new(response))\n}\n\n// ============================================================================\n// IMPL√âMENTATION GRPC - TRAIT G√âN√âR√â PAR TONIC\n// ============================================================================\n\n#[tonic::async_trait]\nimpl GameService for GameServiceImpl {\n    async fn make_move(\n        \u0026self,\n        request: Request\u003cMakeMoveRequest\u003e,\n    ) -\u003e Result\u003cResponse\u003cMakeMoveResponse\u003e, Status\u003e {\n        let req = request.into_inner();\n        make_move_logic(\n            self,\n            req.session_id,\n            req.player_id,\n            req.move_data,\n            req.timestamp\n        ).await\n    }\n\n    async fn get_available_moves(\n        \u0026self,\n        request: Request\u003cGetAvailableMovesRequest\u003e,\n    ) -\u003e Result\u003cResponse\u003cGetAvailableMovesResponse\u003e, Status\u003e {\n        let req = request.into_inner();\n        get_available_moves_logic(\n            self,\n            req.session_id,\n            req.player_id\n        ).await\n    }\n\n    async fn start_turn(\n        \u0026self,\n        request: Request\u003cStartTurnRequest\u003e,\n    ) -\u003e Result\u003cResponse\u003cStartTurnResponse\u003e, Status\u003e {\n        let req = request.into_inner();\n        start_turn_logic(self, req.session_id).await\n    }\n\n    async fn get_game_state(\n        \u0026self,\n        request: Request\u003cGetGameStateRequest\u003e,\n    ) -\u003e Result\u003cResponse\u003cGetGameStateResponse\u003e, Status\u003e {\n        let req = request.into_inner();\n        get_game_state_logic(self, req.session_id).await\n    }\n}","traces":[{"line":29,"address":[4666560],"length":1,"stats":{"Line":0}},{"line":48,"address":[4667065,4666608],"length":1,"stats":{"Line":0}},{"line":49,"address":[4666638,4666697],"length":1,"stats":{"Line":0}},{"line":51,"address":[4487552,4487571],"length":1,"stats":{"Line":0}},{"line":55,"address":[4666973],"length":1,"stats":{"Line":0}},{"line":66,"address":[4667088,4667467,4667442],"length":1,"stats":{"Line":0}},{"line":68,"address":[4667213],"length":1,"stats":{"Line":0}},{"line":76,"address":[4667749,4667488],"length":1,"stats":{"Line":0}},{"line":77,"address":[4667595,4667523],"length":1,"stats":{"Line":0}},{"line":79,"address":[4487616,4488292,4488298],"length":1,"stats":{"Line":0}},{"line":80,"address":[4488003,4487650,4487783,4488311],"length":1,"stats":{"Line":0}},{"line":82,"address":[4510886,4487966,4510880],"length":1,"stats":{"Line":0}},{"line":93,"address":[4668311,4667776,4668239],"length":1,"stats":{"Line":0}},{"line":95,"address":[4667803],"length":1,"stats":{"Line":0}},{"line":96,"address":[4668027],"length":1,"stats":{"Line":0}},{"line":104,"address":[4668352],"length":1,"stats":{"Line":0}},{"line":122,"address":[4669277,4668528,4669249],"length":1,"stats":{"Line":0}},{"line":125,"address":[4668549],"length":1,"stats":{"Line":0}},{"line":126,"address":[4668623],"length":1,"stats":{"Line":0}},{"line":128,"address":[4668668],"length":1,"stats":{"Line":0}},{"line":129,"address":[4668727],"length":1,"stats":{"Line":0}},{"line":130,"address":[4668939],"length":1,"stats":{"Line":0}},{"line":138,"address":[4669312],"length":1,"stats":{"Line":0}},{"line":158,"address":[4670308,4669552,4670280],"length":1,"stats":{"Line":0}},{"line":161,"address":[4669573],"length":1,"stats":{"Line":0}},{"line":162,"address":[4669647],"length":1,"stats":{"Line":0}},{"line":164,"address":[4669692],"length":1,"stats":{"Line":0}},{"line":166,"address":[4669751],"length":1,"stats":{"Line":0}},{"line":167,"address":[4669963],"length":1,"stats":{"Line":0}},{"line":179,"address":[4673348,4670336,4673199],"length":1,"stats":{"Line":0}},{"line":187,"address":[4670546,4670426],"length":1,"stats":{"Line":0}},{"line":188,"address":[4670714],"length":1,"stats":{"Line":0}},{"line":191,"address":[4673325,4670829],"length":1,"stats":{"Line":0}},{"line":194,"address":[4671009,4671169,4673320],"length":1,"stats":{"Line":0}},{"line":199,"address":[4671296,4671233],"length":1,"stats":{"Line":0}},{"line":200,"address":[4671371,4671303],"length":1,"stats":{"Line":0}},{"line":201,"address":[4671404,4673251],"length":1,"stats":{"Line":0}},{"line":205,"address":[4671385],"length":1,"stats":{"Line":0}},{"line":208,"address":[4488368,4488388],"length":1,"stats":{"Line":0}},{"line":209,"address":[4488416,4488436],"length":1,"stats":{"Line":0}},{"line":212,"address":[4671904],"length":1,"stats":{"Line":0}},{"line":217,"address":[4671959],"length":1,"stats":{"Line":0}},{"line":218,"address":[4672016],"length":1,"stats":{"Line":0}},{"line":220,"address":[4672054],"length":1,"stats":{"Line":0}},{"line":221,"address":[4672061],"length":1,"stats":{"Line":0}},{"line":225,"address":[4672230,4672151],"length":1,"stats":{"Line":0}},{"line":226,"address":[4672263,4672333],"length":1,"stats":{"Line":0}},{"line":231,"address":[4672294],"length":1,"stats":{"Line":0}},{"line":232,"address":[4672400],"length":1,"stats":{"Line":0}},{"line":234,"address":[4672413,4672476],"length":1,"stats":{"Line":0}},{"line":239,"address":[4672596,4673149],"length":1,"stats":{"Line":0}},{"line":242,"address":[4672852],"length":1,"stats":{"Line":0}},{"line":244,"address":[4672860],"length":1,"stats":{"Line":0}},{"line":250,"address":[4672949],"length":1,"stats":{"Line":0}},{"line":257,"address":[4673376],"length":1,"stats":{"Line":0}},{"line":262,"address":[3686335],"length":1,"stats":{"Line":0}},{"line":263,"address":[4489096],"length":1,"stats":{"Line":0}},{"line":267,"address":[3686350],"length":1,"stats":{"Line":0}},{"line":274,"address":[4673424],"length":1,"stats":{"Line":0}},{"line":281,"address":[4490059,4489909],"length":1,"stats":{"Line":0}},{"line":283,"address":[4490115,4489966,4490239,4490358],"length":1,"stats":{"Line":0}},{"line":284,"address":[4490664],"length":1,"stats":{"Line":0}},{"line":287,"address":[4490820,4490754],"length":1,"stats":{"Line":0}},{"line":288,"address":[4490828],"length":1,"stats":{"Line":0}},{"line":290,"address":[4490963],"length":1,"stats":{"Line":0}},{"line":295,"address":[4491108,4490722,4491191],"length":1,"stats":{"Line":0}},{"line":297,"address":[4491150,4495240],"length":1,"stats":{"Line":0}},{"line":298,"address":[4495248],"length":1,"stats":{"Line":0}},{"line":300,"address":[4495383],"length":1,"stats":{"Line":0}},{"line":302,"address":[4491395,4495200,4491197],"length":1,"stats":{"Line":0}},{"line":303,"address":[4491349,4496966,4496944],"length":1,"stats":{"Line":0}},{"line":307,"address":[4491474],"length":1,"stats":{"Line":0}},{"line":308,"address":[4491650],"length":1,"stats":{"Line":0}},{"line":310,"address":[4491518],"length":1,"stats":{"Line":0}},{"line":311,"address":[4491550,4494542,4494582],"length":1,"stats":{"Line":0}},{"line":312,"address":[4495056,4495119],"length":1,"stats":{"Line":0}},{"line":313,"address":[4494548,4494883],"length":1,"stats":{"Line":0}},{"line":314,"address":[4494891,4494956],"length":1,"stats":{"Line":0}},{"line":319,"address":[4491790,4491686],"length":1,"stats":{"Line":0}},{"line":320,"address":[4491969],"length":1,"stats":{"Line":0}},{"line":321,"address":[4491995],"length":1,"stats":{"Line":0}},{"line":322,"address":[4492021],"length":1,"stats":{"Line":0}},{"line":323,"address":[4492044],"length":1,"stats":{"Line":0}},{"line":324,"address":[4492089],"length":1,"stats":{"Line":0}},{"line":326,"address":[4492119],"length":1,"stats":{"Line":0}},{"line":328,"address":[4491903],"length":1,"stats":{"Line":0}},{"line":330,"address":[4494093,4491935],"length":1,"stats":{"Line":0}},{"line":331,"address":[4494101,4494166],"length":1,"stats":{"Line":0}},{"line":333,"address":[4494329,4494408],"length":1,"stats":{"Line":0}},{"line":338,"address":[4492526,4492456],"length":1,"stats":{"Line":0}},{"line":339,"address":[4492183],"length":1,"stats":{"Line":0}},{"line":340,"address":[4492221],"length":1,"stats":{"Line":0}},{"line":341,"address":[4492293],"length":1,"stats":{"Line":0}},{"line":342,"address":[4492361],"length":1,"stats":{"Line":0}},{"line":343,"address":[4492440],"length":1,"stats":{"Line":0}},{"line":345,"address":[4492673],"length":1,"stats":{"Line":0}},{"line":346,"address":[4492727],"length":1,"stats":{"Line":0}},{"line":349,"address":[4492807],"length":1,"stats":{"Line":0}},{"line":350,"address":[4492985,4492891,4493018],"length":1,"stats":{"Line":0}},{"line":353,"address":[4493166],"length":1,"stats":{"Line":0}},{"line":354,"address":[4493640,4493341,4493571],"length":1,"stats":{"Line":0}},{"line":355,"address":[4493635],"length":1,"stats":{"Line":0}},{"line":359,"address":[3671413],"length":1,"stats":{"Line":0}},{"line":360,"address":[4497184,4497196,4495805],"length":1,"stats":{"Line":0}},{"line":362,"address":[4495837],"length":1,"stats":{"Line":0}},{"line":363,"address":[4495928],"length":1,"stats":{"Line":0}},{"line":365,"address":[4492561],"length":1,"stats":{"Line":0}},{"line":367,"address":[4492599],"length":1,"stats":{"Line":0}},{"line":368,"address":[4492639],"length":1,"stats":{"Line":0}},{"line":370,"address":[4493804,4493749],"length":1,"stats":{"Line":0}},{"line":375,"address":[4673536],"length":1,"stats":{"Line":0}},{"line":380,"address":[4497548,4497434],"length":1,"stats":{"Line":0}},{"line":383,"address":[3679569],"length":1,"stats":{"Line":0}},{"line":384,"address":[4498046],"length":1,"stats":{"Line":0}},{"line":387,"address":[4498095,4498161],"length":1,"stats":{"Line":0}},{"line":388,"address":[4498169],"length":1,"stats":{"Line":0}},{"line":390,"address":[4498304],"length":1,"stats":{"Line":0}},{"line":395,"address":[4498515,4498073,4498445],"length":1,"stats":{"Line":0}},{"line":397,"address":[4499617,4498477],"length":1,"stats":{"Line":0}},{"line":398,"address":[4499625],"length":1,"stats":{"Line":0}},{"line":400,"address":[4499760],"length":1,"stats":{"Line":0}},{"line":402,"address":[4498521,4498694,4499580],"length":1,"stats":{"Line":0}},{"line":403,"address":[4499856,4498654,4499878],"length":1,"stats":{"Line":0}},{"line":407,"address":[4498854,4498799],"length":1,"stats":{"Line":0}},{"line":409,"address":[4499335,4498889],"length":1,"stats":{"Line":0}},{"line":410,"address":[4499343],"length":1,"stats":{"Line":0}},{"line":412,"address":[4499478],"length":1,"stats":{"Line":0}},{"line":416,"address":[4498949,4498860],"length":1,"stats":{"Line":0}},{"line":417,"address":[4498956],"length":1,"stats":{"Line":0}},{"line":419,"address":[4498972],"length":1,"stats":{"Line":0}},{"line":420,"address":[4499035],"length":1,"stats":{"Line":0}},{"line":423,"address":[4673616],"length":1,"stats":{"Line":0}},{"line":427,"address":[4500553,4500406],"length":1,"stats":{"Line":0}},{"line":428,"address":[3672489],"length":1,"stats":{"Line":0}},{"line":429,"address":[4501135],"length":1,"stats":{"Line":0}},{"line":432,"address":[4501219],"length":1,"stats":{"Line":0}},{"line":437,"address":[4501187,4502554,4501424,4501506],"length":1,"stats":{"Line":0}},{"line":439,"address":[4502346,4501466],"length":1,"stats":{"Line":0}},{"line":440,"address":[4502384,4502456],"length":1,"stats":{"Line":0}},{"line":443,"address":[4501512],"length":1,"stats":{"Line":0}},{"line":444,"address":[4501683],"length":1,"stats":{"Line":0}},{"line":445,"address":[4501775,4501756,4501685],"length":1,"stats":{"Line":0}},{"line":446,"address":[4501895],"length":1,"stats":{"Line":0}},{"line":448,"address":[4502043,4501606],"length":1,"stats":{"Line":0}},{"line":449,"address":[4502153,4502081],"length":1,"stats":{"Line":0}},{"line":455,"address":[4501940,4502620,4502764],"length":1,"stats":{"Line":0}},{"line":457,"address":[4502700],"length":1,"stats":{"Line":0}},{"line":459,"address":[4502769,4502626],"length":1,"stats":{"Line":0}},{"line":460,"address":[4502868],"length":1,"stats":{"Line":0}},{"line":461,"address":[4502894],"length":1,"stats":{"Line":0}},{"line":463,"address":[4502806],"length":1,"stats":{"Line":0}},{"line":464,"address":[4502838,4503022],"length":1,"stats":{"Line":0}},{"line":470,"address":[4503329,4502939],"length":1,"stats":{"Line":0}},{"line":473,"address":[4503833,4503872],"length":1,"stats":{"Line":0}},{"line":474,"address":[4503597,4503662],"length":1,"stats":{"Line":0}},{"line":475,"address":[4503670],"length":1,"stats":{"Line":0}},{"line":476,"address":[4503738],"length":1,"stats":{"Line":0}},{"line":477,"address":[4503817],"length":1,"stats":{"Line":0}},{"line":479,"address":[4504007],"length":1,"stats":{"Line":0}},{"line":480,"address":[4504070],"length":1,"stats":{"Line":0}},{"line":482,"address":[4504133],"length":1,"stats":{"Line":0}},{"line":483,"address":[4504239],"length":1,"stats":{"Line":0}},{"line":484,"address":[4504265],"length":1,"stats":{"Line":0}},{"line":486,"address":[4504177],"length":1,"stats":{"Line":0}},{"line":487,"address":[4504209],"length":1,"stats":{"Line":0}},{"line":491,"address":[4503909],"length":1,"stats":{"Line":0}},{"line":493,"address":[4503941],"length":1,"stats":{"Line":0}},{"line":494,"address":[4507966,4504466,4507952],"length":1,"stats":{"Line":0}},{"line":495,"address":[4504518],"length":1,"stats":{"Line":0}},{"line":499,"address":[4503485],"length":1,"stats":{"Line":0}},{"line":503,"address":[4503537],"length":1,"stats":{"Line":0}},{"line":504,"address":[4504624,4504691],"length":1,"stats":{"Line":0}},{"line":505,"address":[4504904,4505049],"length":1,"stats":{"Line":0}},{"line":507,"address":[4505232],"length":1,"stats":{"Line":0}},{"line":508,"address":[4505249,4505328],"length":1,"stats":{"Line":0}},{"line":509,"address":[4505424,4505340],"length":1,"stats":{"Line":0}},{"line":512,"address":[4505466],"length":1,"stats":{"Line":0}},{"line":513,"address":[4505538,4505617,4505643],"length":1,"stats":{"Line":0}},{"line":515,"address":[3672504],"length":1,"stats":{"Line":0}},{"line":516,"address":[4506339,4506428],"length":1,"stats":{"Line":0}},{"line":521,"address":[4506987],"length":1,"stats":{"Line":0}},{"line":522,"address":[4507037],"length":1,"stats":{"Line":0}},{"line":523,"address":[4507087],"length":1,"stats":{"Line":0}},{"line":524,"address":[4507098],"length":1,"stats":{"Line":0}},{"line":525,"address":[4507140],"length":1,"stats":{"Line":0}},{"line":527,"address":[4507253],"length":1,"stats":{"Line":0}},{"line":530,"address":[4673664],"length":1,"stats":{"Line":0}},{"line":534,"address":[4508308,4508194],"length":1,"stats":{"Line":0}},{"line":537,"address":[4508510,4508239,4508339],"length":1,"stats":{"Line":0}},{"line":538,"address":[4508794],"length":1,"stats":{"Line":0}},{"line":540,"address":[4508843],"length":1,"stats":{"Line":0}},{"line":544,"address":[4509086,4509016,4508821],"length":1,"stats":{"Line":0}},{"line":545,"address":[4510579,4509048],"length":1,"stats":{"Line":0}},{"line":548,"address":[4509092],"length":1,"stats":{"Line":0}},{"line":549,"address":[4509268],"length":1,"stats":{"Line":0}},{"line":550,"address":[4510306,4509179],"length":1,"stats":{"Line":0}},{"line":553,"address":[4509398,4509295],"length":1,"stats":{"Line":0}},{"line":554,"address":[4510661,4510640],"length":1,"stats":{"Line":0}},{"line":557,"address":[4509633,4509421,4509482],"length":1,"stats":{"Line":0}},{"line":558,"address":[4509618,4509519],"length":1,"stats":{"Line":0}},{"line":560,"address":[4509542,4509488],"length":1,"stats":{"Line":0}},{"line":563,"address":[4509550],"length":1,"stats":{"Line":0}},{"line":564,"address":[4509568,4509684],"length":1,"stats":{"Line":0}},{"line":565,"address":[4509700,4509753],"length":1,"stats":{"Line":0}},{"line":566,"address":[4509778],"length":1,"stats":{"Line":0}},{"line":570,"address":[4509816],"length":1,"stats":{"Line":0}},{"line":572,"address":[4509856],"length":1,"stats":{"Line":0}},{"line":574,"address":[4509896],"length":1,"stats":{"Line":0}},{"line":577,"address":[4510013],"length":1,"stats":{"Line":0}},{"line":590,"address":[4511428],"length":1,"stats":{"Line":0}},{"line":593,"address":[4511440],"length":1,"stats":{"Line":0}},{"line":594,"address":[4511472],"length":1,"stats":{"Line":0}},{"line":595,"address":[4511504],"length":1,"stats":{"Line":0}},{"line":596,"address":[4511536],"length":1,"stats":{"Line":0}},{"line":604,"address":[4512437],"length":1,"stats":{"Line":0}},{"line":607,"address":[4512449],"length":1,"stats":{"Line":0}},{"line":608,"address":[4512481],"length":1,"stats":{"Line":0}},{"line":616,"address":[4513488],"length":1,"stats":{"Line":0}},{"line":617,"address":[3713165],"length":1,"stats":{"Line":0}},{"line":624,"address":[4514481],"length":1,"stats":{"Line":0}},{"line":625,"address":[3714173],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":221},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","services","mod.rs"],"content":"pub mod session_service;\npub mod session_manager;\npub mod game_manager;\npub mod game_service;\nmod session_manager_integration_test;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","services","session_manager.rs"],"content":"// src/services/session_manager.rs - 100% fonctionnel - TOUTES les fonctions extraites\n\nuse std::collections::HashMap;\nuse std::sync::Arc;\nuse tokio::sync::RwLock;\nuse uuid::Uuid;\nuse crate::generated::takeiteasygame::v1::*;\n\n// ============================================================================\n// TYPES DE DONN√âES IMMUTABLES PURS\n// ============================================================================\n\n#[derive(Debug, Clone)]\npub struct GameSession {\n    pub id: String,\n    pub code: String,\n    pub players: HashMap\u003cString, Player\u003e,\n    pub current_player_id: Option\u003cString\u003e,\n    pub state: i32,\n    pub max_players: i32,\n    pub game_mode: String,\n    pub created_at: std::time::Instant,\n    pub board_state: String,\n    pub turn_number: i32,\n}\n\n#[derive(Debug, Clone)]\npub enum SessionAction {\n    CreateSession { session: GameSession },\n    UpdateSession { session: GameSession },\n    RemoveSession { session_id: String },\n}\n\n#[derive(Debug, Clone)]\npub struct SessionStoreState {\n    pub sessions: HashMap\u003cString, GameSession\u003e,\n    pub sessions_by_code: HashMap\u003cString, String\u003e,\n}\n\nimpl SessionStoreState {\n    pub fn new() -\u003e Self {\n        Self {\n            sessions: HashMap::new(),\n            sessions_by_code: HashMap::new(),\n        }\n    }\n}\n\n// SessionManager - Structure de donn√©es pure (pas de logique)\n#[derive(Clone)]\npub struct SessionManager {\n    store: Arc\u003cRwLock\u003cSessionStoreState\u003e\u003e,\n}\n\n// ============================================================================\n// FONCTIONS DE CONSTRUCTION (FACTORY FUNCTIONS)\n// ============================================================================\n\npub fn new_session_manager() -\u003e SessionManager {\n    SessionManager {\n        store: Arc::new(RwLock::new(SessionStoreState::new())),\n    }\n}\n\npub fn get_store_from_manager(manager: \u0026SessionManager) -\u003e \u0026Arc\u003cRwLock\u003cSessionStoreState\u003e\u003e {\n    \u0026manager.store\n}\n\n// ============================================================================\n// FONCTIONS PURES - MANIPULATION D'√âTAT\n// ============================================================================\n\npub fn apply_session_action(state: SessionStoreState, action: SessionAction) -\u003e SessionStoreState {\n    match action {\n        SessionAction::CreateSession { session } =\u003e {\n            let mut new_state = state;\n            new_state.sessions.insert(session.id.clone(), session.clone());\n            new_state.sessions_by_code.insert(session.code.clone(), session.id.clone());\n            new_state\n        },\n        SessionAction::UpdateSession { session } =\u003e {\n            let mut new_state = state;\n            new_state.sessions.insert(session.id.clone(), session.clone());\n            new_state.sessions_by_code.insert(session.code.clone(), session.id.clone());\n            new_state\n        },\n        SessionAction::RemoveSession { session_id } =\u003e {\n            let mut new_state = state;\n            if let Some(session) = new_state.sessions.remove(\u0026session_id) {\n                new_state.sessions_by_code.remove(\u0026session.code);\n            }\n            new_state\n        }\n    }\n}\n\n// ============================================================================\n// FONCTIONS PURES - REQU√äTES\n// ============================================================================\n\npub fn find_session_by_code\u003c'a\u003e(state: \u0026'a SessionStoreState, code: \u0026str) -\u003e Option\u003c\u0026'a GameSession\u003e {\n    state.sessions_by_code.get(code)\n        .and_then(|session_id| state.sessions.get(session_id))\n}\n\npub fn find_session_by_id\u003c'a\u003e(state: \u0026'a SessionStoreState, session_id: \u0026str) -\u003e Option\u003c\u0026'a GameSession\u003e {\n    state.sessions.get(session_id)\n}\n\npub fn count_sessions(state: \u0026SessionStoreState) -\u003e usize {\n    state.sessions.len()\n}\n\npub fn get_all_session_codes(state: \u0026SessionStoreState) -\u003e Vec\u003cString\u003e {\n    state.sessions_by_code.keys().cloned().collect()\n}\n\n// ============================================================================\n// FONCTIONS PURES - CR√âATION D'OBJETS\n// ============================================================================\n\npub fn create_game_session(max_players: i32, game_mode: String) -\u003e GameSession {\n    GameSession {\n        id: Uuid::new_v4().to_string(),\n        code: generate_session_code(),\n        players: HashMap::new(),\n        current_player_id: None,\n        state: 0, // WAITING\n        max_players,\n        game_mode,\n        created_at: std::time::Instant::now(),\n        board_state: \"{}\".to_string(),\n        turn_number: 0,\n    }\n}\n\npub fn create_session_action(max_players: i32, game_mode: String) -\u003e (SessionAction, String) {\n    let session = create_game_session(max_players, game_mode);\n    let session_code = session.code.clone();\n    (SessionAction::CreateSession { session }, session_code)\n}\n\n// ============================================================================\n// FONCTIONS PURES - TRANSFORMATIONS DE SESSIONS\n// ============================================================================\n\n// src/services/session_manager.rs\n// src/services/session_manager.rs\npub fn add_player_to_session(\n    session: GameSession,\n    player_name: String\n) -\u003e Result\u003c(GameSession, String), String\u003e {\n    if session.players.len() \u003e= session.max_players as usize {\n        return Err(\"SESSION_FULL\".to_string());\n    }\n\n    if session.state != 0 {\n        return Err(\"GAME_IN_PROGRESS\".to_string());\n    }\n\n    let player_id = Uuid::new_v4().to_string();\n\n    // ‚úÖ Le cr√©ateur (premier joueur) est automatiquement pr√™t\n    let is_first_player = session.players.is_empty();\n\n    let player = Player {\n        id: player_id.clone(),\n        name: player_name,\n        score: 0,\n        is_ready: is_first_player, // ‚Üê Automatiquement pr√™t si c'est le cr√©ateur\n        is_connected: true,\n        joined_at: chrono::Utc::now().timestamp(),\n    };\n\n    let mut new_session = session;\n    new_session.players.insert(player_id.clone(), player);\n\n    Ok((new_session, player_id))\n}\n\npub fn set_player_ready_in_session(\n    session: GameSession,\n    player_id: \u0026str,\n    ready: bool\n) -\u003e Result\u003c(GameSession, bool), String\u003e {\n    let mut new_session = session;\n\n    match new_session.players.get_mut(player_id) {\n        Some(player) =\u003e {\n            player.is_ready = ready;\n\n            let game_started = if all_players_ready(\u0026new_session) \u0026\u0026 new_session.players.len() \u003e= 2 {\n                new_session = start_game(new_session);\n                true\n            } else {\n                false\n            };\n\n            Ok((new_session, game_started))\n        },\n        None =\u003e Err(\"PLAYER_NOT_FOUND\".to_string())\n    }\n}\n\npub fn remove_player_from_session(\n    session: GameSession,\n    player_id: \u0026str\n) -\u003e (GameSession, bool) {\n    let mut new_session = session;\n    let was_removed = new_session.players.remove(player_id).is_some();\n\n    // If it was the current player's turn, advance to next player\n    if new_session.current_player_id.as_ref() == Some(\u0026player_id.to_string()) {\n        new_session = advance_turn(new_session);\n    }\n\n    (new_session, was_removed)\n}\n\npub fn advance_turn(session: GameSession) -\u003e GameSession {\n    let mut new_session = session;\n\n    if let Some(current_id) = \u0026new_session.current_player_id {\n        let player_ids: Vec\u003cString\u003e = new_session.players.keys().cloned().collect();\n\n        if let Some(current_index) = player_ids.iter().position(|id| id == current_id) {\n            let next_index = (current_index + 1) % player_ids.len();\n            new_session.current_player_id = Some(player_ids[next_index].clone());\n            new_session.turn_number += 1;\n        }\n    }\n\n    new_session\n}\n\n// ============================================================================\n// FONCTIONS PURES - UTILITAIRES\n// ============================================================================\n\nfn all_players_ready(session: \u0026GameSession) -\u003e bool {\n    !session.players.is_empty() \u0026\u0026\n        session.players.values().all(|p| p.is_ready \u0026\u0026 p.is_connected)\n}\n\nfn start_game(session: GameSession) -\u003e GameSession {\n    let mut new_session = session;\n    new_session.state = 1; // IN_PROGRESS\n\n    // Set first player\n    if let Some(first_player_id) = new_session.players.keys().next() {\n        new_session.current_player_id = Some(first_player_id.clone());\n    }\n\n    new_session.turn_number = 1;\n    new_session.board_state = r#\"{\"tiles\": [], \"available_positions\": []}\"#.to_string();\n\n    new_session\n}\n\npub fn session_to_game_state(session: \u0026GameSession) -\u003e GameState {\n    GameState {\n        session_id: session.id.clone(),\n        players: session.players.values().cloned().collect(),\n        current_player_id: session.current_player_id.clone().unwrap_or_default(),\n        state: session.state,\n        board_state: session.board_state.clone(),\n        turn_number: session.turn_number,\n    }\n}\n\nfn generate_session_code() -\u003e String {\n    use rand::Rng;\n    let mut rng = rand::rng();\n    let chars: Vec\u003cchar\u003e = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\".chars().collect();\n\n    (0..6)\n        .map(|_| chars[rng.random_range(0..chars.len())])\n        .collect()\n}\n\n// ============================================================================\n// FONCTIONS DE STORE - OP√âRATIONS ASYNCHRONES COMPOSABLES\n// ============================================================================\n\npub async fn create_session_in_store\u003cF, T\u003e(\n    store: \u0026Arc\u003cRwLock\u003cSessionStoreState\u003e\u003e,\n    max_players: i32,\n    game_mode: String,\n    continuation: F\n) -\u003e Result\u003cT, String\u003e\nwhere\n    F: FnOnce(String) -\u003e Result\u003cT, String\u003e,\n{\n    let (action, session_code) = create_session_action(max_players, game_mode);\n\n    {\n        let mut state = store.write().await;\n        *state = apply_session_action(state.clone(), action);\n    }\n\n    continuation(session_code)\n}\n\npub async fn get_session_by_code_from_store(\n    store: \u0026Arc\u003cRwLock\u003cSessionStoreState\u003e\u003e,\n    code: \u0026str\n) -\u003e Option\u003cGameSession\u003e {\n    let state = store.read().await;\n    find_session_by_code(\u0026*state, code).cloned()\n}\n\npub async fn get_session_by_id_from_store(\n    store: \u0026Arc\u003cRwLock\u003cSessionStoreState\u003e\u003e,\n    session_id: \u0026str\n) -\u003e Option\u003cGameSession\u003e {\n    let state = store.read().await;\n    find_session_by_id(\u0026*state, session_id).cloned()\n}\n\npub async fn update_session_in_store(\n    store: \u0026Arc\u003cRwLock\u003cSessionStoreState\u003e\u003e,\n    session: GameSession\n) -\u003e Result\u003c(), String\u003e {\n    let action = SessionAction::UpdateSession { session };\n\n    {\n        let mut state = store.write().await;\n        *state = apply_session_action(state.clone(), action);\n    }\n\n    Ok(())\n}\n\npub async fn transform_session_in_store\u003cF, T\u003e(\n    store: \u0026Arc\u003cRwLock\u003cSessionStoreState\u003e\u003e,\n    session_id: \u0026str,\n    transformation: F\n) -\u003e Result\u003cOption\u003cT\u003e, String\u003e\nwhere\n    F: FnOnce(GameSession) -\u003e Result\u003c(GameSession, T), String\u003e,\n{\n    let current_session = get_session_by_id_from_store(store, session_id).await;\n\n    match current_session {\n        Some(session) =\u003e {\n            match transformation(session) {\n                Ok((updated_session, result)) =\u003e {\n                    update_session_in_store(store, updated_session).await?;\n                    Ok(Some(result))\n                },\n                Err(e) =\u003e Err(e)\n            }\n        },\n        None =\u003e Ok(None)\n    }\n}\n\npub async fn query_store\u003cF, T\u003e(\n    store: \u0026Arc\u003cRwLock\u003cSessionStoreState\u003e\u003e,\n    query: F\n) -\u003e T\nwhere\n    F: FnOnce(\u0026SessionStoreState) -\u003e T,\n{\n    let state = store.read().await;\n    query(\u0026*state)\n}\n\n// ============================================================================\n// FONCTIONS DE NIVEAU SUP√âRIEUR - COMPOSITION AVEC SESSIONMANAGER\n// ============================================================================\n\npub async fn create_session_with_manager(\n    manager: \u0026SessionManager,\n    max_players: i32,\n    game_mode: String\n) -\u003e String {\n    create_session_in_store(get_store_from_manager(manager), max_players, game_mode, |code| Ok(code)).await\n        .unwrap_or_else(|_| \"ERROR\".to_string())\n}\n\npub async fn get_session_by_code_with_manager(\n    manager: \u0026SessionManager,\n    code: \u0026str\n) -\u003e Option\u003cGameSession\u003e {\n    get_session_by_code_from_store(get_store_from_manager(manager), code).await\n}\n\npub async fn get_session_by_id_with_manager(\n    manager: \u0026SessionManager,\n    session_id: \u0026str\n) -\u003e Option\u003cGameSession\u003e {\n    get_session_by_id_from_store(get_store_from_manager(manager), session_id).await\n}\n\npub async fn update_session_with_manager(\n    manager: \u0026SessionManager,\n    session: GameSession\n) -\u003e Result\u003c(), String\u003e {\n    update_session_in_store(get_store_from_manager(manager), session).await\n}\n\npub async fn create_session_functional_with_manager(\n    manager: \u0026SessionManager,\n    max_players: i32,\n    game_mode: String\n) -\u003e Result\u003cString, String\u003e {\n    create_session_in_store(get_store_from_manager(manager), max_players, game_mode, |code| Ok(code)).await\n}\n\npub async fn transform_session_with_manager\u003cF\u003e(\n    manager: \u0026SessionManager,\n    session_id: \u0026str,\n    f: F\n) -\u003e Result\u003cOption\u003cGameSession\u003e, String\u003e\nwhere\n    F: FnOnce(GameSession) -\u003e Result\u003cGameSession, String\u003e,\n{\n    transform_session_in_store(get_store_from_manager(manager), session_id, |session| {\n        f(session).map(|updated_session| (updated_session.clone(), updated_session))\n    }).await\n}\n\npub async fn with_session_state_from_manager\u003cF, T\u003e(\n    manager: \u0026SessionManager,\n    f: F\n) -\u003e T\nwhere\n    F: FnOnce(\u0026SessionStoreState) -\u003e T,\n{\n    query_store(get_store_from_manager(manager), f).await\n}\n\n// ============================================================================\n// IMPL√âMENTATION VIDE - SESSIONMANAGER DEVIENT JUSTE UNE STRUCTURE\n// ============================================================================\n\nimpl SessionManager {\n    // Seule fonction dans l'impl - construction\n    pub fn new() -\u003e Self {\n        new_session_manager()\n    }\n\n    // Toutes les autres fonctions sont maintenant externes !\n    // Utilisez les fonctions *_with_manager() √† la place\n}\n\n","traces":[{"line":41,"address":[4148873,4148736,4148867],"length":1,"stats":{"Line":4}},{"line":43,"address":[4148758],"length":1,"stats":{"Line":4}},{"line":44,"address":[4148763],"length":1,"stats":{"Line":4}},{"line":59,"address":[4148896],"length":1,"stats":{"Line":4}},{"line":61,"address":[4148903],"length":1,"stats":{"Line":4}},{"line":65,"address":[4148960],"length":1,"stats":{"Line":4}},{"line":73,"address":[4149925,4148976,4149965],"length":1,"stats":{"Line":4}},{"line":74,"address":[4149003],"length":1,"stats":{"Line":4}},{"line":75,"address":[4149087],"length":1,"stats":{"Line":4}},{"line":76,"address":[4149125],"length":1,"stats":{"Line":4}},{"line":77,"address":[4149931,4149536,4149196],"length":1,"stats":{"Line":8}},{"line":78,"address":[4149672,4149903],"length":1,"stats":{"Line":4}},{"line":79,"address":[4149862],"length":1,"stats":{"Line":4}},{"line":81,"address":[4149223],"length":1,"stats":{"Line":2}},{"line":82,"address":[4149264],"length":1,"stats":{"Line":2}},{"line":83,"address":[4149335,4150018,4150409],"length":1,"stats":{"Line":4}},{"line":84,"address":[4150157,4150387],"length":1,"stats":{"Line":2}},{"line":85,"address":[4150351],"length":1,"stats":{"Line":3}},{"line":87,"address":[4149367],"length":1,"stats":{"Line":0}},{"line":88,"address":[4149391],"length":1,"stats":{"Line":0}},{"line":89,"address":[4150489,4149486],"length":1,"stats":{"Line":0}},{"line":90,"address":[4150572,4150682],"length":1,"stats":{"Line":0}},{"line":92,"address":[4150739],"length":1,"stats":{"Line":0}},{"line":101,"address":[4150816],"length":1,"stats":{"Line":4}},{"line":102,"address":[4150840],"length":1,"stats":{"Line":4}},{"line":103,"address":[3247776,3247790],"length":1,"stats":{"Line":8}},{"line":106,"address":[4150880],"length":1,"stats":{"Line":1}},{"line":107,"address":[4150898],"length":1,"stats":{"Line":1}},{"line":110,"address":[4150912],"length":1,"stats":{"Line":0}},{"line":111,"address":[4150917],"length":1,"stats":{"Line":0}},{"line":114,"address":[4150928],"length":1,"stats":{"Line":0}},{"line":115,"address":[4150946],"length":1,"stats":{"Line":0}},{"line":122,"address":[4151655,4151695,4151008],"length":1,"stats":{"Line":4}},{"line":124,"address":[4151041,4151114],"length":1,"stats":{"Line":8}},{"line":125,"address":[4151140],"length":1,"stats":{"Line":4}},{"line":126,"address":[4151190],"length":1,"stats":{"Line":4}},{"line":131,"address":[4151289],"length":1,"stats":{"Line":4}},{"line":132,"address":[4151370],"length":1,"stats":{"Line":4}},{"line":137,"address":[4151728,4151974],"length":1,"stats":{"Line":4}},{"line":138,"address":[4151757],"length":1,"stats":{"Line":4}},{"line":139,"address":[4151762],"length":1,"stats":{"Line":4}},{"line":140,"address":[4151823],"length":1,"stats":{"Line":4}},{"line":149,"address":[4153044,4152000,4153277],"length":1,"stats":{"Line":3}},{"line":153,"address":[4152035,4152145],"length":1,"stats":{"Line":6}},{"line":154,"address":[4152173,4153170],"length":1,"stats":{"Line":2}},{"line":157,"address":[4152162],"length":1,"stats":{"Line":3}},{"line":158,"address":[4153109,4152223],"length":1,"stats":{"Line":0}},{"line":161,"address":[4152254,4152204],"length":1,"stats":{"Line":6}},{"line":164,"address":[4152283,4152346],"length":1,"stats":{"Line":6}},{"line":167,"address":[4152355],"length":1,"stats":{"Line":3}},{"line":172,"address":[4152415,4152478],"length":1,"stats":{"Line":6}},{"line":175,"address":[4152625],"length":1,"stats":{"Line":3}},{"line":176,"address":[4152737,4152655],"length":1,"stats":{"Line":6}},{"line":178,"address":[4152855],"length":1,"stats":{"Line":3}},{"line":181,"address":[4153964,4153989,4153312],"length":1,"stats":{"Line":1}},{"line":186,"address":[4153371],"length":1,"stats":{"Line":1}},{"line":188,"address":[4153416,4153482],"length":1,"stats":{"Line":2}},{"line":189,"address":[4153525],"length":1,"stats":{"Line":1}},{"line":190,"address":[4153541],"length":1,"stats":{"Line":1}},{"line":192,"address":[4153685,4153552,4153671,4153926],"length":1,"stats":{"Line":3}},{"line":193,"address":[4153718,4153887],"length":1,"stats":{"Line":2}},{"line":194,"address":[4153918],"length":1,"stats":{"Line":1}},{"line":196,"address":[4153677],"length":1,"stats":{"Line":0}},{"line":199,"address":[4153778],"length":1,"stats":{"Line":1}},{"line":201,"address":[4153563],"length":1,"stats":{"Line":0}},{"line":205,"address":[4154000,4154624],"length":1,"stats":{"Line":0}},{"line":209,"address":[4154043],"length":1,"stats":{"Line":0}},{"line":210,"address":[4154088,4154160],"length":1,"stats":{"Line":0}},{"line":213,"address":[4154619,4154236],"length":1,"stats":{"Line":0}},{"line":214,"address":[4154530],"length":1,"stats":{"Line":0}},{"line":217,"address":[4154437],"length":1,"stats":{"Line":0}},{"line":220,"address":[4154656,4155531],"length":1,"stats":{"Line":0}},{"line":221,"address":[4154673],"length":1,"stats":{"Line":0}},{"line":223,"address":[4154688],"length":1,"stats":{"Line":0}},{"line":224,"address":[4154861,4154752],"length":1,"stats":{"Line":0}},{"line":226,"address":[3247822,3247808],"length":1,"stats":{"Line":0}},{"line":227,"address":[4155148,4155260,4155110],"length":1,"stats":{"Line":0}},{"line":228,"address":[4155229,4155283],"length":1,"stats":{"Line":0}},{"line":229,"address":[4155510,4155476],"length":1,"stats":{"Line":0}},{"line":233,"address":[4154780],"length":1,"stats":{"Line":0}},{"line":240,"address":[4155552],"length":1,"stats":{"Line":1}},{"line":241,"address":[4155566,4155622],"length":1,"stats":{"Line":1}},{"line":242,"address":[3247856,3247871],"length":1,"stats":{"Line":3}},{"line":245,"address":[4155648,4156221],"length":1,"stats":{"Line":1}},{"line":246,"address":[4155682],"length":1,"stats":{"Line":1}},{"line":247,"address":[4155684],"length":1,"stats":{"Line":1}},{"line":250,"address":[4155695,4156062,4155763],"length":1,"stats":{"Line":3}},{"line":251,"address":[4155897,4155833],"length":1,"stats":{"Line":2}},{"line":254,"address":[4155852],"length":1,"stats":{"Line":1}},{"line":255,"address":[4156067,4155863],"length":1,"stats":{"Line":2}},{"line":257,"address":[4156193],"length":1,"stats":{"Line":1}},{"line":260,"address":[4156717,4156723,4156240],"length":1,"stats":{"Line":0}},{"line":262,"address":[4156270],"length":1,"stats":{"Line":0}},{"line":263,"address":[4156289,4156365],"length":1,"stats":{"Line":0}},{"line":264,"address":[4156467,4156394],"length":1,"stats":{"Line":0}},{"line":265,"address":[4156479],"length":1,"stats":{"Line":0}},{"line":266,"address":[4156489],"length":1,"stats":{"Line":0}},{"line":267,"address":[4156572],"length":1,"stats":{"Line":0}},{"line":271,"address":[4156969,4156963,4156736],"length":1,"stats":{"Line":4}},{"line":273,"address":[4156749],"length":1,"stats":{"Line":4}},{"line":274,"address":[4156842,4156763],"length":1,"stats":{"Line":8}},{"line":276,"address":[4156871,4156919],"length":1,"stats":{"Line":8}},{"line":277,"address":[3247933,3247920],"length":1,"stats":{"Line":8}},{"line":285,"address":[3248016,3248080],"length":1,"stats":{"Line":4}},{"line":294,"address":[3248360,3248452,3249960,3250052],"length":1,"stats":{"Line":8}},{"line":297,"address":[3727201,3725089],"length":1,"stats":{"Line":8}},{"line":298,"address":[3250567,3250555,3248955,3248967,3249568,3250784,3251168,3249184,3249126,3250726],"length":1,"stats":{"Line":4}},{"line":301,"address":[3249341,3250941],"length":1,"stats":{"Line":4}},{"line":304,"address":[4156992],"length":1,"stats":{"Line":4}},{"line":308,"address":[3251469,3251508,3251676,3251578],"length":1,"stats":{"Line":8}},{"line":309,"address":[3251910,3251964],"length":1,"stats":{"Line":8}},{"line":312,"address":[4157040],"length":1,"stats":{"Line":1}},{"line":316,"address":[3252205,3252314,3252244,3252412],"length":1,"stats":{"Line":2}},{"line":317,"address":[3252700,3252646],"length":1,"stats":{"Line":2}},{"line":320,"address":[4157088],"length":1,"stats":{"Line":2}},{"line":324,"address":[3253003],"length":1,"stats":{"Line":2}},{"line":327,"address":[3680157],"length":1,"stats":{"Line":4}},{"line":328,"address":[3253509,3253521,3253989,3253738,3253682],"length":1,"stats":{"Line":2}},{"line":331,"address":[3253904],"length":1,"stats":{"Line":3}},{"line":334,"address":[3254304,3254096,3254144,3254192,3254368,3254240],"length":1,"stats":{"Line":5}},{"line":342,"address":[3750977,3752817,3751665,3720753,3737729,3750145],"length":1,"stats":{"Line":10}},{"line":344,"address":[3261129,3263083,3265133,3255121,3259083,3257067],"length":1,"stats":{"Line":5}},{"line":345,"address":[3261174,3255166,3257108,3259124,3265178,3263124],"length":1,"stats":{"Line":4}},{"line":346,"address":[3265242,3257172,3259188,3255378,3257299,3259315,3255230,3261403,3263188,3261238,3263315,3265394],"length":1,"stats":{"Line":8}},{"line":347,"address":[3255528,3261553,3263483,3265562,3259483,3257467],"length":1,"stats":{"Line":4}},{"line":348,"address":[3265656,3261620,3258659,3263577,3255595,3260705,3256643,3261690,3262659,3254697,3264706,3265746,3257776,3263667,3257651,3255665,3263792,3257561,3255791,3265872,3259792,3259577,3261815,3259667],"length":1,"stats":{"Line":8}},{"line":349,"address":[3260132,3256132,3262155,3264132,3266216,3258116],"length":1,"stats":{"Line":4}},{"line":351,"address":[3261447,3263359,3257343,3259359,3265438,3255422],"length":1,"stats":{"Line":0}},{"line":354,"address":[3263245,3265324,3259245,3257229,3255312,3261337],"length":1,"stats":{"Line":1}},{"line":365,"address":[],"length":0,"stats":{"Line":0}},{"line":366,"address":[],"length":0,"stats":{"Line":0}},{"line":373,"address":[4157168],"length":1,"stats":{"Line":4}},{"line":378,"address":[3682561],"length":1,"stats":{"Line":16}},{"line":379,"address":[3267344,3267360],"length":1,"stats":{"Line":0}},{"line":382,"address":[4157232],"length":1,"stats":{"Line":4}},{"line":386,"address":[3267599,3267718,3267816,3267638],"length":1,"stats":{"Line":8}},{"line":389,"address":[4157280],"length":1,"stats":{"Line":1}},{"line":393,"address":[3268262,3268342,3268440,3268223],"length":1,"stats":{"Line":2}},{"line":396,"address":[4157328],"length":1,"stats":{"Line":2}},{"line":400,"address":[3682717],"length":1,"stats":{"Line":4}},{"line":403,"address":[4157408],"length":1,"stats":{"Line":0}},{"line":408,"address":[3689201],"length":1,"stats":{"Line":0}},{"line":411,"address":[3270336,3270288,3270384,3270432],"length":1,"stats":{"Line":4}},{"line":419,"address":[3272049,3271751,3270673,3271063,3272755,3272872,3270782,3270829,3272439,3273408,3272919,3273167,3272158,3272205,3271517,3273568,3273488,3273296,3271361,3271470],"length":1,"stats":{"Line":19}},{"line":420,"address":[3273824,3273851,3273337,3274000,3274176,3273424,3273584,3273648,3274203,3274027,3273675,3273504],"length":1,"stats":{"Line":9}},{"line":421,"address":[3272441,3270822,3271510,3272943,3273169,3270891,3273559,3270849,3272267,3273639,3273398,3271400,3272990,3271753,3273479,3272794,3271579,3272225,3272912,3271065,3271537,3272198,3270712,3272088],"length":1,"stats":{"Line":15}},{"line":431,"address":[],"length":0,"stats":{"Line":0}},{"line":440,"address":[4157472],"length":1,"stats":{"Line":0}},{"line":441,"address":[4157473],"length":1,"stats":{"Line":0}}],"covered":106,"coverable":149},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","services","session_manager_integration_test.rs"],"content":"// tests/session_manager_integration_test.rs\n// Premier test d'int√©gration pour session_manager\n\nuse std::sync::Arc;\nuse crate::services::session_manager::*;\nuse crate::generated::takeiteasygame::v1::Player;\n\n#[cfg(test)]\nmod session_manager_basic_integration {\n    use super::*;\n\n    #[tokio::test]\n    async fn test_complete_session_workflow() {\n        // üèóÔ∏è √âTAPE 1: Cr√©er le manager\n        let manager = new_session_manager();\n\n        // üèóÔ∏è √âTAPE 2: Cr√©er une session\n        let session_code = create_session_with_manager(\u0026manager, 4, \"classic\".to_string()).await;\n\n        // ‚úÖ V√©rifier que la session existe\n        assert!(!session_code.is_empty());\n        assert_ne!(session_code, \"ERROR\");\n\n        // üèóÔ∏è √âTAPE 3: R√©cup√©rer la session cr√©√©e\n        let session = get_session_by_code_with_manager(\u0026manager, \u0026session_code).await;\n        assert!(session.is_some());\n\n        let mut session = session.unwrap();\n        let session_id = session.id.clone();\n\n        // ‚úÖ V√©rifier les propri√©t√©s initiales\n        assert_eq!(session.code, session_code);\n        assert_eq!(session.max_players, 4);\n        assert_eq!(session.game_mode, \"classic\");\n        assert_eq!(session.players.len(), 0);\n        assert_eq!(session.state, 0); // WAITING\n\n        // üèóÔ∏è √âTAPE 4: Ajouter le premier joueur (Alice)\n        let result = add_player_to_session(session.clone(), \"Alice\".to_string());\n        assert!(result.is_ok());\n\n        let (session_with_alice, alice_id) = result.unwrap();\n\n        // ‚úÖ V√©rifier Alice\n        assert_eq!(session_with_alice.players.len(), 1);\n        assert!(session_with_alice.players.contains_key(\u0026alice_id));\n\n        let alice = \u0026session_with_alice.players[\u0026alice_id];\n        assert_eq!(alice.name, \"Alice\");\n        assert!(alice.is_ready); // Premier joueur auto-ready\n        assert!(alice.is_connected);\n\n        // üèóÔ∏è √âTAPE 5: Sauvegarder la session mise √† jour\n        let update_result = update_session_with_manager(\u0026manager, session_with_alice.clone()).await;\n        assert!(update_result.is_ok());\n\n        // üèóÔ∏è √âTAPE 6: Ajouter un second joueur (Bob)\n        let transform_result = transform_session_with_manager(\u0026manager, \u0026session_id, |session| {\n            add_player_to_session(session, \"Bob\".to_string())\n                .map(|(updated_session, _player_id)| updated_session)\n        }).await;\n\n        assert!(transform_result.is_ok());\n        assert!(transform_result.unwrap().is_some());\n\n        // üèóÔ∏è √âTAPE 7: R√©cup√©rer l'√©tat final et v√©rifier\n        let final_session = get_session_by_id_with_manager(\u0026manager, \u0026session_id).await;\n        assert!(final_session.is_some());\n\n        let final_session = final_session.unwrap();\n        assert_eq!(final_session.players.len(), 2);\n\n        // ‚úÖ V√©rifier que les deux joueurs sont pr√©sents\n        let alice_exists = final_session.players.values().any(|p| p.name == \"Alice\" \u0026\u0026 p.is_ready);\n        let bob_exists = final_session.players.values().any(|p| p.name == \"Bob\" \u0026\u0026 !p.is_ready);\n\n        assert!(alice_exists, \"Alice should exist and be ready\");\n        assert!(bob_exists, \"Bob should exist and not be ready initially\");\n\n        println!(\"‚úÖ Session workflow test completed successfully!\");\n    }\n\n    #[tokio::test]\n    async fn test_player_ready_triggers_game_start() {\n        // üèóÔ∏è Setup: Cr√©er session avec 2 joueurs\n        let manager = new_session_manager();\n        let session_code = create_session_with_manager(\u0026manager, 4, \"classic\".to_string()).await;\n        let session = get_session_by_code_with_manager(\u0026manager, \u0026session_code).await.unwrap();\n        let session_id = session.id.clone();\n\n        // Ajouter Alice (auto-ready)\n        let (session_with_alice, alice_id) = add_player_to_session(session, \"Alice\".to_string()).unwrap();\n        update_session_with_manager(\u0026manager, session_with_alice).await.unwrap();\n\n        // Ajouter Bob\n        let _transform_result = transform_session_with_manager(\u0026manager, \u0026session_id, |session| {\n            add_player_to_session(session, \"Bob\".to_string())\n                .map(|(updated_session, _player_id)| updated_session)\n        }).await.unwrap().unwrap();\n\n        // R√©cup√©rer l'ID de Bob depuis la session mise √† jour\n        let session_with_bob = get_session_by_id_with_manager(\u0026manager, \u0026session_id).await.unwrap();\n        let bob_id = session_with_bob.players.values()\n            .find(|p| p.name == \"Bob\")\n            .unwrap()\n            .id.clone();\n\n        // üèóÔ∏è √âTAPE CRITIQUE: Bob se met ready\n        let store = get_store_from_manager(\u0026manager);\n        let ready_result = transform_session_in_store(store, \u0026session_id, |session| {\n            set_player_ready_in_session(session, \u0026bob_id, true)\n        }).await;\n\n        assert!(ready_result.is_ok());\n        let session_result = ready_result.unwrap();\n        assert!(session_result.is_some());\n        let game_started = session_result.unwrap();\n\n        // ‚úÖ V√âRIFICATION: Le jeu doit avoir d√©marr√©\n        assert!(game_started, \"Game should start when both players are ready\");\n\n        // V√©rifier l'√©tat final de la session\n        let final_session = get_session_by_id_with_manager(\u0026manager, \u0026session_id).await.unwrap();\n        assert_eq!(final_session.state, 1); // IN_PROGRESS\n        assert!(final_session.current_player_id.is_some());\n        assert_eq!(final_session.turn_number, 1);\n\n        println!(\"‚úÖ Game start trigger test completed successfully!\");\n    }\n\n    #[tokio::test]\n    async fn test_session_not_found_scenarios() {\n        let manager = new_session_manager();\n\n        // Test avec un ID inexistant\n        let result = get_session_by_id_with_manager(\u0026manager, \"inexistant_id\").await;\n        assert!(result.is_none());\n\n        // Test avec un code inexistant\n        let result = get_session_by_code_with_manager(\u0026manager, \"NOCODE\").await;\n        assert!(result.is_none());\n\n        // Test de transformation sur session inexistante\n        let transform_result = transform_session_with_manager(\u0026manager, \"fake_id\", |session| {\n            Ok(session) // Cette fonction ne devrait jamais √™tre appel√©e\n        }).await;\n\n        assert!(transform_result.is_ok());\n        assert!(transform_result.unwrap().is_none()); // None car session n'existe pas\n\n        println!(\"‚úÖ Session not found scenarios test completed!\");\n    }\n\n    #[tokio::test]\n    async fn test_session_full_error() {\n        let manager = new_session_manager();\n\n        // Cr√©er une session avec limite de 2 joueurs\n        let session_code = create_session_with_manager(\u0026manager, 2, \"classic\".to_string()).await;\n        let session = get_session_by_code_with_manager(\u0026manager, \u0026session_code).await.unwrap();\n\n        // Ajouter 2 joueurs (limite atteinte)\n        let (session1, _) = add_player_to_session(session, \"Alice\".to_string()).unwrap();\n        let (session2, _) = add_player_to_session(session1, \"Bob\".to_string()).unwrap();\n\n        // Essayer d'ajouter un 3√®me joueur\n        let result = add_player_to_session(session2, \"Charlie\".to_string());\n\n        // ‚úÖ Doit √©chouer avec SESSION_FULL\n        assert!(result.is_err());\n        assert_eq!(result.unwrap_err(), \"SESSION_FULL\");\n\n        println!(\"‚úÖ Session full error test completed!\");\n    }\n\n    #[tokio::test]\n    async fn test_concurrent_operations() {\n        let manager = Arc::new(new_session_manager());\n        let session_code = create_session_with_manager(\u0026manager, 10, \"test\".to_string()).await;\n        let session = get_session_by_code_with_manager(\u0026manager, \u0026session_code).await.unwrap();\n        let session_id = session.id.clone();\n\n        // Lancer 5 op√©rations concurrentes d'ajout de joueurs\n        let mut handles = vec![];\n\n        for i in 0..5 {\n            let manager_clone = manager.clone();\n            let session_id_clone = session_id.clone();\n\n            let handle = tokio::spawn(async move {\n                transform_session_with_manager(\u0026manager_clone, \u0026session_id_clone, |session| {\n                    add_player_to_session(session, format!(\"Player{}\", i))\n                        .map(|(updated_session, _)| updated_session)\n                }).await\n            });\n\n            handles.push(handle);\n        }\n\n        // Attendre que toutes les op√©rations se terminent\n        let results = futures::future::join_all(handles).await;\n\n        // V√©rifier que toutes ont r√©ussi\n        for (i, result) in results.iter().enumerate() {\n            assert!(result.is_ok(), \"Task {} failed\", i);\n            assert!(result.as_ref().unwrap().is_ok(), \"Transform {} failed\", i);\n        }\n\n        // V√©rifier l'√©tat final\n        let final_session = get_session_by_id_with_manager(\u0026manager, \u0026session_id).await.unwrap();\n        assert_eq!(final_session.players.len(), 5);\n\n        println!(\"‚úÖ Concurrent operations test completed! Added {} players\", final_session.players.len());\n    }\n}\n\n// ============================================================================\n// HELPER POUR LANCER CE TEST\n// ============================================================================\n\n#[cfg(test)]\nmod test_runner {\n    use super::*;\n\n    #[tokio::test]\n    async fn run_session_manager_integration_tests() {\n        println!(\"üöÄ Running Session Manager Integration Tests\");\n        println!(\"===========================================\");\n\n        // Ce test sert de point d'entr√©e document√©\n        // Les vrais tests sont dans le module session_manager_basic_integration\n\n        // Test simple pour v√©rifier que l'infrastructure fonctionne\n        let manager = new_session_manager();\n        let session_code = create_session_with_manager(\u0026manager, 4, \"test\".to_string()).await;\n        assert!(!session_code.is_empty());\n\n        println!(\"‚úÖ Session Manager integration tests infrastructure OK!\");\n    }\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","services","session_service.rs"],"content":"// src/services/session_service.rs - Version avec debugging am√©lior√©\n\nuse tonic::{Request, Response, Status};\nuse std::sync::Arc;\nuse crate::generated::takeiteasygame::v1::{\n    GetSessionStateRequest,\n    GetSessionStateResponse,\n    SessionState as ProtoSessionState\n};\n// Import des types g√©n√©r√©s par tonic\nuse crate::generated::takeiteasygame::v1::*;\nuse crate::generated::takeiteasygame::v1::session_service_server::SessionService;\n\nuse crate::services::session_manager::{SessionManager, new_session_manager, get_store_from_manager, add_player_to_session, set_player_ready_in_session, session_to_game_state, transform_session_in_store, get_session_by_code_with_manager, update_session_with_manager, create_session_functional_with_manager, get_session_by_id_with_manager};\n\n#[derive(Clone)]\npub struct SessionServiceImpl {\n    session_manager: Arc\u003cSessionManager\u003e,\n}\n\nimpl SessionServiceImpl {\n    pub fn new() -\u003e Self {\n        Self {\n            session_manager: Arc::new(new_session_manager()), // Fonction extraite !\n        }\n    }\n    pub fn new_with_manager(session_manager: Arc\u003cSessionManager\u003e) -\u003e Self {\n        Self {\n            session_manager,\n        }\n    }\n    \n}\n\n// ============================================================================\n// FONCTIONS PURES - CR√âATION DE R√âPONSES (inchang√©es)\n// ============================================================================\n\nfn create_success_response(\n    session_code: String,\n    session_id: String,\n    player_id: String,\n    player: Player\n) -\u003e CreateSessionResponse {\n    CreateSessionResponse {\n        result: Some(create_session_response::Result::Success(\n            CreateSessionSuccess {\n                session_code,\n                session_id,\n                player_id,\n                player: Some(player),\n            }\n        )),\n    }\n}\n\nfn create_error_response(code: String, message: String) -\u003e CreateSessionResponse {\n    CreateSessionResponse {\n        result: Some(create_session_response::Result::Error(Error {\n            code,\n            message,\n            details: std::collections::HashMap::new(),\n        })),\n    }\n}\n\nfn join_success_response(\n    session_id: String,\n    player_id: String,\n    game_state: GameState\n) -\u003e JoinSessionResponse {\n    JoinSessionResponse {\n        result: Some(join_session_response::Result::Success(\n            JoinSessionSuccess {\n                session_id,\n                player_id,\n                game_state: Some(game_state),\n            }\n        )),\n    }\n}\n\nfn join_error_response(code: String, message: String) -\u003e JoinSessionResponse {\n    JoinSessionResponse {\n        result: Some(join_session_response::Result::Error(Error {\n            code,\n            message,\n            details: std::collections::HashMap::new(),\n        })),\n    }\n}\n\nfn set_ready_success_response(game_started: bool) -\u003e SetReadyResponse {\n    SetReadyResponse {\n        success: true,\n        error: None,\n        game_started,\n    }\n}\n\nfn set_ready_error_response(code: String, message: String) -\u003e SetReadyResponse {\n    SetReadyResponse {\n        success: false,\n        error: Some(Error {\n            code,\n            message,\n            details: std::collections::HashMap::new(),\n        }),\n        game_started: false,\n    }\n}\n\n// ============================================================================\n// FONCTIONS COMPOSABLES - LOGIQUE M√âTIER AVEC DEBUG AM√âLIOR√â\n// ============================================================================\n\n// session_service.rs - dans create_session_logic_with_manager\nasync fn create_session_logic_with_manager(\n    manager: \u0026SessionManager,\n    player_name: String,\n    max_players: i32,\n    game_mode: String\n) -\u003e Result\u003cResponse\u003cCreateSessionResponse\u003e, Status\u003e {\n    match create_session_functional_with_manager(manager, max_players, game_mode).await {\n        Ok(session_code) =\u003e {\n            if let Some(mut session) = get_session_by_code_with_manager(manager, \u0026session_code).await {\n                // Ajouter le joueur humain\n                match add_player_to_session(session.clone(), player_name.clone()) {\n                    Ok((mut updated_session, player_id)) =\u003e {\n\n                        // ü§ñ AJOUTER AUTOMATIQUEMENT MCTS √Ä CHAQUE SESSION\n                        let mcts_player = Player {\n                            id: \"mcts_ai\".to_string(),\n                            name: \"ü§ñ MCTS IA\".to_string(),\n                            score: 0,\n                            is_ready: true,  // MCTS toujours pr√™t\n                            is_connected: true,\n                            joined_at: chrono::Utc::now().timestamp(),\n                        };\n\n                        updated_session.players.insert(\"mcts_ai\".to_string(), mcts_player);\n                        let player = updated_session.players.get(\u0026player_id).cloned()\n                            .ok_or_else(|| Status::internal(\"Player not found after creation\"))?;\n\n                        let session_id = updated_session.id.clone();\n\n                        // Sauvegarder avec MCTS\n                        update_session_with_manager(manager, updated_session).await\n                            .map_err(|e| Status::internal(e))?;\n\n                        let response = create_success_response(session_code, session_id, player_id, player);\n                        Ok(Response::new(response))\n                    },\n                    Err(e) =\u003e {\n                        log::error!(\"‚ùå √âchec ajout joueur: {}\", e);\n                        let response = create_error_response(e, \"Failed to add player to session\".to_string());\n                        Ok(Response::new(response))\n                    }\n                }\n            } else {\n                log::error!(\"‚ùå Session introuvable apr√®s cr√©ation: {}\", session_code);\n                Err(Status::internal(\"Failed to retrieve created session\"))\n            }\n        },\n        Err(e) =\u003e {\n            log::error!(\"‚ùå √âchec cr√©ation session: {}\", e);\n            let response = create_error_response(\n                \"CREATION_FAILED\".to_string(),\n                \"Failed to create session\".to_string()\n            );\n            Ok(Response::new(response))\n        }\n    }\n}\n\n// session_service.rs - dans join_session_logic\nasync fn join_session_logic(\n    manager: \u0026SessionManager,\n    session_code: String,\n    player_name: String\n) -\u003e Result\u003cResponse\u003cJoinSessionResponse\u003e, Status\u003e {\n    let session = match get_session_by_code_with_manager(manager, \u0026session_code).await {\n        Some(session) =\u003e {            session\n        },\n        None =\u003e {\n            log::error!(\"‚ùå Session introuvable avec code: {}\", session_code);\n            return Ok(Response::new(join_error_response(\n                \"SESSION_NOT_FOUND\".to_string(),\n                format!(\"Session with code {} not found\", session_code)\n            )));\n        }\n    };\n\n    // üîß NOUVEAU: Gestion sp√©ciale pour les viewers\n    if player_name.contains(\"Viewer\") || player_name.contains(\"Observer\") {\n        // Cr√©er un joueur viewer (read-only)\n        let viewer_id = format!(\"viewer_{}\", uuid::Uuid::new_v4().to_string()[0..8].to_string());\n        let viewer_player = Player {\n            id: viewer_id.clone(),\n            name: player_name.clone(),\n            score: 0,\n            is_ready: true,  // Toujours pr√™t (n'affecte pas le jeu)\n            is_connected: true,\n            joined_at: chrono::Utc::now().timestamp(),\n        };\n\n        // üîß NE PAS ajouter le viewer √† la session (juste retourner l'√©tat)\n        let session_id = session.id.clone();\n        let game_state = session_to_game_state(\u0026session);\n        let response = join_success_response(session_id, viewer_id, game_state);\n        return Ok(Response::new(response));\n    }\n\n    match add_player_to_session(session, player_name.clone()) {\n        Ok((mut updated_session, player_id)) =\u003e {\n\n            // ü§ñ V√âRIFIER SI MCTS EST D√âJ√Ä PR√âSENT, SINON L'AJOUTER\n            if !updated_session.players.contains_key(\"mcts_ai\") {\n                let mcts_player = Player {\n                    id: \"mcts_ai\".to_string(),\n                    name: \"ü§ñ MCTS IA\".to_string(),\n                    score: 0,\n                    is_ready: true,\n                    is_connected: true,\n                    joined_at: chrono::Utc::now().timestamp(),\n                };\n\n                updated_session.players.insert(\"mcts_ai\".to_string(), mcts_player);            } else {            }\n\n            let session_id = updated_session.id.clone();\n            let game_state = session_to_game_state(\u0026updated_session);\n            update_session_with_manager(manager, updated_session).await\n                .map_err(|e| Status::internal(e))?;\n\n            let response = join_success_response(session_id, player_id, game_state);\n            Ok(Response::new(response))\n        },\n        Err(e) =\u003e {\n            log::error!(\"‚ùå √âchec join session: {}\", e);\n            let response = join_error_response(e, \"Failed to join session\".to_string());\n            Ok(Response::new(response))\n        }\n    }\n}\n\n// üîß FONCTION SET_READY AVEC DEBUG ULTRA-D√âTAILL√â\nasync fn set_ready_logic(\n    manager: \u0026SessionManager,\n    session_id: String,\n    player_id: String,\n    ready: bool\n) -\u003e Result\u003cResponse\u003cSetReadyResponse\u003e, Status\u003e {\n    // üîç √âtape 1: V√©rifier l'existence de la session AVANT transform\n    match get_session_by_id_with_manager(manager, \u0026session_id).await {\n        Some(session) =\u003e {\n            // V√©rifier si le joueur existe\n            if let Some(player) = session.players.get(\u0026player_id) {            } else {\n                log::error!(\"‚ùå Joueur {} introuvable dans session {}\", player_id, session_id);\n                return Ok(Response::new(set_ready_error_response(\n                    \"PLAYER_NOT_FOUND\".to_string(),\n                    format!(\"Player {} not found in session {}\", player_id, session_id)\n                )));\n            }\n        },\n        None =\u003e {\n            log::error!(\"‚ùå Session {} introuvable lors de SET_READY\", session_id);\n\n            // üîç Debug: Lister toutes les sessions existantes\n            let store = get_store_from_manager(manager);\n            let state = store.read().await;\n            log::error!(\"üîç Sessions existantes ({} total):\", state.sessions.len());\n            for (sid, session) in \u0026state.sessions {\n                log::error!(\"  - id={}, code={}, players={}\", sid, session.code, session.players.len());\n            }\n            drop(state);\n\n            return Ok(Response::new(set_ready_error_response(\n                \"SESSION_NOT_FOUND\".to_string(),\n                format!(\"Session {} not found\", session_id)\n            )));\n        }\n    }\n\n    // üîß √âtape 2: Continuer avec la logique normale\n    let store = get_store_from_manager(manager);\n\n    // Utilisation directe de transform_session_in_store pour r√©cup√©rer game_started\n    let result = transform_session_in_store(store, \u0026session_id, |session| {        set_player_ready_in_session(session, \u0026player_id, ready)\n    }).await;\n\n    match result {\n        Ok(Some(game_started)) =\u003e {            Ok(Response::new(set_ready_success_response(game_started)))\n        },\n        Ok(None) =\u003e {\n            log::error!(\"‚ùå Session {} disparue pendant transform\", session_id);\n            Ok(Response::new(set_ready_error_response(\n                \"SESSION_NOT_FOUND\".to_string(),\n                \"Session not found during update\".to_string()\n            )))\n        },\n        Err(error_code) =\u003e {\n            log::error!(\"‚ùå Erreur pendant SET_READY: {}\", error_code);\n            Ok(Response::new(set_ready_error_response(\n                error_code,\n                \"Failed to set ready status\".to_string()\n            )))\n        }\n    }\n}\n\n// ============================================================================\n// IMPL√âMENTATION GRPC - TRAIT G√âN√âR√â PAR TONIC (inchang√©)\n// ============================================================================\n\n#[tonic::async_trait]\nimpl SessionService for SessionServiceImpl {\n    async fn create_session(\n        \u0026self,\n        request: Request\u003cCreateSessionRequest\u003e,\n    ) -\u003e Result\u003cResponse\u003cCreateSessionResponse\u003e, Status\u003e {\n        let req = request.into_inner();\n        create_session_logic_with_manager(\n            \u0026self.session_manager,\n            req.player_name,\n            req.max_players,\n            req.game_mode\n        ).await\n    }\n\n    async fn join_session(\n        \u0026self,\n        request: Request\u003cJoinSessionRequest\u003e,\n    ) -\u003e Result\u003cResponse\u003cJoinSessionResponse\u003e, Status\u003e {\n        let req = request.into_inner();\n        join_session_logic(\n            \u0026self.session_manager,\n            req.session_code,\n            req.player_name\n        ).await\n    }\n\n    async fn set_ready(\n        \u0026self,\n        request: Request\u003cSetReadyRequest\u003e,\n    ) -\u003e Result\u003cResponse\u003cSetReadyResponse\u003e, Status\u003e {\n        let req = request.into_inner();\n        set_ready_logic(\n            \u0026self.session_manager,\n            req.session_id,\n            req.player_id,\n            req.ready\n        ).await\n    }\n\n    // üîç GET_SESSION_STATE AVEC DEBUG AM√âLIOR√â\n    async fn get_session_state(\n        \u0026self,\n        request: Request\u003cGetSessionStateRequest\u003e,\n    ) -\u003e Result\u003cResponse\u003cGetSessionStateResponse\u003e, Status\u003e {\n        let req = request.into_inner();\n        // Utiliser votre fonction fonctionnelle get_session_by_id_with_manager\n        match get_session_by_id_with_manager(\u0026self.session_manager, \u0026req.session_id).await {\n            Some(session) =\u003e {\n                // Convertir votre GameSession en GameState proto\n                let proto_players: Vec\u003ccrate::generated::takeiteasygame::v1::Player\u003e =\n                    session.players.values().map(|p| {\n                        crate::generated::takeiteasygame::v1::Player {\n                            id: p.id.clone(),\n                            name: p.name.clone(),\n                            score: p.score,\n                            is_ready: p.is_ready,\n                            is_connected: p.is_connected,\n                            joined_at: p.joined_at,\n                        }\n                    }).collect();\n\n                let game_state = crate::generated::takeiteasygame::v1::GameState {\n                    session_id: session.id.clone(),\n                    players: proto_players,\n                    current_player_id: session.current_player_id.clone().unwrap_or_default(),\n                    state: match session.state {\n                        0 =\u003e ProtoSessionState::Waiting as i32,\n                        1 =\u003e ProtoSessionState::InProgress as i32,\n                        2 =\u003e ProtoSessionState::Finished as i32,\n                        _ =\u003e ProtoSessionState::Waiting as i32,\n                    },\n                    board_state: session.board_state.clone(),\n                    turn_number: session.turn_number,\n                };\n\n                Ok(Response::new(GetSessionStateResponse {\n                    game_state: Some(game_state),\n                    error: None,\n                }))\n            }\n            None =\u003e {\n                log::error!(\"‚ùå GET_SESSION_STATE: Session {} introuvable\", req.session_id);\n\n                // üîç Debug: Lister toutes les sessions existantes\n                let store = get_store_from_manager(\u0026self.session_manager);\n                let state = store.read().await;\n                log::error!(\"üîç Sessions existantes ({} total):\", state.sessions.len());\n                for (sid, session) in \u0026state.sessions {\n                    log::error!(\"  - id={}, code={}\", sid, session.code);\n                }\n                drop(state);\n\n                // Session non trouv√©e\n                Ok(Response::new(GetSessionStateResponse {\n                    game_state: None,\n                    error: Some(crate::generated::takeiteasygame::v1::Error {\n                        code: \"SESSION_NOT_FOUND\".to_string(),\n                        message: format!(\"Session {} not found\", req.session_id),\n                        details: std::collections::HashMap::new(),\n                    }),\n                }))\n            }\n        }\n    }\n}","traces":[{"line":22,"address":[4304496],"length":1,"stats":{"Line":0}},{"line":24,"address":[4304497],"length":1,"stats":{"Line":0}},{"line":27,"address":[4304512],"length":1,"stats":{"Line":0}},{"line":39,"address":[4304528],"length":1,"stats":{"Line":0}},{"line":46,"address":[4304739],"length":1,"stats":{"Line":0}},{"line":57,"address":[4304832,4305211,4305186],"length":1,"stats":{"Line":0}},{"line":59,"address":[4304957],"length":1,"stats":{"Line":0}},{"line":67,"address":[4305232],"length":1,"stats":{"Line":0}},{"line":73,"address":[4305398],"length":1,"stats":{"Line":0}},{"line":83,"address":[4305842,4305488,4305867],"length":1,"stats":{"Line":0}},{"line":85,"address":[4305613],"length":1,"stats":{"Line":0}},{"line":93,"address":[4305888],"length":1,"stats":{"Line":0}},{"line":101,"address":[4306306,4306000,4306331],"length":1,"stats":{"Line":0}},{"line":104,"address":[4306125],"length":1,"stats":{"Line":0}},{"line":118,"address":[4306352],"length":1,"stats":{"Line":0}},{"line":124,"address":[3686492],"length":1,"stats":{"Line":0}},{"line":125,"address":[4164479],"length":1,"stats":{"Line":0}},{"line":126,"address":[4165432,4164663,4163949,4164521],"length":1,"stats":{"Line":0}},{"line":128,"address":[4168396,4165892,4165817,4165966],"length":1,"stats":{"Line":0}},{"line":129,"address":[4166193],"length":1,"stats":{"Line":0}},{"line":133,"address":[4166298],"length":1,"stats":{"Line":0}},{"line":134,"address":[4166392],"length":1,"stats":{"Line":0}},{"line":138,"address":[4166464,4166527],"length":1,"stats":{"Line":0}},{"line":141,"address":[4166670,4166773],"length":1,"stats":{"Line":0}},{"line":142,"address":[4166898,4166990,4167111,4167622],"length":1,"stats":{"Line":0}},{"line":143,"address":[4170544,4170556,4167104],"length":1,"stats":{"Line":0}},{"line":145,"address":[4167382,4167283],"length":1,"stats":{"Line":0}},{"line":148,"address":[3686534],"length":1,"stats":{"Line":0}},{"line":149,"address":[4170592,4169210,4170604],"length":1,"stats":{"Line":0}},{"line":151,"address":[4169241],"length":1,"stats":{"Line":0}},{"line":152,"address":[4169543],"length":1,"stats":{"Line":0}},{"line":154,"address":[4166102],"length":1,"stats":{"Line":0}},{"line":155,"address":[4166148,4167838,4167750],"length":1,"stats":{"Line":0}},{"line":156,"address":[4168107,4168305,4167756],"length":1,"stats":{"Line":0}},{"line":157,"address":[4168211],"length":1,"stats":{"Line":0}},{"line":161,"address":[4165847,4168483,4168523],"length":1,"stats":{"Line":0}},{"line":162,"address":[4168489,4168793],"length":1,"stats":{"Line":0}},{"line":165,"address":[4164399],"length":1,"stats":{"Line":0}},{"line":166,"address":[4164810,4164850,4164431],"length":1,"stats":{"Line":0}},{"line":168,"address":[4165169,4164816],"length":1,"stats":{"Line":0}},{"line":169,"address":[4165177],"length":1,"stats":{"Line":0}},{"line":171,"address":[4165312],"length":1,"stats":{"Line":0}},{"line":177,"address":[4306432],"length":1,"stats":{"Line":0}},{"line":182,"address":[4170915,4170992,4171106,4171219],"length":1,"stats":{"Line":0}},{"line":183,"address":[4171512],"length":1,"stats":{"Line":0}},{"line":186,"address":[4171586,4171678],"length":1,"stats":{"Line":0}},{"line":187,"address":[4172241,4172178],"length":1,"stats":{"Line":0}},{"line":188,"address":[4171644,4172001],"length":1,"stats":{"Line":0}},{"line":189,"address":[4172078,4172009],"length":1,"stats":{"Line":0}},{"line":195,"address":[4172482,4171548,4172384],"length":1,"stats":{"Line":0}},{"line":197,"address":[4174736,4172450],"length":1,"stats":{"Line":0}},{"line":199,"address":[4175209],"length":1,"stats":{"Line":0}},{"line":200,"address":[4175277],"length":1,"stats":{"Line":0}},{"line":204,"address":[4175349,4175412],"length":1,"stats":{"Line":0}},{"line":208,"address":[4175615,4175540],"length":1,"stats":{"Line":0}},{"line":209,"address":[4175639],"length":1,"stats":{"Line":0}},{"line":210,"address":[4175684],"length":1,"stats":{"Line":0}},{"line":211,"address":[4175819],"length":1,"stats":{"Line":0}},{"line":214,"address":[4174673,4172588,4172519],"length":1,"stats":{"Line":0}},{"line":215,"address":[4172818],"length":1,"stats":{"Line":0}},{"line":218,"address":[4172914,4173602,4173001],"length":1,"stats":{"Line":0}},{"line":220,"address":[4173007],"length":1,"stats":{"Line":0}},{"line":221,"address":[4173109],"length":1,"stats":{"Line":0}},{"line":225,"address":[4173244,4173181],"length":1,"stats":{"Line":0}},{"line":228,"address":[4173074,4173380,4173430,4173615],"length":1,"stats":{"Line":0}},{"line":230,"address":[4173038,4173686],"length":1,"stats":{"Line":0}},{"line":231,"address":[4173698,4173781],"length":1,"stats":{"Line":0}},{"line":232,"address":[4176296,4173793,4175971,4171013,4173939],"length":1,"stats":{"Line":0}},{"line":233,"address":[4176290,4177276,4177264],"length":1,"stats":{"Line":0}},{"line":235,"address":[4176321],"length":1,"stats":{"Line":0}},{"line":236,"address":[4176601],"length":1,"stats":{"Line":0}},{"line":238,"address":[4172727],"length":1,"stats":{"Line":0}},{"line":239,"address":[4174054,4172773,4174142],"length":1,"stats":{"Line":0}},{"line":240,"address":[4174411,4174609,4174060],"length":1,"stats":{"Line":0}},{"line":241,"address":[4174515],"length":1,"stats":{"Line":0}},{"line":247,"address":[4306496],"length":1,"stats":{"Line":0}},{"line":254,"address":[4177634,4177554,4177888,4177769],"length":1,"stats":{"Line":0}},{"line":255,"address":[4178204],"length":1,"stats":{"Line":0}},{"line":257,"address":[4178878,4178238],"length":1,"stats":{"Line":0}},{"line":258,"address":[4179231,4179271,4178948],"length":1,"stats":{"Line":0}},{"line":259,"address":[4179928,4179865],"length":1,"stats":{"Line":0}},{"line":260,"address":[4179237,4179641],"length":1,"stats":{"Line":0}},{"line":261,"address":[4179718,4179649],"length":1,"stats":{"Line":0}},{"line":266,"address":[4178276,4178364],"length":1,"stats":{"Line":0}},{"line":269,"address":[4178334,4178660],"length":1,"stats":{"Line":0}},{"line":270,"address":[3674325],"length":1,"stats":{"Line":0}},{"line":271,"address":[4180432,4180307,4180400],"length":1,"stats":{"Line":0}},{"line":272,"address":[4180788,4180414],"length":1,"stats":{"Line":0}},{"line":273,"address":[4181569,4180940],"length":1,"stats":{"Line":0}},{"line":275,"address":[4180985],"length":1,"stats":{"Line":0}},{"line":277,"address":[4181322,4181259],"length":1,"stats":{"Line":0}},{"line":278,"address":[4181082,4181016],"length":1,"stats":{"Line":0}},{"line":279,"address":[4181159,4181090],"length":1,"stats":{"Line":0}},{"line":285,"address":[4178996],"length":1,"stats":{"Line":0}},{"line":288,"address":[4179039,4182150,4179158,4183750,4183906,4183712],"length":1,"stats":{"Line":0}},{"line":289,"address":[3674347],"length":1,"stats":{"Line":0}},{"line":291,"address":[4182326,4182204],"length":1,"stats":{"Line":0}},{"line":292,"address":[4182353,4183030],"length":1,"stats":{"Line":0}},{"line":295,"address":[4182475,4182389],"length":1,"stats":{"Line":0}},{"line":296,"address":[4182860,4182923],"length":1,"stats":{"Line":0}},{"line":297,"address":[4182780,4182441],"length":1,"stats":{"Line":0}},{"line":298,"address":[4182788],"length":1,"stats":{"Line":0}},{"line":301,"address":[4182241],"length":1,"stats":{"Line":0}},{"line":302,"address":[4182281,4183110,4183198],"length":1,"stats":{"Line":0}},{"line":303,"address":[4183569,4183506],"length":1,"stats":{"Line":0}},{"line":304,"address":[4183116],"length":1,"stats":{"Line":0}},{"line":305,"address":[4183164],"length":1,"stats":{"Line":0}},{"line":321,"address":[4184484,4184539],"length":1,"stats":{"Line":0}},{"line":323,"address":[4184555],"length":1,"stats":{"Line":0}},{"line":324,"address":[4184613],"length":1,"stats":{"Line":0}},{"line":325,"address":[4184653],"length":1,"stats":{"Line":0}},{"line":326,"address":[4184660],"length":1,"stats":{"Line":0}},{"line":334,"address":[4185748,4185803],"length":1,"stats":{"Line":0}},{"line":336,"address":[4185819],"length":1,"stats":{"Line":0}},{"line":337,"address":[4185877],"length":1,"stats":{"Line":0}},{"line":338,"address":[4185917],"length":1,"stats":{"Line":0}},{"line":346,"address":[4186981,4187036],"length":1,"stats":{"Line":0}},{"line":348,"address":[4187052],"length":1,"stats":{"Line":0}},{"line":349,"address":[4187110],"length":1,"stats":{"Line":0}},{"line":350,"address":[4187150],"length":1,"stats":{"Line":0}},{"line":351,"address":[4187190],"length":1,"stats":{"Line":0}},{"line":360,"address":[4188418],"length":1,"stats":{"Line":0}},{"line":362,"address":[3717016],"length":1,"stats":{"Line":0}},{"line":363,"address":[4189136],"length":1,"stats":{"Line":0}},{"line":365,"address":[4189893,4193539,4193545,4193312,4189173],"length":1,"stats":{"Line":0}},{"line":367,"address":[4193457],"length":1,"stats":{"Line":0}},{"line":368,"address":[4193349],"length":1,"stats":{"Line":0}},{"line":369,"address":[4193378],"length":1,"stats":{"Line":0}},{"line":370,"address":[4193441],"length":1,"stats":{"Line":0}},{"line":371,"address":[4193445],"length":1,"stats":{"Line":0}},{"line":372,"address":[4193449],"length":1,"stats":{"Line":0}},{"line":373,"address":[4193453],"length":1,"stats":{"Line":0}},{"line":375,"address":[4193534,4189923],"length":1,"stats":{"Line":0}},{"line":378,"address":[4189931],"length":1,"stats":{"Line":0}},{"line":380,"address":[4190039,4190122],"length":1,"stats":{"Line":0}},{"line":381,"address":[4190129],"length":1,"stats":{"Line":0}},{"line":387,"address":[4190360],"length":1,"stats":{"Line":0}},{"line":388,"address":[4190492],"length":1,"stats":{"Line":0}},{"line":391,"address":[4190778],"length":1,"stats":{"Line":0}},{"line":392,"address":[4190648],"length":1,"stats":{"Line":0}},{"line":393,"address":[4190770],"length":1,"stats":{"Line":0}},{"line":397,"address":[4189298,4189199,4189337],"length":1,"stats":{"Line":0}},{"line":400,"address":[4189636,4189304],"length":1,"stats":{"Line":0}},{"line":401,"address":[3717034],"length":1,"stats":{"Line":0}},{"line":402,"address":[4191394,4191510,4191481],"length":1,"stats":{"Line":0}},{"line":403,"address":[4191839,4191495],"length":1,"stats":{"Line":0}},{"line":404,"address":[4192942,4191991],"length":1,"stats":{"Line":0}},{"line":406,"address":[4192036],"length":1,"stats":{"Line":0}},{"line":409,"address":[4192868,4192602],"length":1,"stats":{"Line":0}},{"line":410,"address":[4192077],"length":1,"stats":{"Line":0}},{"line":411,"address":[4192394],"length":1,"stats":{"Line":0}},{"line":412,"address":[4192085],"length":1,"stats":{"Line":0}},{"line":413,"address":[4192231,4192156],"length":1,"stats":{"Line":0}},{"line":414,"address":[4192331],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":154},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","strategy","mod.rs"],"content":"pub mod position_evaluation;","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","strategy","position_evaluation.rs"],"content":"use crate::game::plateau::Plateau;\nuse crate::game::tile::Tile;\nuse crate::scoring::scoring::compute_alignment_score;\n\n// Version simplifi√©e qui se concentre sur les positions strat√©giques\npub fn calculate_line_completion_bonus(_plateau: \u0026Plateau, position: usize, tile: \u0026Tile) -\u003e f64 {\n    let mut bonus = 0.0;\n\n    // Bonus bas√© sur les positions strat√©giques identifi√©es dans tes donn√©es\n    bonus += match position {\n        8 =\u003e 5.0,                 // Position 8: 150.6 moyenne - excellente\n        14 =\u003e 4.0,                // Position 14: 147.7 moyenne - tr√®s bonne\n        2 =\u003e 4.0,                 // Position 2: 147.1 moyenne - tr√®s bonne\n        5 =\u003e 3.0,                 // Position 5: 143.6 moyenne - bonne\n        11 =\u003e 3.0,                // Position 11: 142.9 moyenne - bonne\n        10 =\u003e 2.0,                // Position 10: 140.8 moyenne - correcte\n        13 =\u003e 2.0,                // Position 13: 140.2 moyenne - correcte\n        1 | 4 | 6 | 9 | 0 =\u003e 1.0, // Positions moyennes\n        12 | 15 | 16 =\u003e 0.5,      // Positions plus faibles\n        7 | 17 =\u003e 0.0,            // Positions les plus faibles\n        _ =\u003e 0.0,\n    };\n\n    // Bonus pour les valeurs de tuiles √©lev√©es (plus de points potentiels)\n    let tile_value_bonus = ((tile.0 + tile.1) as f64) * 0.1;\n    bonus += tile_value_bonus;\n\n    // Bonus pour la coh√©rence des couleurs/formes\n    if tile.0 == tile.1 {\n        bonus += 1.0; // Tuiles avec m√™me couleur et forme\n    }\n\n    // Bonus central l√©g√®rement plus complexe\n    let row = position / 3;\n    let col = position % 3;\n    if row \u003e= 1 \u0026\u0026 row \u003c= 4 \u0026\u0026 col \u003e= 1 \u0026\u0026 col \u003c= 1 {\n        bonus += 2.0; // Zone centrale du plateau\n    }\n\n    bonus\n}\n\n// ============================================================================\n// ALTERNATIVE PLUS SIMPLE (Si la version ci-dessus pose encore probl√®me)\n// ============================================================================\n\n// Si vous pr√©f√©rez une version plus simple, utilisez celle-ci:\n\npub fn enhanced_position_evaluation(\n    plateau: \u0026Plateau,\n    position: usize,\n    tile: \u0026Tile,\n    current_turn: usize,\n) -\u003e f64 {\n    // Score de base alignement (votre fonction existante)\n    let alignment_score = compute_alignment_score(plateau, position, tile);\n\n    // Bonus pour positions centrales strat√©giques en d√©but de partie\n    let position_bonus = if current_turn \u003c 8 {\n        match position {\n            7 | 8 | 9 | 10 | 11 =\u003e 5.0,           // Ligne centrale - critique\n            4 | 5 | 6 | 12 | 13 | 14 | 15 =\u003e 3.0, // Positions strat√©giques\n            _ =\u003e 0.0,\n        }\n    } else {\n        0.0 // En fin de partie, seul l'alignement compte\n    };\n\n    // Malus pour positions coins/bords si d√©but de partie\n    let position_malus = if current_turn \u003c 5 {\n        match position {\n            0 | 2 | 16 | 18 =\u003e -2.0, // Coins - √† √©viter en d√©but\n            1 | 17 =\u003e -1.0,          // Bords\n            _ =\u003e 0.0,\n        }\n    } else {\n        0.0\n    };\n\n    // Bonus pour compl√©tion de lignes\n    let completion_bonus = calculate_line_completion_bonus(plateau, position, tile);\n\n    alignment_score + position_bonus + position_malus + completion_bonus\n}\n","traces":[{"line":6,"address":[3522320],"length":1,"stats":{"Line":0}},{"line":7,"address":[3522349],"length":1,"stats":{"Line":0}},{"line":10,"address":[3522358,3522568],"length":1,"stats":{"Line":0}},{"line":11,"address":[3522407],"length":1,"stats":{"Line":0}},{"line":12,"address":[3522426],"length":1,"stats":{"Line":0}},{"line":13,"address":[3522442],"length":1,"stats":{"Line":0}},{"line":14,"address":[3522458],"length":1,"stats":{"Line":0}},{"line":15,"address":[3522474],"length":1,"stats":{"Line":0}},{"line":16,"address":[3522490],"length":1,"stats":{"Line":0}},{"line":17,"address":[3522506],"length":1,"stats":{"Line":0}},{"line":18,"address":[3522522],"length":1,"stats":{"Line":0}},{"line":19,"address":[3522538],"length":1,"stats":{"Line":0}},{"line":20,"address":[3522554],"length":1,"stats":{"Line":0}},{"line":21,"address":[3522393],"length":1,"stats":{"Line":0}},{"line":25,"address":[3522586,3522652],"length":1,"stats":{"Line":0}},{"line":26,"address":[3522631],"length":1,"stats":{"Line":0}},{"line":29,"address":[3522643,3522751],"length":1,"stats":{"Line":0}},{"line":30,"address":[3522731],"length":1,"stats":{"Line":0}},{"line":34,"address":[3522670],"length":1,"stats":{"Line":0}},{"line":35,"address":[3522698],"length":1,"stats":{"Line":0}},{"line":36,"address":[3522723,3522817,3522769],"length":1,"stats":{"Line":0}},{"line":37,"address":[3522797],"length":1,"stats":{"Line":0}},{"line":40,"address":[3522753],"length":1,"stats":{"Line":0}},{"line":49,"address":[3522832],"length":1,"stats":{"Line":0}},{"line":56,"address":[3522875],"length":1,"stats":{"Line":0}},{"line":59,"address":[3522912,3522897],"length":1,"stats":{"Line":0}},{"line":60,"address":[3522919],"length":1,"stats":{"Line":0}},{"line":61,"address":[3522989],"length":1,"stats":{"Line":0}},{"line":62,"address":[3523005],"length":1,"stats":{"Line":0}},{"line":63,"address":[3522978],"length":1,"stats":{"Line":0}},{"line":66,"address":[3522903],"length":1,"stats":{"Line":0}},{"line":70,"address":[3522970,3523030],"length":1,"stats":{"Line":0}},{"line":71,"address":[3523037],"length":1,"stats":{"Line":0}},{"line":72,"address":[3523183],"length":1,"stats":{"Line":0}},{"line":73,"address":[3523199],"length":1,"stats":{"Line":0}},{"line":74,"address":[3523172],"length":1,"stats":{"Line":0}},{"line":77,"address":[3523021],"length":1,"stats":{"Line":0}},{"line":81,"address":[3523131],"length":1,"stats":{"Line":0}},{"line":83,"address":[3523151],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":39},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","test.rs"],"content":"#[cfg(test)]\npub(crate) mod tests {\n    use crate::game::plateau::Plateau;\n    use crate::game::tile::Tile;\n    pub fn create_mcts_node(state: GameState, parent: Option\u003c*mut MCTSNode\u003e) -\u003e MCTSNode {\n        MCTSNode {\n            state,\n            visits: 0,\n            value: 0.0,\n            children: Vec::new(),\n            parent,\n        }\n    }\n    pub fn choisir_et_placer(deck: \u0026mut Deck, plateau: \u0026mut Plateau) {\n        let mut rng = rand::rng();\n\n        // R√©p√©ter jusqu'√† ce que le plateau soit plein\n        while plateau.tiles.contains(\u0026Tile(0, 0, 0)) {\n            // Choisir une tuile al√©atoirement dans le deck\n            let deck_len = deck.tiles.len();\n            if deck_len == 0 {\n                break; // Plus de tuiles disponibles\n            }\n            let tile_index = rng.random_range(0..deck_len);\n            let tuile = deck.tiles.remove(tile_index); // Retirer la tuile du deck\n\n            // Choisir une position al√©atoire dans le plateau\n            let mut position;\n            loop {\n                position = rng.random_range(0..plateau.tiles.len());\n                if plateau.tiles[position] == Tile(0, 0, 0) {\n                    break; // Trouver une case vide\n                }\n            }\n\n            // Placer la tuile dans le plateau\n            plateau.tiles[position] = tuile;\n        }\n    }\n\n    pub fn placer_tile(plateau: \u0026mut Plateau, tuile: Tile, position: usize) -\u003e bool {\n        if plateau.tiles[position] != Tile(0, 0, 0) {\n            return false; // Case d√©j√† occup√©e\n        }\n        plateau.tiles[position] = tuile;\n        true\n    }\n\n    pub fn create_game_state() -\u003e GameState {\n        let plateau = create_plateau_empty();\n        let deck = create_deck();\n        GameState { plateau, deck }\n    }\n\n    pub fn apply_move(mut game_state: GameState, tile: Tile, position: usize) -\u003e Option\u003cGameState\u003e {\n        if !placer_tile(\u0026mut game_state.plateau, tile, position){\n            return None; // Invalid move\n        }\n        else {\n            placer_tile(\u0026mut game_state.plateau, tile, position);\n            let new_plateau = game_state.plateau.clone();\n            let mut new_deck = game_state.deck.clone();\n            new_deck = replace_tile_in_deck(\u0026new_deck, \u0026tile);\n\n\n            Some(GameState {\n                plateau: new_plateau,\n                deck: new_deck,\n            })\n\n        }\n    }\n    pub fn select_ucb1\u003c'a\u003e(node: \u0026'a mut MCTSNode, exploration: f64) -\u003e \u0026'a mut MCTSNode {\n        let total_visits = node.visits as f64;\n\n        node.children\n            .iter_mut()\n            .map(|child| {\n                let ucb_score = if child.visits == 0 {\n                    f64::INFINITY // Prioritize unvisited nodes\n                } else if total_visits \u003e 0.0 {\n                    let exploitation = child.value / child.visits as f64;\n                    let exploration_term = exploration * ((total_visits.ln() / child.visits as f64).sqrt());\n                    exploitation + exploration_term\n                } else {\n                    0.0 // No valid exploration term if parent has zero visits\n                };\n                (ucb_score, child)\n            })\n            .inspect(|(ucb_score, child)| {\n                println!(\n                    \"Child: visits={}, value={}, UCB1 score={}\",\n                    child.visits, child.value, ucb_score\n                );\n            })\n            .max_by(|(score_a, _), (score_b, _)| score_a.partial_cmp(score_b).unwrap_or(std::cmp::Ordering::Equal))\n            .expect(\"No children to select\")\n            .1\n    }\n    pub fn expand(mut root: MCTSNode, new_state: GameState)-\u003eMCTSNode {\n        let new_node = MCTSNode {\n            state: new_state.clone(),\n            visits: 0,\n            value: 0.0,\n            children: Vec::new(),\n            parent: None,\n        };\n        root.children.push(new_node);\n        root\n    }\n    pub fn backpropagate(node: \u0026mut MCTSNode, score: f64) {\n        // Start from the current node\n        let mut current: *mut MCTSNode = node;\n\n        unsafe {\n            // Traverse up the tree\n            while let Some(parent) = (*current).parent {\n                // Update the current node\n                (*current).visits += 1;\n                (*current).value += score;\n\n                // Move to the parent node\n                current = parent;\n            }\n\n            // Update the root node\n            (*current).visits += 1;\n            (*current).value += score;\n        }\n    }\n    use rand::Rng;\n    use crate::game::create_deck::create_deck;\n    use crate::game::get_legal_moves::get_legal_moves;\n    use crate::game::plateau_is_full::is_plateau_full;\n    use crate::game::simulate_game::simulate_games;\n    use crate::neural::tensor_conversion::convert_plateau_to_tensor;\n    use crate::game::deck::Deck;\n    use crate::game::game_state::GameState;\n    use crate::mcts::mcts_node::MCTSNode;\n    use crate::game::plateau::create_plateau_empty;\n    use crate::game::remove_tile_from_deck::replace_tile_in_deck;\n    use crate::scoring::scoring::result;\n\n    #[test]\n    fn test_placement_tuile_valide_take_it_easy() {\n        let mut plateau:Plateau=create_plateau_empty();\n        let shuffled_deck:Deck= create_deck();\n        let tuile = shuffled_deck.tiles[5].clone();\n        assert!(placer_tile(\u0026mut plateau, tuile.clone(), 1));\n        assert_eq!(plateau.tiles[1], tuile);\n    }\n\n\n\n\n\n\n    #[test]\n    fn test_is_plateau_full() {\n        let mut plateau = create_plateau_empty();\n        assert!(!is_plateau_full(\u0026plateau)); // Initially, plateau is empty\n\n        for i in 0..plateau.tiles.len() {\n            plateau.tiles[i] = Tile(1, 2, 3); // Fill the plateau\n        }\n        assert!(is_plateau_full(\u0026plateau)); // Plateau should now be full\n    }\n    #[test]\n    fn test_get_legal_moves_main() {\n        let mut plateau = create_plateau_empty();\n        let legal_moves = get_legal_moves(plateau.clone());\n        assert_eq!(legal_moves.len(), plateau.tiles.len()); // All positions should be legal initially\n\n        plateau.tiles[0] = Tile(1, 2, 3); // Fill one position\n        let legal_moves = get_legal_moves(plateau.clone());\n        assert_eq!(legal_moves.len(), plateau.tiles.len() - 1); // One less legal move\n        assert!(!legal_moves.contains(\u00260)); // Position 0 should no longer be legal\n    }\n    #[test]\n    fn test_simulate_games() {\n        let plateau = create_plateau_empty();\n        let deck = create_deck();\n        let _num_simulations = 10;\n\n        let avg_score = simulate_games(plateau, deck);\n        assert!(avg_score \u003e= 0); // Score should be non-negative\n    }\n    #[test]\n    fn test_convert_plateau_to_tensor() {\n        let plateau = create_plateau_empty();\n        let tile = Tile(1, 2, 3);\n        let deck = create_deck();\n\n        let tensor = convert_plateau_to_tensor(\u0026plateau, \u0026tile, \u0026deck, /* usize */0, 19/* usize */);\n        assert_eq!(tensor.size(), vec![1, 5, 47, 1]); // Ensure the tensor has the correct shape\n    }\n\n\n\n    #[test]\n    fn test_placement_tuile_not_valide_take_it_easy() {\n        let mut plateau:Plateau=create_plateau_empty();\n        let deck_sfuffle: Deck = create_deck();\n        let tile = deck_sfuffle.tiles[5].clone();\n        assert!(placer_tile(\u0026mut plateau, tile.clone(), 1));\n        assert_eq!(plateau.tiles[1], tile);\n        let tile = deck_sfuffle.tiles[5].clone();\n        assert!(!placer_tile(\u0026mut plateau, tile.clone(), 1));\n    }\n    #[test]\n    fn test_choir_aleatorytile() {\n        // Cr√©e un deck\n        let deck_shuffle: Deck = create_deck();\n\n        // G√©n√®re un index al√©atoire\n        let mut rng = rand::rng();\n        let index = rng.random_range(0..deck_shuffle.tiles.len());\n\n        // S√©lectionne une tuile al√©atoire\n        let tuile = deck_shuffle.tiles[index].clone();\n\n        // V√©rifie que la tuile existe dans le deck\n        assert!(deck_shuffle.tiles.contains(\u0026tuile));\n        println!(\"Tuile choisie al√©atoirement : {:?}\", tuile);\n    }\n\n\n\n\n\n\n    #[test]\n    fn test_retirer_tuile_aleatoire_du_deck() {\n        use rand::Rng; // Pour g√©n√©rer un indice al√©atoire\n\n        // Cr√©e un deck initial\n        let deck_shuffle: Deck = create_deck();\n\n        // G√©n√®re un indice al√©atoire\n        let mut rng = rand::rng();\n        let index = rng.random_range(0..deck_shuffle.tiles.len());\n\n        // R√©cup√®re la tuile choisie al√©atoirement\n        let tuile_choisie = deck_shuffle.tiles[index].clone();\n\n        // Supprime la tuile du deck\n        let nouveau_deck = replace_tile_in_deck(\u0026deck_shuffle, \u0026tuile_choisie);\n        \n\n        // V√©rifie que la nouvelle taille du deck est r√©duite de 1\n        assert_eq!(27-nouveau_deck.tiles.iter().filter(|\u0026\u0026tile| tile == Tile(0, 0, 0)).count(),26);\n\n        // V√©rifie que la tuile choisie n'est plus pr√©sente dans le nouveau deck\n        assert!(!nouveau_deck.tiles.contains(\u0026tuile_choisie));\n\n        println!(\"Tuile retir√©e : {:?}\", tuile_choisie);\n        println!(\"Taille du deck initial : {}\", deck_shuffle.tiles.len());\n        println!(\"Taille du nouveau deck : {}\", nouveau_deck.tiles.len());\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy() {\n        let mut deck = create_deck();\n        let mut plateau = create_plateau_empty();\n\n        // Remplir le plateau\n        choisir_et_placer(\u0026mut deck, \u0026mut plateau);\n\n        // V√©rifier que le plateau est plein\n        assert!(!plateau.tiles.contains(\u0026Tile(0, 0, 0)));\n        println!(\"Deck restant : {:?}\", deck.tiles);\n        println!(\"Plateau final : {:?}\", plateau.tiles);\n        // V√©rifier que le deck est vide ou contient moins de tuiles\n        assert!(deck.tiles.len() + plateau.tiles.len() == 27);\n\n\n\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_first_3_plateau_3_1() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 0);\n        placer_tile(\u0026mut plateau, deck.tiles[1].clone(), 1);\n        placer_tile(\u0026mut plateau, deck.tiles[2].clone(), 2);\n        let point=result(\u0026plateau);\n        assert_eq!(point,3);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_first_3_plateau_3_2() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[9].clone(), 0);\n        placer_tile(\u0026mut plateau, deck.tiles[10].clone(), 1);\n        placer_tile(\u0026mut plateau, deck.tiles[11].clone(), 2);\n        let point=result(\u0026plateau);\n        assert_eq!(point,15);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_2_column_plateau_4_2() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[9].clone(), 3);\n        placer_tile(\u0026mut plateau, deck.tiles[10].clone(), 4);\n        placer_tile(\u0026mut plateau, deck.tiles[11].clone(), 5);\n        placer_tile(\u0026mut plateau, deck.tiles[12].clone(), 6);\n        println!(\"{:?}\", plateau.tiles);\n\n\n        let point=result(\u0026plateau);\n        assert_eq!(point,20);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_column_center_plateau_5_2() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[9].clone(), 7);\n        placer_tile(\u0026mut plateau, deck.tiles[10].clone(), 8);\n        placer_tile(\u0026mut plateau, deck.tiles[11].clone(), 9);\n        placer_tile(\u0026mut plateau, deck.tiles[12].clone(), 10);\n        placer_tile(\u0026mut plateau, deck.tiles[13].clone(), 11);\n        println!(\"{:?}\", plateau.tiles);\n\n\n        let point=result(\u0026plateau);\n        assert_eq!(point,25);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_column_4_plateau_4_2() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[9].clone(), 12);\n        placer_tile(\u0026mut plateau, deck.tiles[10].clone(), 13);\n        placer_tile(\u0026mut plateau, deck.tiles[11].clone(), 14);\n        placer_tile(\u0026mut plateau, deck.tiles[12].clone(), 15);\n        println!(\"{:?}\", plateau.tiles);\n\n\n        let point=result(\u0026plateau);\n        assert_eq!(point,20);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_last_column_3_plateau_3_1() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 16);\n        placer_tile(\u0026mut plateau, deck.tiles[1].clone(),17);\n        placer_tile(\u0026mut plateau, deck.tiles[2].clone(), 18);\n        let point=result(\u0026plateau);\n        assert_eq!(point,3);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_first_diag_plateau_0_3_7() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 0);\n        placer_tile(\u0026mut plateau, deck.tiles[4].clone(),3);\n        placer_tile(\u0026mut plateau, deck.tiles[5].clone(), 7);\n        let point=result(\u0026plateau);\n        assert_eq!(point,6);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_second_diag_plateau_1_4_8_12() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 1);\n        placer_tile(\u0026mut plateau, deck.tiles[4].clone(),4);\n        placer_tile(\u0026mut plateau, deck.tiles[5].clone(), 8);\n        placer_tile(\u0026mut plateau, deck.tiles[9].clone(), 12);\n        let point=result(\u0026plateau);\n        assert_eq!(point,8);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_third_diag_plateau_2_5_9_13_16() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 2);\n        placer_tile(\u0026mut plateau, deck.tiles[4].clone(),5);\n        placer_tile(\u0026mut plateau, deck.tiles[5].clone(), 9);\n        placer_tile(\u0026mut plateau, deck.tiles[9].clone(), 13);\n        placer_tile(\u0026mut plateau, deck.tiles[13].clone(), 16);\n        let point=result(\u0026plateau);\n        assert_eq!(point,10);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_fourth_diag_plateau_6_10_14_17() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 6);\n        placer_tile(\u0026mut plateau, deck.tiles[4].clone(),10);\n        placer_tile(\u0026mut plateau, deck.tiles[5].clone(), 14);\n        placer_tile(\u0026mut plateau, deck.tiles[9].clone(), 17);\n\n        let point=result(\u0026plateau);\n        assert_eq!(point,8);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_last_diag_plateau_11_15_18() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 11);\n        placer_tile(\u0026mut plateau, deck.tiles[4].clone(),15);\n        placer_tile(\u0026mut plateau, deck.tiles[5].clone(), 18);\n\n\n        let point=result(\u0026plateau);\n        assert_eq!(point,6);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_firdt_diag_left_plateau_7_12_16() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 7);\n        placer_tile(\u0026mut plateau, deck.tiles[2].clone(),12);\n        placer_tile(\u0026mut plateau, deck.tiles[3].clone(), 16);\n\n\n        let point=result(\u0026plateau);\n        assert_eq!(point,9);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_second_diag_left_plateau_3_8_13_17() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 3);\n        placer_tile(\u0026mut plateau, deck.tiles[2].clone(),8);\n        placer_tile(\u0026mut plateau, deck.tiles[3].clone(), 13);\n        placer_tile(\u0026mut plateau, deck.tiles[9].clone(), 17);\n\n\n        let point=result(\u0026plateau);\n        assert_eq!(point,12);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_third_diag_left_plateau_0_4_9_14_18() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 0);\n        placer_tile(\u0026mut plateau, deck.tiles[2].clone(),4);\n        placer_tile(\u0026mut plateau, deck.tiles[3].clone(), 9);\n        placer_tile(\u0026mut plateau, deck.tiles[9].clone(), 14);\n        placer_tile(\u0026mut plateau, deck.tiles[11].clone(), 18);\n\n\n        let point=result(\u0026plateau);\n        assert_eq!(point,15);\n    }\n\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_fourth_diag_left_plateau_1_5_10_15() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 1);\n        placer_tile(\u0026mut plateau, deck.tiles[2].clone(),5);\n        placer_tile(\u0026mut plateau, deck.tiles[3].clone(), 10);\n        placer_tile(\u0026mut plateau, deck.tiles[9].clone(), 15);\n\n\n        let point=result(\u0026plateau);\n        assert_eq!(point,12);\n    }\n    #[test]\n    fn test_remplir_plateau_take_it_easy_count_last_diag_left_plateau_2_6_11() {\n        let deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        placer_tile(\u0026mut plateau, deck.tiles[0].clone(), 2);\n        placer_tile(\u0026mut plateau, deck.tiles[2].clone(),6);\n        placer_tile(\u0026mut plateau, deck.tiles[3].clone(), 11);\n\n\n        let point=result(\u0026plateau);\n        assert_eq!(point,9);\n    }\n\n\n    #[test]\n    fn test_get_legal_moves() {\n        let mut state = create_game_state();\n        placer_tile(\u0026mut state.plateau, state.deck.tiles[0].clone(), 2);\n        placer_tile(\u0026mut state.plateau, state.deck.tiles[2].clone(),6);\n        placer_tile(\u0026mut state.plateau, state.deck.tiles[3].clone(), 11);\n        // At the beginning, all positions are empty\n        let moves:Vec\u003c usize\u003e  = get_legal_moves(state.plateau.clone());\n        let expectedly: usize = state\n            .plateau\n            .tiles\n            .iter()\n            .map(|tile| if tile == \u0026Tile(0, 0, 0) { 1 } else { 0 })\n            .sum();\n\n        assert_eq!(moves.len(), expectedly);\n    }\n\n\n    #[test]\n    fn test_apply_move() {\n        let state = create_game_state();\n\n        let tile = state.deck.tiles[0].clone();\n        let position = 2;\n\n        let new_state = apply_move(state,tile, position);\n\n        // Ensure the tile is placed correctly\n        assert_eq!(new_state.clone().unwrap().plateau.tiles[position], tile);\n\n        // Ensure the tile is removed from the deck\n        assert!(!new_state.clone().unwrap().deck.tiles.contains(\u0026tile));\n    }\n\n\n\n\n    #[test]\n    fn test_simulate() {\n        let state = create_game_state();\n        let score = simulate(state);\n\n        // Ensure the simulation produces a valid score\n        assert!(score \u003e= 0);\n    }\n    fn simulate(game_state: GameState) -\u003e i32 {\n        let mut simulated_state = game_state.clone();\n\n        // Randomly choose and place tiles until the plateau is full\n        // Randomly choose and place tiles until the plateau is full\n        while simulated_state.plateau.tiles.contains(\u0026Tile(0, 0, 0)) {\n            let legal_moves = get_legal_moves(simulated_state.plateau.clone());\n            if legal_moves.is_empty() {\n                break; // No more moves possible\n            }\n\n            let mut rng = rand::rng();\n            let position = legal_moves[rng.random_range(0..legal_moves.len())].clone();\n            let tile_index = rng.random_range(0..simulated_state.deck.tiles.len());\n            let chosen_tile = simulated_state.deck.tiles[tile_index].clone();\n            simulated_state = apply_move(simulated_state,chosen_tile, position).unwrap();\n        }\n\n        // Return the result of the completed plateau\n        result(\u0026simulated_state.plateau)\n    }\n    #[test]\n    fn test_is_game_over() {\n        let mut state = create_game_state();\n\n        // Game is not over at the beginning\n        assert!(!is_game_over(state.clone()));\n        let mut position = 0;\n        while state.plateau.tiles.contains(\u0026Tile(0, 0, 0)) {\n                if let Some(empty_tile) = state.deck.tiles.iter().filter(|tile| **tile != Tile(0, 0, 0)).collect::\u003cVec\u003c_\u003e\u003e().first() {\n                    if let Some(new_state) = apply_move(state.clone(), **empty_tile, position) {\n                        state = new_state;\n                    }\n                }\n            position += 1;\n        }\n\n\n        assert!(is_game_over(state.clone()));\n    }\n    pub fn is_game_over(game_state: GameState) -\u003e bool {\n        !game_state.plateau.tiles.contains(\u0026Tile(0, 0, 0))\n    }\n    #[test]\n    fn test_node_initialization() {\n        let initial_state = create_game_state();\n        let node = MCTSNode {\n            state: initial_state.clone(),\n            visits: 0,\n            value: 0.0,\n            children: Vec::new(),\n            parent: None,\n        };\n\n        assert_eq!(node.visits, 0);\n        assert_eq!(node.value, 0.0);\n        assert!(node.children.is_empty());\n    }\n    #[test]\n    fn test_selection_with_ucb1() {\n        let mut root = MCTSNode {\n            state: create_game_state(),\n            visits: 10,\n            value: 0.0,\n            children: vec![\n                MCTSNode { state: create_game_state(), visits: 1, value: 5.0, children: vec![], parent: None },\n                MCTSNode { state: create_game_state(), visits: 2, value: 8.0, children: vec![], parent: None },\n            ],\n            parent: None,\n        };\n\n        let total_visits = root.visits as f64;\n        let exploration = 1.4;\n\n        // Calculate expected UCB1 scores\n        let ucb1_child_1 = 5.0 / 1.0 + exploration * ((total_visits.ln() / 1.0).sqrt());\n        let ucb1_child_2 = 8.0 / 2.0 + exploration * ((total_visits.ln() / 2.0).sqrt());\n\n        // Select the child with the higher UCB1 score\n        let expected_visits = if ucb1_child_1 \u003e ucb1_child_2 { 1 } else { 2 };\n\n        let selected = select_ucb1(\u0026mut root, exploration);\n        assert_eq!(selected.visits, expected_visits); // Ensure correct child selected\n    }\n\n\n\n\n\n\n\n\n    #[test]\n    fn test_node_expansion() {\n        let mut root = MCTSNode {\n            state: create_game_state(),\n            visits: 0,\n            value: 0.0,\n            children: Vec::new(),\n            parent: None,\n        };\n\n        let next_state = create_game_state(); // Define a valid next state\n        root=expand(root,next_state.clone());\n\n        assert_eq!(root.children.len(), 1);\n        assert_eq!(root.children[0].state, next_state);\n    }\n\n\n\n\n\n\n    #[test]\n    fn test_backpropagate_with_parent() {\n        let mut root = create_mcts_node(create_game_state(), None);\n\n        let child = create_mcts_node(create_game_state(), Some(\u0026mut root as *mut _));\n        root.children.push(child);\n\n        let  leaf = create_mcts_node(create_game_state(), Some(\u0026mut root.children[0] as *mut _));\n        root.children[0].children.push(leaf);\n\n        println!(\"Before backpropagation: root = {:?}, child = {:?}, leaf = {:?}\", root, root.children[0], root.children[0].children[0]);\n\n        let leaf_mut = \u0026mut root.children[0].children[0];\n        backpropagate(leaf_mut, 10.0);\n\n        println!(\"After backpropagation: root = {:?}, child = {:?}, leaf = {:?}\", root, root.children[0], root.children[0].children[0]);\n\n        assert_eq!(root.visits, 1);\n        assert_eq!(root.value, 10.0);\n\n        assert_eq!(root.children[0].visits, 1);\n        assert_eq!(root.children[0].value, 10.0);\n\n        assert_eq!(root.children[0].children[0].visits, 1);\n        assert_eq!(root.children[0].children[0].value, 10.0);\n    }\n    #[test]\n    fn test_initialize_root_node() {\n        let root_state = create_game_state();\n        let root_node = create_mcts_node(root_state.clone(), None);\n\n        assert_eq!(root_node.visits, 0);\n        assert_eq!(root_node.value, 0.0);\n        assert!(root_node.children.is_empty());\n        assert!(root_node.parent.is_none());\n    }\n    #[test]\n    fn test_selection_step_with_ucb1() {\n        let mut root = create_mcts_node(create_game_state(), None);\n        root.visits = 10; // Ensure the root has non-zero visits\n\n        // Child 1: Unvisited node\n        let mut child1 = create_mcts_node(create_game_state(), Some(\u0026mut root as *mut _));\n        child1.visits = 0;\n        child1.value = 0.0;\n\n        // Child 2: Explored node\n        let mut child2 = create_mcts_node(create_game_state(), Some(\u0026mut root as *mut _));\n        child2.visits = 2;\n        child2.value = 8.0;\n\n        // Child 3: Another explored node\n        let mut child3 = create_mcts_node(create_game_state(), Some(\u0026mut root as *mut _));\n        child3.visits = 1;\n        child3.value = 5.0;\n\n        root.children.push(child1);\n        root.children.push(child2);\n        root.children.push(child3);\n\n        // Debugging: Print the state of the root and children\n        println!(\"Root: {:?}\", root);\n        for (i, child) in root.children.iter().enumerate() {\n            println!(\"Child {}: {:?}\", i + 1, child);\n        }\n\n        // Select the best node using UCB1\n        let selected = select_ucb1(\u0026mut root, 1.4);\n\n        // Debugging: Print the selected node\n        println!(\"Selected node: {:?}\", selected);\n\n        // The unvisited node (child1) should be selected due to infinite UCB1 score\n        assert_eq!(selected.visits, 0);\n    }\n\n    #[test]\n    fn test_expansion_step() {\n        let mut root = create_mcts_node(create_game_state(), None);\n        let next_state = create_game_state(); // Simulate the next state\n\n        root = expand(root, next_state.clone());\n\n        assert_eq!(root.children.len(), 1);\n        assert_eq!(root.children[0].state, next_state);\n    }\n    #[test]\n    fn test_simulation_step() {\n        let initial_state = create_game_state();\n        let score = simulate(initial_state);\n\n        assert!(score \u003e= 0); // Ensure the score is valid\n    }\n    #[test]\n    fn test_backpropagation_step() {\n        let mut root = create_mcts_node(create_game_state(), None);\n        let child = create_mcts_node(create_game_state(), Some(\u0026mut root as *mut _));\n        root.children.push(child);\n\n        let leaf = create_mcts_node(create_game_state(), Some(\u0026mut root.children[0] as *mut _));\n        root.children[0].children.push(leaf);\n\n        let leaf_mut = \u0026mut root.children[0].children[0];\n        backpropagate(leaf_mut, 10.0);\n\n        assert_eq!(root.visits, 1);\n        assert_eq!(root.value, 10.0);\n        assert_eq!(root.children[0].visits, 1);\n        assert_eq!(root.children[0].value, 10.0);\n        assert_eq!(root.children[0].children[0].visits, 1);\n        assert_eq!(root.children[0].children[0].value, 10.0);\n    }\n    #[test]\n    fn test_run_mcts() {\n        let mut root = create_mcts_node(create_game_state(), None);\n        let exploration = 1.4;\n\n        for _ in 0..100 {\n            // Selection\n            let mut selected_node: \u0026mut MCTSNode = \u0026mut root;\n            while !selected_node.children.is_empty() {\n                selected_node = select_ucb1(selected_node, exploration);\n            }\n\n            // Expansion\n            let legal_moves = get_legal_moves(selected_node.state.plateau.clone());\n            if !legal_moves.is_empty() {\n                let mut rng = rand::rng();\n                let position = legal_moves[rng.random_range(0..legal_moves.len())];\n                let tile_index = rng.random_range(0..selected_node.state.deck.tiles.len());\n                let chosen_tile = selected_node.state.deck.tiles[tile_index];\n                let deck_size_before = selected_node.state.deck.tiles.iter().filter(|tile| **tile != Tile(0, 0, 0)).collect::\u003cVec\u003c_\u003e\u003e().len();\n                println!(\"Deck size before expansion: {}\", deck_size_before);\n\n                if let Some(new_state) = apply_move(selected_node.state.clone(), chosen_tile, position) {\n                    expand(selected_node.clone(), new_state.clone());\n\n                    let deck_size_after = new_state.deck.tiles.iter().filter(|tile| **tile != Tile(0, 0, 0)).collect::\u003cVec\u003c_\u003e\u003e().len();\n                    println!(\"Deck size after expansion: {}\", deck_size_after);\n\n                    assert_eq!(deck_size_after, deck_size_before - 1, \"Deck size did not decrement correctly!\");\n                }\n\n            }\n\n            // Simulation\n            let simulated_score = simulate(selected_node.state.clone());\n\n            // Backpropagation\n            backpropagate(selected_node, simulated_score.into());\n        }\n\n        // Verify root node is updated\n        assert!(root.visits \u003e 0);\n        assert!(root.value \u003e 0.0);\n    }\n\n\n\n\n}","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","training","evaluator.rs"],"content":"use rand::{rng, Rng};\nuse crate::game::create_deck::create_deck;\nuse crate::game::plateau::create_plateau_empty;\nuse crate::game::plateau_is_full::is_plateau_full;\nuse crate::game::remove_tile_from_deck::replace_tile_in_deck;\nuse crate::mcts::algorithm::mcts_find_best_position_for_tile_with_nn;\nuse crate::neural::policy_value_net::{PolicyNet, ValueNet};\nuse crate::scoring::scoring::result;\n\npub async fn evaluate_model(policy_net: \u0026PolicyNet, value_net: \u0026ValueNet, num_simulations: usize) {    let mut scores = Vec::new();\n\n    for _ in 0..10 {\n        let mut deck = create_deck();\n        let mut plateau = create_plateau_empty();\n        let total_turns = 19; // The number of moves in the game\n        let mut current_turn = 0;\n        while !is_plateau_full(\u0026plateau) {\n            let tile_index = rng().random_range(0..deck.tiles.len());\n            let chosen_tile = deck.tiles[tile_index];\n            let game_result = mcts_find_best_position_for_tile_with_nn(\n                \u0026mut plateau,\n                \u0026mut deck,\n                chosen_tile,\n                policy_net,\n                value_net,\n                num_simulations,\n                current_turn,\n                total_turns,\n            );\n            let best_position = game_result.best_position;\n            plateau.tiles[best_position] = chosen_tile;\n            deck = replace_tile_in_deck(\u0026deck, \u0026chosen_tile);\n            current_turn += 1; // Increment turn counter each time a tile is placed\n        }\n\n        let game_score = result(\u0026plateau);\n        scores.push(game_score);\n    }\n\n    let avg_score: f64 = scores.iter().copied().sum::\u003ci32\u003e() as f64 / scores.len() as f64;    // **Stop ping task**\n}","traces":[{"line":10,"address":[4021436,4020038,4019840,4019875,4021364],"length":1,"stats":{"Line":0}},{"line":12,"address":[4020085,4020168],"length":1,"stats":{"Line":0}},{"line":13,"address":[4020233],"length":1,"stats":{"Line":0}},{"line":14,"address":[4020528],"length":1,"stats":{"Line":0}},{"line":15,"address":[4019863],"length":1,"stats":{"Line":0}},{"line":16,"address":[4020575],"length":1,"stats":{"Line":0}},{"line":17,"address":[4020595,4020647],"length":1,"stats":{"Line":0}},{"line":18,"address":[4020653,4020696],"length":1,"stats":{"Line":0}},{"line":19,"address":[4020841],"length":1,"stats":{"Line":0}},{"line":27,"address":[4020918],"length":1,"stats":{"Line":0}},{"line":30,"address":[4021013],"length":1,"stats":{"Line":0}},{"line":31,"address":[4021029,4021101],"length":1,"stats":{"Line":0}},{"line":32,"address":[4021146,4021168],"length":1,"stats":{"Line":0}},{"line":33,"address":[4021291,4021344],"length":1,"stats":{"Line":0}},{"line":36,"address":[4020677,4021374],"length":1,"stats":{"Line":0}},{"line":37,"address":[4021381],"length":1,"stats":{"Line":0}},{"line":40,"address":[4020251],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":17},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","training","mod.rs"],"content":"pub mod websocket;\npub mod evaluator;\npub mod session;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","training","session.rs"],"content":"use crate::data::append_result::append_to_results_file;\nuse crate::data::load_data::load_game_data;\nuse crate::data::save_data::save_game_data;\nuse crate::game::create_deck::create_deck;\nuse crate::game::plateau::create_plateau_empty;\nuse crate::game::plateau_is_full::is_plateau_full;\nuse crate::game::remove_tile_from_deck::replace_tile_in_deck;\nuse crate::game::tile::Tile;\nuse crate::mcts::algorithm::mcts_find_best_position_for_tile_with_nn;\nuse crate::mcts::mcts_result::MCTSResult;\nuse crate::neural::policy_value_net::{PolicyNet, ValueNet};\nuse crate::neural::training::trainer::train_network_with_game_data;\nuse crate::scoring::scoring::result;\nuse crate::training::evaluator::evaluate_model;\nuse crate::training::websocket::{send_websocket_message};\nuse crate::utils::image::generate_tile_image_names;\nuse futures_util::{StreamExt};\nuse rand::{rng, Rng};\nuse std::collections::HashMap;\nuse std::sync::Arc;\nuse tch::nn;\nuse tch::nn::Optimizer;\nuse tokio::net::TcpListener;\nuse tokio_tungstenite::accept_async;\n\n/// Lance une session MCTS vs Humain - Version refactoris√©e avec send_websocket_message\npub async fn train_and_evaluate(\n    vs_policy: \u0026nn::VarStore,\n    vs_value: \u0026nn::VarStore,\n    policy_net: \u0026mut PolicyNet,\n    value_net: \u0026mut ValueNet,\n    optimizer_policy: \u0026mut Optimizer,\n    optimizer_value: \u0026mut Optimizer,\n    num_games: usize,\n    num_simulations: usize,\n    evaluation_interval: usize,\n    listener: Arc\u003cTcpListener\u003e,\n) {\n    let mut total_score = 0;\n    let mut games_played = 0;\n    let results_file = \"results.csv\";\n\n    while let Ok((stream, _)) = listener.accept().await {\n        let ws_stream = accept_async(stream)\n            .await\n            .expect(\"Failed to accept WebSocket\");\n        let (mut write, _) = ws_stream.split();\n        let mut scores_by_position: HashMap\u003cusize, Vec\u003ci32\u003e\u003e = HashMap::new();\n        let mut scores = Vec::new(); // Stocke les scores\n        let evaluation_interval_average = 10;\n\n        while games_played \u003c num_games {\n            let mut batch_games_played = 0; // Tracks games processed in this evaluation interval\n            let max_memory_size = 1000; // Store last 500 games\n\n            for game in 0..evaluation_interval {\n                let mut deck = create_deck();\n                let mut plateau = create_plateau_empty();\n                let mut game_data = Vec::new();\n                let mut first_move: Option\u003c(usize, Tile)\u003e = None;\n                let total_turns = 19; // The number of moves in the game\n                let mut current_turn = 0;\n\n                while !is_plateau_full(\u0026plateau) {\n                    let tile_index = rng().random_range(0..deck.tiles.len());\n                    let chosen_tile = deck.tiles[tile_index];\n\n                    // ‚úÖ Send preview before placement - REFACTORIS√â\n                    let chosen_tile_image = format!(\n                        \"../image/{}{}{}.png\",\n                        chosen_tile.0, chosen_tile.1, chosen_tile.2\n                    );\n                    let payload = serde_json::json!({\n                        \"next_tile\": chosen_tile_image,\n                        \"plateau_tiles\": generate_tile_image_names(\u0026plateau.tiles)\n                    });\n\n                    // üîÑ REMPLACEMENT: write.send() ‚Üí send_websocket_message()\n                    if let Err(e) = send_websocket_message(\n                        \u0026mut write,\n                        payload.to_string(),\n                        \u0026listener\n                    ).await {\n                        log::error!(\"Failed to send tile preview: {}\", e);\n                        break;\n                    }\n\n                    let game_result = mcts_find_best_position_for_tile_with_nn(\n                        \u0026mut plateau,\n                        \u0026mut deck,\n                        chosen_tile,\n                        policy_net,\n                        value_net,\n                        num_simulations,\n                        current_turn,\n                        total_turns,\n                    );\n\n                    let best_position = game_result.best_position;\n                    if first_move.is_none() {\n                        first_move = Some((best_position, chosen_tile));\n                    }\n                    plateau.tiles[best_position] = chosen_tile;\n                    deck = replace_tile_in_deck(\u0026deck, \u0026chosen_tile);\n\n                    // ‚úÖ Send score to client - REFACTORIS√â\n                    let current_score = result(\u0026plateau);\n                    let score_payload = serde_json::json!({\n                        \"type\": \"score_update\",\n                        \"current_score\": current_score,\n                    });\n\n                    // üîÑ REMPLACEMENT: Logique complexe de reconnexion ‚Üí send_websocket_message()\n                    if let Err(e) = send_websocket_message(\n                        \u0026mut write,\n                        score_payload.to_string(),\n                        \u0026listener\n                    ).await {\n                        log::error!(\"Failed to send score update: {}\", e);\n                        break;\n                    }\n\n                    game_data.push(game_result); // Store training data\n\n                    // ‚úÖ Send updated plateau state - REFACTORIS√â\n                    let payload_after_placement = serde_json::json!({\n                        \"next_tile\": null, // Clear preview\n                        \"plateau_tiles\": generate_tile_image_names(\u0026plateau.tiles) // new updated state\n                    });\n\n                    // üîÑ REMPLACEMENT: Logique complexe de reconnexion ‚Üí send_websocket_message()\n                    if let Err(e) = send_websocket_message(\n                        \u0026mut write,\n                        payload_after_placement.to_string(),\n                        \u0026listener\n                    ).await {\n                        log::error!(\"Failed to send plateau update: {}\", e);\n                        break;\n                    }\n\n                    current_turn += 1; // Increment turn counter each time a tile is placed\n                }\n\n                let final_score = result(\u0026plateau);\n\n                if let Some((position, _)) = first_move {\n                    scores_by_position\n                        .entry(position)\n                        .or_insert_with(Vec::new)\n                        .push(final_score);\n                }\n\n                let mut batch_game_data = Vec::new();\n\n                // Prioritized historical data\n                let prioritized_data: Vec\u003cMCTSResult\u003e = load_game_data(\"game_data\")\n                    .into_iter()\n                    .filter(|r| r.subscore \u003e 100.0) // Only select high-score games\n                    .take(50) // Limit to 50 samples to prevent overfitting\n                    .collect();\n\n                // Add historical data to batch\n                batch_game_data.extend(prioritized_data);\n\n                // Add current game's data to batch\n                batch_game_data.extend(game_data.iter().map(|result| MCTSResult {\n                    best_position: result.best_position,\n                    board_tensor: result.board_tensor.shallow_clone(),\n                    subscore: result.subscore,\n                }));\n\n                // Keep only last max_memory_size experiences\n                if batch_game_data.len() \u003e max_memory_size {\n                    let to_remove = batch_game_data.len() - max_memory_size;\n                    batch_game_data.drain(0..to_remove); // Remove oldest data\n                }\n\n                // Train in batches\n                let batch_size = 10;\n                for batch in batch_game_data.chunks(batch_size) {\n                    train_network_with_game_data(\n                        \u0026vs_policy,\n                        \u0026vs_value,\n                        batch, // Use each batch directly\n                        final_score.into(),\n                        policy_net,\n                        value_net,\n                        optimizer_policy,\n                        optimizer_value,\n                    );\n                }                scores.push(final_score);\n\n                // Update batch-specific counters\n                batch_games_played += 1;\n                total_score += final_score;\n\n                if game % evaluation_interval_average == 0 \u0026\u0026 game != 0 {\n                    let moyenne: f64 = scores.iter().sum::\u003ci32\u003e() as f64 / scores.len() as f64;\n                    // üîÑ REMPLACEMENT: write.send().await.unwrap() ‚Üí send_websocket_message()\n                    let result_message = format!(\"GAME_RESULT:{}\", moyenne);\n                    if let Err(e) = send_websocket_message(\n                        \u0026mut write,\n                        result_message,\n                        \u0026listener\n                    ).await {\n                        log::error!(\"Failed to send game result: {}\", e);\n                    }\n                }\n\n                // Save current game data for future training\n                save_game_data(\"game_data\", game_data);\n            }\n\n            // Update main game counters\n            games_played += batch_games_played;\n\n            // Append results to the file\n            let avg_score = total_score as f64 / games_played as f64;\n            append_to_results_file(results_file, avg_score);\n\n            // Calculate and display averages\n            let mut averages: Vec\u003c(usize, f64)\u003e = scores_by_position\n                .iter()\n                .map(|(position, scores)| {\n                    let average_score: f64 =\n                        scores.iter().sum::\u003ci32\u003e() as f64 / scores.len() as f64;\n                    (*position, average_score)\n                })\n                .collect();\n\n            averages.sort_by(|a, b| b.1.partial_cmp(\u0026a.1).unwrap_or(std::cmp::Ordering::Equal));\n\n            log::info!(\"\\n--- Average Scores by First Position (Sorted) ---\");\n            for (position, average_score) in averages {\n                log::info!(\n                    \"Position: {}, Average Score: {:.2}\",\n                    position,\n                    average_score\n                );\n            }\n\n            // Evaluate model after each interval\n            evaluate_model(policy_net, value_net, num_simulations).await;\n\n         \n            let model_path = \"model_weights\";\n            // Save model weights\n            if let Err(e) = policy_net.save_model(vs_policy, \"model_weights/policy/policy.params\") {\n                log::error!(\"Error saving PolicyNet weights: {:?}\", e);\n            }\n            if let Err(e) = value_net.save_model(vs_value, \"model_weights/value/value.params\") {\n                log::error!(\"Error saving ValueNet weights: {:?}\", e);\n            }\n        }\n        break; // Exit after handling one connection\n    }\n}\n","traces":[{"line":27,"address":[3826208],"length":1,"stats":{"Line":0}},{"line":39,"address":[5237529],"length":1,"stats":{"Line":0}},{"line":40,"address":[5237547],"length":1,"stats":{"Line":0}},{"line":41,"address":[5237566],"length":1,"stats":{"Line":0}},{"line":43,"address":[3669266],"length":1,"stats":{"Line":0}},{"line":44,"address":[5238486,5238580,5238867,5238891],"length":1,"stats":{"Line":0}},{"line":45,"address":[5238869,5238573,5237677,5238693,5238613],"length":1,"stats":{"Line":0}},{"line":47,"address":[5238949],"length":1,"stats":{"Line":0}},{"line":48,"address":[5239065],"length":1,"stats":{"Line":0}},{"line":49,"address":[5239087],"length":1,"stats":{"Line":0}},{"line":50,"address":[5239153],"length":1,"stats":{"Line":0}},{"line":52,"address":[5239172,5241017],"length":1,"stats":{"Line":0}},{"line":53,"address":[5241085],"length":1,"stats":{"Line":0}},{"line":54,"address":[5241104],"length":1,"stats":{"Line":0}},{"line":56,"address":[5241123,5241471,5241493],"length":1,"stats":{"Line":0}},{"line":57,"address":[5241604],"length":1,"stats":{"Line":0}},{"line":58,"address":[5243366],"length":1,"stats":{"Line":0}},{"line":59,"address":[5243435],"length":1,"stats":{"Line":0}},{"line":60,"address":[5243516],"length":1,"stats":{"Line":0}},{"line":61,"address":[5243546],"length":1,"stats":{"Line":0}},{"line":62,"address":[5243565],"length":1,"stats":{"Line":0}},{"line":64,"address":[5243668,5243584],"length":1,"stats":{"Line":0}},{"line":65,"address":[5243733,5243674],"length":1,"stats":{"Line":0}},{"line":66,"address":[5243900],"length":1,"stats":{"Line":0}},{"line":69,"address":[5243972],"length":1,"stats":{"Line":0}},{"line":73,"address":[5250906,5244221,5244783,5244614,5244790,5244317,5244279,5244390,5244692],"length":1,"stats":{"Line":0}},{"line":75,"address":[5244654,5244760],"length":1,"stats":{"Line":0}},{"line":80,"address":[5245066],"length":1,"stats":{"Line":0}},{"line":81,"address":[5245089,5245143],"length":1,"stats":{"Line":0}},{"line":82,"address":[5245151],"length":1,"stats":{"Line":0}},{"line":84,"address":[5245762,5245648,5245790],"length":1,"stats":{"Line":0}},{"line":89,"address":[5246096],"length":1,"stats":{"Line":0}},{"line":90,"address":[5246114],"length":1,"stats":{"Line":0}},{"line":91,"address":[5246124],"length":1,"stats":{"Line":0}},{"line":92,"address":[5246152],"length":1,"stats":{"Line":0}},{"line":93,"address":[5246167],"length":1,"stats":{"Line":0}},{"line":94,"address":[5246174],"length":1,"stats":{"Line":0}},{"line":95,"address":[5246181],"length":1,"stats":{"Line":0}},{"line":96,"address":[5246188],"length":1,"stats":{"Line":0}},{"line":99,"address":[5246288],"length":1,"stats":{"Line":0}},{"line":100,"address":[5246319,5246396,5246683],"length":1,"stats":{"Line":0}},{"line":101,"address":[5246494],"length":1,"stats":{"Line":0}},{"line":103,"address":[5246410,5246696],"length":1,"stats":{"Line":0}},{"line":104,"address":[5246717,5246779],"length":1,"stats":{"Line":0}},{"line":107,"address":[5246897],"length":1,"stats":{"Line":0}},{"line":108,"address":[5246968,5247013,5250795,5247305,5247078,5247375],"length":1,"stats":{"Line":0}},{"line":115,"address":[5247585],"length":1,"stats":{"Line":0}},{"line":116,"address":[5247608,5247662],"length":1,"stats":{"Line":0}},{"line":117,"address":[5247670],"length":1,"stats":{"Line":0}},{"line":119,"address":[5248167,5248281,5248309],"length":1,"stats":{"Line":0}},{"line":123,"address":[5248615],"length":1,"stats":{"Line":0}},{"line":126,"address":[5249080,5250718,5248901,5248708,5248982,5249073],"length":1,"stats":{"Line":0}},{"line":128,"address":[5248944,5249050],"length":1,"stats":{"Line":0}},{"line":133,"address":[5249365],"length":1,"stats":{"Line":0}},{"line":134,"address":[5249388,5249445],"length":1,"stats":{"Line":0}},{"line":135,"address":[5249453],"length":1,"stats":{"Line":0}},{"line":137,"address":[5250095,5249953,5250067],"length":1,"stats":{"Line":0}},{"line":141,"address":[5250492,5250575],"length":1,"stats":{"Line":0}},{"line":144,"address":[5243693,5250980],"length":1,"stats":{"Line":0}},{"line":146,"address":[5250987],"length":1,"stats":{"Line":0}},{"line":147,"address":[5251024,5251084],"length":1,"stats":{"Line":0}},{"line":153,"address":[5251054],"length":1,"stats":{"Line":0}},{"line":156,"address":[5251220,5251130],"length":1,"stats":{"Line":0}},{"line":158,"address":[5254138,5254128],"length":1,"stats":{"Line":0}},{"line":163,"address":[5251301],"length":1,"stats":{"Line":0}},{"line":166,"address":[5254176,5254256,5251338],"length":1,"stats":{"Line":0}},{"line":167,"address":[5254213],"length":1,"stats":{"Line":0}},{"line":168,"address":[5254222],"length":1,"stats":{"Line":0}},{"line":169,"address":[5254251],"length":1,"stats":{"Line":0}},{"line":173,"address":[5251509],"length":1,"stats":{"Line":0}},{"line":174,"address":[5251605,5251727],"length":1,"stats":{"Line":0}},{"line":175,"address":[5251756,5251693],"length":1,"stats":{"Line":0}},{"line":179,"address":[5237049],"length":1,"stats":{"Line":0}},{"line":180,"address":[5251782,5251564],"length":1,"stats":{"Line":0}},{"line":182,"address":[5252029],"length":1,"stats":{"Line":0}},{"line":183,"address":[5252052],"length":1,"stats":{"Line":0}},{"line":185,"address":[5252067],"length":1,"stats":{"Line":0}},{"line":186,"address":[5253988],"length":1,"stats":{"Line":0}},{"line":187,"address":[5254003],"length":1,"stats":{"Line":0}},{"line":188,"address":[5254010],"length":1,"stats":{"Line":0}},{"line":189,"address":[5254017],"length":1,"stats":{"Line":0}},{"line":191,"address":[5252100],"length":1,"stats":{"Line":0}},{"line":194,"address":[5252223,5252129],"length":1,"stats":{"Line":0}},{"line":195,"address":[5252319,5252193,5252251],"length":1,"stats":{"Line":0}},{"line":197,"address":[5252356,5253807,5252265],"length":1,"stats":{"Line":0}},{"line":198,"address":[5252491],"length":1,"stats":{"Line":0}},{"line":200,"address":[5252690],"length":1,"stats":{"Line":0}},{"line":202,"address":[5252824],"length":1,"stats":{"Line":0}},{"line":203,"address":[5252841],"length":1,"stats":{"Line":0}},{"line":204,"address":[5252881],"length":1,"stats":{"Line":0}},{"line":206,"address":[5253372,5253527,5253502],"length":1,"stats":{"Line":0}},{"line":211,"address":[5252408],"length":1,"stats":{"Line":0}},{"line":215,"address":[5241629,5241791],"length":1,"stats":{"Line":0}},{"line":218,"address":[5241697],"length":1,"stats":{"Line":0}},{"line":219,"address":[5241768],"length":1,"stats":{"Line":0}},{"line":222,"address":[5241811,5241899],"length":1,"stats":{"Line":0}},{"line":224,"address":[5254288,5254330],"length":1,"stats":{"Line":0}},{"line":226,"address":[5254340],"length":1,"stats":{"Line":0}},{"line":227,"address":[5254455],"length":1,"stats":{"Line":0}},{"line":231,"address":[5254464,5254494,5241951],"length":1,"stats":{"Line":0}},{"line":233,"address":[5242012,5242149],"length":1,"stats":{"Line":0}},{"line":234,"address":[5242070,5242512,5242385],"length":1,"stats":{"Line":0}},{"line":235,"address":[5242770,5242560],"length":1,"stats":{"Line":0}},{"line":243,"address":[3669396],"length":1,"stats":{"Line":0}},{"line":246,"address":[5237061],"length":1,"stats":{"Line":0}},{"line":248,"address":[5239664,5239582],"length":1,"stats":{"Line":0}},{"line":249,"address":[5239948,5239923,5239781],"length":1,"stats":{"Line":0}},{"line":251,"address":[5240361,5240250],"length":1,"stats":{"Line":0}},{"line":252,"address":[5240635,5240663,5240478],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":109},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","training","websocket.rs"],"content":"use futures_util::stream::SplitSink;\nuse futures_util::{SinkExt, StreamExt};\nuse tokio::net::TcpListener;\nuse tokio_tungstenite::tungstenite::Message;\nuse tokio_tungstenite::{accept_async, WebSocketStream};\n\npub async fn reconnect_websocket(\n    listener: \u0026TcpListener,\n) -\u003e Option\u003cSplitSink\u003cWebSocketStream\u003ctokio::net::TcpStream\u003e, Message\u003e\u003e {\n    match listener.accept().await {\n        Ok((stream, _)) =\u003e {            let ws_stream = accept_async(stream)\n                .await\n                .expect(\"Failed to accept WebSocket\");\n            let (write, _) = ws_stream.split();\n            Some(write)\n        }\n        Err(e) =\u003e {\n            log::error!(\"Error while reconnecting WebSocket: {:?}\", e);\n            None\n        }\n    }\n}\n/// Envoie un message via WebSocket avec gestion d'erreur\npub async fn send_websocket_message(\n    write: \u0026mut SplitSink\u003cWebSocketStream\u003ctokio::net::TcpStream\u003e, Message\u003e,\n    message: String,\n    listener: \u0026TcpListener,\n) -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    if let Err(e) = write.send(Message::Text(message.clone())).await {\n        log::error!(\"WebSocket error: {:?}. Attempting to reconnect...\", e);\n\n        if let Some(new_write) = reconnect_websocket(listener).await {\n            *write = new_write;\n            write.send(Message::Text(message)).await?;\n        } else {\n            return Err(\"Failed to reconnect WebSocket\".into());\n        }\n    }\n    Ok(())\n}","traces":[{"line":7,"address":[3464368],"length":1,"stats":{"Line":0}},{"line":10,"address":[3163380,3163498,3163426,3163597],"length":1,"stats":{"Line":0}},{"line":11,"address":[3163998,3164703,3164085,3164721],"length":1,"stats":{"Line":0}},{"line":12,"address":[3164705,3163441,3164078,3164112,3164538],"length":1,"stats":{"Line":0}},{"line":14,"address":[3164779],"length":1,"stats":{"Line":0}},{"line":15,"address":[3164889],"length":1,"stats":{"Line":0}},{"line":17,"address":[3163936],"length":1,"stats":{"Line":0}},{"line":18,"address":[3164230,3164184,3163953],"length":1,"stats":{"Line":0}},{"line":19,"address":[3164200],"length":1,"stats":{"Line":0}},{"line":24,"address":[3464384],"length":1,"stats":{"Line":0}},{"line":29,"address":[3165618,3165234,3165436,3165310],"length":1,"stats":{"Line":0}},{"line":30,"address":[3165961,3166099,3166135],"length":1,"stats":{"Line":0}},{"line":32,"address":[3165331,3166462,3166535,3166105],"length":1,"stats":{"Line":0}},{"line":33,"address":[3167001,3166943],"length":1,"stats":{"Line":0}},{"line":34,"address":[3167105,3165352,3167464,3168102,3167318],"length":1,"stats":{"Line":0}},{"line":36,"address":[3167395,3166962],"length":1,"stats":{"Line":0}},{"line":39,"address":[3167863],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":17},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","utils","image.rs"],"content":"use crate::game::tile::Tile;\n\npub fn generate_tile_image_names(tiles: \u0026[Tile]) -\u003e Vec\u003cString\u003e {\n    tiles\n        .iter()\n        .map(|tile| format!(\"../image/{}{}{}.png\", tile.0, tile.1, tile.2))\n        .collect()\n}","traces":[{"line":3,"address":[5542656],"length":1,"stats":{"Line":0}},{"line":4,"address":[5542706],"length":1,"stats":{"Line":0}},{"line":6,"address":[5216814,5216768],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":3},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","utils","mod.rs"],"content":"pub mod random_index;\npub mod image;","traces":[],"covered":0,"coverable":0},{"path":["/","home","jcgouleau","IdeaProjects","RustProject","take_it_easy","src","utils","random_index.rs"],"content":"pub fn random_index(max: usize) -\u003e usize {\n    use rand::Rng;\n    let mut rng = rand::rng();\n    rng.random_range(0..max)\n}","traces":[{"line":1,"address":[5014176,5014290,5014296],"length":1,"stats":{"Line":0}},{"line":3,"address":[5014190],"length":1,"stats":{"Line":0}},{"line":4,"address":[5014209],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":3}]};
        var previousData = null;
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, e('a', null, pathToString(file.path))),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('pre', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('code', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>